function launchFullscreen(a,b){a.requestFullscreen?a.requestFullscreen(b):a.mozRequestFullScreen?a.mozRequestFullScreen(b):a.webkitRequestFullscreen?a.webkitRequestFullscreen(b):a.msRequestFullscreen&&a.msRequestFullscreen(b)}function exitFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function inFullscreen(){return"webkitIsFullScreen"in document?document.webkitIsFullScreen:!!(document.mozFullScreenElement||document.msFullscreenElement||document.fullscreenEnabled||document.querySelector(".viewer-fill-browser"))}function fullscreenElement(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function isFullscreenAvailable(a){return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullscreen||a.msRequestFullscreen}function getAndroidVersion(a){var a=a||navigator.userAgent,b=a.match(/Android\s([0-9\.]*)/);return b?b[1]:!1}function isTouchDevice(){return"ontouchstart"in window}function isIOSDevice(){return/ip(ad|hone|od)/.test(navigator.userAgent.toLowerCase())}function isAndroidDevice(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")}function isMobileDevice(){return isIOSDevice()||isAndroidDevice()}function isSafari(){var a=navigator.userAgent.toLowerCase();return-1!==a.indexOf("safari")&&-1===a.indexOf("chrome")}function detectWebGL(){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),b=["webgl","experimental-webgl","moz-webgl","webkit-3d"],c=!1,d=0;4>d;d++)try{if(c=a.getContext(b[d]),c=rescueFromPolymer(c),c&&"function"==typeof c.getParameter)return 1}catch(e){}return 0}return-1}function touchStartToClick(a){a.preventDefault(),a.stopPropagation(),a.target.click()}function init_three_dds_loader(){THREE.DDSLoader=function(){this._parser=THREE.DDSLoader.parse},THREE.DDSLoader.prototype=Object.create(THREE.CompressedTextureLoader.prototype),THREE.DDSLoader.prototype.constructor=THREE.DDSLoader,THREE.DDSLoader.parse=function(a,b){function c(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}function d(a){return String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)}function e(a,b,c,d){for(var e=c*d*4,f=new Uint8Array(a,b,e),g=new Uint8Array(e),h=0,i=0,j=0;d>j;j++)for(var k=0;c>k;k++){var l=f[i];i++;var m=f[i];i++;var n=f[i];i++;var o=f[i];i++,g[h]=n,h++,g[h]=m,h++,g[h]=l,h++,g[h]=o,h++}return g}var f={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},g=542327876,h=512,i=4,j=c("DXT1"),k=c("DXT3"),l=c("DXT5"),m=31,n=0,o=1,p=3,q=4,r=7,s=20,t=21,u=22,v=23,w=24,x=25,y=26,z=28,A=new Int32Array(a,0,m);if(A[n]!==g)return console.error("THREE.DDSLoader.parse: Invalid magic number in DDS header."),f;if(!A[s]&i)return console.error("THREE.DDSLoader.parse: Unsupported format, must contain a FourCC code."),f;var B,C=A[t],D=!1;switch(C){case j:B=8,f.format=THREE.RGB_S3TC_DXT1_Format;break;case k:B=16,f.format=THREE.RGBA_S3TC_DXT3_Format;break;case l:B=16,f.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==A[u]&&16711680&A[v]&&65280&A[w]&&255&A[x]&&4278190080&A[y]))return console.error("THREE.DDSLoader.parse: Unsupported FourCC code ",d(C)),f;D=!0,B=64,f.format=THREE.RGBAFormat}f.mipmapCount=1,A[r]>0&&b!==!1&&(f.mipmapCount=Math.max(1,A[r])),f.isCubemap=A[z]&h?!0:!1,f.width=A[q],f.height=A[p];for(var E=A[o]+4,F=f.width,G=f.height,H=f.isCubemap?6:1,I=0;H>I;I++){for(var J=0;J<f.mipmapCount;J++){if(D)var K=e(a,E,F,G),L=K.length;else var L=Math.max(4,F)/4*Math.max(4,G)/4*B,K=new Uint8Array(a,E,L);var M={data:K,width:F,height:G};f.mipmaps.push(M),E+=L,F=Math.max(.5*F,1),G=Math.max(.5*G,1)}F=f.width,G=f.height}return f}}function trace(a){"\n"==a[a.length-1]&&(a=a.substring(0,a.length-1)),console.log((performance.now()/1e3).toFixed(3)+": "+a)}function init_three_triangulator(){"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(a,b,c){var d=b>a?a+":"+b:b+":"+a;return c+":"+d}function b(b,c,d,e,f,g,h){this.pt1=b,this.pt2=c,this.p1=-1,this.p2=-1,this.eid1=a(d,e,h),this.eid2=a(f,g,h)}function c(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function d(a,b,c){this.pts=a,this.edges=b,this.bbox=c,this.pipResult=!1}function e(a,b){this.edges=a,this.bbox=b,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function f(a){this.indices=[],this.cset=a;var b=this.pts=a.pts;this.intervalTree=new d(a.pts,a.edges,a.bbox),this.intervalTree.build();for(var c=0;c<b.length;c++)b[c].id=c;var e=new lmv_poly2tri.SweepContext([]);if(e.points_=b.slice(),a.contours)for(var f=this.cset.contours,g=0;g<f.length;g++){for(var h=f[g],i=h[0]!==h[h.length-1],j=[],k=0;k<h.length-1;k++)j.push(b[h[k]]);e.initEdges(j,i)}else for(var l=this.cset.edges,c=0;c<l.length;c++){var m=l[c];if(m.p1!=m.p2){var n=[b[m.p1],b[m.p2]];e.initEdges(n,!0)}}this.triangulate(e),this.processResult(e)}return d.prototype.splitNode=function(a){if(!(a.bbox.min.y>=a.bbox.max.y||a.node_edges.length<3)){var b=.5*(a.bbox.min.y+a.bbox.max.y);a.left=new c,a.right=new c;for(var d=this.pts,e=a.node_edges,f=[],g=new THREE.Vector2,h=0;h<e.length;h++){var i=this.edges[e[h]],j=d[i.p1].y,k=d[i.p2].y;if(j>k){var l=j;j=k,k=l}var m=null;b>k?(a.left.node_edges.push(e[h]),m=a.left.bbox):j>b?(a.right.node_edges.push(e[h]),m=a.right.bbox):f.push(e[h]),m&&(g.set(d[i.p1].x,d[i.p1].y),m.expandByPoint(g),g.set(d[i.p2].x,d[i.p2].y),m.expandByPoint(g))}a.node_edges=f,a.left.node_edges.length&&this.splitNode(a.left),a.right.node_edges.length&&this.splitNode(a.right)}},d.prototype.build=function(){this.root=new c;for(var a=this.root.node_edges,b=0;b<this.edges.length;b++)a.push(b);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},d.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var d=this.pts,e=a.node_edges,f=0,g=e.length;g>f;f++){var h=this.edges[e[f]],i=d[h.p1],j=i.x,k=i.y,l=k>=c,m=d[h.p2],n=m.x,o=m.y,p=o>=c;l!=p&&(o-c)*(j-n)>=(n-b)*(k-o)==p&&(this.pipResult=!this.pipResult)}var q=a.left;q&&q.bbox.min.y<=c&&q.bbox.max.y>=c&&this.pointInPolygonRec(q,b,c);var r=a.right;r&&r.bbox.min.y<=c&&r.bbox.max.y>=c&&this.pointInPolygonRec(r,b,c)},d.prototype.pointInPolygon=function(a,b){return this.pipResult=!1,this.pointInPolygonRec(this.root,a,b),this.pipResult},e.prototype.getPointIndex=function(a,b,c){var d=this.idmap[c];if(void 0!==d)return d;var e,f=0|a*this.scale,g=0|b*this.scale,h=this.xymap[f];return void 0===h?(this.xymap[f]=h={},e=void 0):e=h[g],void 0===e&&(h[g]=e=this.pts.length,this.idmap[c]=e,this.pts.push({x:a,y:b})),e},e.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1),b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}},e.prototype.sanitizeEdges=function(){for(var a={},b=[],c=0,d=this.edges.length;d>c;c++){var e=this.edges[c];if(e.p1!==e.p2){var f=Math.min(e.p1,e.p2)+":"+Math.max(e.p1,e.p2);a[f]!==!0&&(a[f]=!0,b.push(e))}}this.edges=b},e.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var d=[];for(var e in a)if(2!==a[e].length){stderr("Incomplete edge table");break}for(;;){var f=void 0;for(var e in a)if(a[e].length>1){f=e;break}if(!f)for(var e in a)if(a[e].length>0){f=e;break}if(!f)break;var g=-1,h=parseInt(f),i=a[f];for(d.push(h);i&&i.length;){var j=i.shift();if(j===g&&(j=i.shift()),void 0===j){delete a[h];break}d.push(j),0==i.length?delete a[h]:i[0]===g&&delete a[h],g=h,h=j,i=a[j]}d.length&&(this.contours.push(d),d=[])}for(var k=[],b=0;b<this.contours.length;b++){var l=this.contours[b];l[0]!==l[l.length-1]&&k.push(l)}if(k.length)for(var m=!0;m;){m=!1;for(var n={},o=this.contours,b=0;b<o.length;b++){var l=o[b],p=l[0],q=l[l.length-1];p!==q&&(n[p]?n[p].push(-b-1):n[p]=[-b-1],n[q]?n[q].push(b):n[q]=[b])}for(var e in n){var r=n[e];if(2==r.length){var s=void 0;if(r[0]<0&&r[1]<0){var t=-r[0]-1,u=-r[1]-1;o[u].shift(),Array.prototype.push.apply(o[t].reverse(),o[u]),s=u}if(r[0]<0&&r[1]>0){var t=-r[0]-1,u=r[1];o[u].pop(),Array.prototype.push.apply(o[u],o[t]),s=t}if(r[0]>0&&r[1]<0){var t=r[0],u=-r[1]-1;o[t].pop(),Array.prototype.push.apply(o[t],o[u]),s=u}if(r[0]>0&&r[1]>0){var t=r[0],u=r[1];o[t].pop(),Array.prototype.push.apply(o[t],o[u].reverse()),s=u}void 0!==s&&(o.splice(s,1),m=!0);break}}}},f.prototype.triangulate=function(a){try{a.triangulate()}catch(b){}},f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],d=c.points_[0],e=c.points_[1],f=c.points_[2];void 0!==d.id&&void 0!==e.id&&void 0!==f.id&&this.filterFace(d.id,e.id,f.id)}},f.prototype.pointInEdgeList=function(a,b){for(var c,d,e,f,g,h,i=this.cset.pts,j=this.cset.edges,k=!1,l=0,m=j.length;m>l;++l){var n=j[l];e=i[n.p1].x,f=i[n.p1].y,c=f>=b,g=i[n.p2].x,h=i[n.p2].y,d=h>=b,c!=d&&(h-b)*(e-g)>=(g-a)*(f-h)==d&&(k=!k)}return k},f.prototype.pointInContour=function(a,b,c){var d,e,f,g,h,i,j=!1,k=this.cset.pts;f=k[c[c.length-1]].x,g=k[c[c.length-1]].y,d=g>=b;for(var l=0,m=c.length;m>l;++l)h=k[c[l]].x,i=k[c[l]].y,e=i>=b,d!=e&&(i-b)*(f-h)>=(h-a)*(g-i)==e&&(j=!j),d=e,f=h,g=i;return j},f.prototype.pointInPolygon=function(a,b){for(var c=!1,d=0;d<this.cset.contours.length;d++)this.pointInContour(a,b,this.cset.contours[d])&&(c=!c);return c},f.prototype.filterFace=function(a,b,c){var d=this.pts[a],e=this.pts[b],f=this.pts[c],g=(d.x+e.x+f.x)/3,h=(d.y+e.y+f.y)/3;if(this.intervalTree.pointInPolygon(g,h)){var i=e.x-d.x,j=e.y-d.y,k=f.x-d.x,l=f.y-d.y,m=i*l-k*j;m>0?this.indices.push(a,b,c):this.indices.push(a,c,b)}},{TriangulatedSurface:f,ContourSet:e,Edge:b}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a){return Math.abs(a)<i}function b(b,c,d,e,f){var g=k.subVectors(d,c),h=b.normal.dot(g);if(a(h))return e.copy(c),f.copy(d),2;h=1/h;var j=-(c.dot(b.normal)*h+b.constant*h);if(-i>j||j>1+i)return 0;var l=g.multiplyScalar(j).add(c);return e.copy(l),1}function c(a,c,d,e,f,g,h,k,n){var o=a.distanceToPoint(c),p=a.distanceToPoint(d),q=a.distanceToPoint(e);if(-i>o&&-i>p&&-i>q)return null;if(o>i&&p>i&&q>i)return null;var r=Math.sign(o),s=Math.sign(p),t=Math.sign(q);if(0===r&&0===s&&0===t)return null;var u,v,w,x,y,z;if(r!==s){var A=b(a,c,d,l,m);if(2==A)return void k.push(new j(c.clone(),d.clone(),f,f,g,g,n));1==A?(w=f,x=g,u=l.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(s!==t){var A=b(a,d,e,l,m);if(2==A)return void k.push(new j(d.clone(),e.clone(),g,g,h,h,n));1==A?u?l.distanceTo(u)>i&&(y=g,z=h,v=l.clone()):(w=g,x=h,u=l.clone()):console.warn("Unexpected zero intersections where at least one was expected")}if(t!==r){var A=b(a,e,c,l,m);if(2==A)return void k.push(new j(e.clone(),c.clone(),h,h,f,f,n));1==A?u?l.distanceTo(u)>i&&(y=h,z=f,v=l.clone()):console.warn("Unexpected single intersection point"):console.warn("Unexpected zero intersections where at least one was expected")}u&&v?k.push(new j(u,v,w,x,y,z,n)):console.warn("Unexpected one intersection where two were expected")}function d(a,b){n.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(n),d=Math.sign(c);n.set(b.min.x,b.min.y,b.max.z);var e=a.distanceToPoint(n);return Math.sign(e)!==d?!0:(n.set(b.min.x,b.max.y,b.min.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:(n.set(b.min.x,b.max.y,b.max.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:(n.set(b.max.x,b.min.y,b.min.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:(n.set(b.max.x,b.min.y,b.max.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:(n.set(b.max.x,b.max.y,b.min.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:(n.set(b.max.x,b.max.y,b.max.z),e=a.distanceToPoint(n),Math.sign(e)!==d?!0:!1))))))}function e(a,b,d){var e=b.geometry,f=d.length,g=e.attributes,h=b.matrixWorld;r.getInverse(h),s.copy(a).applyMatrix4(r);var i,j,k;if(void 0!==g.index){var l=g.index.array||e.ib,m=e.vb?e.vb:g.position.array,n=e.vb?e.vbstride:3,t=e.offsets;t&&0!==t.length||(t=[{start:0,count:l.length,index:0}]);for(var u=0,v=t.length;v>u;++u)for(var w=t[u].start,x=t[u].count,y=t[u].index,z=w,A=w+x;A>z;z+=3)i=y+l[z],j=y+l[z+1],k=y+l[z+2],o.x=m[i*n],o.y=m[i*n+1],o.z=m[i*n+2],p.x=m[j*n],p.y=m[j*n+1],p.z=m[j*n+2],q.x=m[k*n],q.y=m[k*n+1],q.z=m[k*n+2],c(s,o,p,q,i,j,k,d,b.fragId)}else for(var m=e.vb?e.vb:g.position.array,n=e.vb?e.vbstride:3,z=0,B=0,A=m.length;A>z;z+=3,B+=9)i=z,j=z+1,k=z+2,o.x=m[i*n],o.y=m[i*n+1],o.z=m[i*n+2],p.x=m[j*n],p.y=m[j*n+1],p.z=m[j*n+2],q.x=m[k*n],q.y=m[k*n+1],q.z=m[k*n+2],c(s,o,p,q,i,j,k,d,b.fragId);for(var z=f;z<d.length;z++)d[z].pt1.applyMatrix4(h),d[z].pt2.applyMatrix4(h)}function f(a,b,c){var d=b,e=Math.sqrt(1-d*d),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h;c.set(j*g+d,j*h-e*i,j*i+e*h,0,j*h+e*i,k*h+d,k*i-e*g,0,j*i-e*h,k*i+e*g,f*i*i+d,0,0,0,0,1)}function g(b){var c=new THREE.Vector3(0,0,1),d=b.normal.clone().cross(c);d=d.normalize();var e=c.dot(b.normal),g=new THREE.Matrix4;return a(d.x)&&a(d.y)&&a(d.z)?g.elements[14]=e*b.constant:(f(d,e,g),g.elements[14]=b.constant),g}function h(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];e.pt1.applyMatrix4(a),e.pt2.applyMatrix4(a),c.expandByPoint(e.pt1),c.expandByPoint(e.pt2)}}var i=1e-10,j=Autodesk.Viewing.Private.Triangulator.Edge,k=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Vector3,q=new THREE.Vector3,r=new THREE.Matrix4,s=new THREE.Plane;return{makePlaneBasis:g,convertToPlaneCoords:h,intersectTrianglePlane:c,intersectMeshPlane:e,intersectBoxPlane:d}}())}function NodeArray(a,b){b?this.bytes_per_node=32:this.bytes_per_node=36;var c,d;a instanceof ArrayBuffer?(c=a.byteLength/this.bytes_per_node,d=a,this.nodeCount=c):(c=0|a,d=new ArrayBuffer(this.bytes_per_node*c),this.nodeCount=0),this.nodeCapacity=c,this.nodesRaw=d,this.is_lean_node=b,this.node_stride=this.bytes_per_node/4,this.node_stride_short=this.bytes_per_node/2,this.nodesF=new Float32Array(this.nodesRaw),this.nodesI=new Int32Array(this.nodesRaw),this.nodesS=new Uint16Array(this.nodesRaw)}function BVHBuilder(a,b){this.boxes=a.boxes,this.polygonCounts=a.polygonCounts,this.materials=a.materials,this.materialDefs=b,this.prim_count=a.length,this.frags_per_leaf_node=-1,this.frags_per_inner_node=-1,this.nodes=null,this.work_buf=new ArrayBuffer(4*this.prim_count),this.sort_prims=new Int32Array(this.work_buf),this.primitives=new Int32Array(this.prim_count),this.centroids=new Float32Array(POINT_STRIDE*this.prim_count),this.boxv_o=new Float32Array(6),this.boxc_o=new Float32Array(6),this.boxv_t=new Float32Array(6),this.boxc_t=new Float32Array(6),this.recursion_stack=[]}function RenderContext(){function a(){function a(a){a.material.blending=THREE.NoBlending,a.material.depthWrite=!1,a.material.depthTest=!1}var b=X.NormalsShader;d=new THREE.ShaderMaterial({fragmentShader:b.fragmentShader,vertexShader:b.vertexShader,uniforms:THREE.UniformsUtils.clone(b.uniforms)}),d.blending=THREE.NoBlending,d.packedNormals=!0,d._noCutplanesMaterial=d.clone(),d._noCutplanesMaterial.cutplanes=null,d._noCutplanesMaterial.blending=THREE.NoBlending,d._noCutplanesMaterial.packedNormals=!0,j=new X.LmvShaderPass(X.SAOShader),a(j),i=new X.LmvShaderPass(X.SAOBlurShader),a(i),l=new X.LmvShaderPass(X.SAOMinifyFirstShader),a(l),k=new X.LmvShaderPass(X.SAOMinifyShader),a(k),m=new X.LmvShaderPass(X.FXAAShader),a(m),n=new X.LmvShaderPass(X.CelShader),a(n),o=new X.LmvShaderPass(X.BlendShader),a(o),h=new X.LmvShaderPass(X.BackgroundShader),a(h),p=new X.LmvShaderPass(X.CopyShader),a(p)}function b(a,b){var c=3*a[1],d=3*(a[3]-a[1])-c,e=1-c-d;return((e*b+d)*b+c)*b}var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=!1,x=!1,y=null,z=null,A=null,B=null,C=null,D=null,E=0,F=0,G=0,H=1,I=!1,J=new Uint8Array(4),K=(new THREE.Color).setRGB(1,1,1),L=(new THREE.Color).setRGB(0,0,0),M=null,N=!1,O=!1,P=!1,Q=!1,R=0,S=0,T=[.42,0,1,1],U=.004,V={antialias:!0,sao:!1,useHdrTarget:!1,haveTwoSided:!1,useSSAA:!1,idbuffer:!0,customPresentPass:!1,toonShaded:!1,envMapBg:!1},W={},X=Autodesk.Viewing.Shaders;this.settings=V,this.init=function(b,d,e){return init_ShaderChunks(X),init_FireflyPhongShader(X),init_FireflyPrismShader(X),init_BackgroundShader(X),init_BlendShader(X),init_CelShader(X),init_CopyShader(X),init_FXAAShader(X),init_LineShader(X),init_NormalsShader(X),init_SAOBlurShader(X),init_SAOMinifyShader(X),init_SAOShader(X),init_FireflyBasicShader(X),b?(N=-1!=window.navigator.userAgent.indexOf("Firefox")&&-1!=window.navigator.userAgent.indexOf("Mac OS"),O=isAndroidDevice()||isIOSDevice(),V.idbuffer=!O,u=d,v=e,c=b,a(),void this.initPostPipeline(V.sao,V.antialias,!1)):void console.error("You need a gl context to make a renderer. Things will go downhill from here.")},this.overlayUpdate=function(a){if(0===R||-1===R)return!1;var c=o.uniforms.highlightIntensity.value,d=(performance.now()-S)*U;d=Math.min(d,1);var e=b(T,d);return c!=e?(o.uniforms.highlightIntensity.value=e,!0):!1},this.beginScene=function(a,b,d,e){if(f=b,g=d,w=!1,x=!1,!z)return void(u||I||(console.error("Rendering to a canvas that was resized to zero. If you see this message you may be accidentally leaking a viewer instance."),I=!0));if(e&&(M&&!V.envMapBg?(c.setClearColor(M,1),c.clearTarget(z,!0,!0,!1)):(h.uniforms.uCamDir.value=f.getWorldDirection(),h.uniforms.uCamUp.value=f.up,h.uniforms.uResolution.value.set(u,v),h.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*f.fov)),c.clearTarget(z,!1,!0,!1),h.render(c,z,null))),D&&(c.setClearColor(K,1),c.clearTarget(D,!0,!1,!1)),V.sao||V.toonShaded){e&&(c.setClearColor(L,0),c.clearTarget(t,!0,!1,!1));var i=b.near,k=b.far;j.uniforms.cameraNear.value=i,j.uniforms.cameraFar.value=k,n.uniforms.cameraNear.value=i,n.uniforms.cameraFar.value=k,l.uniforms.cameraNear.value=i,l.uniforms.cameraInvNearFar.value=1/(i-k);var m=b.projectionMatrix.elements;b.isPerspective?(j.uniforms.projInfo.value.set(-2/(z.width*m[0]),-2/(z.height*m[5]),(1-m[8])/m[0],(1+m[9])/m[5]),n.uniforms.projInfo.value.copy(j.uniforms.projInfo.value),j.uniforms.isOrtho.value=0,n.uniforms.isOrtho.value=0):(j.uniforms.projInfo.value.set(-2/(z.width*m[0]),-2/(z.height*m[5]),(1-m[12])/m[0],(1-m[13])/m[5]),n.uniforms.projInfo.value.copy(j.uniforms.projInfo.value),j.uniforms.isOrtho.value=1,n.uniforms.isOrtho.value=1);var o=.25;j.uniforms.projScale.value=.5*o*(z.height*m[5])}this.renderScenePart(a,!0,!0,!1,!0)},this.renderScenePart=function(a,b,h,i,j){w=!1,x=!1;var k=j?g:void 0;if(P&&Q)V.idbuffer&&i&&(V.sao||V.toonShaded)?c.render(a,f,[z,t,D],!1,k):V.sao||V.toonShaded?c.render(a,f,[z,t],!1,k):V.idbuffer&&i?c.render(a,f,[z,D]):c.render(a,f,z,!1,k);else if(Q){if(V.idbuffer&&i?c.render(a,f,[z,D],!1,k):c.render(a,f,z,!1,k),(V.sao||V.toonShaded)&&h){var l=a.overrideMaterial;a.overrideMaterial=d,c.render(a,f,t,!1,void 0),a.overrideMaterial=l}}else{if(b&&c.render(a,f,z,!1,k),V.idbuffer&&i&&e){var l=a.overrideMaterial;a.overrideMaterial=e,c.render(a,f,D,!1,void 0),a.overrideMaterial=l}if((V.sao||V.toonShaded)&&h){var l=a.overrideMaterial;a.overrideMaterial=d,c.render(a,f,t,!1,void 0),a.overrideMaterial=l}}},this.clearAllOverlays=function(){c.clearTarget(A,!0,!1,!1)},this.renderOverlays=function(a,b){var d=0;for(var e in a){var g=a[e],h=g.scene,i=g.camera?g.camera:f;h.children.length&&(d||(d=1,c.setClearColor(L,0),c.clearTarget(A,!0,!1,!1)),g.materialPre&&(h.overrideMaterial=g.materialPre),c.render(h,i,A,!1,b),g.materialPost&&(h.overrideMaterial=g.materialPost,c.context.depthFunc(c.context.GREATER),c.render(h,i,A,!1,b),c.context.depthFunc(c.context.LEQUAL)),h.overrideMaterial=null)}o.uniforms.useOverlay.value=d},this.computeSSAO=function(a){if(a||!V.sao||V.toonShaded)o.uniforms.useAO.value=0;else{if(!w){if(y){var b=y[0];l.uniforms.resolution.value.set(1/b.width,1/b.height),l.render(c,b,t);for(var d=1;d<y.length;d++){var e=y[d];k.uniforms.resolution.value.set(1/e.width,1/e.height),k.render(c,e,b),b=e}}j.render(c,C,z),i.uniforms.axis.value.set(1,0),i.render(c,B,C),i.uniforms.axis.value.set(0,1),i.render(c,C,B),w=!0}o.uniforms.useAO.value=1}},this.presentBuffer=function(a){var b=!V.sao&&!o.uniforms.useOverlay.value&&!o.uniforms.objID.value;b?V.antialias?a?(m.render(c,B,z),a.render(c,null,B)):V.toonShaded?(n.render(c,B,z),m.render(c,null,B)):m.render(c,null,z):a?a.render(c,null,z):V.toonShaded?(n.render(c,B,z),p.render(c,null,B)):p.render(c,null,z):V.antialias?(o.render(c,B,z),a?(m.render(c,C,B),a.render(c,null,C)):V.toonShaded?(n.render(c,C,B),m.render(c,null,C)):m.render(c,null,B)):a?(o.render(c,B,z),a.render(c,null,B)):V.toonShaded?(o.render(c,B,z),n.render(c,C,B),p.render(c,null,C)):o.render(c,null,z)},this.composeFinalFrame=function(a,b,c){V.sao&&!V.toonShaded&&this.computeSSAO(a),c||this.presentBuffer()},this.cleanup=function(){if(z&&(z.dispose(),z=null),t&&(t.dispose(),t=null),A&&(A.dispose(),A=null),B&&(B.dispose(),B=null),C&&(C.dispose(),C=null),y){for(var a=0;a<y.length;a++)y[a].dispose();y=[]}},this.setSize=function(a,b,d){u=a,v=b;var e=0|a*c.getPixelRatio(),f=0|b*c.getPixelRatio();if(V.logicalWidth=a,V.logicalHeight=b,V.deviceWidth=e,V.deviceHeight=f,0==a&&0==b)return void this.cleanup();c.setSize(a,b),stderr("width: "+e+" height: "+f);var g=1/e,h=1/f;if((V.useSSAA||V.toonShaded&&c.getPixelRatio()<=1)&&(e*=2,f*=2,d=!0),(d||!z||z.width!=e||z.height!=f)&&(stderr("Reallocating render targets."),this.cleanup(),z=new THREE.WebGLRenderTarget(e,f,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,type:V.useHdrTarget?THREE.FloatType:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),A=new THREE.WebGLRenderTarget(e,f,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,stencilBuffer:!1,generateMipmaps:!1}),A.shareDepthFrom=z,t=null,B=null,C=null,y=[]),(V.antialias||V.sao||V.customPresentPass||V.toonShaded)&&(d||!B||B.width!=e||B.height!=f)&&(B=new THREE.WebGLRenderTarget(e,f,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1})),V.sao||V.toonShaded){if(d||!t||t.width!=e||t.height!=f){var k=THREE.FloatType;isMobileDevice()&&(k=THREE.HalfFloatType),t=new THREE.WebGLRenderTarget(e,f,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:k,stencilBuffer:!1}),t.shareDepthFrom=z,y=[];for(var l=0;5>l;l++){var p=new THREE.WebGLRenderTarget(0|e/(2<<l),0|f/(2<<l),{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBAFormat,depthBuffer:!1,stencilBuffer:!1});p.generateMipmaps=!1,y.push(p),j.uniforms["tDepth_mip"+(l+1)].value=p}P=!N&&c.verifyMRTWorks([z,t]),C=B.clone()}!C&&V.antialias&&V.customPresentPass&&(C=B.clone()),j.uniforms.size.value.set(e,f),j.uniforms.resolution.value.set(g,h),j.uniforms.tDepth.value=t,i.uniforms.size.value.set(e,f),i.uniforms.resolution.value.set(g,h),n.uniforms.tDepth.value=t}V.idbuffer?((d||!D||D.width!=e||D.height!=f)&&(D=new THREE.WebGLRenderTarget(e,f,{minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter,format:THREE.RGBFormat,type:THREE.UnsignedByteType,stencilBuffer:!1,generateMipmaps:!1}),D.shareDepthFrom=z,Q=!N&&c.verifyMRTWorks([z,D]),Q||console.warn("ID buffer requested, but MRT is not supported. Some features will not work.")),n.uniforms.tID.value=D):D&&(D.dispose(),D=null),m.uniforms.uResolution.value.set(g,h),n.uniforms.resolution.value.set(g,h),o.uniforms.tOverlay.value=A,o.uniforms.tAO.value=C,o.uniforms.useAO.value=V.sao?1:0,o.uniforms.resolution.value.set(g,h),o.uniforms.tID.value=D},this.getMaxAnisotropy=function(){return c.getMaxAnisotropy()},this.hasMRT=function(){return!N&&c.supportsMRT()},this.applyMRTFlags=function(a){var b=a.mrtNormals,c=a.mrtIdBuffer;a.mrtNormals=this.hasMRT()&&P&&(V.sao||V.toonShaded),a.mrtIdBuffer=this.hasMRT()&&Q&&V.idbuffer,(a.mrtNormals!==b||a.mrtIdBuffer!==c)&&(a.needsUpdate=!0)},this.initPostPipeline=function(a,b){V.sao=a&&!_isIE11,V.antialias=b&&!_isIE11,V.sao&&(V.toonShaded=!1),V.haveTwoSided&&(d.side=THREE.DoubleSide,d._noCutplanesMaterial.side=d.side),d.needsUpdate=!0,d._noCutplanesMaterial.needsUpdate=!0,j.material.needsUpdate=!0,i.material.needsUpdate=!0,l.material.needsUpdate=!0,k.material.needsUpdate=!0,m.material.needsUpdate=!0,n.material.needsUpdate=!0,o.material.needsUpdate=!0,h.material.needsUpdate=!0,p.material.needsUpdate=!0,this.setSize(u,v)},this.setClearColors=function(a,b){M=b?a.equals(b)||O?new THREE.Color(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)):void 0:a.clone(),M||(h.uniforms.color1.value.copy(a),h.uniforms.color2.value.copy(b))},this.setAOOptions=function(a,b){void 0!==a&&(j.uniforms.radius.value=a),void 0!==b&&(j.uniforms.intensity.value=b),w=!1},this.getAORadius=function(){return j.uniforms.radius.value},this.getAOIntensity=function(){return j.uniforms.intensity.value},this.setCubeMap=function(a){h.material.envMap=a},this.setEnvRotation=function(a){F=a,h.material.envRotationSin=Math.sin(a),h.material.envRotationCos=Math.cos(a)},this.getEnvRotation=function(){return F},this.setTonemapExposureBias=function(a){E=a},this.getExposureBias=function(){return E},this.setTonemapMethod=function(a){G=a,0===a?c.gammaInput=!1:c.gammaInput=!0},this.getToneMapMethod=function(){return G},this.toggleTwoSided=function(a){V.haveTwoSided!=a&&d&&(d.side=a?THREE.DoubleSide:THREE.FrontSide,d.needsUpdate=!0,d._noCutplanesMaterial.side=d.side,d._noCutplanesMaterial.needsUpdate=!0),V.haveTwoSided=a},this.toggleCelShading=function(a){V.sao=!a,V.toonShaded=a,V.idbuffer=a,this.initPostPipeline(V.sao,V.antialias)},this.toggleEnvMapBackground=function(a){V.envMapBg=a,h.uniforms.envMapBackground.value=a},this.enter2DMode=function(a){e=a,W.sao=V.sao,W.antialias=V.antialias,W.idbuffer=V.idbuffer,V.idbuffer=!0,o.material.defines.IS_2D="",this.initPostPipeline(!1,!1)},this.exit2DMode=function(){e=null,V.idbuffer=W.idbuffer,delete o.material.defines.IS_2D,this.initPostPipeline(W.sao,W.antialias)},this.idAtPixel=function(a,b){if(!D)return 0;var d=0|.5*(a+1)*D.width,e=0|.5*(b+1)*D.height;if(x&&d===q&&e===r)return s;c.readRenderTargetPixels(D,d,e,1,1,J);var f=J[2]<<16|J[1]<<8|J[0];return f=f<<8>>8,q=d,r=e,s=f,x=!0,f},this.idAtPixels=function(a,b,d){if(!D)return 0;var e=.5*(a+1)*D.width-.5*(d-1),f=.5*(b+1)*D.height-.5*(d-1),g=new Uint8Array(4*d*d);c.readRenderTargetPixels(D,e,f,d,d,g);for(var h,i=0;d*d>i&&(h=g[4*i+2]<<16|g[4*i+1]<<8|g[4*i],h=h<<8>>8,!(h>=0));i++);return h},this.rolloverObjectViewport=function(a,b,c){var d=c?c[0]:this.idAtPixel(a,b);return this.rolloverObjectId(d,c)},this.rolloverObjectId=function(a,b){return a==R?!1:(o.uniforms.highlightIntensity.value=0,o.uniforms.objID.value=a,S=performance.now(),R=a,b?(b.length>1&&b.shift(),o.uniforms.highlightRange.value=1,o.uniforms.objIDStart.value=b[0],o.uniforms.objIDEnd.value=b[b.length-1]):(o.uniforms.highlightRange.value=0,0>=a&&(a=0),o.uniforms.objIDv3.value.set((255&a)/255,(a>>8&255)/255,(a>>16&255)/255)),!0)},this.setUnitScale=function(a){H=a},this.getUnitScale=function(){return H},this.getBlendPass=function(){return o},this.getColorTarget=function(){return z},this.getDepthMaterial=function(){return d}}function init_FXAAShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.FXAAShader&&(a.FXAAShader={uniforms:{tDiffuse:{type:"t",value:null},uResolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)}},vertexShader:["uniform vec2 uResolution;","varying vec2 vPos;","varying vec4 vPosPos;","void main() {","vPos = uv;","vPosPos.xy = uv + vec2(-0.5, -0.5) * uResolution;","vPosPos.zw = uv + vec2( 0.5,  0.5) * uResolution;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define FXAA_EDGE_SHARPNESS (8.0)","#define FXAA_EDGE_THRESHOLD (0.125)","#define FXAA_EDGE_THRESHOLD_MIN (0.05)","#define FXAA_RCP_FRAME_OPT (0.50)","#define FXAA_RCP_FRAME_OPT2 (2.0)","uniform sampler2D tDiffuse;","uniform highp vec2 uResolution;","varying vec2 vPos;","varying vec4 vPosPos;","float FxaaLuma(vec3 rgb) {","return dot(rgb, vec3(0.299, 0.587, 0.114));","}","void main() {","float lumaNw = FxaaLuma(texture2D(tDiffuse, vPosPos.xy).rgb);","float lumaSw = FxaaLuma(texture2D(tDiffuse, vPosPos.xw).rgb);","float lumaNe = FxaaLuma(texture2D(tDiffuse, vPosPos.zy).rgb) + 1.0/384.0;","float lumaSe = FxaaLuma(texture2D(tDiffuse, vPosPos.zw).rgb);","vec3 rgbM = texture2D(tDiffuse, vPos.xy).rgb;","float lumaM = FxaaLuma(rgbM.rgb);","float lumaMax = max(max(lumaNe, lumaSe), max(lumaNw, lumaSw));","float lumaMin = min(min(lumaNe, lumaSe), min(lumaNw, lumaSw));","float lumaMaxSubMinM = max(lumaMax, lumaM) - min(lumaMin, lumaM);","float lumaMaxScaledClamped = max(FXAA_EDGE_THRESHOLD_MIN, lumaMax * FXAA_EDGE_THRESHOLD);","if (lumaMaxSubMinM < lumaMaxScaledClamped) {","gl_FragColor = vec4(rgbM, 1.0);","return;","}","float dirSwMinusNe = lumaSw - lumaNe;","float dirSeMinusNw = lumaSe - lumaNw;","vec2 dir1 = normalize(vec2(dirSwMinusNe + dirSeMinusNw, dirSwMinusNe - dirSeMinusNw));","vec3 rgbN1 = texture2D(tDiffuse, vPos.xy - dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;","vec3 rgbP1 = texture2D(tDiffuse, vPos.xy + dir1 * FXAA_RCP_FRAME_OPT*uResolution).rgb;","float dirAbsMinTimesC = min(abs(dir1.x), abs(dir1.y)) * FXAA_EDGE_SHARPNESS;","vec2 dir2 = clamp(dir1.xy / dirAbsMinTimesC, -2.0, 2.0);","vec3 rgbN2 = texture2D(tDiffuse, vPos.xy - dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;","vec3 rgbP2 = texture2D(tDiffuse, vPos.xy + dir2 * FXAA_RCP_FRAME_OPT2*uResolution).rgb;","vec3 rgbA = rgbN1 + rgbP1;","vec3 rgbB = ((rgbN2 + rgbP2) * 0.25) + (rgbA * 0.25);","float lumaB = FxaaLuma(rgbB);","if ((lumaB < lumaMin) || (lumaB > lumaMax))","gl_FragColor = vec4(rgbA * 0.5, 1.0);","else","gl_FragColor = vec4(rgbB, 1.0);","}"].join("\n")})}function init_ShaderChunks(){"use strict";var a=Autodesk.Viewing.Shaders;a.PackDepthShaderChunk=["vec4 packDepth( const in float depth ) {","vec4 enc = vec4(1.0, 255.0, 65025.0, 160581375.0) * depth;","enc = fract(enc);","enc -= enc.yzww * vec4(1.0/255.0,1.0/255.0,1.0/255.0,0.0);","return enc;","}","float unpackDepth( const in vec4 rgba_depth ) {","return dot( rgba_depth, vec4(1.0, 1.0/255.0, 1.0/65025.0, 1.0/160581375.0) );","}"].join("\n"),a.TonemapShaderChunk=["float luminance_post(vec3 rgb) {","return dot(rgb, vec3(0.299, 0.587, 0.114));","}","float luminance_pre(vec3 rgb) {","return dot(rgb, vec3(0.212671, 0.715160, 0.072169));","}","vec3 xyz2rgb(vec3 xyz) {","vec3 R = vec3( 3.240479, -1.537150, -0.498535);","vec3 G = vec3(-0.969256,  1.875992,  0.041556);","vec3 B = vec3( 0.055648, -0.204043,  1.057311);","vec3 rgb;","rgb.b = dot(xyz, B);","rgb.g = dot(xyz, G);","rgb.r = dot(xyz, R);","return rgb;","}","vec3 rgb2xyz(vec3 rgb) {","vec3 X = vec3(0.412453, 0.35758, 0.180423);","vec3 Y = vec3(0.212671, 0.71516, 0.0721688);","vec3 Z = vec3(0.0193338, 0.119194, 0.950227);","vec3 xyz;","xyz.x = dot(rgb, X);","xyz.y = dot(rgb, Y);","xyz.z = dot(rgb, Z);","return xyz;","}","vec3 xyz2xyY(vec3 xyz) {","float sum = xyz.x + xyz.y + xyz.z;","sum = 1.0 / sum;","vec3 xyY;","xyY.z = xyz.y;","xyY.x = xyz.x * sum;","xyY.y = xyz.y * sum;","return xyY;","}","vec3 xyY2xyz(vec3 xyY) {","float x = xyY.x;","float y = xyY.y;","float Y = xyY.z;","vec3 xyz;","xyz.y = Y;","xyz.x = x * (Y / y);","xyz.z = (1.0 - x - y) * (Y / y);","return xyz;","}","float toneMapCanon_T(float x)","{","float xpow = pow(x, 1.60525727);","float tmp = ((1.05542877*4.68037409)*xpow) / (4.68037409*xpow + 1.0);","return clamp(tmp, 0.0, 1.0);","}","const float Shift = 1.0 / 0.18;","float toneMapCanonFilmic_NoGamma(float x) {","x *= Shift;","const float A = 0.2;","const float B = 0.34;","const float C = 0.002;","const float D = 1.68;","const float E = 0.0005;","const float F = 0.252;","const float scale = 1.0/0.833837;","return (((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F) * scale;","}","vec3 toneMapCanonFilmic_WithGamma(vec3 x) {","x *= Shift;","const float A = 0.27;","const float B = 0.29;","const float C = 0.052;","const float D = 0.2;","const float F = 0.18;","const float scale = 1.0/0.897105;","return (((x*(A*x+C*B))/(x*(A*x+B)+D*F))) * scale;","}","vec3 toneMapCanonOGS_WithGamma_WithColorPerserving(vec3 x) {","vec3 outColor = x.rgb;","outColor = min(outColor, vec3(3.0));","float inLum = luminance_pre(outColor);","if (inLum > 0.0) {","float outLum = toneMapCanon_T(inLum);","outColor = outColor * (outLum / inLum);","outColor = clamp(outColor, vec3(0.0), vec3(1.0));","}","float gamma = 1.0/2.2;","outColor = pow(outColor, vec3(gamma));","return outColor;","}"].join("\n"),
a.OrderedDitheringShaderChunk=["vec3 orderedDithering(vec3 col) {","const vec4 m0 = vec4( 1.0, 13.0,  4.0, 16.0);","const vec4 m1 = vec4( 9.0,  5.0, 12.0,  8.0);","const vec4 m2 = vec4( 3.0, 15.0,  2.0, 14.0);","const vec4 m3 = vec4(11.0,  7.0, 10.0,  6.0);","int i = int(mod(float(gl_FragCoord.x), 4.0));","int j = int(mod(float(gl_FragCoord.y), 4.0));","vec4 biasRow;","if      (i==0) biasRow = m0;","else if (i==1) biasRow = m1;","else if (i==2) biasRow = m2;","else           biasRow = m3;","float bias;","if      (j==0) bias = biasRow.x;","else if (j==1) bias = biasRow.y;","else if (j==2) bias = biasRow.z;","else           bias = biasRow.w;","return col + bias / 17.0 / 256.0;","}"].join("\n"),a.CutPlanesUniforms={cutplanes:{type:"v4v",value:[]},hatchParams:{type:"v2",value:new THREE.Vector2(1,10)},hatchTintColor:{type:"c",value:new THREE.Color(16777215)},hatchTintIntensity:{type:"f",value:1}},a.CutPlanesShaderChunk=["#if NUM_CUTPLANES > 0","uniform vec4 cutplanes[NUM_CUTPLANES];","bool checkCutPlanes(vec3 worldPosition) {","bool isCut = false;","for (int i=0; i<NUM_CUTPLANES; i++) {","float dotPlane = dot(vec4(worldPosition, 1.0), cutplanes[i]);","isCut = isCut || (dotPlane > 0.0);","}","if (isCut) {","discard;","return true;","}","return false;","}","#endif"].join("\n"),a.PackNormalsShaderChunk=["#define kPI 3.14159265358979","vec2 encodeNormal (vec3 n)","{","return (vec2(atan(n.y,n.x)/kPI, n.z)+1.0)*0.5;","}","vec3 decodeNormal (vec2 enc)","{","vec2 ang = enc * 2.0 - 1.0;","vec2 scth = vec2(sin(ang.x * kPI), cos(ang.x * kPI));","vec2 scphi = vec2(sqrt(1.0 - ang.y * ang.y), ang.y);","return vec3(scth.y * scphi.x, scth.x * scphi.x, scphi.y);","}"].join("\n"),a.HatchPatternShaderChunk=["#ifdef HATCH_PATTERN","uniform vec2 hatchParams;","uniform vec3 hatchTintColor;","uniform float hatchTintIntensity;","float curveGaussian(float r, float invWidth) {","float amt = clamp(r * invWidth, 0.0, 1.0);","float exponent = amt * 3.5;","return exp(-exponent*exponent);","}","vec4 calculateHatchPattern(vec2 hatchParams, vec2 coord, vec4 fragColor, vec3 hatchTintColor, float hatchTintIntensity ) {","float hatchSlope = hatchParams.x;","float hatchPeriod = hatchParams.y;","if (abs(hatchSlope) <= 1.0) {","float hatchPhase = coord.y - hatchSlope * coord.x;","float dist = abs(mod((hatchPhase), (hatchPeriod)));","if (dist < 1.0) {","fragColor = vec4(0.0,0.0,0.0,1.0);","} else {","fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);","}","} else {","float hatchPhase = - coord.y / hatchSlope + coord.x;","float dist = abs(mod((hatchPhase), (hatchPeriod)));","if (dist < 1.0) {","fragColor = vec4(0.0,0.0,0.0,1.0);","} else {","fragColor.xyz = mix(fragColor.xyz, hatchTintColor, hatchTintIntensity);","}","}","return fragColor;","}","#endif"].join("\n"),a.EnvSamplingShaderChunk=["uniform float envRotationSin;","uniform float envRotationCos;","vec3 adjustLookupVector(in vec3 lookup) {","return vec3(","envRotationCos * lookup.x - envRotationSin * lookup.z,","lookup.y,","envRotationSin * lookup.x + envRotationCos * lookup.z);","}"].join("\n"),a.IdUniforms={dbId:{type:"v4",value:new THREE.Vector4(0,0,0,0)}},a.IdOutputShaderChunk=["#ifdef MRT_ID_BUFFER","#ifdef MRT_NORMALS","const int index = 2;","#else","const int index = 1;","#endif","gl_FragData[index] = vec4(dbId.rgb, 1.0);","#elif defined(ID_COLOR)","gl_FragColor = dbId;","#endif"].join("\n"),a.FinalOutputShaderChunk=["#ifdef HATCH_PATTERN","gl_FragColor = calculateHatchPattern(hatchParams, gl_FragCoord.xy, gl_FragColor, hatchTintColor, hatchTintIntensity);","#endif","#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)","gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;","#endif","#ifdef MRT_NORMALS","gl_FragData[1] = vec4(geomNormal.x, geomNormal.y, depth, gl_FragColor.a < 1.0 ? 0.0 : 1.0);","#endif",a.IdOutputShaderChunk].join("\n")}function init_CopyShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.CopyShader&&(a.CopyShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","vUv = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","gl_FragColor = texture2D(tDiffuse, vUv);","}"].join("\n")})}function init_CelShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.CelShader&&(a.CelShader={uniforms:{tDiffuse:{type:"t",value:null},tDepth:{type:"t",value:null},tID:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},isOrtho:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#extension GL_OES_standard_derivatives : enable","uniform sampler2D tDiffuse;","uniform sampler2D tDepth;","uniform sampler2D tID;","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraFar;","uniform float isOrtho;","uniform vec4 projInfo;","varying vec2 vUv;","vec4 recoverNZ(vec4 nrmz) {","float z = sqrt(1.0 - dot(nrmz.xy, nrmz.xy));","nrmz.w = -(nrmz.z +cameraNear) / (cameraFar - cameraNear);","nrmz.z = z;","return nrmz;","}",a.TonemapShaderChunk,"vec4 quantize(vec4 c) {","c *= c;","float L = max(c.x, max(c.y, c.z));","c.xyz *= floor(L * 8.0 + 0.5) / (8.0 * L);","c.w = 1.0;","return sqrt(c);","}","vec4 quantizeRGB(vec4 c) {","c *= c;","c.xyz *= floor(c.xyz * 8.0 + 0.5) / 8.0;","c.w = 1.0;","return sqrt(c);","}","vec3 reconstructCSPosition(vec2 S, float z) {","return vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);","}","vec3 reconstructCSFaceNormal(vec3 C) {","return normalize(cross(dFdy(C), dFdx(C)));","}","vec3 getPosition(ivec2 ssP, float depth) {","vec3 P;","P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);","return P;","}","int isObjectEdge() {","vec4 MM = texture2D(tID, vUv + vec2( 0.0,  0.0));","vec4 LL = texture2D(tID, vUv + vec2(-1.0, -1.0) * resolution);","if (MM != LL) return 1;","vec4 LM = texture2D(tID, vUv + vec2( 0.0, -1.0) * resolution);","if (MM != LM) return 1;","vec4 LR = texture2D(tID, vUv + vec2( 1.0, -1.0) * resolution);","if (MM != LR) return 1;","vec4 ML = texture2D(tID, vUv + vec2(-1.0,  0.0) * resolution);","if (MM != ML) return 1;","vec4 MR = texture2D(tID, vUv + vec2( 1.0,  0.0) * resolution);","if (MM != MR) return 1;","vec4 UL = texture2D(tID, vUv + vec2(-1.0,  1.0) * resolution);","if (MM != UL) return 1;","vec4 UM = texture2D(tID, vUv + vec2( 0.0,  1.0) * resolution);","if (MM != UM) return 1;","vec4 UR = texture2D(tID, vUv + vec2( 1.0,  1.0) * resolution);","if (MM != UR) return 1;","return 0;","}","float normalDiff(vec3 n1, vec3 n2) {","float d = dot(n1.xyz, n2.xyz);","return acos(clamp(d, -1.0, 1.0));","}","const float r = 1.0;","void main() {","vec4 color = texture2D(tDiffuse, vUv);","ivec2 ssC = ivec2(gl_FragCoord.xy);","if (isObjectEdge() == 1) {","gl_FragColor = vec4(0,0,0,1);","return;","}","vec4 MM = texture2D(tDepth, vUv + vec2( 0.0,  0.0));","if (MM.z == 0.0) {","gl_FragColor = quantize(color);","return;","}","vec4 LL = texture2D(tDepth, vUv + vec2(-r, -r) * resolution);","vec4 LM = texture2D(tDepth, vUv + vec2( 0.0, -r) * resolution);","vec4 LR = texture2D(tDepth, vUv + vec2( r, -r) * resolution);","vec4 ML = texture2D(tDepth, vUv + vec2(-r,  0.0) * resolution);","vec4 MR = texture2D(tDepth, vUv + vec2( r,  0.0) * resolution);","vec4 UL = texture2D(tDepth, vUv + vec2(-r, r) * resolution);","vec4 UM = texture2D(tDepth, vUv + vec2( 0.0,  r) * resolution);","vec4 UR = texture2D(tDepth, vUv + vec2( r,  r) * resolution);","vec3 C = getPosition(ssC + ivec2(-1, -1), LL.z);","vec3 LLz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2( 0, -1), LM.z);","vec3 LMz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2( 1, -1), LR.z);","vec3 LRz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2(-1, 0), ML.z);","vec3 MLz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2( 0, 0), MM.z);","vec3 MMz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2( 1, 0), MR.z);","vec3 MRz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2(-1, 1), UL.z);","vec3 ULz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2(0, 1), UM.z);","vec3 UMz = reconstructCSFaceNormal(C);","C = getPosition(ssC + ivec2(1, 1), UR.z);","vec3 URz = reconstructCSFaceNormal(C);","LL = recoverNZ(LL);","LM = recoverNZ(LM);","LR = recoverNZ(LR);","ML = recoverNZ(ML);","MM = recoverNZ(MM);","MR = recoverNZ(MR);","UL = recoverNZ(UL);","UM = recoverNZ(UM);","UR = recoverNZ(UR);","float pLL = normalDiff(LL.xyz, MM.xyz);","float pLM = normalDiff(LM.xyz, MM.xyz);","float pLR = normalDiff(LR.xyz, MM.xyz);","float pML = normalDiff(ML.xyz, MM.xyz);","float pMM = normalDiff(MM.xyz, MM.xyz);","float pMR = normalDiff(MR.xyz, MM.xyz);","float pUL = normalDiff(UL.xyz, MM.xyz);","float pUM = normalDiff(UM.xyz, MM.xyz);","float pUR = normalDiff(UR.xyz, MM.xyz);","float pLLz = normalDiff(LLz.xyz, MMz.xyz);","float pLMz = normalDiff(LMz.xyz, MMz.xyz);","float pLRz = normalDiff(LRz.xyz, MMz.xyz);","float pMLz = normalDiff(MLz.xyz, MMz.xyz);","float pMMz = normalDiff(MMz.xyz, MMz.xyz);","float pMRz = normalDiff(MRz.xyz, MMz.xyz);","float pULz = normalDiff(ULz.xyz, MMz.xyz);","float pUMz = normalDiff(UMz.xyz, MMz.xyz);","float pURz = normalDiff(URz.xyz, MMz.xyz);","float dGx = (dFdx(UL.w) + 2.0 * dFdx(UM.w) + dFdx(UR.w)) - (dFdx(LL.w) + 2.0 * dFdx(LM.w) + dFdx(LR.w)) + (dFdx(UR.w) + 2.0 * dFdx(MR.w) - dFdx(LR.w)) - (dFdx(UL.w) + 2.0 * dFdx(ML.w) - dFdx(LL.w));","float dGy = (dFdy(UL.w) + 2.0 * dFdy(UM.w) + dFdy(UR.w)) - (dFdy(LL.w) + 2.0 * dFdy(LM.w) + dFdy(LR.w)) + (dFdy(UR.w) + 2.0 * dFdy(MR.w) - dFdy(LR.w)) - (dFdy(UL.w) + 2.0 * dFdy(ML.w) - dFdy(LL.w));","float Gn = (abs(pUL - pMM) + 2.0 * abs(pUM - pMM) + abs(pUR - pMM) + 2.0 * abs(pML - pMM) + 2.0 * abs(pMR - pMM) + abs(pLL - pMM) + 2.0 * abs(pLM - pMM) + abs(pLR - pMM));","float Gnz = (abs(pULz - pMMz) + 2.0 * abs(pUMz - pMMz) + abs(pURz - pMMz) + 2.0 * abs(pMLz - pMMz) + 2.0 * abs(pMRz - pMMz) + abs(pLLz - pMMz) + 2.0 * abs(pLMz - pMMz) + abs(pLRz - pMMz));","float G = (abs(UL.w - MM.w) + 2.0 * abs(UM.w - MM.w) + abs(UR.w - MM.w) + 2.0 * abs(ML.w - MM.w) + 2.0 * abs(MR.w - MM.w) + abs(LL.w - MM.w) + 2.0 * abs(LM.w - MM.w) + abs(LR.w - MM.w));","float dd = abs(dFdx(G)) + abs(dFdy(G));","if (dd > 0.004 || abs(Gnz) > 2.2 || abs(Gn) > 2.0)","gl_FragColor = vec4(0.0,0.0,0.0,1.0);","else","gl_FragColor = /*vec4(1.0,1.0,1.0,1.0);*/quantize(color);","}"].join("\n")})}function init_BlendShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.BlendShader&&(a.BlendShader={uniforms:{tDiffuse:{type:"t",value:null},tAO:{type:"t",value:null},useAO:{type:"i",value:0},tOverlay:{type:"t",value:null},useOverlay:{type:"i",value:0},tID:{type:"t",value:null},objID:{type:"i",value:0},objIDv3:{type:"v3",value:new THREE.Vector3(0,0,0)},highlightIntensity:{type:"f",value:1},resolution:{type:"v2",value:new THREE.Vector2(1/1024,1/512)},highlightRange:{type:"i",value:0},objIDStart:{type:"i",value:0},objIDEnd:{type:"i",value:0}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tAO;","uniform int useAO;","uniform sampler2D tOverlay;","uniform int useOverlay;","uniform vec2 resolution;","uniform int objID;","uniform vec3 objIDv3;","uniform sampler2D tID;","uniform float highlightIntensity;","uniform int highlightRange;","uniform int objIDStart;","uniform int objIDEnd;","varying vec2 vUv;",a.TonemapShaderChunk,"vec4 overlayEdgeDetect(vec2 vUv) {","#define IS_SELECTION(C) ( (C).b > (C).r && (C).b > (C).g )","#define CHECK_EDGE_ALPHA(I, J)     { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a > 0.0 && IS_SELECTION(c)) { hasEdge++; selectionPixel = c; } }","#define CHECK_EDGE_SELECTION(I, J) { vec4 c = texture2D( tOverlay, vUv+resolution*vec2((I),(J)) ); maxAlpha = max(maxAlpha, c.a); if (c.a <= 0.0) hasEdge++; }","int hasEdge = 0;","vec4 center = texture2D(tOverlay, vUv);","vec4 selectionPixel = vec4(0.0);","float maxAlpha = 0.0;","bool paintOutline = false;","if (center.a <= 0.0) {","CHECK_EDGE_ALPHA(-1.0,-1.0);","CHECK_EDGE_ALPHA( 0.0,-1.0);","CHECK_EDGE_ALPHA( 1.0,-1.0);","CHECK_EDGE_ALPHA(-1.0, 0.0);","CHECK_EDGE_ALPHA( 1.0, 0.0);","CHECK_EDGE_ALPHA(-1.0, 1.0);","CHECK_EDGE_ALPHA( 0.0, 1.0);","CHECK_EDGE_ALPHA( 1.0, 1.0);","if (hasEdge != 0) {","center = selectionPixel;","paintOutline = true;","}","}","else if (center.a > 0.0 && IS_SELECTION(center)) {","CHECK_EDGE_SELECTION(-1.0,-1.0);","CHECK_EDGE_SELECTION( 0.0,-1.0);","CHECK_EDGE_SELECTION( 1.0,-1.0);","CHECK_EDGE_SELECTION(-1.0, 0.0);","CHECK_EDGE_SELECTION( 1.0, 0.0);","CHECK_EDGE_SELECTION(-1.0, 1.0);","CHECK_EDGE_SELECTION( 0.0, 1.0);","CHECK_EDGE_SELECTION( 1.0, 1.0);","if (hasEdge != 0)","paintOutline = true;","else","center.a = -center.a;","}","if (paintOutline) {","float maxComponent = max(center.r, max(center.g, center.b));","center.rgb /= maxComponent;","center.rgb = sqrt(center.rgb);","center.a = 0.5 + 0.5 * maxAlpha * 0.125 * float(hasEdge);","}","return center;","}","vec4 sampleColor() {","return texture2D( tDiffuse, vUv );","}","float sampleAO() {","return (useAO != 0) ? texture2D(tAO, vUv).r : 1.0;","}","void main() {","vec4 texel = sampleColor();","texel.rgb *= sampleAO();","if (useOverlay != 0) {","vec4 overlay = overlayEdgeDetect(vUv);","if (overlay.a < 0.0) {","overlay.a = -overlay.a;","if (overlay.a >= 0.99) {","overlay.a = 0.75;","texel.rgb = vec3(luminance_post(texel.rgb));","}","}","texel.rgb = mix(texel.rgb, sqrt(overlay.rgb)/*sqrt=gamma*/, overlay.a);","}","if (highlightRange == 0) {","if (objID != 0) {","vec4 idAtPixel = texture2D(tID, vUv);","vec3 idDelta = abs(idAtPixel.rgb - objIDv3.rgb);","if (max(max(idDelta.r, idDelta.g), idDelta.b) < 1e-3) {","#ifdef IS_2D","texel.rgb = mix(texel.rgb, vec3(1.0,1.0,0.0), highlightIntensity * 0.25);","#else","texel.rgb += highlightIntensity * 0.2;","#endif","}","}","} else {","vec4 idAtPixel = texture2D(tID, vUv);","int dbId = int(idAtPixel.r * 255.0 + idAtPixel.g * 255.0 * 256.0 + idAtPixel.b * 255.0 * 256.0 * 256.0);","if (dbId >= objIDStart && dbId <= objIDEnd) {","#ifdef IS_2D","texel.rgb = mix(texel.rgb, vec3(1.0,1.0,0.0), highlightIntensity * 0.25);","#else","texel.rgb += highlightIntensity * 0.2;","#endif","}","}","gl_FragColor = texel;","}"].join("\n")})}function init_SAOShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.SAOShader&&(a.SAOShader={uniforms:{tDepth:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)},cameraNear:{type:"f",value:1},cameraFar:{type:"f",value:100},radius:{type:"f",value:10},bias:{type:"f",value:.01},projScale:{type:"f",value:500},projInfo:{type:"v4",value:new THREE.Vector4(0,0,0,0)},intensity:{type:"f",value:.5},isOrtho:{type:"f",value:1},tDepth_mip1:{type:"t",value:null},tDepth_mip2:{type:"t",value:null},tDepth_mip3:{type:"t",value:null},tDepth_mip4:{type:"t",value:null},tDepth_mip5:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define USE_MIPMAP 1","uniform float cameraNear;","uniform float cameraFar;","uniform vec2 size;","uniform vec2 resolution;","uniform float lumInfluence;","varying vec2 vUv;","#define NUM_SAMPLES (17)","#define LOG_MAX_OFFSET (3)","#define MAX_MIP_LEVEL (5)","#define NUM_SPIRAL_TURNS (7)","uniform float           projScale;","uniform sampler2D tDepth;","#ifdef USE_MIPMAP","uniform sampler2D tDepth_mip1;","uniform sampler2D tDepth_mip2;","uniform sampler2D tDepth_mip3;","uniform sampler2D tDepth_mip4;","uniform sampler2D tDepth_mip5;","#endif","uniform float radius;","uniform float bias;","uniform float intensity;","uniform float isOrtho;","vec2 tapLocation(int sampleNumber, float spinAngle, out float ssR){","float alpha = float(float(sampleNumber) + 0.5) * (1.0 / float(NUM_SAMPLES));","float angle = alpha * (float(NUM_SPIRAL_TURNS) * 6.28) + spinAngle;","ssR = alpha;","return vec2(cos(angle), sin(angle));","}","float CSZToKey(float z) {","return clamp(z * (1.0 / -cameraFar), 0.0, 1.0);","}","void packKey(float key, out vec2 p) {","float temp = floor(key * 256.0);","p.x = temp * (1.0 / 256.0);","p.y = key * 256.0 - temp;","}",a.PackDepthShaderChunk,"float unpackDepthNearFar( const in vec4 rgba_depth ) {","float depth = unpackDepth( rgba_depth );","if (depth == 0.0)","return -cameraFar * 1.0e10;","return depth * (cameraNear - cameraFar) - cameraNear;","}","uniform vec4 projInfo;","vec3 reconstructCSPosition(vec2 S, float z) {","return vec3((S.xy * projInfo.xy + projInfo.zw) * mix(z, -1.0, isOrtho), z);","}","vec3 reconstructCSFaceNormal(vec3 C) {","return normalize(cross(dFdy(C), dFdx(C)));","}","vec3 reconstructNonUnitCSFaceNormal(vec3 C) {","return cross(dFdy(C), dFdx(C));","}","vec3 getPosition(ivec2 ssP, float depth) {","vec3 P;","P = reconstructCSPosition(vec2(ssP) + vec2(0.5), depth);","return P;","}","vec3 getOffsetPosition(ivec2 ssC, vec2 unitOffset, float ssR) {","ivec2 ssP = ivec2(ssR * unitOffset) + ssC;","vec3 P;","vec2 screenUV = (vec2(ssP) + vec2(0.5)) * resolution;","#ifdef USE_MIPMAP","int mipLevel = int(max(0.0, min(floor(log2(ssR)) - float(LOG_MAX_OFFSET), float(MAX_MIP_LEVEL))));","if (mipLevel == 0) {","P.z = texture2D(tDepth, screenUV).z;","if (P.z == 0.0) P.z = -cameraFar * 1.0e10;","}","else if (mipLevel == 1)","P.z = unpackDepthNearFar(texture2D(tDepth_mip1, screenUV));","else if (mipLevel == 2)","P.z = unpackDepthNearFar(texture2D(tDepth_mip2, screenUV));","else if (mipLevel == 3)","P.z = unpackDepthNearFar(texture2D(tDepth_mip3, screenUV));","else if (mipLevel == 4)","P.z = unpackDepthNearFar(texture2D(tDepth_mip4, screenUV));","else if (mipLevel == 5)","P.z = unpackDepthNearFar(texture2D(tDepth_mip5, screenUV));","#else","P.z = texture2D(tDepth, screenUV).z;","if (P.z == 0.0) P.z = -cameraFar * 1.0e10;","#endif","P = reconstructCSPosition(vec2(ssP) + vec2(0.5), P.z);","return P;","}","float sampleAO(in ivec2 ssC, in vec3 C, in vec3 n_C, in float ssDiskRadius, in int tapIndex, in float randomPatternRotationAngle) {","float ssR;","vec2 unitOffset = tapLocation(tapIndex, randomPatternRotationAngle, ssR);","ssR *= ssDiskRadius;","vec3 Q = getOffsetPosition(ssC, unitOffset, ssR);","vec3 v = Q - C;","float vv = dot(v, v);","float vn = dot(v, n_C);","const float epsilon = 0.01;","float f = max(radius * radius - vv, 0.0); return f * f * f * max((vn - bias) / (epsilon + vv), 0.0);","}","const bool useNoise = true;","vec2 rand( const vec2 coord ) {","vec2 noise;","if ( useNoise ) {","float nx = dot ( coord, vec2( 12.9898, 78.233 ) );","float ny = dot ( coord, vec2( 12.9898, 78.233 ) * 2.0 );","noise = clamp( fract ( 43758.5453 * sin( vec2( nx, ny ) ) ), 0.0, 1.0 );","} else {","float ff = fract( 1.0 - coord.s * ( size.x / 2.0 ) );","float gg = fract( coord.t * ( size.y / 2.0 ) );","noise = vec2( 0.25, 0.75 ) * vec2( ff ) + vec2( 0.75, 0.25 ) * gg;","}","return ( noise * 2.0  - 1.0 );","}","float getRandomAngle(vec2 pos) {","vec2 rnd = rand(pos);","return atan(rnd.y, rnd.x);","}","void main() {","ivec2 ssC = ivec2(gl_FragCoord.xy);","vec4 nrmz = texture2D(tDepth, vUv);","if (nrmz.z == 0.0) {","gl_FragColor.r = 1.0;","gl_FragColor.a = 0.0;","packKey(1.0, gl_FragColor.gb);","return;","}","vec3 C = getPosition(ssC, nrmz.z);","packKey(CSZToKey(C.z), gl_FragColor.gb);","float randomPatternRotationAngle = getRandomAngle(vUv);","vec3 n_C = vec3(nrmz.x, nrmz.y, sqrt(1.0 - dot(nrmz.xy, nrmz.xy)));","float ssDiskRadius = -projScale * radius / mix(C.z, -1.0, isOrtho);","float sum = 0.0;","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 0, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 1, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 2, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 3, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 4, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 5, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 6, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 7, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 8, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 9, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 10, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 11, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 12, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 13, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 14, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 15, randomPatternRotationAngle);","sum += sampleAO(ssC, C, n_C, ssDiskRadius, 16, randomPatternRotationAngle);","float intensityDivR6 = intensity / pow(radius, 6.0);","float A = max(0.0, 1.0 - sum * intensityDivR6 * (5.0 / float(NUM_SAMPLES)));","if (abs(dFdx(C.z)) < 0.02) {","A -= dFdx(A) * (mod(float(ssC.x), 2.0) - 0.5);","}","if (abs(dFdy(C.z)) < 0.02) {","A -= dFdy(A) * (mod(float(ssC.y), 2.0) - 0.5);","}","gl_FragColor.r = A;","gl_FragColor.a = 1.0;","}"].join("\n")})}function init_SAOBlurShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.SAOBlurShader&&(a.SAOBlurShader={uniforms:{tDiffuse:{type:"t",value:null},size:{type:"v2",value:new THREE.Vector2(512,512)},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)},axis:{type:"v2",value:new THREE.Vector2(1,0)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["#define EDGE_SHARPNESS     (1.0)","#define SCALE               (2)","#define R                   (4)","#define VALUE_TYPE        float","#define VALUE_COMPONENTS   r","#define VALUE_IS_KEY       0","#define KEY_COMPONENTS     gb","#if __VERSION__ >= 330","const float gaussian[R + 1] =","float[](0.153170, 0.144893, 0.122649, 0.092902, 0.062970);  // stddev = 2.0","#endif","uniform sampler2D   tDiffuse;","uniform vec2 size;","uniform vec2 resolution;","uniform vec2       axis;","#define  result         gl_FragColor.VALUE_COMPONENTS","#define  keyPassThrough gl_FragColor.KEY_COMPONENTS","float unpackKey(vec2 p) {","return p.x * (256.0 / 257.0) + p.y * (1.0 / 257.0);","}","varying vec2 vUv;","void main() {","#   if __VERSION__ < 330","float gaussian[R + 1];","#       if R == 3","gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902;  // stddev = 2.0","#       elif R == 4","gaussian[0] = 0.153170; gaussian[1] = 0.144893; gaussian[2] = 0.122649; gaussian[3] = 0.092902; gaussian[4] = 0.062970;  // stddev = 2.0","#       elif R == 6","gaussian[0] = 0.111220; gaussian[1] = 0.107798; gaussian[2] = 0.098151; gaussian[3] = 0.083953; gaussian[4] = 0.067458; gaussian[5] = 0.050920; gaussian[6] = 0.036108;","#       endif","#   endif","ivec2 axisi = ivec2(axis);","ivec2 ssC = ivec2(gl_FragCoord.xy);","vec4 temp = texture2D(tDiffuse, vUv);","gl_FragColor.gb = temp.KEY_COMPONENTS;","gl_FragColor.a = temp.a;","VALUE_TYPE sum = temp.VALUE_COMPONENTS;","if (temp.a == 0.0) {","result = sum;","return;","}","float key = unpackKey(keyPassThrough);","float BASE = gaussian[0];","float totalWeight = BASE;","sum *= totalWeight;","int r = -4; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[4];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = -3; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[3];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = -2; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[2];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r=-1; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[1];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = 1; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[1];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = 2; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[2];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = 3; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[3];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","r = 4; {","vec2 ssUV = vec2(ssC + axisi * (r * SCALE))*resolution;","temp = texture2D(tDiffuse, ssUV);","float      tapKey = unpackKey(temp.KEY_COMPONENTS);","VALUE_TYPE value  = temp.VALUE_COMPONENTS;","float weight = 0.3 + gaussian[4];","float dz = tapKey - key;","weight *= max(0.0, 1.0 - (EDGE_SHARPNESS * 2000.0) * abs(dz));","sum += value * weight;","totalWeight += weight;","}","const float epsilon = 0.0001;","result = sum / (totalWeight + epsilon);","}"].join("\n")})}function init_SAOMinifyShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.SAOMinifyFirstShader&&(a.SAOMinifyFirstShader={uniforms:{tDiffuse:{type:"t",value:null},cameraNear:{type:"f",value:1},cameraInvNearFar:{type:"f",value:100},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","uniform float cameraNear;","uniform float cameraInvNearFar;",a.PackDepthShaderChunk,"void main() {","vec2 ssP = vec2(gl_FragCoord.xy);","ssP = ssP * 2.0 + mod(ssP, 2.0);","ssP = (ssP + 0.5) * resolution * 0.5;","float depth = texture2D(tDiffuse, ssP).z;","if (depth != 0.0)","depth = (depth + cameraNear) * cameraInvNearFar;","gl_FragColor = packDepth(depth);","}"].join("\n")},a.SAOMinifyShader={uniforms:{tDiffuse:{type:"t",value:null},resolution:{type:"v2",value:new THREE.Vector2(1/512,1/512)}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 resolution;","void main() {","vec2 ssP = vec2(gl_FragCoord.xy);","ssP = ssP * 2.0 + mod(ssP, 2.0);","ssP = (ssP + 0.5) * resolution * 0.5;","gl_FragColor = texture2D(tDiffuse, ssP);","}"].join("\n")})}function init_FireflyPhongShader(){var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.FireflyPhongShader&&(a.FireflyPhongShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.lights,a.CutPlanesUniforms,a.IdUniforms,{emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},reflMipIndex:{type:"f",value:0},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)},texMatrix:{type:"m3",value:new THREE.Matrix3},texMatrixBump:{type:"m3",value:new THREE.Matrix3},texMatrixAlpha:{type:"m3",value:new THREE.Matrix3},irradianceMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1}}]),vertexShader:["varying vec3 vViewPosition;","#ifndef FLAT_SHADED","varying vec3 vNormal;","#endif","#if defined( USE_MAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform mat3 texMatrix;","#endif","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec2 vUvBump;","uniform mat3 texMatrixBump;","#endif","#if defined( USE_ALPHAMAP )","varying vec2 vUvAlpha;","uniform mat3 texMatrixAlpha;","#endif","#if defined( USE_ENVMAP )","#if ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","uniform float refractionRatio;","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif","#ifdef USE_COLOR","varying vec3 vColor;","#endif","#ifdef USE_LOGDEPTHBUF","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;","#endif","uniform float logDepthBufFC;","#endif","#ifdef MRT_NORMALS","varying float depth;","#endif",a.PackNormalsShaderChunk,"void main() {","#if defined( USE_MAP ) || defined( USE_SPECULARMAP )","vUv = (texMatrix * vec3(uv, 1.0)).xy;","#endif","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vUvBump = (texMatrixBump * vec3(uv, 1.0)).xy;","#endif","#if defined( USE_ALPHAMAP )","vUvAlpha = (texMatrixAlpha * vec3(uv, 1.0)).xy;","#endif","#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif","#ifdef UNPACK_NORMALS","vec3 objectNormal = decodeNormal(normal);","#else","vec3 objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;","#ifndef FLAT_SHADED","vNormal = normalize( transformedNormal );","#endif","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","#endif","#ifdef USE_LOGDEPTHBUF","if (projectionMatrix[3][3] == 0.0) {","gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;","#ifdef USE_LOGDEPTHBUF_EXT","vFragDepth = 1.0 + gl_Position.w;","#else","gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;","#endif","} else {","#ifdef USE_LOGDEPTHBUF_EXT","vFragDepth = 1.0 + vViewPosition.z;","#else","#endif","}","#endif","#ifdef MRT_NORMALS","depth = mvPosition.z;","#endif","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",a.EnvSamplingShaderChunk,"#ifdef USE_COLOR","varying vec3 vColor;","#endif","#ifdef GAMMA_INPUT","vec3 InputToLinear(vec3 c) {","return c * c;","}","float InputToLinear(float c) {","return c * c;","}","#else","vec3 InputToLinear(vec3 c) {","return c;","}","float InputToLinear(float c) {","return c;","}","#endif","#if defined( USE_MAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","varying vec2 vUvBump;","#endif","#if defined( USE_ALPHAMAP )","varying vec2 vUvAlpha;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif","#if TONEMAP_OUTPUT > 0","uniform float exposureBias;",a.TonemapShaderChunk,"#endif","#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)","uniform float envMapExposure;","#endif","#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)","uniform vec4 dbId;","#endif","vec3 RGBMDecode(in vec4 vRGBM, in float exposure) {","vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);","ret *= ret;","ret *= exposure;","return ret;","}","vec3 GammaDecode(in vec4 vRGBA, in float exposure) {","return vRGBA.xyz * vRGBA.xyz * exposure;","}","#ifdef USE_ENVMAP","uniform float reflMipIndex;","uniform float reflectivity;","uniform samplerCube envMap;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform float refractionRatio;","#endif","vec3 sampleReflection(vec3 dir, float mipIndex) {","vec3 adjDir = adjustLookupVector(dir);","#ifdef ENV_GAMMA","#ifdef HAVE_TEXTURE_LOD","vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );","#else","vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );","#endif","return GammaDecode(envTexColor, envMapExposure);","#elif defined(ENV_RGBM)","#ifdef HAVE_TEXTURE_LOD","vec4 envTexColor = textureCubeLodEXT( envMap, adjDir, mipIndex );","#else","vec4 envTexColor = textureCube( envMap, adjDir, mipIndex );","#endif","return RGBMDecode(envTexColor, envMapExposure);","#else","vec4 envTexColor = textureCube( envMap, adjDir );","vec3 cubeColor = envTexColor.xyz;","#ifdef GAMMA_INPUT","cubeColor *= cubeColor;","#endif","return cubeColor;","#endif","}","#endif","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef USE_IRRADIANCEMAP","uniform samplerCube irradianceMap;","#endif","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","varying highp vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying highp vec3 vViewPosition;","#ifndef FLAT_SHADED","varying highp vec3 vNormal;","#endif","#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUvBump );","vec2 dSTdy = dFdy( vUvBump );","float Hll = bumpScale * GET_BUMPMAP(vUvBump).x;","float dBx = bumpScale * GET_BUMPMAP(vUvBump + dSTdx).x - Hll;","float dBy = bumpScale * GET_BUMPMAP(vUvBump + dSTdy).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif","#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUvBump.st );","vec2 st1 = dFdy( vUvBump.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = GET_NORMALMAP(vUvBump).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif","#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif","#ifdef USE_ALPHAMAP","uniform sampler2D alphaMap;","#endif",a.HatchPatternShaderChunk,"#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)","varying highp float depth;","#define gl_FragColor gl_FragData[0]","#endif","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#ifdef USE_LOGDEPTHBUF_EXT","#extension GL_EXT_frag_depth : enable","varying highp float vFragDepth;","#endif","#endif","vec3 Schlick_v3(vec3 v, float cosHV) {","float facing = max(1.0 - cosHV, 0.0);","float facing2 = facing * facing;","return v + (1.0 - v) * facing * facing2 * facing2;","}","float Schlick_f(float v, float cosHV) {","float facing = max(1.0 - cosHV, 0.0);","float facing2 = facing * facing;","return v + ( 1.0 - v ) * facing2 * facing2 * facing;","}",a.CutPlanesShaderChunk,"void main() {","#if NUM_CUTPLANES > 0","if (checkCutPlanes(vWorldPosition)) return;","#endif","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );","#ifdef USE_MAP","vec4 texelColor = GET_MAP(vUv);","#ifdef MAP_INVERT","texelColor.xyz = 1.0-texelColor.xyz;","#endif","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif","#ifdef USE_ALPHAMAP","vec4 texelAlpha = GET_ALPHAMAP(vUvAlpha);","gl_FragColor.a *= texelAlpha.r;","#endif","#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif","float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = GET_SPECULARMAP(vUv);","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif","#ifndef FLAT_SHADED","vec3 normal = normalize( vNormal );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#else","vec3 fdx = dFdx( vViewPosition );","vec3 fdy = dFdy( vViewPosition );","vec3 normal = normalize( cross( fdx, fdy ) );","#endif","vec3 geomNormal = normal;","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","vec3 viewDirection;","if (projectionMatrix[3][3] == 0.0) {","viewDirection = normalize( vViewPosition );","} else {","viewDirection = vec3(0.0, 0.0, 1.0);","}","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","float shininessB = shininess * 4.0;","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += InputToLinear(diffuse) * InputToLinear(pointLightColor[ i ]) * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewDirection );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininessB ), 0.0 );","float specularNormalization = shininessB * 0.125 + 0.25;","vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, pointHalfVector ) );","pointSpecular += schlick * InputToLinear(pointLightColor[ i ]) * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization ;","}","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += InputToLinear(diffuse) * InputToLinear(spotLightColor[ i ]) * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewDirection );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininessB ), 0.0 );","float specularNormalization = shininessB * 0.125 + 0.25;","vec3 schlick = Schlick_v3(InputToLinear(specular), dot( lVector, spotHalfVector ) );","spotSpecular += schlick * InputToLinear(spotLightColor[ i ]) * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","}","}","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += InputToLinear(diffuse) * InputToLinear(directionalLightColor[ i ]) * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewDirection );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininessB ), 0.0 );","float specularNormalization = shininessB * 0.125 + 0.25;","vec3 schlick = Schlick_v3(InputToLinear(specular), dot( dirVector, dirHalfVector ));","dirSpecular += schlick * InputToLinear(directionalLightColor[ i ]) * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","}","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#ifdef USE_IRRADIANCEMAP","vec3 worldNormal = mat3(viewMatrixInverse) * normal;","vec4 cubeColor4 = textureCube(irradianceMap, adjustLookupVector(worldNormal));","#ifdef IRR_GAMMA","vec3 indirectDiffuse = GammaDecode(cubeColor4, envMapExposure);","#elif defined(IRR_RGBM)","vec3 indirectDiffuse = RGBMDecode(cubeColor4, envMapExposure);","#else","vec3 indirectDiffuse = cubeColor4.xyz;","#ifdef GAMMA_INPUT","indirectDiffuse.xyz *= indirectDiffuse.xyz;","#endif","#endif","totalDiffuse += InputToLinear(diffuse) * indirectDiffuse;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( InputToLinear(emissive) + totalDiffuse + ambientLightColor * InputToLinear(diffuse) ) + totalSpecular;","#endif","#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif","#if defined(USE_ENVMAP)","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","#ifdef ENVMAP_MODE_REFLECTION","reflectVec = reflect( -viewDirection, normal );","#else ","reflectVec = refract( -viewDirection, normal, refractionRatio );","#endif","#else","reflectVec = reflect( -viewDirection, normal );","#endif","reflectVec = mat3(viewMatrixInverse) * reflectVec;","float reflectScale = 1.0;","vec3 cubeColor = sampleReflection(reflectVec, reflMipIndex);","cubeColor *= reflectScale;","float facing = dot( viewDirection, geomNormal );","if (facing < -1e-2)","facing = 1.0;","else","facing = max(1e-6, facing);","vec3 schlickRefl;","#ifdef METAL","schlickRefl = InputToLinear(specular);","#else","schlickRefl = Schlick_v3(InputToLinear(specular), facing);","gl_FragColor.a = mix(gl_FragColor.a, Schlick_f(gl_FragColor.a, facing), reflectivity);","float invSchlick = (1.0 - facing * 0.5);","float invSchlick2 = invSchlick * invSchlick;","float norm_factor = 1.0 - invSchlick * invSchlick2 * invSchlick2;","norm_factor = (28.0 / 23.0) * norm_factor;","gl_FragColor.xyz *= norm_factor * (1.0 - InputToLinear(specular));","#endif","gl_FragColor.xyz += cubeColor.xyz * specularStrength * schlickRefl.xyz;","#ifdef CLEARCOAT","vec3 reflectVecClearcoat = reflect( -viewDirection, geomNormal );","reflectVecClearcoat = mat3(viewMatrixInverse) * reflectVecClearcoat;","vec3 cubeColorClearcoat = sampleReflection(reflectVecClearcoat, 0.0);","float schlickClearcoat = Schlick_f(InputToLinear(reflectivity), facing);","gl_FragColor.xyz = mix(gl_FragColor.xyz, cubeColorClearcoat * schlickClearcoat, 0.5);","#endif","#endif","#if TONEMAP_OUTPUT == 1","gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);","#elif TONEMAP_OUTPUT == 2","gl_FragColor.xyz = toneMapCanonFilmic_WithGamma( exposureBias * gl_FragColor.xyz );","#endif",a.FinalOutputShaderChunk,"}"].join("\n")
},THREE.ShaderLib.firefly_phong=a.FireflyPhongShader)}function init_FireflyPrismShader(){function a(a){var b=a+"_texMatrix",c=a+"_invert",d={};return d[a]={type:"t",value:null},d[b]={type:"m3",value:new THREE.Matrix3},d[c]={type:"i",value:0},d}function b(a){var b=a+"_texMatrix",c=a+"_bumpScale",d=a+"_bumpmapType",e={};return e[a]={type:"t",value:null},e[b]={type:"m3",value:new THREE.Matrix3},e[c]={type:"v2",value:new THREE.Vector2(1,1)},e[d]={type:"i",value:0},e}function c(a){var b=["#if defined( USE_SURFACE_ALBEDO_MAP ) || defined( USE_SURFACE_ROUGHNESS_MAP ) || defined( USE_SURFACE_CUTOUT_MAP ) || defined( USE_SURFACE_ANISOTROPY_MAP ) || defined( USE_SURFACE_ROTATION_MAP ) || defined( USE_OPAQUE_ALBEDO_MAP ) || defined( USE_OPAQUE_F0_MAP ) || defined( USE_OPAQUE_LUMINANCE_MODIFIER_MAP ) || defined( USE_LAYERED_BOTTOM_F0_MAP ) || defined( USE_LAYERED_F0_MAP ) || defined( USE_LAYERED_DIFFUSE_MAP ) || defined( USE_LAYERED_FRACTION_MAP ) || defined( USE_LAYERED_ROUGHNESS_MAP ) || defined( USE_LAYERED_ANISOTROPY_MAP ) || defined( USE_LAYERED_ROTATION_MAP ) || defined( USE_METAL_F0_MAP ) || defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )",a,"#endif"].join("\n");return b}function d(a,b,c,d){var e=c?"_v3":"",f=c?"vec3 ":"",g=c?b+" = averageOfFloat3("+b+e+");":"",h=d?b+e+" = SRGBToLinear("+b+e+");":"",i=["#if defined( USE_"+a.toUpperCase()+"_MAP )","vec2 uv_"+a+"_map = ("+a+"_map_texMatrix * vec3(vUv, 1.0)).xy;",f+b+e+" = texture2D("+a+"_map, uv_"+a+"_map).xyz;",h,"if("+a+"_map_invert) "+b+e+" = vec3(1.0) - "+b+e+";",g,"#else",b+" = "+a+";","#endif"].join("\n");return i}function e(a){var b=a+"_texMatrix",c=a+"_invert",d="USE_"+a,e=["#if defined( "+d.toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform bool "+c+";","#endif"].join("\n");return e}function f(a){var b=a+"_texMatrix",c=a+"_bumpScale",d=a+"_bumpmapType",e="USE_"+a,f=["#if defined( "+e.toUpperCase()+" )","uniform sampler2D "+a+";","uniform mat3 "+b+";","uniform vec2 "+c+";","uniform int "+d+";","#endif"].join("\n");return f}var g=Autodesk.Viewing.Shaders,h=Autodesk.Viewing.Private;"undefined"==typeof g.PrismShader&&(g.PrismShader={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.lights,g.CutPlanesUniforms,g.IdUniforms,a("surface_albedo_map"),a("surface_roughness_map"),a("surface_cutout_map"),a("surface_anisotropy_map"),a("surface_rotation_map"),a("opaque_albedo_map"),a("opaque_f0_map"),a("opaque_luminance_modifier_map"),a("layered_bottom_f0_map"),a("layered_f0_map"),a("layered_diffuse_map"),a("layered_fraction_map"),a("layered_roughness_map"),a("layered_anisotropy_map"),a("layered_rotation_map"),a("metal_f0_map"),b("surface_normal_map"),b("layered_normal_map"),{surface_albedo:{type:"c",value:new THREE.Color(1118481)},surface_roughness:{type:"f",value:1},surface_anisotropy:{type:"f",value:1},surface_rotation:{type:"f",value:1},opaque_albedo:{type:"c",value:new THREE.Color(1118481)},opaque_f0:{type:"f",value:1},opaque_luminance_modifier:{type:"c",value:new THREE.Color(1118481)},opaque_luminance:{type:"f",value:1},metal_f0:{type:"c",value:new THREE.Color(1118481)},layered_f0:{type:"f",value:1},layered_diffuse:{type:"c",value:new THREE.Color(0)},layered_fraction:{type:"f",value:1},layered_bottom_f0:{type:"c",value:new THREE.Color(1118481)},layered_roughness:{type:"f",value:1},layered_anisotropy:{type:"f",value:1},layered_rotation:{type:"f",value:1},transparent_ior:{type:"f",value:2},transparent_color:{type:"c",value:new THREE.Color(1118481)},transparent_distance:{type:"f",value:1},wood_fiber_cosine_enable:{type:"i",value:1},wood_fiber_cosine_bands:{type:"i",value:2},wood_fiber_cosine_weights:{type:"v4",value:new THREE.Vector4(2.5,.5,1,1)},wood_fiber_cosine_frequencies:{type:"v4",value:new THREE.Vector4(15,4,1,1)},wood_fiber_perlin_enable:{type:"i",value:1},wood_fiber_perlin_bands:{type:"i",value:3},wood_fiber_perlin_weights:{type:"v4",value:new THREE.Vector4(3,1,.2,1)},wood_fiber_perlin_frequencies:{type:"v4",value:new THREE.Vector4(40,20,3.5,1)},wood_fiber_perlin_scale_z:{type:"f",value:.3},wood_growth_perlin_enable:{type:"i",value:1},wood_growth_perlin_bands:{type:"i",value:3},wood_growth_perlin_weights:{type:"v4",value:new THREE.Vector4(1,2,1,1)},wood_growth_perlin_frequencies:{type:"v4",value:new THREE.Vector4(1,5,13,1)},wood_latewood_ratio:{type:"f",value:.238},wood_earlywood_sharpness:{type:"f",value:.395},wood_latewood_sharpness:{type:"f",value:.109},wood_ring_thickness:{type:"f",value:.75},wood_earlycolor_perlin_enable:{type:"i",value:1},wood_earlycolor_perlin_bands:{type:"i",value:2},wood_earlycolor_perlin_weights:{type:"v4",value:new THREE.Vector4(.3,.5,.15,1)},wood_earlycolor_perlin_frequencies:{type:"v4",value:new THREE.Vector4(8,3,.35,1)},wood_early_color:{type:"c",value:new THREE.Color(.286,.157,.076)},wood_use_manual_late_color:{type:"i",value:0},wood_manual_late_color:{type:"c",value:new THREE.Color(.62,.35,.127)},wood_latecolor_perlin_enable:{type:"i",value:1},wood_latecolor_perlin_bands:{type:"i",value:1},wood_latecolor_perlin_weights:{type:"v4",value:new THREE.Vector4(.75,.55,1,1)},wood_latecolor_perlin_frequencies:{type:"v4",value:new THREE.Vector4(4.5,.05,1,1)},wood_late_color_power:{type:"f",value:1.25},wood_diffuse_perlin_enable:{type:"i",value:1},wood_diffuse_perlin_bands:{type:"i",value:3},wood_diffuse_perlin_weights:{type:"v4",value:new THREE.Vector4(.15,.2,.05,1)},wood_diffuse_perlin_frequencies:{type:"v4",value:new THREE.Vector4(.05,.1,3,1)},wood_diffuse_perlin_scale_z:{type:"f",value:.2},wood_use_pores:{type:"i",value:1},wood_pore_type:{type:"i",value:0},wood_pore_radius:{type:"f",value:.04},wood_pore_cell_dim:{type:"f",value:.15},wood_pore_color_power:{type:"f",value:1.45},wood_pore_depth:{type:"f",value:.02},wood_use_rays:{type:"i",value:1},wood_ray_color_power:{type:"f",value:1.1},wood_ray_seg_length_z:{type:"f",value:5},wood_ray_num_slices:{type:"f",value:160},wood_ray_ellipse_z2x:{type:"f",value:10},wood_ray_ellipse_radius_x:{type:"f",value:.2},wood_use_latewood_bump:{type:"i",value:1},wood_latewood_bump_depth:{type:"f",value:.01},wood_use_groove_roughness:{type:"i",value:1},wood_groove_roughness:{type:"f",value:.85},wood_diffuse_lobe_weight:{type:"f",value:.9},permutationMap:{type:"t",value:null},gradientMap:{type:"t",value:null},perm2DMap:{type:"t",value:null},permGradMap:{type:"t",value:null},irradianceMap:{type:"t",value:null},envMap:{type:"t",value:null},exposureBias:{type:"f",value:1},envMapExposure:{type:"f",value:1},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},envExponentMin:{type:"f",value:1},envExponentMax:{type:"f",value:512},envExponentCount:{type:"f",value:10}}]),vertexShader:["varying vec3 vViewPosition;","varying vec3 vNormal;","#if defined(PRISMWOOD) && !defined(NO_UVW)","varying vec3 vUvw;","#endif","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif",c("#define USE_MAP"),"#ifdef USE_MAP","varying vec2 vUv;","#endif","#ifdef USE_LOGDEPTHBUF","#ifdef USE_LOGDEPTHBUF_EXT","varying float vFragDepth;","#endif","uniform float logDepthBufFC;","#endif","#ifdef MRT_NORMALS","varying float depth;","#endif",g.PackNormalsShaderChunk,"#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0)","varying vec3 vTangent;","varying vec3 vBitangent;","void ComputeTangents(vec3 normal, out vec3 u, out vec3 v)","{","    float scale = normal.z < 0.0 ? -1.0 : 1.0;","    vec3 temp = scale * normal;","    float e    = temp.z;","    float h    = 1.0/(1.0 + e);","    float hvx  = h   *  temp.y;","    float hvxy = hvx * -temp.x;","    u = vec3(e + hvx * temp.y, hvxy,                -temp.x);","    v = vec3(hvxy,             e + h * temp.x * temp.x, -temp.y);","    u *= scale;","    v *= scale;","}","#endif","void main() {","#ifdef USE_MAP","vUv = uv;","#endif","#if defined(PRISMWOOD) && !defined(NO_UVW)","vUvw = uvw;","#endif","#ifdef UNPACK_NORMALS","vec3 objectNormal = decodeNormal(normal);","#else","vec3 objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;","vNormal = normalize( transformedNormal );","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vViewPosition = -mvPosition.xyz;","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","#endif","#if !defined(USE_MAP) && (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0)","vec3 Tu, Tv;","ComputeTangents(vNormal, Tu, Tv);","vTangent = Tu;","vBitangent = Tv;","#endif","#ifdef USE_LOGDEPTHBUF","if (projectionMatrix[3][3] == 0.0) {","gl_Position.z = log2(max(1.0e-6, gl_Position.w + 1.0)) * logDepthBufFC;","#ifdef USE_LOGDEPTHBUF_EXT","vFragDepth = 1.0 + gl_Position.w;","#else","gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;","#endif","} else {","#ifdef USE_LOGDEPTHBUF_EXT","vFragDepth = 1.0 + vViewPosition.z;","#else","#endif","}","#endif","#ifdef MRT_NORMALS","depth = mvPosition.z;","#endif","}"].join("\n"),fragmentShader:["//**************************************************************************/","// Copyright 2015 Autodesk, Inc. ","// All rights reserved.","// ","// This computer source code and related instructions and comments are the ","// unpublished confidential and proprietary information of Autodesk, Inc. ","// and are protected under Federal copyright and state trade secret law. ","// They may not be disclosed to, copied or used by any third party without","// the prior written consent of Autodesk, Inc. ","//**************************************************************************/ ","#define PI 3.141592654","#define RECIPROCAL_PI 0.318309886","#define RECIPROCAL_2PI 0.159154943","#define ONE 0.00390625","uniform vec3 surface_albedo;","uniform float surface_roughness;","uniform float surface_anisotropy;","uniform float surface_rotation;","#if defined( PRISMOPAQUE )","uniform vec3 opaque_albedo;","uniform float opaque_f0;","uniform vec3 opaque_luminance_modifier;","uniform float opaque_luminance;","#elif defined( PRISMMETAL )","uniform vec3 metal_f0;","#elif defined( PRISMLAYERED )","uniform float layered_f0;","uniform vec3 layered_diffuse;","uniform float layered_fraction;","uniform vec3 layered_bottom_f0;","uniform float layered_roughness;","uniform float layered_anisotropy;","uniform float layered_rotation;","#elif defined( PRISMTRANSPARENT )","uniform float transparent_ior;","uniform vec3 transparent_color;","uniform float transparent_distance;","#elif defined( PRISMWOOD )","uniform bool wood_fiber_cosine_enable;","uniform int wood_fiber_cosine_bands;","uniform vec4 wood_fiber_cosine_weights;","uniform vec4 wood_fiber_cosine_frequencies;","uniform bool wood_fiber_perlin_enable;","uniform int wood_fiber_perlin_bands;","uniform vec4 wood_fiber_perlin_weights;","uniform vec4 wood_fiber_perlin_frequencies;","uniform float wood_fiber_perlin_scale_z;","uniform bool wood_growth_perlin_enable;","uniform int wood_growth_perlin_bands;","uniform vec4 wood_growth_perlin_weights;","uniform vec4 wood_growth_perlin_frequencies;","uniform float wood_latewood_ratio;","uniform float wood_earlywood_sharpness;","uniform float wood_latewood_sharpness;","uniform float wood_ring_thickness;","uniform bool wood_earlycolor_perlin_enable;","uniform int wood_earlycolor_perlin_bands;","uniform vec4 wood_earlycolor_perlin_weights;","uniform vec4 wood_earlycolor_perlin_frequencies;","uniform vec3 wood_early_color;","uniform bool wood_use_manual_late_color;","uniform vec3 wood_manual_late_color;","uniform bool wood_latecolor_perlin_enable;","uniform int wood_latecolor_perlin_bands;","uniform vec4 wood_latecolor_perlin_weights;","uniform vec4 wood_latecolor_perlin_frequencies;","uniform float wood_late_color_power;","uniform bool wood_diffuse_perlin_enable;","uniform int wood_diffuse_perlin_bands;","uniform vec4 wood_diffuse_perlin_weights;","uniform vec4 wood_diffuse_perlin_frequencies;","uniform float wood_diffuse_perlin_scale_z;","uniform bool wood_use_pores;","uniform int wood_pore_type;","uniform float wood_pore_radius;","uniform float wood_pore_cell_dim;","uniform float wood_pore_color_power;","uniform float wood_pore_depth;","uniform bool wood_use_rays;","uniform float wood_ray_color_power;","uniform float wood_ray_seg_length_z;","uniform float wood_ray_num_slices;","uniform float wood_ray_ellipse_z2x;","uniform float wood_ray_ellipse_radius_x;","uniform bool wood_use_latewood_bump;","uniform float wood_latewood_bump_depth;","uniform bool wood_use_groove_roughness;","uniform float wood_groove_roughness;","uniform float wood_diffuse_lobe_weight;","uniform sampler2D permutationMap;","uniform sampler2D gradientMap;","uniform sampler2D perm2DMap;","uniform sampler2D permGradMap;","#endif","uniform float envExponentMin;","uniform float envExponentMax;","uniform float envExponentCount;",g.EnvSamplingShaderChunk,"#if TONEMAP_OUTPUT > 0","uniform float exposureBias;",g.TonemapShaderChunk,"#endif","#if defined(MRT_NORMALS) || defined(MRT_ID_BUFFER)","varying highp float depth;","#define gl_FragColor gl_FragData[0]","#endif","#if MAX_SPOT_LIGHTS > 0 || NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif","#ifdef USE_LOGDEPTHBUF","uniform float logDepthBufFC;","#ifdef USE_LOGDEPTHBUF_EXT","#extension GL_EXT_frag_depth : enable","varying highp float vFragDepth;","#endif","#endif","#if defined(MRT_ID_BUFFER) || defined(ID_COLOR)","uniform vec4 dbId;","#endif",c("#define USE_MAP"),"#ifdef USE_MAP","varying vec2 vUv;","#endif","#if defined(PRISMWOOD) && !defined(NO_UVW)","varying vec3 vUvw;","#endif",e("surface_albedo_map"),e("surface_roughness_map"),e("surface_cutout_map"),e("surface_anisotropy_map"),e("surface_rotation_map"),e("opaque_albedo_map"),e("opaque_f0_map"),e("opaque_luminance_modifier_map"),e("layered_bottom_f0_map"),e("layered_f0_map"),e("layered_diffuse_map"),e("layered_fraction_map"),e("layered_roughness_map"),e("layered_anisotropy_map"),e("layered_rotation_map"),e("metal_f0_map"),f("surface_normal_map"),f("layered_normal_map"),"vec3 RGBMDecode(in vec4 vRGBM, in float exposure) {","vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);","ret *= ret;","ret *= exposure;","return ret;","}","vec3 GammaDecode(in vec4 vRGBA, in float exposure) {","return vRGBA.xyz * vRGBA.xyz * exposure;","}","float SRGBToLinearComponent(float color) {","float result = color;","if (result<=0.04045)","result *= 0.07739938;","else","result = pow(abs((result+0.055)*0.947867298), 2.4);","return result;","}","vec3 SRGBToLinear(vec3 color) {","vec3 result = color;","result.x = SRGBToLinearComponent(result.x);","result.y = SRGBToLinearComponent(result.y);","result.z = SRGBToLinearComponent(result.z);","return result;","}","#if defined( USE_ENVMAP )","uniform float envMapExposure;","uniform samplerCube envMap;","#endif","float averageOfFloat3(in vec3 value)","{ ","    const float oneThird = 1.0 / 3.0; ","    return dot(value, vec3(oneThird, oneThird, oneThird)); ","} ","#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP )","vec3 heightMapTransform(sampler2D bumpTexture, vec2 uv, mat3 transform, vec2 bumpScale, vec3 T, vec3 B, vec3 N) {","vec2 st = (transform * vec3(uv, 1.0)).xy;","mat3 mtxTangent = mat3(T, B, N);","T = normalize(mtxTangent * (transform * vec3(1.0, 0.0, 0.0)));","B = normalize(mtxTangent * (transform * vec3(0.0, 1.0, 0.0)));","const float oneThird = 1.0 / 3.0;","vec3 avg = vec3(oneThird, oneThird, oneThird);","vec2 offset = fwidth(st);","float h0 = dot(texture2D(bumpTexture, st).xyz, avg);","float hx = dot(texture2D(bumpTexture, st + vec2(offset.x, 0.0)).xyz, avg);","float hy = dot(texture2D(bumpTexture, st + vec2(0.0, offset.y)).xyz, avg);","vec2 diff = vec2(h0 - hx, h0 - hy) / offset;","return normalize(N + (diff.x * T * bumpScale.x + diff.y * B * bumpScale.y));","}","vec3 normalMapTransform(sampler2D bumpTexture, vec2 uv, mat3 transform, vec2 bumpScale, vec3 T, vec3 B, vec3 N) {","vec2 st = (transform * vec3(uv, 1.0)).xy;","vec3 NMap =  2.0 * texture2D( bumpTexture, st ).xyz - 1.0; ","return normalize(bumpScale.x * (NMap.x * T + NMap.y * B) + NMap.z * N);","}","#endif","#if !defined(USE_MAP)&& (MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0)","varying vec3 vTangent;","varying vec3 vBitangent;","#endif","#if defined( USE_ENVMAP )","vec3 sampleReflection(vec3 N, vec3 V, float mipIndex) {","vec3 dir = (2.0 * dot(V, N)) * N - V;","dir = adjustLookupVector(mat3(viewMatrixInverse) * dir);","#ifdef ENV_GAMMA","#ifdef HAVE_TEXTURE_LOD","vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );","#else","vec4 envTexColor = textureCube( envMap, dir, mipIndex );","#endif","return GammaDecode(envTexColor, envMapExposure);","#elif defined(ENV_RGBM)","#ifdef HAVE_TEXTURE_LOD","vec4 envTexColor = textureCubeLodEXT( envMap, dir, mipIndex );","#else","vec4 envTexColor = textureCube( envMap, dir, mipIndex );","#endif","return RGBMDecode(envTexColor, envMapExposure);","#else","vec4 envTexColor = textureCube( envMap, dir );","vec3 cubeColor = envTexColor.xyz;","#ifdef GAMMA_INPUT","cubeColor *= cubeColor;","#endif","return cubeColor;","#endif","}","#endif",g.HatchPatternShaderChunk,"#if defined( USE_ENVMAP ) && defined( USE_IRRADIANCEMAP )","uniform samplerCube irradianceMap;","vec3 sampleNormal(vec3 normal) {","vec3 worldNormal = mat3(viewMatrixInverse) * normal;","vec4 cubeColor4 = textureCube(irradianceMap, adjustLookupVector(worldNormal));","#ifdef IRR_GAMMA","vec3 indirectDiffuse = GammaDecode(cubeColor4, envMapExposure);","#elif defined(IRR_RGBM)","vec3 indirectDiffuse = RGBMDecode(cubeColor4, envMapExposure);","#else","vec3 indirectDiffuse = cubeColor4.xyz;","#ifdef GAMMA_INPUT","indirectDiffuse.xyz *= indirectDiffuse.xyz;","#endif","#endif","return indirectDiffuse;}","#endif","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","float sqr(float x) {return x*x;}","float aSqrd(float maxAlphaSqr, float cosTheta)","{","   float tan2 = 1.0/sqr(cosTheta) - 1.0;","   return maxAlphaSqr * tan2;","}","vec3 Fresnel_Schlick(vec3 f0, float cosAngle)","{","    float x = 1.0 - cosAngle;","    float x2 = x * x;","    float x5 = x * x2 * x2;","    return f0 + (1.0 - f0) * x5;","}","vec3 Fresnel_Rough(vec3 f0, float cosAngle, float alpha)","{","    float x = 1.0 - cosAngle;","    float x2 = x * x;","    float x5 = x * x2 * x2;","    vec3 maxReflectance = mix(vec3(1.0), f0, vec3(min(0.7, alpha)) / 0.7);","    return f0 + (maxReflectance - f0) * x5;","}","float IORToReflectance(float ior)","{","    return sqr((1.0 - ior)/(1.0 + ior));","}","vec2 RoughnessToAlpha(float roughness, float anisotropy)","{","    vec2 alpha = roughness * vec2(1.0, 1.0 - anisotropy);","    alpha = alpha * alpha;","    alpha = clamp(alpha, 0.001, 1.0);","    return alpha;","}","float AlphaToPhong(float alpha)","{","    return max(0.0, 2.56/alpha - 7.0);","}","float ExponentToReflMipIndex(float exponent)","{","    float targetLog = log2(exponent);","    float minLog = log2(envExponentMin); ","    float maxLog = log2(envExponentMax); ","    float deltaLog = clamp(targetLog - minLog, 0.0, maxLog - minLog);  ","    float level = clamp((1.0-(deltaLog + 0.5) / envExponentCount), 0.0, 1.0) * 6.0; ","    return level; ","}","#if defined( PRISMWOOD )","vec3 NoiseWood(inout float roughness_inout)","{","//If the mesh has no uvw, use a const zero vector.","//This is used by section tool.","#ifdef NO_UVW","   vec3 vUvw_uniform = vec3(0.0);","#else","   vec3 vUvw_uniform = vUvw;","#endif","  lowp float surfaceRoughness_1;","  surfaceRoughness_1 = surface_roughness;","  lowp float roughness_2;","  roughness_2 = surfaceRoughness_1;","  lowp vec3 diffAlbedo_3;","  lowp vec3 lateColor_4;","  lowp vec3 earlyColor_5;","  lowp float radiusLength_6;","  lowp vec3 p_7;","  p_7 = vUvw_uniform;","  if (wood_fiber_cosine_enable) {","    lowp vec3 p_8;","    p_8 = p_7;","    lowp vec3 tmpvar_9;","    lowp float weight_10;","    lowp float radiusShift_11;","    lowp float tmpvar_12;","    tmpvar_12 = sqrt(dot (vUvw_uniform.xy, vUvw_uniform.xy));","    if ((tmpvar_12 < 1e-05)) {","      tmpvar_9 = p_7;","    } else {","      lowp vec2 tmpvar_13;","      tmpvar_13 = (vUvw_uniform.xy / tmpvar_12);","      radiusShift_11 = 0.0;","      if ((0 < wood_fiber_cosine_bands)) {","        radiusShift_11 = (wood_fiber_cosine_weights.x * cos((","          (vUvw_uniform.z * 0.1591549)","         * wood_fiber_cosine_frequencies.x)));","        if ((1 < wood_fiber_cosine_bands)) {","          radiusShift_11 = (radiusShift_11 + (wood_fiber_cosine_weights.y * cos(","            ((vUvw_uniform.z * 0.1591549) * wood_fiber_cosine_frequencies.y)","          )));","          if ((2 < wood_fiber_cosine_bands)) {","            radiusShift_11 = (radiusShift_11 + (wood_fiber_cosine_weights.z * cos(","              ((vUvw_uniform.z * 0.1591549) * wood_fiber_cosine_frequencies.z)","            )));","            if ((3 < wood_fiber_cosine_bands)) {","              radiusShift_11 = (radiusShift_11 + (wood_fiber_cosine_weights.w * cos(","                ((vUvw_uniform.z * 0.1591549) * wood_fiber_cosine_frequencies.w)","              )));","            };","          };","        };","      };","      lowp float tmpvar_14;","      tmpvar_14 = clamp ((tmpvar_12 / 1.5), 0.0, 1.0);","      weight_10 = tmpvar_14;","      if ((tmpvar_14 >= 0.5)) {","        weight_10 = ((tmpvar_14 * tmpvar_14) * (3.0 - (tmpvar_14 + tmpvar_14)));","      };","      p_8.xy = (vUvw_uniform.xy + ((tmpvar_13 * radiusShift_11) * weight_10));","      tmpvar_9 = p_8;","    };","    p_7 = tmpvar_9;","  };","  if (wood_fiber_perlin_enable) {","    lowp vec3 p_15;","    p_15 = p_7;","    lowp vec3 tmpvar_16;","    tmpvar_16.xy = p_7.xy;","    tmpvar_16.z = (p_7.z * wood_fiber_perlin_scale_z);","    lowp vec3 p_17;","    p_17 = tmpvar_16;","    highp int bands_18;","    bands_18 = wood_fiber_perlin_bands;","    highp vec4 w_19;","    w_19 = wood_fiber_perlin_weights;","    highp vec4 f_20;","    f_20 = wood_fiber_perlin_frequencies;","    lowp float noise_22;","    noise_22 = 0.0;","    for (int i_21 = 0; i_21 < 4; ++i_21) {","      if ((i_21 >= bands_18)) {","        break;","      };","      lowp vec3 p_23;","      p_23 = (p_17 * f_20[i_21]);","      lowp vec4 AA_24;","      lowp vec3 modp_25;","      lowp vec3 tmpvar_26;","      tmpvar_26 = (vec3(mod (floor(p_23), 256.0)));","      modp_25.z = tmpvar_26.z;","      modp_25.xy = (tmpvar_26.xy * 0.00390625);","      AA_24 = ((texture2D (perm2DMap, modp_25.xy, 0.0) * 255.0) + tmpvar_26.z);","      AA_24 = ((vec4(mod (floor(AA_24), 256.0))) * 0.00390625);","      lowp vec2 tmpvar_27;","      tmpvar_27.y = 0.0;","      tmpvar_27.x = AA_24.x;","      lowp vec2 tmpvar_28;","      tmpvar_28.y = 0.0;","      tmpvar_28.x = AA_24.y;","      lowp vec2 tmpvar_29;","      tmpvar_29.y = 0.0;","      tmpvar_29.x = AA_24.z;","      lowp vec2 tmpvar_30;","      tmpvar_30.y = 0.0;","      tmpvar_30.x = AA_24.w;","      lowp vec2 tmpvar_31;","      tmpvar_31.y = 0.0;","      tmpvar_31.x = (AA_24.x + 0.00390625);","      lowp vec2 tmpvar_32;","      tmpvar_32.y = 0.0;","      tmpvar_32.x = (AA_24.y + 0.00390625);","      lowp vec2 tmpvar_33;","      tmpvar_33.y = 0.0;","      tmpvar_33.x = (AA_24.z + 0.00390625);","      lowp vec2 tmpvar_34;","      tmpvar_34.y = 0.0;","      tmpvar_34.x = (AA_24.w + 0.00390625);","      p_23 = (p_23 - floor(p_23));","      lowp vec3 tmpvar_35;","      tmpvar_35 = (((p_23 * p_23) * p_23) * ((p_23 *","        ((p_23 * 6.0) - 15.0)","      ) + 10.0));","      noise_22 = (noise_22 + (w_19[i_21] * mix (","        mix (mix (dot ((","          (texture2D (permGradMap, tmpvar_27, 0.0).xyz * 2.0)","         - 1.0), p_23), dot ((","          (texture2D (permGradMap, tmpvar_29, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(-1.0, 0.0, 0.0))), tmpvar_35.x), mix (dot ((","          (texture2D (permGradMap, tmpvar_28, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(0.0, -1.0, 0.0))), dot ((","          (texture2D (permGradMap, tmpvar_30, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(-1.0, -1.0, 0.0))), tmpvar_35.x), tmpvar_35.y)","      ,","        mix (mix (dot ((","          (texture2D (permGradMap, tmpvar_31, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(0.0, 0.0, -1.0))), dot ((","          (texture2D (permGradMap, tmpvar_33, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(-1.0, 0.0, -1.0))), tmpvar_35.x), mix (dot ((","          (texture2D (permGradMap, tmpvar_32, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(0.0, -1.0, -1.0))), dot ((","          (texture2D (permGradMap, tmpvar_34, 0.0).xyz * 2.0)","         - 1.0), (p_23 + vec3(-1.0, -1.0, -1.0))), tmpvar_35.x), tmpvar_35.y)","      , tmpvar_35.z)));","    };","    p_15.xy = (p_7.xy + noise_22);","    p_7 = p_15;","  };","  lowp float tmpvar_36;","  tmpvar_36 = sqrt(dot (p_7.xy, p_7.xy));","  radiusLength_6 = tmpvar_36;","  if (wood_growth_perlin_enable) {","    lowp float radiusLength_37;","    radiusLength_37 = tmpvar_36;","    lowp float noise_38;","    noise_38 = 0.0;","    if ((0 < wood_growth_perlin_bands)) {","      lowp float p_39;","      p_39 = (tmpvar_36 * wood_growth_perlin_frequencies.x);","      lowp float modp_40;","      modp_40 = (((float(mod (","        floor(p_39)","      , 256.0))) + 256.0) * 0.00390625);","      lowp vec2 tmpvar_41;","      tmpvar_41.y = 0.0;","      tmpvar_41.x = modp_40;","      lowp vec2 tmpvar_42;","      tmpvar_42.y = 0.0;","      tmpvar_42.x = texture2D (permutationMap, tmpvar_41, 0.0).x;","      lowp vec2 tmpvar_43;","      tmpvar_43.y = 0.0;","      tmpvar_43.x = (modp_40 + 0.00390625);","      lowp vec2 tmpvar_44;","      tmpvar_44.y = 0.0;","      tmpvar_44.x = texture2D (permutationMap, tmpvar_43, 0.0).x;","      p_39 = (p_39 - floor(p_39));","      noise_38 = (wood_growth_perlin_weights.x * mix ((","        ((texture2D (gradientMap, tmpvar_42, 0.0).x * 2.0) - 1.0)","       * p_39), (","        ((texture2D (gradientMap, tmpvar_44, 0.0).x * 2.0) - 1.0)","       *","        (p_39 - 1.0)","      ), (","        ((p_39 * p_39) * p_39)","       *","        ((p_39 * ((p_39 * 6.0) - 15.0)) + 10.0)","      )));","      if ((1 < wood_growth_perlin_bands)) {","        lowp float p_45;","        p_45 = (tmpvar_36 * wood_growth_perlin_frequencies.y);","        lowp float modp_46;","        modp_46 = (((float(mod (","          floor(p_45)","        , 256.0))) + 256.0) * 0.00390625);","        lowp vec2 tmpvar_47;","        tmpvar_47.y = 0.0;","        tmpvar_47.x = modp_46;","        lowp vec2 tmpvar_48;","        tmpvar_48.y = 0.0;","        tmpvar_48.x = texture2D (permutationMap, tmpvar_47, 0.0).x;","        lowp vec2 tmpvar_49;","        tmpvar_49.y = 0.0;","        tmpvar_49.x = (modp_46 + 0.00390625);","        lowp vec2 tmpvar_50;","        tmpvar_50.y = 0.0;","        tmpvar_50.x = texture2D (permutationMap, tmpvar_49, 0.0).x;","        p_45 = (p_45 - floor(p_45));","        noise_38 = (noise_38 + (wood_growth_perlin_weights.y * mix (","          (((texture2D (gradientMap, tmpvar_48, 0.0).x * 2.0) - 1.0) * p_45)","        ,","          (((texture2D (gradientMap, tmpvar_50, 0.0).x * 2.0) - 1.0) * (p_45 - 1.0))","        ,","          (((p_45 * p_45) * p_45) * ((p_45 * (","            (p_45 * 6.0)","           - 15.0)) + 10.0))","        )));","        if ((2 < wood_growth_perlin_bands)) {","          lowp float p_51;","          p_51 = (tmpvar_36 * wood_growth_perlin_frequencies.z);","          lowp float modp_52;","          modp_52 = (((float(mod (","            floor(p_51)","          , 256.0))) + 256.0) * 0.00390625);","          lowp vec2 tmpvar_53;","          tmpvar_53.y = 0.0;","          tmpvar_53.x = modp_52;","          lowp vec2 tmpvar_54;","          tmpvar_54.y = 0.0;","          tmpvar_54.x = texture2D (permutationMap, tmpvar_53, 0.0).x;","          lowp vec2 tmpvar_55;","          tmpvar_55.y = 0.0;","          tmpvar_55.x = (modp_52 + 0.00390625);","          lowp vec2 tmpvar_56;","          tmpvar_56.y = 0.0;","          tmpvar_56.x = texture2D (permutationMap, tmpvar_55, 0.0).x;","          p_51 = (p_51 - floor(p_51));","          noise_38 = (noise_38 + (wood_growth_perlin_weights.z * mix (","            (((texture2D (gradientMap, tmpvar_54, 0.0).x * 2.0) - 1.0) * p_51)","          ,","            (((texture2D (gradientMap, tmpvar_56, 0.0).x * 2.0) - 1.0) * (p_51 - 1.0))","          ,","            (((p_51 * p_51) * p_51) * ((p_51 * (","              (p_51 * 6.0)","             - 15.0)) + 10.0))","          )));","          if ((3 < wood_growth_perlin_bands)) {","            lowp float p_57;","            p_57 = (tmpvar_36 * wood_growth_perlin_frequencies.w);","            lowp float modp_58;","            modp_58 = (((float(mod (","              floor(p_57)","            , 256.0))) + 256.0) * 0.00390625);","            lowp vec2 tmpvar_59;","            tmpvar_59.y = 0.0;","            tmpvar_59.x = modp_58;","            lowp vec2 tmpvar_60;","            tmpvar_60.y = 0.0;","            tmpvar_60.x = texture2D (permutationMap, tmpvar_59, 0.0).x;","            lowp vec2 tmpvar_61;","            tmpvar_61.y = 0.0;","            tmpvar_61.x = (modp_58 + 0.00390625);","            lowp vec2 tmpvar_62;","            tmpvar_62.y = 0.0;","            tmpvar_62.x = texture2D (permutationMap, tmpvar_61, 0.0).x;","            p_57 = (p_57 - floor(p_57));","            noise_38 = (noise_38 + (wood_growth_perlin_weights.w * mix (","              (((texture2D (gradientMap, tmpvar_60, 0.0).x * 2.0) - 1.0) * p_57)","            ,","              (((texture2D (gradientMap, tmpvar_62, 0.0).x * 2.0) - 1.0) * (p_57 - 1.0))","            ,","              (((p_57 * p_57) * p_57) * ((p_57 * (","                (p_57 * 6.0)","               - 15.0)) + 10.0))","            )));","          };","        };","      };","    };","    radiusLength_37 = (tmpvar_36 + noise_38);","    if ((radiusLength_37 < 0.0)) {","      radiusLength_37 = 0.0;","    };","    radiusLength_6 = radiusLength_37;","  };","  lowp float earlyWoodRatio_63;","  highp float tmpvar_64;","  tmpvar_64 = (1.0 - wood_latewood_ratio);","  highp float tmpvar_65;","  tmpvar_65 = (wood_earlywood_sharpness * tmpvar_64);","  highp float tmpvar_66;","  tmpvar_66 = (wood_latewood_sharpness * wood_latewood_ratio);","  highp float tmpvar_67;","  tmpvar_67 = (tmpvar_64 - tmpvar_65);","  highp float tmpvar_68;","  tmpvar_68 = (tmpvar_64 + tmpvar_66);","  highp float tmpvar_69;","  tmpvar_69 = (wood_latewood_ratio - tmpvar_66);","  lowp float tmpvar_70;","  tmpvar_70 = ((float(mod (radiusLength_6, wood_ring_thickness))) / wood_ring_thickness);","  earlyWoodRatio_63 = 0.0;","  if ((tmpvar_70 <= tmpvar_65)) {","    earlyWoodRatio_63 = 1.0;","  } else {","    if ((tmpvar_70 <= tmpvar_64)) {","      earlyWoodRatio_63 = (1.0 - ((tmpvar_70 - tmpvar_65) / tmpvar_67));","    } else {","      if ((tmpvar_70 <= tmpvar_68)) {","        earlyWoodRatio_63 = 0.0;","      } else {","        earlyWoodRatio_63 = ((tmpvar_70 - tmpvar_68) / tmpvar_69);","      };","    };","  };","  earlyColor_5 = wood_early_color;","  if (wood_earlycolor_perlin_enable) {","    lowp float noise_71;","    noise_71 = 0.0;","    if ((0 < wood_earlycolor_perlin_bands)) {","      lowp float p_72;","      p_72 = (radiusLength_6 * wood_earlycolor_perlin_frequencies.x);","      lowp float modp_73;","      modp_73 = (((float(mod (","        floor(p_72)","      , 256.0))) + 256.0) * 0.00390625);","      lowp vec2 tmpvar_74;","      tmpvar_74.y = 0.0;","      tmpvar_74.x = modp_73;","      lowp vec2 tmpvar_75;","      tmpvar_75.y = 0.0;","      tmpvar_75.x = texture2D (permutationMap, tmpvar_74, 0.0).x;","      lowp vec2 tmpvar_76;","      tmpvar_76.y = 0.0;","      tmpvar_76.x = (modp_73 + 0.00390625);","      lowp vec2 tmpvar_77;","      tmpvar_77.y = 0.0;","      tmpvar_77.x = texture2D (permutationMap, tmpvar_76, 0.0).x;","      p_72 = (p_72 - floor(p_72));","      noise_71 = (wood_earlycolor_perlin_weights.x * mix ((","        ((texture2D (gradientMap, tmpvar_75, 0.0).x * 2.0) - 1.0)","       * p_72), (","        ((texture2D (gradientMap, tmpvar_77, 0.0).x * 2.0) - 1.0)","       *","        (p_72 - 1.0)","      ), (","        ((p_72 * p_72) * p_72)","       *","        ((p_72 * ((p_72 * 6.0) - 15.0)) + 10.0)","      )));","      if ((1 < wood_earlycolor_perlin_bands)) {","        lowp float p_78;","        p_78 = (radiusLength_6 * wood_earlycolor_perlin_frequencies.y);","        lowp float modp_79;","        modp_79 = (((float(mod (","          floor(p_78)","        , 256.0))) + 256.0) * 0.00390625);","        lowp vec2 tmpvar_80;","        tmpvar_80.y = 0.0;","        tmpvar_80.x = modp_79;","        lowp vec2 tmpvar_81;","        tmpvar_81.y = 0.0;","        tmpvar_81.x = texture2D (permutationMap, tmpvar_80, 0.0).x;","        lowp vec2 tmpvar_82;","        tmpvar_82.y = 0.0;","        tmpvar_82.x = (modp_79 + 0.00390625);","        lowp vec2 tmpvar_83;","        tmpvar_83.y = 0.0;","        tmpvar_83.x = texture2D (permutationMap, tmpvar_82, 0.0).x;","        p_78 = (p_78 - floor(p_78));","        noise_71 = (noise_71 + (wood_earlycolor_perlin_weights.y * mix (","          (((texture2D (gradientMap, tmpvar_81, 0.0).x * 2.0) - 1.0) * p_78)","        ,","          (((texture2D (gradientMap, tmpvar_83, 0.0).x * 2.0) - 1.0) * (p_78 - 1.0))","        ,","          (((p_78 * p_78) * p_78) * ((p_78 * (","            (p_78 * 6.0)","           - 15.0)) + 10.0))","        )));","        if ((2 < wood_earlycolor_perlin_bands)) {","          lowp float p_84;","          p_84 = (radiusLength_6 * wood_earlycolor_perlin_frequencies.z);","          lowp float modp_85;","          modp_85 = (((float(mod (","            floor(p_84)","          , 256.0))) + 256.0) * 0.00390625);","          lowp vec2 tmpvar_86;","          tmpvar_86.y = 0.0;","          tmpvar_86.x = modp_85;","          lowp vec2 tmpvar_87;","          tmpvar_87.y = 0.0;","          tmpvar_87.x = texture2D (permutationMap, tmpvar_86, 0.0).x;","          lowp vec2 tmpvar_88;","          tmpvar_88.y = 0.0;","          tmpvar_88.x = (modp_85 + 0.00390625);","          lowp vec2 tmpvar_89;","          tmpvar_89.y = 0.0;","          tmpvar_89.x = texture2D (permutationMap, tmpvar_88, 0.0).x;","          p_84 = (p_84 - floor(p_84));","          noise_71 = (noise_71 + (wood_earlycolor_perlin_weights.z * mix (","            (((texture2D (gradientMap, tmpvar_87, 0.0).x * 2.0) - 1.0) * p_84)","          ,","            (((texture2D (gradientMap, tmpvar_89, 0.0).x * 2.0) - 1.0) * (p_84 - 1.0))","          ,","            (((p_84 * p_84) * p_84) * ((p_84 * (","              (p_84 * 6.0)","             - 15.0)) + 10.0))","          )));","          if ((3 < wood_earlycolor_perlin_bands)) {","            lowp float p_90;","            p_90 = (radiusLength_6 * wood_earlycolor_perlin_frequencies.w);","            lowp float modp_91;","            modp_91 = (((float(mod (","              floor(p_90)","            , 256.0))) + 256.0) * 0.00390625);","            lowp vec2 tmpvar_92;","            tmpvar_92.y = 0.0;","            tmpvar_92.x = modp_91;","            lowp vec2 tmpvar_93;","            tmpvar_93.y = 0.0;","            tmpvar_93.x = texture2D (permutationMap, tmpvar_92, 0.0).x;","            lowp vec2 tmpvar_94;","            tmpvar_94.y = 0.0;","            tmpvar_94.x = (modp_91 + 0.00390625);","            lowp vec2 tmpvar_95;","            tmpvar_95.y = 0.0;","            tmpvar_95.x = texture2D (permutationMap, tmpvar_94, 0.0).x;","            p_90 = (p_90 - floor(p_90));","            noise_71 = (noise_71 + (wood_earlycolor_perlin_weights.w * mix (","              (((texture2D (gradientMap, tmpvar_93, 0.0).x * 2.0) - 1.0) * p_90)","            ,","              (((texture2D (gradientMap, tmpvar_95, 0.0).x * 2.0) - 1.0) * (p_90 - 1.0))","            ,","              (((p_90 * p_90) * p_90) * ((p_90 * (","                (p_90 * 6.0)","               - 15.0)) + 10.0))","            )));","          };","        };","      };","    };","    earlyColor_5 = pow (abs(wood_early_color), vec3((1.0 + noise_71)));","  };","  if (wood_use_manual_late_color) {","    lateColor_4 = wood_manual_late_color;","  } else {","    lateColor_4 = pow (abs(earlyColor_5), vec3(wood_late_color_power));","  };","  if (wood_latecolor_perlin_enable) {","    lowp float noise_96;","    noise_96 = 0.0;","    if ((0 < wood_latecolor_perlin_bands)) {","      lowp float p_97;","      p_97 = (radiusLength_6 * wood_latecolor_perlin_frequencies.x);","      lowp float modp_98;","      modp_98 = (((float(mod (","        floor(p_97)","      , 256.0))) + 256.0) * 0.00390625);","      lowp vec2 tmpvar_99;","      tmpvar_99.y = 0.0;","      tmpvar_99.x = modp_98;","      lowp vec2 tmpvar_100;","      tmpvar_100.y = 0.0;","      tmpvar_100.x = texture2D (permutationMap, tmpvar_99, 0.0).x;","      lowp vec2 tmpvar_101;","      tmpvar_101.y = 0.0;","      tmpvar_101.x = (modp_98 + 0.00390625);","      lowp vec2 tmpvar_102;","      tmpvar_102.y = 0.0;","      tmpvar_102.x = texture2D (permutationMap, tmpvar_101, 0.0).x;","      p_97 = (p_97 - floor(p_97));","      noise_96 = (wood_latecolor_perlin_weights.x * mix ((","        ((texture2D (gradientMap, tmpvar_100, 0.0).x * 2.0) - 1.0)","       * p_97), (","        ((texture2D (gradientMap, tmpvar_102, 0.0).x * 2.0) - 1.0)","       *","        (p_97 - 1.0)","      ), (","        ((p_97 * p_97) * p_97)","       *","        ((p_97 * ((p_97 * 6.0) - 15.0)) + 10.0)","      )));","      if ((1 < wood_latecolor_perlin_bands)) {","        lowp float p_103;","        p_103 = (radiusLength_6 * wood_latecolor_perlin_frequencies.y);","        lowp float modp_104;","        modp_104 = (((float(mod (","          floor(p_103)","        , 256.0))) + 256.0) * 0.00390625);","        lowp vec2 tmpvar_105;","        tmpvar_105.y = 0.0;","        tmpvar_105.x = modp_104;","        lowp vec2 tmpvar_106;","        tmpvar_106.y = 0.0;","        tmpvar_106.x = texture2D (permutationMap, tmpvar_105, 0.0).x;","        lowp vec2 tmpvar_107;","        tmpvar_107.y = 0.0;","        tmpvar_107.x = (modp_104 + 0.00390625);","        lowp vec2 tmpvar_108;","        tmpvar_108.y = 0.0;","        tmpvar_108.x = texture2D (permutationMap, tmpvar_107, 0.0).x;","        p_103 = (p_103 - floor(p_103));","        noise_96 = (noise_96 + (wood_latecolor_perlin_weights.y * mix (","          (((texture2D (gradientMap, tmpvar_106, 0.0).x * 2.0) - 1.0) * p_103)","        ,","          (((texture2D (gradientMap, tmpvar_108, 0.0).x * 2.0) - 1.0) * (p_103 - 1.0))","        ,","          (((p_103 * p_103) * p_103) * ((p_103 * (","            (p_103 * 6.0)","           - 15.0)) + 10.0))","        )));","        if ((2 < wood_latecolor_perlin_bands)) {","          lowp float p_109;","          p_109 = (radiusLength_6 * wood_latecolor_perlin_frequencies.z);","          lowp float modp_110;","          modp_110 = (((float(mod (","            floor(p_109)","          , 256.0))) + 256.0) * 0.00390625);","          lowp vec2 tmpvar_111;","          tmpvar_111.y = 0.0;","          tmpvar_111.x = modp_110;","          lowp vec2 tmpvar_112;","          tmpvar_112.y = 0.0;","          tmpvar_112.x = texture2D (permutationMap, tmpvar_111, 0.0).x;","          lowp vec2 tmpvar_113;","          tmpvar_113.y = 0.0;","          tmpvar_113.x = (modp_110 + 0.00390625);","          lowp vec2 tmpvar_114;","          tmpvar_114.y = 0.0;","          tmpvar_114.x = texture2D (permutationMap, tmpvar_113, 0.0).x;","          p_109 = (p_109 - floor(p_109));","          noise_96 = (noise_96 + (wood_latecolor_perlin_weights.z * mix (","            (((texture2D (gradientMap, tmpvar_112, 0.0).x * 2.0) - 1.0) * p_109)","          ,","            (((texture2D (gradientMap, tmpvar_114, 0.0).x * 2.0) - 1.0) * (p_109 - 1.0))","          ,","            (((p_109 * p_109) * p_109) * ((p_109 * (","              (p_109 * 6.0)","             - 15.0)) + 10.0))","          )));","          if ((3 < wood_latecolor_perlin_bands)) {","            lowp float p_115;","            p_115 = (radiusLength_6 * wood_latecolor_perlin_frequencies.w);","            lowp float modp_116;","            modp_116 = (((float(mod (","              floor(p_115)","            , 256.0))) + 256.0) * 0.00390625);","            lowp vec2 tmpvar_117;","            tmpvar_117.y = 0.0;","            tmpvar_117.x = modp_116;","            lowp vec2 tmpvar_118;","            tmpvar_118.y = 0.0;","            tmpvar_118.x = texture2D (permutationMap, tmpvar_117, 0.0).x;","            lowp vec2 tmpvar_119;","            tmpvar_119.y = 0.0;","            tmpvar_119.x = (modp_116 + 0.00390625);","            lowp vec2 tmpvar_120;","            tmpvar_120.y = 0.0;","            tmpvar_120.x = texture2D (permutationMap, tmpvar_119, 0.0).x;","            p_115 = (p_115 - floor(p_115));","            noise_96 = (noise_96 + (wood_latecolor_perlin_weights.w * mix (","              (((texture2D (gradientMap, tmpvar_118, 0.0).x * 2.0) - 1.0) * p_115)","            ,","              (((texture2D (gradientMap, tmpvar_120, 0.0).x * 2.0) - 1.0) * (p_115 - 1.0))","            ,","              (((p_115 * p_115) * p_115) * ((p_115 * (","                (p_115 * 6.0)","               - 15.0)) + 10.0))","            )));","          };","        };","      };","    };","    lateColor_4 = pow (abs(lateColor_4), vec3((1.0 + noise_96)));","  };","  lowp vec3 tmpvar_121;","  tmpvar_121 = ((earlyWoodRatio_63 * earlyColor_5) + ((1.0 - earlyWoodRatio_63) * lateColor_4));","  diffAlbedo_3 = tmpvar_121;","  if (wood_diffuse_perlin_enable) {","    lowp vec3 p_122;","    p_122.xy = p_7.xy;","    p_122.z = (p_7.z * wood_diffuse_perlin_scale_z);","    lowp vec3 p_123;","    p_123 = p_122;","    highp int bands_124;","    bands_124 = wood_diffuse_perlin_bands;","    highp vec4 w_125;","    w_125 = wood_diffuse_perlin_weights;","    highp vec4 f_126;","    f_126 = wood_diffuse_perlin_frequencies;","    lowp float noise_128;","    noise_128 = 0.0;","    for (int i_127 = 0; i_127 < 4; ++i_127) {","      if ((i_127 >= bands_124)) {","        break;","      };","      lowp vec3 p_129;","      p_129 = (p_123 * f_126[i_127]);","      lowp vec4 AA_130;","      lowp vec3 modp_131;","      lowp vec3 tmpvar_132;","      tmpvar_132 = (vec3(mod (floor(p_129), 256.0)));","      modp_131.z = tmpvar_132.z;","      modp_131.xy = (tmpvar_132.xy * 0.00390625);","      AA_130 = ((texture2D (perm2DMap, modp_131.xy, 0.0) * 255.0) + tmpvar_132.z);","      AA_130 = ((vec4(mod (floor(AA_130), 256.0))) * 0.00390625);","      lowp vec2 tmpvar_133;","      tmpvar_133.y = 0.0;","      tmpvar_133.x = AA_130.x;","      lowp vec2 tmpvar_134;","      tmpvar_134.y = 0.0;","      tmpvar_134.x = AA_130.y;","      lowp vec2 tmpvar_135;","      tmpvar_135.y = 0.0;","      tmpvar_135.x = AA_130.z;","      lowp vec2 tmpvar_136;","      tmpvar_136.y = 0.0;","      tmpvar_136.x = AA_130.w;","      lowp vec2 tmpvar_137;","      tmpvar_137.y = 0.0;","      tmpvar_137.x = (AA_130.x + 0.00390625);","      lowp vec2 tmpvar_138;","      tmpvar_138.y = 0.0;","      tmpvar_138.x = (AA_130.y + 0.00390625);","      lowp vec2 tmpvar_139;","      tmpvar_139.y = 0.0;","      tmpvar_139.x = (AA_130.z + 0.00390625);","      lowp vec2 tmpvar_140;","      tmpvar_140.y = 0.0;","      tmpvar_140.x = (AA_130.w + 0.00390625);","      p_129 = (p_129 - floor(p_129));","      lowp vec3 tmpvar_141;","      tmpvar_141 = (((p_129 * p_129) * p_129) * ((p_129 *","        ((p_129 * 6.0) - 15.0)","      ) + 10.0));","      noise_128 = (noise_128 + (w_125[i_127] * mix (","        mix (mix (dot ((","          (texture2D (permGradMap, tmpvar_133, 0.0).xyz * 2.0)","         - 1.0), p_129), dot ((","          (texture2D (permGradMap, tmpvar_135, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(-1.0, 0.0, 0.0))), tmpvar_141.x), mix (dot ((","          (texture2D (permGradMap, tmpvar_134, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(0.0, -1.0, 0.0))), dot ((","          (texture2D (permGradMap, tmpvar_136, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(-1.0, -1.0, 0.0))), tmpvar_141.x), tmpvar_141.y)","      ,","        mix (mix (dot ((","          (texture2D (permGradMap, tmpvar_137, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(0.0, 0.0, -1.0))), dot ((","          (texture2D (permGradMap, tmpvar_139, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(-1.0, 0.0, -1.0))), tmpvar_141.x), mix (dot ((","          (texture2D (permGradMap, tmpvar_138, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(0.0, -1.0, -1.0))), dot ((","          (texture2D (permGradMap, tmpvar_140, 0.0).xyz * 2.0)","         - 1.0), (p_129 + vec3(-1.0, -1.0, -1.0))), tmpvar_141.x), tmpvar_141.y)","      , tmpvar_141.z)));","    };","    diffAlbedo_3 = pow (abs(tmpvar_121), vec3((1.0 + noise_128)));","  };","  if (wood_use_pores) {","    lowp float woodWeight_142;","    woodWeight_142 = 0.0;","    if ((wood_pore_type == 0)) {","      woodWeight_142 = 1.0;","    } else {","      if ((wood_pore_type == 1)) {","        woodWeight_142 = earlyWoodRatio_63;","      } else {","        if ((wood_pore_type == 2)) {","          woodWeight_142 = (1.0 - earlyWoodRatio_63);","        } else {","          woodWeight_142 = -1.0;","        };","      };","    };","    lowp vec3 p_143;","    p_143 = p_7;","    lowp float tmpvar_144;","    lowp float invRsq_146;","    lowp float weight_147;","    lowp vec2 right_148;","    lowp vec2 left_149;","    if ((woodWeight_142 < 0.0)) {","      tmpvar_144 = 0.0;","    } else {","      lowp float tmpvar_150;","      tmpvar_150 = (wood_pore_radius * woodWeight_142);","      left_149 = floor(((p_7.xy - tmpvar_150) / wood_pore_cell_dim));","      right_148 = floor(((p_7.xy + tmpvar_150) / wood_pore_cell_dim));","      weight_147 = 0.0;","      invRsq_146 = (1.0/((tmpvar_150 * tmpvar_150)));","      for (int j_145 = 0; j_145 <= 4; ++j_145) {","        if ((j_145 > int((right_148.y - left_149.y)))) {","          continue;","        };","        for (int i_151 = 0; i_151 <= 4; ++i_151) {","          lowp float impPosY_152;","          lowp float impPosX_153;","          if ((i_151 > int((right_148.x - left_149.x)))) {","            continue;","          };","          lowp vec2 tmpvar_154;","          tmpvar_154.x = (float(i_151) + left_149.x);","          tmpvar_154.y = (float(j_145) + left_149.y);","          lowp float tmpvar_155;","          lowp vec2 k_156;","          k_156 = ((vec2(mod (tmpvar_154, vec2(256.0, 256.0)))) * 0.00390625);","          lowp vec2 tmpvar_157;","          tmpvar_157.y = 0.0;","          tmpvar_157.x = k_156.x;","          lowp vec2 tmpvar_158;","          tmpvar_158.y = 0.0;","          tmpvar_158.x = (texture2D (permutationMap, tmpvar_157).x + k_156.y);","          tmpvar_155 = (texture2D (permutationMap, tmpvar_158).x * 255.0);","          impPosX_153 = ((tmpvar_154.x + (","            (float(mod (tmpvar_155, 16.0)))","           * 0.06666667)) * wood_pore_cell_dim);","          impPosY_152 = ((tmpvar_154.y + (","            floor((tmpvar_155 / 16.0))","           * 0.06666667)) * wood_pore_cell_dim);","          lowp float rsq_159;","          rsq_159 = (((","            (p_143.x - impPosX_153)","           *","            (p_143.x - impPosX_153)","          ) + (","            (p_143.y - impPosY_152)","           *","            (p_143.y - impPosY_152)","          )) * invRsq_146);","          lowp float tmpvar_160;","          if ((rsq_159 >= 1.0)) {","            tmpvar_160 = 0.0;","          } else {","            lowp float tmpvar_161;","            tmpvar_161 = (1.0 - rsq_159);","            tmpvar_160 = ((tmpvar_161 * tmpvar_161) * tmpvar_161);","          };","          weight_147 = (weight_147 + tmpvar_160);","        };","      };","      tmpvar_144 = weight_147;","    };","    diffAlbedo_3 = pow (abs(diffAlbedo_3), vec3(((","      (wood_pore_color_power - 1.0)","     * tmpvar_144) + 1.0)));","  };","  if (wood_use_rays) {","    lowp vec3 p_162;","    p_162 = p_7;","    lowp float radialLength_164;","    lowp float weight_165;","    lowp ivec2 arrSegs_166;","    lowp float sliceIdx_167;","    lowp int segIdx1_168;","    lowp int tmpvar_169;","    tmpvar_169 = int(floor((p_7.z / wood_ray_seg_length_z)));","    lowp float tmpvar_170;","    tmpvar_170 = ((p_7.z / wood_ray_seg_length_z) - float(tmpvar_169));","    segIdx1_168 = (tmpvar_169 - 1);","    if ((tmpvar_170 > 0.5)) {","      segIdx1_168 = (tmpvar_169 + 1);","    };","    lowp float tmpvar_171;","    lowp float tmpvar_172;","    tmpvar_172 = (min (abs(","      (p_7.y / p_7.x)","    ), 1.0) / max (abs(","      (p_7.y / p_7.x)","    ), 1.0));","    lowp float tmpvar_173;","    tmpvar_173 = (tmpvar_172 * tmpvar_172);","    tmpvar_173 = (((","      ((((","        ((((-0.01213232 * tmpvar_173) + 0.05368138) * tmpvar_173) - 0.1173503)","       * tmpvar_173) + 0.1938925) * tmpvar_173) - 0.3326756)","     * tmpvar_173) + 0.9999793) * tmpvar_172);","    tmpvar_173 = (tmpvar_173 + (float(","      (abs((p_7.y / p_7.x)) > 1.0)","    ) * (","      (tmpvar_173 * -2.0)","     + 1.570796)));","    tmpvar_171 = (tmpvar_173 * sign((p_7.y / p_7.x)));","    if ((abs(p_7.x) > (1e-08 * abs(p_7.y)))) {","      if ((p_7.x < 0.0)) {","        if ((p_7.y >= 0.0)) {","          tmpvar_171 += 3.141593;","        } else {","          tmpvar_171 = (tmpvar_171 - 3.141593);","        };","      };","    } else {","      tmpvar_171 = (sign(p_7.y) * 1.570796);","    };","    lowp float tmpvar_174;","    tmpvar_174 = floor(((","      (tmpvar_171 + 3.141593)","     * 0.1591549) * wood_ray_num_slices));","    sliceIdx_167 = tmpvar_174;","    if ((tmpvar_174 == wood_ray_num_slices)) {","      sliceIdx_167 = (tmpvar_174 - 1.0);","    };","    lowp ivec2 tmpvar_175;","    tmpvar_175.x = tmpvar_169;","    tmpvar_175.y = segIdx1_168;","    arrSegs_166 = tmpvar_175;","    weight_165 = 0.0;","    radialLength_164 = sqrt(dot (p_7.xy, p_7.xy));","    for (int seg_163 = 0; seg_163 < 2; ++seg_163) {","      lowp vec3 p1_176;","      lowp float rayTheta_177;","      lowp vec2 tmpvar_178;","      tmpvar_178.x = sliceIdx_167;","      tmpvar_178.y = float(arrSegs_166[seg_163]);","      lowp float tmpvar_179;","      lowp vec2 k_180;","      k_180 = ((vec2(mod (tmpvar_178, vec2(256.0, 256.0)))) * 0.00390625);","      lowp vec2 tmpvar_181;","      tmpvar_181.y = 0.0;","      tmpvar_181.x = k_180.x;","      lowp vec2 tmpvar_182;","      tmpvar_182.y = 0.0;","      tmpvar_182.x = (texture2D (permutationMap, tmpvar_181).x + k_180.y);","      tmpvar_179 = (texture2D (permutationMap, tmpvar_182).x * 255.0);","      lowp float tmpvar_183;","      tmpvar_183 = ((float(mod (tmpvar_179, 16.0))) * 0.06666667);","      if ((radialLength_164 < (5.0 * tmpvar_183))) {","        continue;","      };","      rayTheta_177 = (((","        (sliceIdx_167 + tmpvar_183)","       / wood_ray_num_slices) * 6.283185) - 3.141593);","      lowp vec3 tmpvar_184;","      tmpvar_184.z = 0.0;","      tmpvar_184.x = cos(rayTheta_177);","      tmpvar_184.y = sin(rayTheta_177);","      p1_176.xy = p_162.xy;","      p1_176.z = (p_162.z - ((","        float(arrSegs_166[seg_163])","       +","        ((tmpvar_179 / 16.0) * 0.06666667)","      ) * wood_ray_seg_length_z));","      p1_176.z = (p1_176.z / wood_ray_ellipse_z2x);","      lowp vec3 tmpvar_185;","      tmpvar_185 = -(p1_176);","      lowp vec3 tmpvar_186;","      tmpvar_186 = ((tmpvar_184.yzx * tmpvar_185.zxy) - (tmpvar_184.zxy * tmpvar_185.yzx));","      lowp float tmpvar_187;","      tmpvar_187 = (sqrt(dot (tmpvar_186, tmpvar_186)) / sqrt(dot (tmpvar_184, tmpvar_184)));","      lowp float rsq_188;","      rsq_188 = ((tmpvar_187 * tmpvar_187) * (1.0/((wood_ray_ellipse_radius_x * wood_ray_ellipse_radius_x))));","      lowp float tmpvar_189;","      if ((rsq_188 >= 1.0)) {","        tmpvar_189 = 0.0;","      } else {","        lowp float tmpvar_190;","        tmpvar_190 = (1.0 - rsq_188);","        tmpvar_189 = ((tmpvar_190 * tmpvar_190) * tmpvar_190);","      };","      weight_165 = (weight_165 + tmpvar_189);","    };","    diffAlbedo_3 = pow (abs(diffAlbedo_3), vec3(((","      (wood_ray_color_power - 1.0)","     * weight_165) + 1.0)));","  };","  if (wood_use_groove_roughness) {","    roughness_2 = ((earlyWoodRatio_63 * wood_groove_roughness) + ((1.0 - earlyWoodRatio_63) * surface_roughness));","  };","  roughness_inout = roughness_2;","  return diffAlbedo_3;","}","#endif","#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0","vec3 DiffuseLobe(vec3 diffuseColor)","{","return diffuseColor * RECIPROCAL_PI;","}","vec3 Rotate(vec3 vec, float angle)","{","float s = sin(angle);","float c = cos(angle);","return vec3(vec.x * c - vec.y * s, vec.x * s + vec.y * c, vec.z);","}","float NDF_GGX(float alphaU, float alphaV, vec3 normal)","{","float nx2 = sqr(normal.x);","float ny2 = sqr(normal.y);","float nz2 = sqr(normal.z);","float scale = 1.0/(alphaU * alphaV * PI);","return scale/sqr(nx2/sqr(alphaU) + ny2/sqr(alphaV) + nz2);","}","float G1_GGX(float aSqrd)","{","    return 2.0 / (1.0 + sqrt(1.0 + aSqrd));","}","vec3 MicrofacetLobe(","vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH,","float roughness, float anisotropy, float rotation, vec3 reflectance)","{","vec2 alpha = RoughnessToAlpha(roughness, anisotropy);","Hlocal = Rotate(Hlocal, rotation);","vec3 F = Fresnel_Schlick(reflectance, VdotH);","float D = NDF_GGX(alpha.x, alpha.y, Hlocal);","float alpha2 = max(sqr(alpha.x), sqr(alpha.y));","float alpha2NL = aSqrd(alpha2, NdotL);","float alpha2NV = aSqrd(alpha2, NdotV);","float G = G1_GGX(alpha2NL) * G1_GGX(alpha2NV);","return max(F * D * G / (4.0 * NdotL * NdotV), vec3(0.0));","}","#if defined( PRISMOPAQUE )","vec3 BRDF_Opaque(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH, ","                 vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, ","                 float opaqueF0, vec3 opaqueAlbedo)","{","    vec3 diffuse = DiffuseLobe(opaqueAlbedo);","    vec3 specular = surfaceAlbedo * MicrofacetLobe(","        Hlocal, NdotL, NdotH, NdotV, VdotH,","        surfaceRoughness, surfaceAnisotropy, surfaceRotation, vec3(opaqueF0));","    return (specular+diffuse)*NdotL;","}","#elif defined( PRISMMETAL )","vec3 BRDF_Metal(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH, ","                vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation, ","                vec3 metalF0)","{","    vec3 specular = surfaceAlbedo * MicrofacetLobe(","        Hlocal, NdotL, NdotH, NdotV, VdotH,","        surfaceRoughness, surfaceAnisotropy, surfaceRotation, metalF0);","    return specular*NdotL;","}","#elif defined( PRISMLAYERED )","vec3 BRDF_Layered(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH, ","                  vec3 Hlocal2, float N2dotL, float N2dotH, float N2dotV, ","                  vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation,","                  float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,","                  float layeredRotation, vec3 bottom_f0, float layeredFraction)","{","    vec3 Fl = Fresnel_Schlick(vec3(layeredF0), NdotL);","    vec3 Fv = Fresnel_Schlick(vec3(layeredF0), NdotV);","    vec3 amount = (1.0 - Fl) * (1.0 - Fv);","    vec3 topSpecular = surfaceAlbedo * MicrofacetLobe(","        Hlocal, NdotL, NdotH, NdotV, VdotH,","        surfaceRoughness, surfaceAnisotropy, surfaceRotation,","        vec3(layeredF0));","    vec3 topDiffuse = DiffuseLobe(layeredDiffuse);","    vec3 botSpecular = MicrofacetLobe(","        Hlocal2, N2dotL, N2dotH, N2dotV, VdotH,","        layeredRoughness, layeredAnisotropy, layeredRotation,","        bottom_f0);","    return topSpecular*NdotL + amount * mix(topDiffuse*NdotL, botSpecular*N2dotL, layeredFraction);","}","#elif defined( PRISMTRANSPARENT )","vec3 BRDF_Transparent(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH, ","                vec3 surfaceAlbedo, float surfaceRoughness, float surfaceAnisotropy, float surfaceRotation)","{","    vec3 reflectance = vec3(IORToReflectance(transparent_ior));","    vec3 specular = surfaceAlbedo * MicrofacetLobe(","        Hlocal, NdotL, NdotH, NdotV, VdotH,","        surfaceRoughness, surfaceAnisotropy, surfaceRotation, reflectance);","    return specular*NdotL;","}","#elif defined( PRISMWOOD )","vec3 BRDF_Wood(vec3 Hlocal, float NdotL, float NdotH, float NdotV, float VdotH, ","                 vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)","{","    vec3 diffuse = DiffuseLobe(woodDiffuse);","    vec3 specular = surfaceAlbedo * MicrofacetLobe(","        Hlocal, NdotL, NdotH, NdotV, VdotH,","        surfaceRoughness, 0.0, 0.0, vec3(0.04));","    return (specular+diffuse)*NdotL;","}","#endif","#endif","#if defined( USE_ENVMAP )","#if defined( PRISMOPAQUE )","vec3 Environment_Opaque(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness,","                        float opaqueF0, vec3 opaqueAlbedo)","{","    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;","    float exponent = AlphaToPhong(alpha);","    float reflMipIndex = ExponentToReflMipIndex(exponent);","    vec3 F = Fresnel_Rough(vec3(opaqueF0), NdotV, alpha);","#if defined( USE_IRRADIANCEMAP )","    vec3 envIrradiance = sampleNormal(N);","#else","    vec3 envIrradiance = vec3(1.0);","#endif","    vec3 diffuse = (1.0 - F) * opaqueAlbedo * envIrradiance;","     vec3 luminanceModifier;",d("opaque_luminance_modifier","luminanceModifier",!1,!0),"    vec3 emission = luminanceModifier * opaque_luminance;","    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);","    vec3 specular = F* surfaceAlbedo * envSpecular;","    return diffuse + specular + emission;","}","#elif defined( PRISMMETAL )","vec3 Environment_Metal(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 metalF0)","{","    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;","    float exponent = AlphaToPhong(alpha);","    float reflMipIndex = ExponentToReflMipIndex(exponent);","    vec3 F = Fresnel_Rough(metalF0, NdotV, alpha);","    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);","    vec3 specular = F * surfaceAlbedo * envSpecular;","    return specular;","}","#elif defined( PRISMLAYERED )","vec3 Environment_Layered(vec3 N, vec3 V, float NdotV, vec3 N2, float N2dotV, vec3 surfaceAlbedo, float surfaceRoughness,","                         float layeredF0, vec3 layeredDiffuse, float layeredRoughness, float layeredAnisotropy,","                         float layeredRotation, vec3 bottom_f0, float layeredFraction)","{","    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;","    float exponent = AlphaToPhong(alpha);","    float reflMipIndex = ExponentToReflMipIndex(exponent);","    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);","    vec3 F = Fresnel_Schlick(vec3(layeredF0), NdotV);","    vec3 topSpecular = F * surfaceAlbedo * envSpecular;","    vec3 amount = (1.0 - F);","#if defined( USE_IRRADIANCEMAP )","    vec3 envIrradiance = sampleNormal(N);","#else","    vec3 envIrradiance = vec3(1.0);","#endif","    vec3 topDiffuse = layeredDiffuse * envIrradiance;","    alpha = RoughnessToAlpha(layeredRoughness, 0.0).x;","    exponent = AlphaToPhong(alpha);","    reflMipIndex = ExponentToReflMipIndex(exponent);","    envSpecular = sampleReflection(N2, V, reflMipIndex);","    F = Fresnel_Rough(bottom_f0, N2dotV, alpha);","    vec3 botSpecular = F * envSpecular;","    return topSpecular + amount * mix(topDiffuse, botSpecular, layeredFraction);","}","#elif defined( PRISMTRANSPARENT )","vec3 Environment_Transparent(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness)","{","    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;","    float exponent = AlphaToPhong(alpha);","    float reflMipIndex = ExponentToReflMipIndex(exponent);","    vec3 reflectance = vec3(IORToReflectance(transparent_ior));","    vec3 F = Fresnel_Rough(reflectance, NdotV, alpha);","    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);","    vec3 specular = F * surfaceAlbedo * envSpecular;","#if defined( USE_IRRADIANCEMAP )","    vec3 envIrradiance = sampleNormal(N);","#else","    vec3 envIrradiance = vec3(1.0);","#endif","    vec3 color = 0.5 * (1.0 - F) * transparent_color * envIrradiance;","    return specular + color;","}","#elif defined( PRISMWOOD )","vec3 Environment_Wood(vec3 N, vec3 V, float NdotV, vec3 surfaceAlbedo, float surfaceRoughness, vec3 woodDiffuse)","{","    float alpha = RoughnessToAlpha(surfaceRoughness, 0.0).x;","    float exponent = AlphaToPhong(alpha);","    float reflMipIndex = ExponentToReflMipIndex(exponent);","    vec3 F = Fresnel_Rough(vec3(0.04), NdotV, alpha);","#if defined( USE_IRRADIANCEMAP )","    vec3 envIrradiance = sampleNormal(N);","#else","    vec3 envIrradiance = vec3(1.0);","#endif","    vec3 diffuse = (1.0 - F) * woodDiffuse * envIrradiance;","    vec3 envSpecular = sampleReflection(N, V, reflMipIndex);","    vec3 specular = F * surfaceAlbedo * envSpecular;","    return diffuse + specular;","}","#endif","#endif","varying vec3 vNormal;","varying vec3 vViewPosition;",g.CutPlanesShaderChunk,"void main() {","#if NUM_CUTPLANES > 0","if (checkCutPlanes(vWorldPosition)) return;","#endif","vec3 N = normalize(vNormal);","#if defined( USE_SURFACE_NORMAL_MAP ) || defined( USE_LAYERED_NORMAL_MAP ) || MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0","#ifndef USE_MAP","vec3 Tu = normalize(vTangent);","vec3 Tv = normalize(vBitangent);","#else","vec3 q0 = dFdx( -vViewPosition );","vec3 q1 = dFdy( -vViewPosition );","vec2 st0 = dFdx( vUv );","vec2 st1 = dFdy( vUv );","vec3 Tu = normalize(  q0 * st1.t - q1 * st0.t );","vec3 Tv = normalize( -q0 * st1.s + q1 * st0.s );","#endif","#endif","vec3 V;","if (projectionMatrix[3][3] == 0.0) {","V = normalize( vViewPosition );","} else {","V = vec3(0.0, 0.0, 1.0);","}","N = faceforward(N, -V, N);","#if defined(PRISMLAYERED)","vec3 N2 = N;","#endif","#ifndef FLAT_SHADED","vec3 normal = normalize( vNormal );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#else","vec3 fdx = dFdx( vViewPosition );","vec3 fdy = dFdy( vViewPosition );","vec3 normal = normalize( cross( fdx, fdy ) );","#endif","vec3 geomNormal = normal;","#if defined( USE_SURFACE_NORMAL_MAP )","if (surface_normal_map_bumpmapType == 0)","     N = heightMapTransform(surface_normal_map, vUv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);","else","     N = normalMapTransform(surface_normal_map, vUv, surface_normal_map_texMatrix, surface_normal_map_bumpScale, Tu, Tv, N);","#endif","#if defined( USE_LAYERED_NORMAL_MAP )","if (layered_normal_map_bumpmapType == 0)","     N2 = heightMapTransform(layered_normal_map, vUv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);","else","     N2 = normalMapTransform(layered_normal_map, vUv, layered_normal_map_texMatrix, layered_normal_map_bumpScale, Tu, Tv, N2);","#endif","float NdotV = dot(N, V);","#if defined(PRISMLAYERED)","float N2dotV = dot(N2, V);","#endif","vec3 surfaceAlbedo;",d("surface_albedo","surfaceAlbedo",!1,!0),"float surfaceRoughness;",d("surface_roughness","surfaceRoughness",!0,!1),"float surfaceAnisotropy;",d("surface_anisotropy","surfaceAnisotropy",!0,!1),"float surfaceRotation;",d("surface_rotation","surfaceRotation",!0,!1),"#if defined(PRISMOPAQUE)","float opaqueF0;",d("opaque_f0","opaqueF0",!0,!1),"vec3 opaqueAlbedo;",d("opaque_albedo","opaqueAlbedo",!1,!0),"#elif defined(PRISMMETAL)","vec3 metalF0;",d("metal_f0","metalF0",!1,!0),"#elif defined(PRISMLAYERED)","float layeredF0;",d("layered_f0","layeredF0",!0,!1),"vec3 layeredDiffuse;",d("layered_diffuse","layeredDiffuse",!1,!0),"float layeredRoughness;",d("layered_roughness","layeredRoughness",!0,!1),"float layeredAnisotropy;",d("layered_anisotropy","layeredAnisotropy",!0,!1),"float layeredRotation;",d("layered_rotation","layeredRotation",!0,!1),"vec3 bottom_f0;",d("layered_bottom_f0","bottom_f0",!1,!0),"float layeredFraction;",d("layered_fraction","layeredFraction",!0,!1),"#elif defined(PRISMWOOD)","vec3 woodDiffuse = NoiseWood(surfaceRoughness);","#endif","vec3 outRadianceLight = vec3(0.0);","#if MAX_DIR_LIGHTS > 0 || MAX_POINT_LIGHTS > 0 || MAX_SPOT_LIGHTS > 0","vec3 lightDirection[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];","vec3 lightColor[ MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS ];","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","lightDirection[i] = normalize( lDirection.xyz );","lightColor[i] = SRGBToLinear(directionalLightColor[ i ]);","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","lightDirection[MAX_DIR_LIGHTS + i] = normalize( lVector );","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lightColor[MAX_DIR_LIGHTS + i] = SRGBToLinear(pointLightColor[ i ]) * lDistance;","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","lightDirection[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = normalize( lVector );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] )","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","lightColor[MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + i] = SRGBToLinear(spotLightColor[ i ]) * lDistance * spotEffect;","}","#endif","for( int i = 0; i < MAX_DIR_LIGHTS + MAX_POINT_LIGHTS + MAX_SPOT_LIGHTS; i ++ ) {","vec3 L = lightDirection[i];","float NdotL = dot(N, L);","vec3 H = normalize(L + V);","float NdotH = dot(N, H);","float VdotH = dot(V, H);","float Hu = dot(H, Tu);","float Hv = dot(H, Tv);","vec3 Hlocal = vec3(Hu, Hv, NdotH);","#if defined(PRISMLAYERED)","float N2dotL = dot(N2, L);","float N2dotH = dot(N2, H);","vec3 Hlocal2 = vec3(Hu, Hv, N2dotH);","#endif","vec3 brdf = lightColor[i] * ","#if defined(PRISMOPAQUE)","    BRDF_Opaque(Hlocal, NdotL, NdotH, NdotV, VdotH,","                surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,","                opaqueF0, opaqueAlbedo);","#elif defined(PRISMMETAL)","    BRDF_Metal(Hlocal, NdotL, NdotH, NdotV, VdotH, ","               surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation, ","               metalF0);","#elif defined(PRISMLAYERED)","    BRDF_Layered(Hlocal, NdotL, NdotH, NdotV, VdotH, Hlocal2, N2dotL, N2dotH, N2dotV,","                 surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation,","                 layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,","                 layeredRotation, bottom_f0, layeredFraction);","#elif defined(PRISMTRANSPARENT)","    BRDF_Transparent(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, surfaceAnisotropy, surfaceRotation);","#elif defined(PRISMWOOD)","    BRDF_Wood(Hlocal, NdotL, NdotH, NdotV, VdotH, surfaceAlbedo, surfaceRoughness, woodDiffuse);","#endif","outRadianceLight += max(vec3(0.0), brdf);","}","#endif","vec3 outRadianceEnv = vec3(0.0);","#if defined( USE_ENVMAP )","outRadianceEnv =","#if defined(PRISMOPAQUE)","    Environment_Opaque(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,","                        opaqueF0, opaqueAlbedo);","#elif defined(PRISMMETAL)","    Environment_Metal(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, metalF0);","#elif defined(PRISMLAYERED)","    Environment_Layered(N, V, clamp(NdotV, 0.0, 1.0), N2, clamp(N2dotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness,","                layeredF0, layeredDiffuse, layeredRoughness, layeredAnisotropy,","                layeredRotation, bottom_f0, layeredFraction);","#elif defined(PRISMTRANSPARENT)","    Environment_Transparent(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness);","#elif defined(PRISMWOOD)","    Environment_Wood(N, V, clamp(NdotV, 0.0, 1.0), surfaceAlbedo, surfaceRoughness, woodDiffuse);","#endif","#endif","float opacity = 1.0;","float surface_cutout = 1.0;",d("surface_cutout","surface_cutout",!0,!1),"#if defined( USE_SURFACE_CUTOUT_MAP )","if(surface_cutout < 0.01) discard;","#endif","#if defined(PRISMTRANSPARENT)","if (transparent_ior == 1.0 && transparent_color == vec3(1.0,1.0,1.0))","opacity = 0.0;","else","opacity = max(0.5, mix(1.0, surfaceRoughness, NdotV));","#endif","gl_FragColor = vec4( outRadianceLight + outRadianceEnv, opacity*surface_cutout );","#if TONEMAP_OUTPUT == 1","gl_FragColor.xyz = toneMapCanonOGS_WithGamma_WithColorPerserving(exposureBias * gl_FragColor.xyz);","#elif TONEMAP_OUTPUT == 2","gl_FragColor.xyz = toneMapCanonFilmic_WithGamma(exposureBias * gl_FragColor.xyz);","#endif",g.FinalOutputShaderChunk,"}"].join("\n")
},THREE.ShaderLib.prism=g.PrismShader,h.createPrismMaterial=function(){var a=new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(g.PrismShader.uniforms),vertexShader:g.PrismShader.vertexShader,fragmentShader:g.PrismShader.fragmentShader});return a.defaultAttributeValues.uvw=[0,0,0],a.mapList={},a.isPrismMaterial=!0,a},h.clonePrismMaterial=function(a){var b=h.createPrismMaterial();switch(b.mapList=a.mapList,b.prismType=a.prismType,b.surface_albedo=a.surface_albedo,b.surface_albedo_map=a.surface_albedo_map,b.surface_roughness=a.surface_roughness,b.surface_roughness_map=a.surface_roughness_map,b.surface_anisotropy=a.surface_anisotropy,b.surface_anisotropy_map=a.surface_anisotropy_map,b.surface_rotation=a.surface_rotation,b.surface_rotation_map=a.surface_rotation_map,b.surface_cutout_map=a.surface_cutout_map,b.surface_normal_map=a.surface_normal_map,b.prismType){case"PrismOpaque":b.opaque_albedo=(new THREE.Color).copy(a.opaque_albedo),b.opaque_luminance_modifier=(new THREE.Color).copy(a.opaque_luminance_modifier),b.opaque_f0=a.opaque_f0,b.opaque_luminance=a.opaque_luminance,b.opaque_albedo_map=a.opaque_albedo_map,b.opaque_luminance_modifier_map=a.opaque_luminance_modifier_map,b.opaque_f0_map=a.opaque_f0_map;break;case"PrismMetal":b.metal_f0=(new THREE.Color).copy(a.metal_f0),b.metal_f0_map=a.metal_f0_map;break;case"PrismLayered":b.layered_f0=a.layered_f0,b.layered_diffuse=(new THREE.Color).copy(a.layered_diffuse),b.layered_fraction=a.layered_fraction,b.layered_bottom_f0=(new THREE.Color).copy(a.layered_bottom_f0),b.layered_roughness=a.layered_roughness,b.layered_anisotropy=a.layered_anisotropy,b.layered_rotation=a.layered_rotation,b.layered_bottom_f0_map=a.layered_bottom_f0_map,b.layered_f0_map=a.layered_f0_map,b.layered_diffuse_map=a.layered_diffuse_map,b.layered_fraction_map=a.layered_fraction_map,b.layered_rotationlayered_roughness_map=a.layered_rotationlayered_roughness_map,b.layered_anisotropy_map=a.layered_anisotropy_map,b.layered_rotation_map=a.layered_rotation_map,b.layered_normal_map=a.layered_normal_map;break;case"PrismTransparent":b.transparent_color=(new THREE.Color).copy(a.transparent_color),b.transparent_distance=a.transparent_distance,b.transparent_ior=a.transparent_ior;break;case"PrismWood":b.wood_fiber_cosine_enable=a.wood_fiber_cosine_enable,b.wood_fiber_cosine_bands=a.wood_fiber_cosine_bands,b.wood_fiber_cosine_weights=(new THREE.Vector4).copy(a.wood_fiber_cosine_weights),b.wood_fiber_cosine_frequencies=(new THREE.Vector4).copy(a.wood_fiber_cosine_frequencies),b.wood_fiber_perlin_enable=a.wood_fiber_perlin_enable,b.wood_fiber_perlin_bands=a.wood_fiber_perlin_bands,b.wood_fiber_perlin_weights=(new THREE.Vector4).copy(a.wood_fiber_perlin_weights),b.wood_fiber_perlin_frequencies=(new THREE.Vector4).copy(a.wood_fiber_perlin_frequencies),b.wood_fiber_perlin_scale_z=a.wood_fiber_perlin_scale_z,b.wood_growth_perlin_enable=a.wood_growth_perlin_enable,b.wood_growth_perlin_bands=a.wood_growth_perlin_bands,b.wood_growth_perlin_weights=(new THREE.Vector4).copy(a.wood_growth_perlin_weights),b.wood_growth_perlin_frequencies=(new THREE.Vector4).copy(a.wood_growth_perlin_frequencies),b.wood_latewood_ratio=a.wood_latewood_ratio,b.wood_earlywood_sharpness=a.wood_earlywood_sharpness,b.wood_latewood_sharpness=a.wood_latewood_sharpness,b.wood_ring_thickness=a.wood_ring_thickness,b.wood_earlycolor_perlin_enable=a.wood_earlycolor_perlin_enable,b.wood_earlycolor_perlin_bands=a.wood_earlycolor_perlin_bands,b.wood_earlycolor_perlin_weights=(new THREE.Vector4).copy(a.wood_earlycolor_perlin_weights),b.wood_earlycolor_perlin_frequencies=(new THREE.Vector4).copy(a.wood_earlycolor_perlin_frequencies),b.wood_early_color=(new THREE.Color).copy(a.wood_early_color),b.wood_use_manual_late_color=a.wood_use_manual_late_color,b.wood_manual_late_color=(new THREE.Color).copy(a.wood_manual_late_color),b.wood_latecolor_perlin_enable=a.wood_latecolor_perlin_enable,b.wood_latecolor_perlin_bands=a.wood_latecolor_perlin_bands,b.wood_latecolor_perlin_weights=(new THREE.Vector4).copy(a.wood_latecolor_perlin_weights),b.wood_latecolor_perlin_frequencies=(new THREE.Vector4).copy(a.wood_latecolor_perlin_frequencies),b.wood_late_color_power=a.wood_late_color_power,b.wood_diffuse_perlin_enable=a.wood_diffuse_perlin_enable,b.wood_diffuse_perlin_bands=a.wood_diffuse_perlin_bands,b.wood_diffuse_perlin_weights=(new THREE.Vector4).copy(a.wood_diffuse_perlin_weights),b.wood_diffuse_perlin_frequencies=(new THREE.Vector4).copy(a.wood_diffuse_perlin_frequencies),b.wood_diffuse_perlin_scale_z=a.wood_diffuse_perlin_scale_z,b.wood_use_pores=a.wood_use_pores,b.wood_pore_type=a.wood_pore_type,b.wood_pore_radius=a.wood_pore_radius,b.wood_pore_cell_dim=a.wood_pore_cell_dim,b.wood_pore_color_power=a.wood_pore_color_power,b.wood_pore_depth=a.wood_pore_depth,b.wood_use_rays=a.wood_use_rays,b.wood_ray_color_power=a.wood_ray_color_power,b.wood_ray_seg_length_z=a.wood_ray_seg_length_z,b.wood_ray_num_slices=a.wood_ray_num_slices,b.wood_ray_ellipse_z2x=a.wood_ray_ellipse_z2x,b.wood_ray_ellipse_radius_x=a.wood_ray_ellipse_radius_x,b.wood_use_latewood_bump=a.wood_use_latewood_bump,b.wood_latewood_bump_depth=a.wood_latewood_bump_depth,b.wood_use_groove_roughness=a.wood_use_groove_roughness,b.wood_groove_roughness=a.wood_groove_roughness,b.wood_diffuse_lobe_weight=a.wood_diffuse_lobe_weight,b.permutationMap=a.permutationMap,b.gradientMap=a.gradientMap,b.perm2DMap=a.perm2DMap,b.permGradMap=a.permGradMap;break;default:console.warn("Unknown prism type: "+a.prismType)}return b.envExponentMin=a.envExponentMin,b.envExponentMax=a.envExponentMax,b.envExponentCount=a.envExponentCount,b.envMap=a.envMap,b.defines=a.defines,b})}function init_NormalsShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.NormalsShader&&(a.NormalsShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:["varying vec3 vNormal;","varying float depth;","#if NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif",a.PackNormalsShaderChunk,"void main() {","#ifdef UNPACK_NORMALS","vec3 objectNormal = decodeNormal(normal);","#else","vec3 objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;","vNormal = normalize( transformedNormal );","#if NUM_CUTPLANES > 0","    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","    vWorldPosition = worldPosition.xyz;","#endif","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","depth = mvPosition.z;","vec4 p_Position = projectionMatrix * mvPosition;","gl_Position = p_Position;","}"].join("\n"),fragmentShader:["varying highp vec3 vNormal;","varying highp float depth;","#if NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif",a.CutPlanesShaderChunk,"void main() {","#if NUM_CUTPLANES > 0","if (checkCutPlanes(vWorldPosition)) return;","#endif","vec3 n = vNormal;","n = n * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","n = normalize( n );","gl_FragColor = vec4(n.x, n.y, depth, 1.0);","}"].join("\n")})}function init_BackgroundShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.BackgroundShader&&(a.BackgroundShader={uniforms:{color1:{type:"v3",value:new THREE.Vector3(41/255,76/255,120/255)},color2:{type:"v3",value:new THREE.Vector3(1/255,2/255,3/255)},envMap:{type:"t",value:null},envRotationSin:{type:"f",value:0},envRotationCos:{type:"f",value:1},exposure:{type:"f",value:1},uCamDir:{type:"v3",value:new THREE.Vector3},uCamUp:{type:"v3",value:new THREE.Vector3},uResolution:{type:"v2",value:new THREE.Vector2(600,400)},uHalfFovTan:{type:"f",value:.5},envMapBackground:{type:"i",value:0}},vertexShader:["uniform vec3 color1;","uniform vec3 color2;","varying vec2 vUv;","varying vec3 vColor;","void main() {","if (uv.y == 0.0)","vColor = color2;","else","vColor = color1;","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["varying vec3 vColor;","varying vec2 vUv;","uniform samplerCube envMap;","uniform float exposure;","uniform vec3 uCamDir;","uniform vec3 uCamUp;","uniform vec2 uResolution;","uniform float uHalfFovTan;","uniform bool envMapBackground;",a.EnvSamplingShaderChunk,"const int bloomRange = 4;",a.OrderedDitheringShaderChunk,"vec3 RGBMDecode(in vec4 vRGBM, in float exposure) {","vec3 ret = vRGBM.rgb * (vRGBM.a * 16.0);","ret *= ret;","ret *= exposure;","return ret;","}","vec3 rayDir(in vec2 vUv) {","vec3 A = (uResolution.x/uResolution.y)*normalize(cross(uCamDir,uCamUp)) * (uHalfFovTan * 2.0);","vec3 B = normalize(uCamUp) * (uHalfFovTan * 2.0);","vec3 C = normalize(uCamDir);","vec3 ray = normalize( C + (2.0*vUv.x-1.0)*A + (2.0*vUv.y-1.0)*B );","return ray;","}","vec4 getColor(in vec3 rd) {","return vec4(RGBMDecode(textureCube(envMap, adjustLookupVector(rd)), exposure), 1.0);","}","void main() {","vec3 rd = rayDir(vUv);","if (envMapBackground) {","gl_FragColor = getColor(rd);","}","else {","gl_FragColor = vec4(orderedDithering(vColor), 1.0);","}","}"].join("\n")})}function init_FireflyBasicShader(a){"use strict";var b=Autodesk.Viewing.Shaders;THREE.ShaderLib.firefly_basic={uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap,b.CutPlanesUniforms]),vertexShader:[THREE.ShaderChunk.common,THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"#if NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif","void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"	#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"	#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,"#if NUM_CUTPLANES > 0","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","#endif",THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,"#if NUM_CUTPLANES > 0","varying highp vec3 vWorldPosition;","#endif",b.CutPlanesShaderChunk,"void main() {","#if NUM_CUTPLANES > 0","if (checkCutPlanes(vWorldPosition)) return;","#endif","	vec3 outgoingLight = vec3( 0.0 );","	vec4 diffuseColor = vec4( diffuse, opacity );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"	outgoingLight = diffuseColor.rgb;",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"	gl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")}}function init_LineShader(a){"use strict";var b=Autodesk.Viewing.Shaders;if("undefined"==typeof a.LineShader){var c=["#define TAU     6.28318530718","#define PI      3.14159265358979","#define HALF_PI 1.57079632679","#define PI_0_5  HALF_PI","#define PI_1_5  4.71238898038"].join("\n"),d=["#define VBB_GT_TRIANGLE_INDEXED  0.0","#define VBB_GT_LINE_SEGMENT      1.0","#define VBB_GT_ARC_CIRCULAR      2.0","#define VBB_GT_ARC_ELLIPTICAL    3.0","#define VBB_GT_TEX_QUAD          4.0","#define VBB_GT_ONE_TRIANGLE      5.0"].join("\n"),e=["#define VBB_INSTANCED_FLAG   0.0","#define VBB_SEG_START_RIGHT  0.0","#define VBB_SEG_START_LEFT   1.0","#define VBB_SEG_END_RIGHT    2.0","#define VBB_SEG_END_LEFT     3.0"].join("\n"),f=["varying vec4 fsColor;","varying vec4 dbId;","varying vec2 fsOffsetDirection;","varying vec4 fsMultipurpose;","varying float fsGeomType;","varying float fsHalfWidth;"].join("\n");a.LineShader={uniforms:{pixelsPerUnit:{type:"f",value:1},aaRange:{type:"f",value:.5},tLayerMask:{type:"t",value:null},tLineStyle:{type:"t",value:null},vLineStyleTexSize:{type:"v2",value:new THREE.Vector2(13,70)},tRaster:{type:"t",value:null},tSelectionTexture:{type:"t",value:null},vSelTexSize:{type:"v2",value:new THREE.Vector2(4096,1)},displayPixelRatio:{type:"f",value:1},opacity:{type:"f",value:1},selectionColor:{type:"v4",value:new THREE.Vector4(0,0,1,1)}},attributes:{fields1:0,fields2:0,color4b:0,dbId4b:0,flags4b:0,layerVp4b:0,extraParams:0,instFlags4b:0},defines:{},vertexShader:[c,d,e,f,"attribute vec3 fields1;","attribute vec3 fields2;","attribute vec4 color4b;","attribute vec4 dbId4b;","attribute vec4 flags4b;","attribute vec4 layerVp4b;","#ifdef HAS_ELLIPTICALS","attribute vec3 extraParams;","#endif","#ifdef USE_INSTANCING","attribute vec4 instFlags4b;","#endif","uniform mat4 mvpMatrix;","uniform float pixelsPerUnit;","uniform float aaRange;","#ifdef HAS_LAYERS","uniform sampler2D tLayerMask;","#endif","#ifdef SELECTION_RENDERER","uniform sampler2D tSelectionTexture;","uniform vec2 vSelTexSize;","uniform vec4 selectionColor;","#endif","vec2 centralVertex;","vec2 offsetPosition;","vec2 cos_sin(const float angle) { return vec2(cos(angle), sin(angle)); }","void min_max(inout vec2 minPt, inout vec2 maxPt, const vec2 p) {","minPt = min(minPt, p);","maxPt = max(maxPt, p);","}","#if defined(USE_INSTANCING)","float getVertexId() { return instFlags4b.x; }","#else","float getVertexId() { return flags4b.x; }","#endif","bool isStartVertex() { return (getVertexId() < VBB_SEG_END_RIGHT); }","bool isLeftVertex()  { float id = getVertexId(); return ((id == VBB_SEG_END_LEFT || id == VBB_SEG_START_LEFT)); }","struct SegmentData { float angle, distAlong, distTotal, lineWidthHalf, lineType; };","void decodeSegmentData(out SegmentData seg) {","seg.angle         = fields1.z;","seg.distAlong     = fields2.x;","seg.distTotal     = fields2.z;","seg.lineWidthHalf = fields2.y;","seg.lineType      = flags4b.z;","}","void strokeLineSegment() {","SegmentData seg; decodeSegmentData(seg);","float isStartCapVertex = isStartVertex() ? -1.0 :  1.0;","float isLeftSide       = isLeftVertex( ) ?  1.0 : -1.0;","float angleTransverse = seg.angle + isLeftSide * HALF_PI;","float lwAdjustment = fsHalfWidth + aaRange;","vec2 transverseOffset = cos_sin(angleTransverse) * lwAdjustment;","offsetPosition.xy += transverseOffset;","float distanceFromStart = max(isStartCapVertex, 0.0) * seg.distAlong;","vec2 along = distanceFromStart * cos_sin(seg.angle);","offsetPosition.xy += along;","centralVertex.xy  += along;","vec2 moveOffset = isStartCapVertex * isLeftSide * vec2(-transverseOffset.y, transverseOffset.x);","offsetPosition.xy -= moveOffset;","centralVertex.xy  -= moveOffset;","fsMultipurpose.x = (isStartCapVertex * lwAdjustment) + distanceFromStart;","fsMultipurpose.y = seg.distAlong;","fsMultipurpose.z = seg.distTotal;","fsMultipurpose.w = seg.lineType;","if (seg.lineWidthHalf < 0.0)","fsHalfWidth = -fsHalfWidth;","}","#ifdef HAS_TRIANGLE_GEOMS","struct TriangleData { vec2 p0, p1, p2; };","void decodeTriangleData(out TriangleData tri) {","// tri.p0 = fields1.xy; // not used in shader...","tri.p1 = vec2(fields1.z, fields2.x);","tri.p2 = fields2.yz;","}","void strokeOneTriangle() {","TriangleData tri; decodeTriangleData(tri);","float vertexId = getVertexId();","if      (vertexId == VBB_SEG_END_RIGHT) offsetPosition.xy = tri.p1;","else if (vertexId == VBB_SEG_END_LEFT)  offsetPosition.xy = tri.p2;","}","#endif","#ifdef HAS_RASTER_QUADS","struct TexQuadData { float angle; vec2 size; };","void decodeTexQuadData(out TexQuadData quad) {","quad.angle     = fields1.z;","quad.size   = fields2.xy;","}","void strokeTexQuad() {","TexQuadData quad; decodeTexQuadData(quad);","vec2 corner = vec2(isLeftVertex() ? -1.0 : 1.0, isStartVertex() ? -1.0 : 1.0);","vec2 p      = 0.5 * corner * quad.size;","vec2 rot    = cos_sin(quad.angle);","vec2 offset = vec2(p.x * rot.x - p.y * rot.y, p.x * rot.y + p.y * rot.x);","offsetPosition.xy += offset;","fsMultipurpose.xy = max(vec2(0.0), corner);","}","#endif","#if defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)","struct ArcData { vec2 c; float start, end, major, minor, tilt; };","void decodeArcData(out ArcData arc) {","arc.c     = fields1.xy;","arc.start = fields1.z;","arc.end   = fields2.x;","arc.major = fields2.z;","#if defined(HAS_ELLIPTICALS)","arc.minor = extraParams.x;","arc.tilt  = extraParams.y;","#endif // defined(HAS_ELLIPTICALS)","}","void strokeArc(const ArcData arc) {","float isStart = isStartVertex() ? -1.0 : 1.0;","float isLeft  = isLeftVertex()  ? -1.0 : 1.0;","vec2 minPt;","vec2 maxPt;","vec2 angles = vec2(arc.start, arc.end);","vec2 endsX = vec2(arc.c.x) + arc.major * cos(angles);","vec2 endsY = vec2(arc.c.y) + arc.minor * sin(angles);","minPt = maxPt = vec2(endsX.x, endsY.x);","min_max(minPt, maxPt, vec2(endsX.y, endsY.y));","if (arc.end > arc.start) {","if (arc.start < PI_0_5 && arc.end > PI_0_5) {","min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));","}","if (arc.start < PI && arc.end > PI) {","min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));","}","if (arc.start < PI_1_5 && arc.end > PI_1_5) {","min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));","}","} else {","min_max(minPt, maxPt, vec2(arc.c.x + arc.major, arc.c.y));","if (arc.start < PI_0_5 || arc.end > PI_0_5) {","min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y + arc.minor));","}","if (arc.start < PI || arc.end > PI) {","min_max(minPt, maxPt, vec2(arc.c.x - arc.major, arc.c.y));","}","if (arc.start < PI_1_5 || arc.end > PI_1_5) {","min_max(minPt, maxPt, vec2(arc.c.x, arc.c.y - arc.minor));","}","}","minPt -= fsHalfWidth + aaRange;","maxPt += fsHalfWidth + aaRange;","offsetPosition.x = (isStart < 0.0) ? minPt.x : maxPt.x;","offsetPosition.y = (isLeft < 0.0)  ? minPt.y : maxPt.y;","fsMultipurpose.x = arc.start;","fsMultipurpose.y = arc.end;","fsMultipurpose.z = arc.major;","fsMultipurpose.w = arc.minor;","}","#endif // defined(HAS_CIRCLES) || defined(HAS_ELLIPTICALS)","#if defined(HAS_CIRCLES)","void strokeCircularArc() {","ArcData arc; decodeArcData(arc);","float r = arc.major;","if (r * pixelsPerUnit < 0.125)","r = 0.25 * aaRange;","arc.major = arc.minor = r;","strokeArc(arc);","}","#endif","#if defined(HAS_ELLIPTICALS)","void strokeEllipticalArc() {","ArcData arc; decodeArcData(arc);","strokeArc(arc);","}","#endif","struct CommonAttribs { vec2 pos; vec4 color; vec2 layerTC, vpTC; float lineWidthHalf, geomType; };","void decodeCommonAttribs(out CommonAttribs attribs) {","attribs.pos           = fields1.xy;","attribs.color         = color4b;","attribs.geomType      = flags4b.y;","attribs.layerTC       = layerVp4b.xy / 255.0;","attribs.vpTC          = layerVp4b.zw / 255.0;","attribs.lineWidthHalf = fields2.y;","}","void strokeIndexedTriangle() {","}","#ifdef SELECTION_RENDERER","bool isSelected(const CommonAttribs attribs) {","vec3 oid = dbId4b.rgb;","float id01 = oid.r + oid.g * 256.0;","float t = (id01 + 0.5) * (1.0 / 4096.0);","float flrt = floor(t);","float texU = t - flrt;","float id23 = oid.b * (65536.0 / 4096.0) + flrt;","t = (id23 + 0.5) / vSelTexSize.y;","float texV = fract(t);","vec4 selBit = texture2D(tSelectionTexture, vec2(texU, texV));","return selBit.r == 1.0;","}","#endif","bool isLayerOff(const CommonAttribs attribs) {","#ifdef HAS_LAYERS","vec4 layerBit = texture2D(tLayerMask, attribs.layerTC);","return layerBit.r == 0.0;","#else","return false;","#endif","}","vec4 getColor(const CommonAttribs attribs) {","if (isLayerOff(attribs)) { return vec4(0.0); }","#ifdef SELECTION_RENDERER","if (isSelected(attribs)) { return selectionColor; }","return vec4(0.0);","#else","return attribs.color;","#endif","}","void main() {","CommonAttribs attribs; decodeCommonAttribs(attribs);","fsColor = getColor(attribs);","if(fsColor.a == 0.0) {","gl_Position = vec4(0.0);","return;","}","centralVertex = offsetPosition = attribs.pos;","float lineWeight = attribs.lineWidthHalf;","if (lineWeight > 0.0) {","if(lineWeight < 0.5 / pixelsPerUnit) {","lineWeight = 0.5 / pixelsPerUnit;","}","}","else {","lineWeight = abs(lineWeight) / pixelsPerUnit;","}","fsHalfWidth = lineWeight;","dbId = dbId4b / 255.0;","if      (attribs.geomType == VBB_GT_LINE_SEGMENT)     strokeLineSegment();","#ifdef HAS_CIRCLES","else if (attribs.geomType == VBB_GT_ARC_CIRCULAR)     strokeCircularArc();","#endif","#ifdef HAS_ELLIPTICALS","else if (attribs.geomType == VBB_GT_ARC_ELLIPTICAL)   strokeEllipticalArc();","#endif","#ifdef HAS_RASTER_QUADS","else if (attribs.geomType == VBB_GT_TEX_QUAD)         strokeTexQuad();","#endif","#ifdef HAS_TRIANGLE_GEOMS","else if (attribs.geomType == VBB_GT_ONE_TRIANGLE)     strokeOneTriangle();","#endif","else if (attribs.geomType == VBB_GT_TRIANGLE_INDEXED) strokeIndexedTriangle();","fsGeomType = attribs.geomType;","fsOffsetDirection = offsetPosition - centralVertex;","gl_Position = mvpMatrix * modelMatrix * vec4( offsetPosition.xy, 0.0, 1.0 );","}"].join("\n"),fragmentShader:[c,d,e,f,"uniform highp float pixelsPerUnit;","uniform highp float aaRange;","uniform float opacity;","#ifdef HAS_RASTER_QUADS","uniform sampler2D tRaster;","#endif","#ifdef HAS_LINESTYLES","uniform sampler2D tLineStyle;","uniform vec2 vLineStyleTexSize;","#endif","float curveGaussian(float r, float invWidth) {","float amt = clamp(r * invWidth, 0.0, 1.0);","float exponent = amt * 2.0;","return exp(-exponent*exponent);","}","#ifdef HAS_LINESTYLES","float getLinePatternPixel(int i, int j) {","return texture2D(tLineStyle, (vec2(i, j) + 0.5) / vLineStyleTexSize).x * 255.0;","}","float getPatternLength(int whichPattern) {","float p1 = getLinePatternPixel(0, whichPattern);","float p2 = getLinePatternPixel(1, whichPattern);","return (p2 * 256.0 + p1);","}","#endif","void fillLineSegment() {","float radius = abs(fsHalfWidth);","float parametricDistance = fsMultipurpose.x;","float segmentLength      = fsMultipurpose.y;","float totalDistance      = fsMultipurpose.z;","#ifdef HAS_LINESTYLES","int whichPattern         = int(fsMultipurpose.w);","if (whichPattern > 0) {","const float TEX_TO_UNIT = 1.0 / 96.0;","float LTSCALE = 1.0;","float patternScale;","if (fsHalfWidth < 0.0) {","patternScale = LTSCALE;","} else {","patternScale = LTSCALE * TEX_TO_UNIT * pixelsPerUnit;","}","float patLen = patternScale * getPatternLength(whichPattern);","float phase = mod((totalDistance + parametricDistance) * pixelsPerUnit, patLen);","bool onPixel = true;","float radiusPixels = radius * pixelsPerUnit;","for (int i=2; i<MAX_LINESTYLE_LENGTH; i+=2) {","float on = getLinePatternPixel(i, whichPattern);","if (on == 1.0) on = 0.0;","on *= patternScale;","onPixel = true;","phase -= on;","if (phase < 0.0) {","break;","}","else if (phase <= radiusPixels) {","onPixel = false;","break;","}","float off = getLinePatternPixel(i+1, whichPattern);","if (off <= 1.0) off = 0.0;","off *= patternScale;","onPixel = false;","phase -= off;","if (phase < -radiusPixels)","discard;","if (phase <= 0.0)","break;","}","if (!onPixel && (abs(phase) <= radiusPixels)) {","segmentLength = 0.0;","parametricDistance = phase / pixelsPerUnit;","}","}","#endif","float dist;","float offsetLength2 = dot(fsOffsetDirection, fsOffsetDirection);","float ltz = max(0.0, sign(-parametricDistance));","float gtsl = max(0.0, sign(parametricDistance - segmentLength));","float d = (ltz + gtsl) * (parametricDistance - gtsl * segmentLength);","dist = sqrt(max(0.0, offsetLength2 + d*d));","float range =  dist - radius;","if (range > aaRange) {","discard;","}","gl_FragColor = fsColor;","gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);","}","#ifdef HAS_CIRCLES","void fillCircularArc() {","float dist   = length(fsOffsetDirection);","vec2 angles  = fsMultipurpose.xy;","float radius = fsMultipurpose.z;","float range  =  abs(dist - radius);","range -= fsHalfWidth;","if (range > aaRange) {","discard;","}","vec2 direction = fsOffsetDirection;","float angle = atan(direction.y, direction.x);","if (angles.x > angles.y)","angles.x -= TAU;","else if (angle < 0.0)","angle += TAU;","if (angle > angles.x && angle < angles.y) {","gl_FragColor = fsColor;","gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);","}","else {","discard;","}","}","#endif","#ifdef HAS_ELLIPTICALS","float EllipticalApprox(","const int iters,","inout float t0, inout float t1,","const vec2 y,   out   vec2 x,","const vec2 e,   const vec2 ey, const vec2 esqr",") {","vec2 r;","for (int i = 0; i < 10; ++i) {","if(i >= iters) break;","float t = mix(t0, t1, 0.5);","r = ey / (vec2(t) + esqr);","vec2 rsq = r * r;","float f = rsq.x + rsq.y - 1.0;","if(f > 0.0) { t0 = t; } else { t1 = t; }","}","x = e * r;","return distance(x, y);","}","float DistancePointEllipseSpecial (vec2 e, vec2 y, out vec2 x, float width, float aaRange) {","float dist;","vec2 esqr = e * e;","vec2 ey   = e * y;","float t0 = -esqr[1] + ey[1];","float t1 = -esqr[1] + length(ey);","dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);","if (dist > max(2.0 * (width + aaRange), e[0] * 0.05))","return dist;","dist = EllipticalApprox(6, t0, t1, y, x, e, ey, esqr);","float ecc = 1.0 +  0.1 * e[0] / e[1];","if (dist > max(ecc * (width + aaRange), e[0] * 0.001))","return dist;","if (dist < (width - aaRange) / ecc)","return dist;","dist = EllipticalApprox(10, t0, t1, y, x, e, ey, esqr);","return dist;","}","float DistancePointEllipse(vec2 e, vec2 y, out vec2 locX, float width, float aaRange) {","vec2 locE, locY;","float diff = sign(e[0] - e[1]);","vec2 swizzle = vec2(max(diff, 0.0), -min(diff, 0.0));","locE.x = dot(e, swizzle.xy);","locE.y = dot(e, swizzle.yx);","locY.x = dot(y, swizzle.xy);","locY.y = dot(y, swizzle.yx);","vec2 refl = sign(locY);","locY *= refl;","vec2 x;","float distance = DistancePointEllipseSpecial(locE, locY, x, width, aaRange);","x *= refl;","locX.x = dot(x, swizzle.xy);","locX.y = dot(x, swizzle.yx);","return distance;","}","void fillEllipticalArc() {","vec2 angles = fsMultipurpose.xy;","vec2 radii  = fsMultipurpose.zw;","vec2 dir    = fsOffsetDirection;","vec2 pos;","float range = DistancePointEllipse(radii, dir, pos, fsHalfWidth, aaRange);","range -= fsHalfWidth;","if (range > aaRange)","discard;","float ar = radii[0] / radii[1];","float angle = atan(ar * pos.y, pos.x);","if (angles.x > angles.y)","angles.x -= TAU;","else if (angle < 0.0)","angle += TAU;","if (angle > angles.x && angle < angles.y) {","gl_FragColor = fsColor;","gl_FragColor.a *= curveGaussian(range+aaRange, pixelsPerUnit);","}","else {","discard;","}","}","#endif","#ifdef HAS_RASTER_QUADS","void fillTexQuad() { gl_FragColor = texture2D(tRaster, fsMultipurpose.xy); }","#endif","void fillTriangle() { gl_FragColor = fsColor; }","void main() {","if (fsColor.a == 0.0) {","discard;","}","if      (abs(fsGeomType - VBB_GT_LINE_SEGMENT) < 0.5)     fillLineSegment();","#ifdef HAS_CIRCLES","else if (abs(fsGeomType - VBB_GT_ARC_CIRCULAR) < 0.5)     fillCircularArc();","#endif","#ifdef HAS_ELLIPTICALS","else if (abs(fsGeomType - VBB_GT_ARC_ELLIPTICAL) < 0.5)   fillEllipticalArc();","#endif","#ifdef HAS_RASTER_QUADS","else if (abs(fsGeomType - VBB_GT_TEX_QUAD) < 0.5)         fillTexQuad();","#endif","#ifdef HAS_TRIANGLE_GEOMS","else if (abs(fsGeomType - VBB_GT_ONE_TRIANGLE) < 0.5)     fillTriangle();","#endif","else fillTriangle();","#ifdef MRT_NORMALS","gl_FragData[1] = vec4(0.0);","#endif","gl_FragColor.a *= opacity;",b.IdOutputShaderChunk,"}"].join("\n")}}}function init_GroundShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.GroundDepthShader&&(a.GroundDepthShader={uniforms:{cutplanes:{type:"v4v",value:[]}},vertexShader:["#ifdef USE_LOGDEPTHBUF","    #ifdef USE_LOGDEPTHBUF_EXT","        varying float vFragDepth;","    #endif","    uniform float logDepthBufFC;","#endif","#if NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif","void main() {","    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );;","#if NUM_CUTPLANES > 0","    vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","    vWorldPosition = worldPosition.xyz;","#endif","#ifdef USE_LOGDEPTHBUF","    gl_Position.z = log2(max(1e-6, gl_Position.w + 1.0)) * logDepthBufFC;","    #ifdef USE_LOGDEPTHBUF_EXT","        vFragDepth = 1.0 + gl_Position.w;","    #else","        gl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;","    #endif","#endif","}"].join("\n"),fragmentShader:["#ifdef USE_LOGDEPTHBUF","    uniform float logDepthBufFC;","    #ifdef USE_LOGDEPTHBUF_EXT","        #extension GL_EXT_frag_depth : enable","        varying float vFragDepth;","    #endif","#endif",a.PackDepthShaderChunk,"#if NUM_CUTPLANES > 0","varying vec3 vWorldPosition;","#endif",a.CutPlanesShaderChunk,"void main() {","#if NUM_CUTPLANES > 0","if (checkCutPlanes(vWorldPosition)) return;","#endif","#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)","gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;","#endif","#ifdef USE_LOGDEPTHBUF_EXT","float depth = gl_FragDepthEXT / gl_FragCoord.w;","#else","float depth = gl_FragCoord.z / gl_FragCoord.w;","#endif","depth = 1.0 - depth;","gl_FragColor = packDepth(depth);","}"].join("\n")},a.GroundShadowAOShader={uniforms:{tDepth:{type:"t",value:null},worldSize:{type:"v3",value:new THREE.Vector3(1,1,1)}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2(uv.x, uv.y);","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define NUM_SAMPLES 29.0","#define NUM_SPIRAL_TURNS 7.0","uniform sampler2D tDepth;","uniform vec3 worldSize;","varying vec2 vUv;","#ifdef PRESET_2","#define SAMPLE_RADIUS 0.3","#define AO_GAMMA 1.0","#define AO_INTENSITY 1.0","#else","#define SAMPLE_RADIUS 0.2","#define AO_GAMMA 3.0","#define AO_INTENSITY 0.8","#endif",a.PackDepthShaderChunk,"#define PI 3.14159265358979","float rand(vec2 co) {","return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);","}","float getRandomAngle(vec2 pos) {","return rand(pos) * (2.0 * PI);","}","vec2 tapLocation(float sampleNumber, float spinAngle, out float ssR){","float alpha = float(sampleNumber + 0.5) * (1.0 / NUM_SAMPLES);","float angle = alpha * (NUM_SPIRAL_TURNS * PI * 2.0) + spinAngle;","ssR = alpha;","return vec2(cos(angle), sin(angle));","}","vec2 sampleAO(vec2 unitDirection, float radius) {","vec2 sampleOffset = unitDirection * radius;","float idepth = unpackDepth(texture2D(tDepth, vUv + sampleOffset));","float depth = 1.0 - idepth;","if (depth < 1e-6) {","if (radius == 0.0)","return vec2(1.0, 1.0);","else","return vec2(0.0, 1.0);","}","vec3 dir = vec3(sampleOffset.x, depth, sampleOffset.y) * worldSize;","float distance2 = dot(dir,dir);","float idistance = 1.0 / sqrt(distance2);","vec3 ndir = dir * idistance;","#ifdef PRESET_2","float importance = ndir.y * idistance;","#else","float importance = ndir.y / distance2;","#endif","vec2 ret;","ret.x = (idepth == 0.0) ? 0.0 : importance;","ret.y = importance;","return ret;","}","void main() {","vec2 sum = vec2(0.0);","float angle = getRandomAngle(vUv);","for (float i = 0.0; i<NUM_SAMPLES; i+= 1.0) {","float ssR;","vec2 uv = tapLocation(i, angle, ssR);","sum += sampleAO(uv, ssR * SAMPLE_RADIUS);","}","float ao = sum.x / sum.y;","gl_FragColor = packDepth(AO_INTENSITY * clamp(pow(ao, AO_GAMMA), 0.0, 0.9999));","}"].join("\n")},a.GroundShadowBlurShader={uniforms:{tDepth:{type:"t",value:null}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = vec2(uv.x, uv.y);","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),
fragmentShader:["uniform sampler2D tDepth;","varying vec2 vUv;","#ifdef HORIZONTAL","#define GET_UV(X) vec2(vUv.x + KERNEL_SCALE*(X), vUv.y)","#else","#define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE*(Y))","#endif",a.PackDepthShaderChunk,"#define PI 3.14159265358979","#define SIGMA ((2.0 * KERNEL_RADIUS+1.0) / 6.0)","#define SIGMASQ2 (2.0 * SIGMA * SIGMA)","#ifdef BOX","#define KERNEL_VAL(X) 1.0","#else","#define KERNEL_VAL(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )","#endif","void main() {","float depthVal = 0.0;","float sum = 0.0;","for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {","depthVal += unpackDepth(texture2D(tDepth, GET_UV(x))) * KERNEL_VAL(x);","sum += KERNEL_VAL(x);","}","gl_FragColor = packDepth(depthVal/sum);","}"].join("\n")},a.GroundShadowColorShader={uniforms:{tDepth:{type:"t",value:null},uShadowColor:{type:"v4",value:new THREE.Vector4(0,0,0,1)}},vertexShader:["varying vec2 vUv;","void main() {","    vUv = vec2(uv.x, uv.y);","    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D tDepth;","uniform vec4 uShadowColor;","varying vec2 vUv;",a.PackDepthShaderChunk,"void main() {","float depthVal = unpackDepth(texture2D(tDepth, vUv));","gl_FragColor = vec4(uShadowColor.rgb, uShadowColor.a * depthVal);","}"].join("\n")})}function init_GroundReflectionShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.GroundReflectionCompShader&&(a.GroundReflectionCompShader={uniforms:{tDiffuse:{type:"t",value:null},tBackground:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform sampler2D tBackground;","uniform vec4 uColor;","varying vec2 vUv;","void main() {","vec4 bgCol = texture2D( tBackground, vUv );","vec4 diffCol = uColor * texture2D( tDiffuse, vUv );","gl_FragColor = mix(bgCol, diffCol, diffCol.a);","}"].join("\n")},a.GroundReflectionDrawShader={uniforms:{tDiffuse:{type:"t",value:null}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = texel;","}"].join("\n")})}function init_GaussianShader(){"use strict";var a=Autodesk.Viewing.Shaders;"undefined"==typeof a.GaussianShader&&(a.GaussianShader={uniforms:{tDiffuse:{type:"t",value:null},uColor:{type:"v4",value:new THREE.Vector4(1,1,1,1)}},vertexShader:["varying vec2 vUv;","void main() {","#if defined(HORIZONTAL) && defined(FLIP_UV)","    vUv = vec2(uv.x, 1.0-uv.y);","#else","    vUv = vec2(uv.x, uv.y);","#endif","    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec4 uColor;","varying vec2 vUv;","#ifdef HORIZONTAL","    #define GET_UV(X) vec2(vUv.x + KERNEL_SCALE_H*(X), vUv.y)","#else","    #define GET_UV(Y) vec2(vUv.x, vUv.y + KERNEL_SCALE_V*(Y))","#endif","#define PI 3.14159265358979","#define SIGMA ((KERNEL_RADIUS+KERNEL_RADIUS+1.0) / 6.0)","#define SIGMASQ2 (2.0 * SIGMA * SIGMA)","#define GAUSSIAN(X) ( (1.0 / sqrt(PI * SIGMASQ2)) * exp(-(X)*(X)/SIGMASQ2) )","void main() {","    vec4 texColSum = vec4(0.0);","    float gaussSum = 0.0;","    for (float x=-KERNEL_RADIUS; x<=KERNEL_RADIUS; x+=1.0) {","        float gauss = GAUSSIAN(x);","        vec4 texCol = texture2D(tDiffuse, GET_UV(x));","        #ifdef HAS_ALPHA","            texCol.rgb *= texCol.a;","        #endif","        texColSum += texCol * gauss;","        gaussSum += gauss;","    }","    #ifdef HAS_ALPHA","        texColSum.rgb /= texColSum.a;","    #endif","#ifdef HORIZONTAL","    gl_FragColor = texColSum/gaussSum;","#else","    gl_FragColor = texColSum/gaussSum * uColor;","#endif","}"].join("\n")})}function init_UnifiedCamera(){if("undefined"==typeof Autodesk.Viewing.UnifiedCamera){var a=function(a,b){THREE.Camera.call(this),this.fov=45,this.near=.1,this.far=1e5,this.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2,this.clientWidth=a,this.clientHeight=b,this.target=new THREE.Vector3(0,0,-1),this.worldup=new THREE.Vector3(0,1,0),this.orthographicCamera=new THREE.OrthographicCamera(this.left,this.right,this.top,this.bottom,this.near,this.far),this.perspectiveCamera=new THREE.PerspectiveCamera(this.fov,this.aspect,this.near,this.far),this.zoom=1,this.toPerspective()};a.ORTHO_FOV=2*Math.atan(.5)*180/Math.PI,a.prototype=Object.create(THREE.Camera.prototype),a.prototype.clone=function(){var b=new a(2*this.right,2*this.top);return THREE.Camera.prototype.clone.call(this,b),b.position.copy(this.position),b.up.copy(this.up),this.target&&(b.target=this.target.clone()),this.worldup&&(b.worldup=this.worldup.clone()),this.worldUpTransform&&(b.worldUpTransform=this.worldUpTransform.clone()),b.left=this.left,b.right=this.right,b.top=this.top,b.bottom=this.bottom,b.near=this.near,b.far=this.far,b.fov=this.fov,b.aspect=this.aspect,b.zoom=this.zoom,b.isPerspective=this.isPerspective,this.updateProjectionMatrix(),b},a.prototype.__computeFovPosition=function(a){if(Math.abs(this.fov-a)<=1e-4)return this.position.clone();var b=this.target.clone().sub(this.position),c=THREE.Math.degToRad(this.fov),d=THREE.Math.degToRad(a),e=b.length()*Math.tan(.5*c)/Math.tan(.5*d),f=b.normalize().multiplyScalar(-e);return this.target.clone().add(f)},a.prototype.toPerspective=function(){!this.isPerspective&&this.saveFov&&(this.position.copy(this.__computeFovPosition(this.saveFov)),this.fov=this.saveFov),this.perspectiveCamera.aspect=this.aspect,this.perspectiveCamera.near=this.near,this.perspectiveCamera.far=this.far,this.perspectiveCamera.fov=this.fov/this.zoom,this.perspectiveCamera.updateProjectionMatrix(),this.projectionMatrix=this.perspectiveCamera.projectionMatrix,this.isPerspective=!0},a.prototype.toOrthographic=function(){if(this.isPerspective){this.saveFov=this.fov;var b=a.ORTHO_FOV;this.position.copy(this.__computeFovPosition(b)),this.fov=b}this.orthoScale=this.target.clone().sub(this.position).length();var c=.5*this.orthoScale,d=c*this.aspect;this.left=this.orthographicCamera.left=-d,this.right=this.orthographicCamera.right=d,this.top=this.orthographicCamera.top=c,this.bottom=this.orthographicCamera.bottom=-c,this.orthographicCamera.near=this.near,this.orthographicCamera.far=this.far,this.orthographicCamera.updateProjectionMatrix(),this.projectionMatrix=this.orthographicCamera.projectionMatrix,this.isPerspective=!1},a.prototype.updateProjectionMatrix=function(){this.isPerspective?this.toPerspective():this.toOrthographic()},a.prototype.setSize=function(a,b){this.aspect=a/b,this.left=-a/2,this.right=a/2,this.top=b/2,this.bottom=-b/2},a.prototype.setFov=function(a){this.fov=a,this.updateProjectionMatrix()},a.prototype.setLens=function(a,b){void 0===b&&(b=24);var c=2*THREE.Math.radToDeg(Math.atan(b/(2*a)));return this.setFov(c),c},a.prototype.getCameraChangedEvent=function(){return{type:Autodesk.Viewing.CAMERA_CHANGE_EVENT,camera:this}},Autodesk.Viewing.UnifiedCamera=a}}function stringToDOM(a){var b=document.createElement("div");return b.innerHTML=a,b.firstChild}function MobileCallbacks(){this.ios=window.webkit,this.android=window.JSINTERFACE,this.iosSend=function(a,b){window.webkit.messageHandlers.callbackHandler.postMessage({command:a,data:b})},this.androidSend=window.JSINTERFACE}function init_WarpShader(){"undefined"==typeof window.WarpShader&&(WarpShader={uniforms:{tDiffuse:{type:"t",value:null},scale:{type:"v2",value:new THREE.Vector2(1,1)},scaleIn:{type:"v2",value:new THREE.Vector2(1,1)},lensCenter:{type:"v2",value:new THREE.Vector2(0,0)},hmdWarpParam:{type:"v4",value:new THREE.Vector4(1,.22,.24,0)},chromAbParam:{type:"v4",value:new THREE.Vector4(.996,-.004,1.014,0)}},defines:{},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec2 scale;","uniform vec2 scaleIn;","uniform vec2 lensCenter;","uniform vec4 hmdWarpParam;","uniform vec4 chromAbParam;","varying vec2 vUv;","vec4 sampleColor() {","vec2 uv = (vUv*2.0)-1.0;","vec2 theta = (uv-lensCenter)*scaleIn;","float rSq = theta.x*theta.x + theta.y*theta.y;","vec2 rvector = theta*(hmdWarpParam.x + hmdWarpParam.y*rSq + hmdWarpParam.z*rSq*rSq + hmdWarpParam.w*rSq*rSq*rSq);","  vec2 rBlue = rvector * (chromAbParam.z + chromAbParam.w * rSq);","  vec2 tcBlue = (lensCenter + scale * rBlue);","  tcBlue = (tcBlue+1.0)/2.0;","  if (any(bvec2(clamp(tcBlue, vec2(0.0,0.0), vec2(1.0,1.0))-tcBlue)))","    return vec4(0.0, 0.0, 0.0, 1.0);","  vec2 tcGreen = lensCenter + scale * rvector;","  tcGreen = (tcGreen+1.0)/2.0;","  vec2 rRed = rvector * (chromAbParam.x + chromAbParam.y * rSq);","  vec2 tcRed = lensCenter + scale * rRed;","  tcRed = (tcRed+1.0)/2.0;","  return vec4(texture2D(tDiffuse, tcRed).r, texture2D(tDiffuse, tcGreen).g, texture2D(tDiffuse, tcBlue).b, 1);","}","void main() {","vec4 texel = sampleColor();","gl_FragColor = texel;","}"].join("\n")})}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1),this.plane=c,this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b),this.plane.constant=b})}function init_TransformGizmos(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=k.vertices.push(b)-1;var c=h(a)/2/Math.PI+.5,d=i(a)/Math.PI+.5;return b.uv=new THREE.Vector2(c,1-d),b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);k.faces.push(d),t.copy(a).add(b).add(c).divideScalar(3);var e=h(t);k.faceVertexUvs[0].push([j(a.uv,a,e),j(b.uv,b,e),j(c.uv,c,e)])}function g(a,b){for(var c=Math.pow(2,b),d=(Math.pow(4,b),e(k.vertices[a.a])),g=e(k.vertices[a.b]),h=e(k.vertices[a.c]),i=[],j=0;c>=j;j++){i[j]=[];for(var l=e(d.clone().lerp(h,j/c)),m=e(g.clone().lerp(h,j/c)),n=c-j,o=0;n>=o;o++)0==o&&j==c?i[j][o]=l:i[j][o]=e(l.clone().lerp(m,o/n))}for(var j=0;c>j;j++)for(var o=0;2*(c-j)-1>o;o++){var p=Math.floor(o/2);o%2==0?f(i[j][p+1],i[j+1][p],i[j][p]):f(i[j][p+1],i[j+1][p+1],i[j+1][p])}}function h(a){return Math.atan2(a.z,-a.x)}function i(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function j(a,b,c){return 0>c&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:d},c=c||1,d=d||0;for(var k=this,l=0,m=a.length;m>l;l+=3)e(new THREE.Vector3(a[l],a[l+1],a[l+2]));for(var n=this.vertices,o=[],l=0,p=0,m=b.length;m>l;l+=3,p++){var q=n[b[l]],r=n[b[l+1]],s=n[b[l+2]];o[p]=new THREE.Face3(q.index,r.index,s.index,[q.clone(),r.clone(),s.clone()])}for(var t=new THREE.Vector3,l=0,m=o.length;m>l;l++)g(o[l],d);for(var l=0,m=this.faceVertexUvs[0].length;m>l;l++){var u=this.faceVertexUvs[0][l],v=u[0].x,w=u[1].x,x=u[2].x,y=Math.max(v,Math.max(w,x)),z=Math.min(v,Math.min(w,x));y>.9&&.1>z&&(.2>v&&(u[0].x+=1),.2>w&&(u[1].x+=1),.2>x&&(u[2].x+=1))}for(var l=0,m=this.vertices.length;m>l;l++)this.vertices[l].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,c,d,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||100,b=b||40,c=c||8,d=d||6,e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],i=0;c>=i;i++)for(var j=0;d>=j;j++){var k=j/d*e,l=i/c*Math.PI*2;f.x=a*Math.cos(k),f.y=a*Math.sin(k);var m=new THREE.Vector3;m.x=(a+b*Math.cos(l))*Math.cos(k),m.y=(a+b*Math.cos(l))*Math.sin(k),m.z=b*Math.sin(l),this.vertices.push(m),g.push(new THREE.Vector2(j/d,i/c)),h.push(m.clone().sub(f).normalize())}for(var i=1;c>=i;i++)for(var j=1;d>=j;j++){var n=(d+1)*i+j-1,o=(d+1)*(i-1)+j-1,p=(d+1)*(i-1)+j,q=(d+1)*i+j,r=new THREE.Face3(n,o,q,[h[n].clone(),h[o].clone(),h[q].clone()]);this.faces.push(r),this.faceVertexUvs[0].push([g[n].clone(),g[o].clone(),g[q].clone()]),r=new THREE.Face3(o,p,q,[h[o].clone(),h[p].clone(),h[q].clone()]),this.faces.push(r),this.faceVertexUvs[0].push([g[o].clone(),g[p].clone(),g[q].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var d=new THREE.Geometry;c=c?c:1;for(var e=0;64*c>=e;++e)"x"==b&&d.vertices.push(new THREE.Vector3(0,Math.cos(e/32*Math.PI),Math.sin(e/32*Math.PI)).multiplyScalar(a)),"y"==b&&d.vertices.push(new THREE.Vector3(Math.cos(e/32*Math.PI),0,Math.sin(e/32*Math.PI)).multiplyScalar(a)),"z"==b&&d.vertices.push(new THREE.Vector3(Math.sin(e/32*Math.PI),Math.cos(e/32*Math.PI),0).multiplyScalar(a));return d},d=function(a,b,c,d,e,f){var g=new THREE.Geometry,h=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,d,e,f));return h.position.y=.5,h.updateMatrix(),g.merge(h.geometry,h.matrix),g},e=function(a){var b=new THREE.Geometry;return"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),b};THREE.TransformGizmo=function(){var a=this,b=!1,c=!1;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;var c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d],c[d].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry)),b.merge(a.geometry,a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(a){a.visible=!1})},this.show=function(){this.traverse(function(c){c.visible=!0,(c.parent==a.pickers||c.parent==a.hemiPicker)&&(c.visible=b),c.parent==a.planes&&(c.visible=!1)}),this.activePlane.visible=c},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})},this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2],h=a[c][d][3];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),h&&(e.visble=h),b.add(e)}};this.setHandlePickerGizmos(),a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),a(this.highlightGizmos,this.highlights),a(this.hemiPickerGizmos,this.hemiPicker),a(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){f.name&&(-1!=f.name.search("E")?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):(-1!=f.name.search("X")||-1!=f.name.search("Y")||-1!=f.name.search("Z"))&&f.quaternion.setFromEuler(a))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(0,.05,.2,12,1,!1),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(g,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new a({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE),"RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=d(0,.05,.2,12,1,!1),c=new THREE.Geometry;c.vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));var e=.15;this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*e*Math.PI),new a({color:16711680})),[0,0,0],[e*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,2*e*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,(.5-e)*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*e*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[e*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,2*e*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,(.5-e)*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new a({color:255})),null,null,!1]]}},this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})}},this.show=function(){this.traverse(function(a){(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)&&(a.visible=!0),a.material&&(a.material.opacity=a.material.oldOpacity),(a.parent==b.pickers||a.parent==b.hemiPicker||a.parent==b.subPickers)&&(a.visible=!1),(a.parent==b.planes||a.parent==b.highlights)&&(a.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(c){c.material&&c.material.highlight&&(c.name==a?((c.parent==b.highlights||c.parent==b.handles)&&(c.visible=!0),c.material.highlight(!0)):(c.material.highlight(!1),c.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(.125,.125,.125),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(a,b,c){function d(c,d){var e=b.getBoundingClientRect(),f=(c.clientX-e.left)/e.width*2-1,g=2*-((c.clientY-e.top)/e.height)+1;a.isPerspective?(t.set(f,g,.5),t.unproject(a),s.set(a.position,t.sub(a.position).normalize())):(t.set(f,g,-1),t.unproject(a),u.set(0,0,-1),s.set(t,u.transformDirection(a.matrixWorld)));var h=s.intersectObjects(d,!0);return h[0]?h[0]:!1}switch(THREE.Object3D.call(this),b=void 0!==b?b:document,this.gizmo={},c){case"translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[c]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[c]),this.gizmo[c].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===c){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var f=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});e.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(e,f);var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var e=new THREE.CircleGeometry(.1,32),f=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:g});this.centerMark=new THREE.Mesh(e,f),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var f=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:g}),h=.12,i=.25,j=1.15;this.ticks.RX=new THREE.Object3D;var e=new THREE.PlaneBufferGeometry(h,i),k=new THREE.Mesh(e,f);k.position.set(0,0,-j-i/2),k.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,j+i/2,0),k.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,0,j+i/2),k.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(k),k=k.clone(),k.position.set(0,-j-i/2,0),k.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(k),this.ticks.RY=new THREE.Object3D,k=k.clone(),k.position.set(0,0,-j-i/2),k.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(k),k=k.clone(),k.position.set(-j-i/2,0,0),k.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(k),k=k.clone(),k.position.set(0,0,j+i/2),k.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(k),k=k.clone(),k.position.set(j+i/2,0,0),k.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(k)}var l=this,m=!1,n=c,o={type:"change"},p={type:"mouseDown"},q={type:"mouseUp",mode:n},r={type:"objectChange"},s=new THREE.Raycaster,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,z=1,A=new THREE.Matrix4,B=new THREE.Vector3,C=new THREE.Matrix4,D=new THREE.Vector3,E=new THREE.Quaternion,F=new THREE.Vector3,G=new THREE.Vector3,H=new THREE.Vector3,I=new THREE.Quaternion,J=new THREE.Quaternion,K=new THREE.Quaternion,L=new THREE.Quaternion,M=new THREE.Quaternion,N=new THREE.Vector3,O=new THREE.Vector3,P=new THREE.Matrix4,Q=new THREE.Matrix4,R=new THREE.Vector3,S=new THREE.Vector3,T=new THREE.Euler,U=new THREE.Matrix4,V=new THREE.Vector3;
new THREE.Euler;this.attach=function(a){l.object=a,this.gizmo[n].show(),l.update(),l.updateUnitVectors()},this.detach=function(a){l.object=void 0,this.axis=null,this.gizmo[n].hide()},this.setMode=function(a){n=a?a:n,"scale"==n&&(l.space="local"),this.gizmo[n].show(),this.update(),l.dispatchEvent(o)},this.getPicker=function(){return l.gizmo[n].hemiPicker.children},this.setPosition=function(a){this.object.position.copy(a),this.update()},this.setNormal=function(a){E.setFromUnitVectors(this.normal,a),this.unitX.applyQuaternion(E),this.unitY.applyQuaternion(E),this.unitZ.applyQuaternion(E),this.normal.copy(a),this.object&&this.object.quaternion.multiply(E),this.update()},this.setSnap=function(a,b){l.snap=a,l.snapDelta=b},this.setSize=function(a){l.size=a,this.update(),l.dispatchEvent(o)},this.setSpace=function(a){l.space=a,this.update(),l.dispatchEvent(o)},this.update=function(c){if(void 0!==l.object){l.object.updateMatrixWorld(),S.setFromMatrixPosition(l.object.matrixWorld),T.setFromRotationMatrix(C.extractRotation(l.object.matrixWorld)),a.updateMatrixWorld(),V.setFromMatrixPosition(a.matrixWorld),this.position.copy(S),this.quaternion.setFromEuler(T),this.normal.set(0,0,1),this.normal.applyEuler(T);var d=S.distanceTo(V),e=a.isPerspective?2*Math.tan(a.fov*Math.PI/360)*d:d,f=b.getBoundingClientRect();z=100*e/f.height,this.scale.set(z,z,z),c&&this.gizmo[n].highlight(l.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(T),this.unitY.applyEuler(T),this.unitZ.applyEuler(T)},this.showRotationGizmos=function(a){for(var b=this.gizmo[n].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0,-1!==d.name.search("R")&&(d.visible=a)}this.useAllPickers=a},this.highlight=function(){this.gizmo[n].highlight(this.axis||"Z")},this.onPointerHover=function(a){if(void 0===l.object||m===!0)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children),e=null,f="";return c&&(e=c.object.name,f=-1!=e.search("R")?"rotate":"translate"),l.axis!==e&&(l.axis=e,l.gizmo[n].activeMode=f,l.update(!0),l.dispatchEvent(o)),null===l.axis&&l.gizmo[n].show(),c?!0:!1},this.onPointerDown=function(b){if(void 0===l.object||m===!0)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){var e=d(c,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children),f=null,g="";e&&(f=e.object.name,g=-1!=f.search("R")?"rotate":"translate"),l.axis!==f&&(l.axis=f,l.gizmo[n].activeMode=g)}var e=null;if((0===c.button||void 0===c.button)&&(e=d(c,l.useAllPickers?l.gizmo[n].pickers.children:l.gizmo[n].subPickers.children))){l.dispatchEvent(p),l.axis=e.object.name,l.update(),B.copy(a.position).sub(S).normalize(),l.gizmo[n].setActivePlane(l.axis,B);var h=d(c,[l.gizmo[n].activePlane]);if(h&&w.copy(h.point),N.copy(l.object.position),O.copy(l.object.scale),P.extractRotation(l.object.matrix),U.extractRotation(l.object.matrixWorld),l.object.parent?(Q.extractRotation(l.object.parent.matrixWorld),R.setFromMatrixScale(C.getInverse(l.object.parent.matrixWorld))):(Q.extractRotation(l.object.matrixWorld),R.setFromMatrixScale(C.getInverse(l.object.matrixWorld))),"transrotate"===n&&"rotate"===l.gizmo[n].activeMode){l.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(l.matrixWorld),l.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(l.matrixWorld),l.startLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.startLine);var i=l.object.geometry.getAttribute("position"),j=(new THREE.Vector3).fromAttribute(i,0).applyMatrix4(l.object.matrixWorld),k=(new THREE.Vector3).fromAttribute(i,1).applyMatrix4(l.object.matrixWorld),o=(new THREE.Vector3).fromAttribute(i,2).applyMatrix4(l.object.matrixWorld),q=(new THREE.Vector3).fromAttribute(i,3).applyMatrix4(l.object.matrixWorld);if("RX"===l.axis){j.lerp(o,.5),k.lerp(q,.5);var r=j.distanceTo(k);l.centerLine.material.dashSize=r/15,l.centerLine.material.gapSize=r/30,l.centerLine.geometry.vertices[0].copy(j),l.centerLine.geometry.vertices[1].copy(k)}else{j.lerp(k,.5),o.lerp(q,.5);var r=j.distanceTo(o);l.centerLine.material.dashSize=r/15,l.centerLine.material.gapSize=r/30,l.centerLine.geometry.vertices[0].copy(j),l.centerLine.geometry.vertices[1].copy(o)}l.centerLine.geometry.computeLineDistances(),l.centerLine.geometry.verticesNeedUpdate=!0,l.parent.add(l.centerLine),l.ticks[l.axis].position.copy(l.position),l.ticks[l.axis].quaternion.copy(l.quaternion),l.ticks[l.axis].scale.copy(l.scale),l.parent.add(l.ticks[l.axis])}}return m=!0,e?!0:!1},this.onPointerMove=function(a){if(void 0===l.object||null===l.axis||m===!1)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,[l.gizmo[n].activePlane]);c&&v.copy(c.point);var e=l.gizmo[n].activeMode;if("translate"==e)v.sub(w),v.multiply(R),"local"==l.space&&(v.applyMatrix4(C.getInverse(U)),F.copy(this.unitX),G.copy(this.unitY),H.copy(this.unitZ),D.set(0,0,0),-1!=l.axis.search("X")&&(F.multiplyScalar(v.dot(this.unitX)),D.add(F)),-1!=l.axis.search("Y")&&(G.multiplyScalar(v.dot(this.unitY)),D.add(G)),-1!=l.axis.search("Z")&&(H.multiplyScalar(v.dot(this.unitZ)),D.add(H)),v.copy(D),v.applyMatrix4(P),l.object.position.copy(N),l.object.position.add(v)),("world"==l.space||-1!=l.axis.search("XYZ"))&&(F.copy(this.unitX),G.copy(this.unitY),H.copy(this.unitZ),D.set(0,0,0),-1!=l.axis.search("X")&&(F.multiplyScalar(v.dot(this.unitX)),D.add(F)),-1!=l.axis.search("Y")&&(G.multiplyScalar(v.dot(this.unitY)),D.add(G)),-1!=l.axis.search("Z")&&(H.multiplyScalar(v.dot(this.unitZ)),D.add(H)),v.copy(D),v.applyMatrix4(C.getInverse(Q)),l.object.position.copy(N),l.object.position.add(v));else if("scale"==e)v.sub(w),v.multiply(R),"local"==l.space&&("XYZ"==l.axis?(z=1+v.y/50,l.object.scale.x=O.x*z,l.object.scale.y=O.y*z,l.object.scale.z=O.z*z):(v.applyMatrix4(C.getInverse(U)),"X"==l.axis&&(l.object.scale.x=O.x*(1+v.x/50)),"Y"==l.axis&&(l.object.scale.y=O.y*(1+v.y/50)),"Z"==l.axis&&(l.object.scale.z=O.z*(1+v.z/50))));else if("rotate"==e){if(v.sub(S),v.multiply(R),D.copy(w).sub(S),D.multiply(R),"RE"==l.axis){v.applyMatrix4(C.getInverse(A)),D.applyMatrix4(C.getInverse(A)),x.set(Math.atan2(v.z,v.y),Math.atan2(v.x,v.z),Math.atan2(v.y,v.x)),y.set(Math.atan2(D.z,D.y),Math.atan2(D.x,D.z),Math.atan2(D.y,D.x)),E.setFromRotationMatrix(C.getInverse(Q));var f=x.z-y.z;if(null!==l.snap){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}M.setFromAxisAngle(B,f),I.setFromRotationMatrix(U),E.multiplyQuaternions(E,M),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}else if("RXYZE"==l.axis){var h=v.clone().cross(D).normalize();E.setFromRotationMatrix(C.getInverse(Q));var i=-v.clone().angleTo(D);if(null!==l.snap){var g=Math.round(i/l.snap)*l.snap;Math.abs(g-i)<l.snapDelta&&(i=g)}J.setFromAxisAngle(h,i),I.setFromRotationMatrix(U),E.multiplyQuaternions(E,J),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}else if("local"==l.space){v.applyMatrix4(C.getInverse(U)),D.applyMatrix4(C.getInverse(U));var j=v.dot(this.unitX),k=v.dot(this.unitY),p=v.dot(this.unitZ),q=D.dot(this.unitX),s=D.dot(this.unitY),t=D.dot(this.unitZ);x.set(Math.atan2(p,k),Math.atan2(j,p),Math.atan2(k,j)),y.set(Math.atan2(t,s),Math.atan2(q,t),Math.atan2(s,q));var u=x.x-y.x,T=x.y-y.y,f=x.z-y.z;if(null!==l.snap){if(-1!=l.axis.search("X")){var g=Math.round(u/l.snap)*l.snap;Math.abs(g-u)<l.snapDelta&&(u=g)}if(-1!=l.axis.search("Y")){var g=Math.round(T/l.snap)*l.snap;Math.abs(g-T)<l.snapDelta&&(T=g)}if(-1!=l.axis.search("Z")){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}}J.setFromAxisAngle(this.unitX,u),K.setFromAxisAngle(this.unitY,T),L.setFromAxisAngle(this.unitZ,f),I.setFromRotationMatrix(P),"RX"==l.axis&&I.multiplyQuaternions(I,J),"RY"==l.axis&&I.multiplyQuaternions(I,K),"RZ"==l.axis&&I.multiplyQuaternions(I,L),l.object.quaternion.copy(I)}else if("world"==l.space){var j=v.dot(this.unitX),k=v.dot(this.unitY),p=v.dot(this.unitZ),q=D.dot(this.unitX),s=D.dot(this.unitY),t=D.dot(this.unitZ);x.set(Math.atan2(p,k),Math.atan2(j,p),Math.atan2(k,j)),y.set(Math.atan2(t,s),Math.atan2(q,t),Math.atan2(s,q)),E.setFromRotationMatrix(C.getInverse(Q));var u=x.x-y.x,T=x.y-y.y,f=x.z-y.z;if(null!==l.snap){if(-1!=l.axis.search("X")){var g=Math.round(u/l.snap)*l.snap;Math.abs(g-u)<l.snapDelta&&(u=g)}if(-1!=l.axis.search("Y")){var g=Math.round(T/l.snap)*l.snap;Math.abs(g-T)<l.snapDelta&&(T=g)}if(-1!=l.axis.search("Z")){var g=Math.round(f/l.snap)*l.snap;Math.abs(g-f)<l.snapDelta&&(f=g)}}J.setFromAxisAngle(this.unitX,u),K.setFromAxisAngle(this.unitY,T),L.setFromAxisAngle(this.unitZ,f),I.setFromRotationMatrix(U),"RX"==l.axis&&E.multiplyQuaternions(E,J),"RY"==l.axis&&E.multiplyQuaternions(E,K),"RZ"==l.axis&&E.multiplyQuaternions(E,L),E.multiplyQuaternions(E,I),l.object.quaternion.copy(E)}"transrotate"===n&&(l.add(l.endLine),l.add(l.centerMark))}return l.object.matrixAutoUpdate=!0,l.update(!0),l.dispatchEvent(o),l.dispatchEvent(r),c?!0:!1},this.onPointerUp=function(a){return m&&null!==l.axis&&(q.mode=n,l.dispatchEvent(q)),m=!1,this.gizmo[n].show(),this.updateUnitVectors(),"transrotate"===n&&"rotate"===this.gizmo[n].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}function stderr(){ENABLE_TRACE&&console.log.apply(console,arguments)}var IS_CONCAT_BUILD=!0,BUILD_LMV_WORKER_URL="lmvworker.min.js",LMV_WORKER_URL=BUILD_LMV_WORKER_URL,ENABLE_DEBUG=!1,ENABLE_TRACE=!1,ENABLE_INLINE_WORKER=!0,AutodeskNamespace=function(a){for(var b="undefined"!=typeof window&&null!==window?window:self,c=a.split("."),d=0;d<c.length;++d)b[c[d]]=b[c[d]]||{},b=b[c[d]];return b};AutodeskNamespace("Autodesk.Viewing.Private"),AutodeskNamespace("Autodesk.Viewing.Extensions"),AutodeskNamespace("Autodesk.Viewing.Shaders"),AutodeskNamespace("Autodesk.Viewing.UI"),AutodeskNamespace("Autodesk.LMVTK");var _isIE11=!!navigator.userAgent.match(/Trident\/7\./);"undefined"!=typeof window&&_isIE11&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}a.prototype=window.CustomEvent.prototype,window.CustomEvent=a}(),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(a,b){if(!b||b>this.byteLength?b=this.byteLength:0>b&&(b=this.byteLength+b,0>b&&(b=0)),0>a&&(a=this.byteLength+a,0>a&&(a=0)),a>=b)return new ArrayBuffer;for(var c=b-a,d=new Uint8Array(this,a,c),e=new Uint8Array(c),f=0;c>f;f++)e[f]=d[f];return e.buffer}),"undefined"!=typeof window&&(window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);var rescueFromPolymer=function(){return isSafari()?function(a){if(!window.Polymer)return a;for(var b in a)if(-1!==b.indexOf("__impl"))return a[b];return a}:function(a){return a}}();!function(){var a="undefined"!=typeof window&&null!==window?window:self;a.performance||(a.performance=Date)}(),"undefined"!=typeof window&&!function(a,b,c,d){"use strict";function e(a,b,c){return setTimeout(k(a,c),b)}function f(a,b,c){return Array.isArray(a)?(g(a,c[b],c),!0):!1}function g(a,b,c){var e;if(a)if(a.forEach)a.forEach(b,c);else if(a.length!==d)for(e=0;e<a.length;)b.call(c,a[e],e,a),e++;else for(e in a)a.hasOwnProperty(e)&&b.call(c,a[e],e,a)}function h(a,b,c){for(var e=Object.keys(b),f=0;f<e.length;)(!c||c&&a[e[f]]===d)&&(a[e[f]]=b[e[f]]),f++;return a}function i(a,b){return h(a,b,!0)}function j(a,b,c){var d,e=b.prototype;d=a.prototype=Object.create(e),d.constructor=a,d._super=e,c&&h(d,c)}function k(a,b){return function(){return a.apply(b,arguments)}}function l(a,b){return typeof a==ka?a.apply(b?b[0]||d:d,b):a}function m(a,b){return a===d?b:a}function n(a,b,c){g(r(b),function(b){a.addEventListener(b,c,!1)})}function o(a,b,c){g(r(b),function(b){a.removeEventListener(b,c,!1)})}function p(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1}function q(a,b){return a.indexOf(b)>-1}function r(a){return a.trim().split(/\s+/g)}function s(a,b,c){if(a.indexOf&&!c)return a.indexOf(b);for(var d=0;d<a.length;){if(c&&a[d][c]==b||!c&&a[d]===b)return d;d++}return-1}function t(a){return Array.prototype.slice.call(a,0)}function u(a,b,c){for(var d=[],e=[],f=0;f<a.length;){var g=b?a[f][b]:a[f];s(e,g)<0&&d.push(a[f]),e[f]=g,f++}return c&&(d=b?d.sort(function(a,c){return a[b]>c[b]}):d.sort()),d}function v(a,b){for(var c,e,f=b[0].toUpperCase()+b.slice(1),g=0;g<ia.length;){if(c=ia[g],e=c?c+f:b,e in a)return e;g++}return d}function w(){return oa++}function x(a){var b=a.ownerDocument;return b.defaultView||b.parentWindow}function y(a,b){var c=this;this.manager=a,this.callback=b,this.element=a.element,this.target=a.options.inputTarget,this.domHandler=function(b){l(a.options.enable,[a])&&c.handler(b)},this.init()}function z(a){var b,c=a.options.inputClass;return new(b=c?c:ra?N:sa?Q:qa?S:M)(a,A)}function A(a,b,c){var d=c.pointers.length,e=c.changedPointers.length,f=b&ya&&d-e===0,g=b&(Aa|Ba)&&d-e===0;c.isFirst=!!f,c.isFinal=!!g,f&&(a.session={}),c.eventType=b,B(a,c),a.emit("hammer.input",c),a.recognize(c),a.session.prevInput=c}function B(a,b){var c=a.session,d=b.pointers,e=d.length;c.firstInput||(c.firstInput=E(b)),e>1&&!c.firstMultiple?c.firstMultiple=E(b):1===e&&(c.firstMultiple=!1);var f=c.firstInput,g=c.firstMultiple,h=g?g.center:f.center,i=b.center=F(d);b.timeStamp=na(),b.deltaTime=b.timeStamp-f.timeStamp,b.angle=J(h,i),b.distance=I(h,i),C(c,b),b.offsetDirection=H(b.deltaX,b.deltaY),b.scale=g?L(g.pointers,d):1,b.rotation=g?K(g.pointers,d):0,D(c,b);var j=a.element;p(b.srcEvent.target,j)&&(j=b.srcEvent.target),b.target=j}function C(a,b){var c=b.center,d=a.offsetDelta||{},e=a.prevDelta||{},f=a.prevInput||{};(b.eventType===ya||f.eventType===Aa)&&(e=a.prevDelta={x:f.deltaX||0,y:f.deltaY||0},d=a.offsetDelta={x:c.x,y:c.y}),b.deltaX=e.x+(c.x-d.x),b.deltaY=e.y+(c.y-d.y)}function D(a,b){var c,e,f,g,h=a.lastInterval||b,i=b.timeStamp-h.timeStamp;if(b.eventType!=Ba&&(i>xa||h.velocity===d)){var j=h.deltaX-b.deltaX,k=h.deltaY-b.deltaY,l=G(i,j,k);e=l.x,f=l.y,c=ma(l.x)>ma(l.y)?l.x:l.y,g=H(j,k),a.lastInterval=b}else c=h.velocity,e=h.velocityX,f=h.velocityY,g=h.direction;b.velocity=c,b.velocityX=e,b.velocityY=f,b.direction=g}function E(a){for(var b=[],c=0;c<a.pointers.length;)b[c]={clientX:la(a.pointers[c].clientX),clientY:la(a.pointers[c].clientY)},c++;return{timeStamp:na(),pointers:b,center:F(b),deltaX:a.deltaX,deltaY:a.deltaY}}function F(a){var b=a.length;if(1===b)return{x:la(a[0].clientX),y:la(a[0].clientY)};for(var c=0,d=0,e=0;b>e;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:la(c/b),y:la(d/b)}}function G(a,b,c){return{x:b/a||0,y:c/a||0}}function H(a,b){return a===b?Ca:ma(a)>=ma(b)?a>0?Da:Ea:b>0?Fa:Ga}function I(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return Math.sqrt(d*d+e*e)}function J(a,b,c){c||(c=Ka);var d=b[c[0]]-a[c[0]],e=b[c[1]]-a[c[1]];return 180*Math.atan2(e,d)/Math.PI}function K(a,b){return J(b[1],b[0],La)-J(a[1],a[0],La)}function L(a,b){return I(b[0],b[1],La)/I(a[0],a[1],La)}function M(){this.evEl=Na,this.evWin=Oa,this.allow=!0,this.pressed=!1,y.apply(this,arguments)}function N(){this.evEl=Ra,this.evWin=Sa,y.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function O(){this.evTarget=Ua,this.evWin=Va,this.started=!1,y.apply(this,arguments)}function P(a,b){var c=t(a.touches),d=t(a.changedTouches);return b&(Aa|Ba)&&(c=u(c.concat(d),"identifier",!0)),[c,d]}function Q(){this.evTarget=Xa,this.targetIds={},y.apply(this,arguments)}function R(a,b){var c=t(a.touches),d=this.targetIds;if(b&(ya|za)&&1===c.length)return d[c[0].identifier]=!0,[c,c];var e,f,g=t(a.changedTouches),h=[],i=this.target;if(f=c.filter(function(a){return p(a.target,i)}),b===ya)for(e=0;e<f.length;)d[f[e].identifier]=!0,e++;for(e=0;e<g.length;)d[g[e].identifier]&&h.push(g[e]),b&(Aa|Ba)&&delete d[g[e].identifier],e++;return h.length?[u(f.concat(h),"identifier",!0),h]:void 0}function S(){y.apply(this,arguments);var a=k(this.handler,this);this.touch=new Q(this.manager,a),this.mouse=new M(this.manager,a)}function T(a,b){this.manager=a,this.set(b)}function U(a){if(q(a,bb))return bb;var b=q(a,cb),c=q(a,db);return b&&c?cb+" "+db:b||c?b?cb:db:q(a,ab)?ab:_a}function V(a){this.id=w(),this.manager=null,this.options=i(a||{},this.defaults),this.options.enable=m(this.options.enable,!0),this.state=eb,this.simultaneous={},this.requireFail=[]}function W(a){return a&jb?"cancel":a&hb?"end":a&gb?"move":a&fb?"start":""}function X(a){return a==Ga?"down":a==Fa?"up":a==Da?"left":a==Ea?"right":""}function Y(a,b){var c=b.manager;return c?c.get(a):a}function Z(){V.apply(this,arguments)}function $(){Z.apply(this,arguments),this.pX=null,this.pY=null}function _(){Z.apply(this,arguments)}function aa(){V.apply(this,arguments),this._timer=null,this._input=null}function ba(){Z.apply(this,arguments)}function ca(){Z.apply(this,arguments)}function da(){V.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ea(a,b){return b=b||{},b.recognizers=m(b.recognizers,ea.defaults.preset),new fa(a,b)}function fa(a,b){b=b||{},this.options=i(b,ea.defaults),this.options.inputTarget=this.options.inputTarget||a,this.handlers={},this.session={},this.recognizers=[],this.element=a,this.input=z(this),this.touchAction=new T(this,this.options.touchAction),ga(this,!0),g(b.recognizers,function(a){var b=this.add(new a[0](a[1]));a[2]&&b.recognizeWith(a[2]),a[3]&&b.requireFailure(a[3])},this)}function ga(a,b){var c=a.element;g(a.options.cssProps,function(a,d){c.style[v(c.style,d)]=b?a:""})}function ha(a,c){var d=b.createEvent("Event");d.initEvent(a,!0,!0),d.gesture=c,c.target.dispatchEvent(d)}var ia=["","webkit","moz","MS","ms","o"],ja=b.createElement("div"),ka="function",la=Math.round,ma=Math.abs,na=Date.now,oa=1,pa=/mobile|tablet|ip(ad|hone|od)|android/i,qa="ontouchstart"in a,ra=v(a,"PointerEvent")!==d,sa=qa&&pa.test(navigator.userAgent),ta="touch",ua="pen",va="mouse",wa="kinect",xa=25,ya=1,za=2,Aa=4,Ba=8,Ca=1,Da=2,Ea=4,Fa=8,Ga=16,Ha=Da|Ea,Ia=Fa|Ga,Ja=Ha|Ia,Ka=["x","y"],La=["clientX","clientY"];y.prototype={handler:function(){},init:function(){this.evEl&&n(this.element,this.evEl,this.domHandler),this.evTarget&&n(this.target,this.evTarget,this.domHandler),this.evWin&&n(x(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&o(this.element,this.evEl,this.domHandler),this.evTarget&&o(this.target,this.evTarget,this.domHandler),this.evWin&&o(x(this.element),this.evWin,this.domHandler)}};var Ma={mousedown:ya,mousemove:za,mouseup:Aa},Na="mousedown",Oa="mousemove mouseup";j(M,y,{handler:function(a){var b=Ma[a.type];b&ya&&0===a.button&&(this.pressed=!0),b&za&&1!==a.which&&(b=Aa),this.pressed&&this.allow&&(b&Aa&&(this.pressed=!1),this.callback(this.manager,b,{pointers:[a],changedPointers:[a],pointerType:va,srcEvent:a}))}});var Pa={pointerdown:ya,pointermove:za,pointerup:Aa,pointercancel:Ba,pointerout:Ba},Qa={2:ta,3:ua,4:va,5:wa},Ra="pointerdown",Sa="pointermove pointerup pointercancel";a.MSPointerEvent&&(Ra="MSPointerDown",Sa="MSPointerMove MSPointerUp MSPointerCancel"),j(N,y,{handler:function(a){var b=this.store,c=!1,d=a.type.toLowerCase().replace("ms",""),e=Pa[d],f=Qa[a.pointerType]||a.pointerType,g=f==ta,h=s(b,a.pointerId,"pointerId");e&ya&&(0===a.button||g)?0>h&&(b.push(a),h=b.length-1):e&(Aa|Ba)&&(c=!0),0>h||(b[h]=a,this.callback(this.manager,e,{pointers:b,changedPointers:[a],pointerType:f,srcEvent:a}),c&&b.splice(h,1))}});var Ta={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Ua="touchstart",Va="touchstart touchmove touchend touchcancel";j(O,y,{handler:function(a){var b=Ta[a.type];if(b===ya&&(this.started=!0),this.started){var c=P.call(this,a,b);b&(Aa|Ba)&&c[0].length-c[1].length===0&&(this.started=!1),this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}});var Wa={touchstart:ya,touchmove:za,touchend:Aa,touchcancel:Ba},Xa="touchstart touchmove touchend touchcancel";j(Q,y,{handler:function(a){var b=Wa[a.type],c=R.call(this,a,b);c&&this.callback(this.manager,b,{pointers:c[0],changedPointers:c[1],pointerType:ta,srcEvent:a})}}),j(S,y,{handler:function(a,b,c){var d=c.pointerType==ta,e=c.pointerType==va;if(d)this.mouse.allow=!1;else if(e&&!this.mouse.allow)return;b&(Aa|Ba)&&(this.mouse.allow=!0),this.callback(a,b,c)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Ya=v(ja.style,"touchAction"),Za=Ya!==d,$a="compute",_a="auto",ab="manipulation",bb="none",cb="pan-x",db="pan-y";T.prototype={set:function(a){a==$a&&(a=this.compute()),Za&&(this.manager.element.style[Ya]=a),this.actions=a.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var a=[];return g(this.manager.recognizers,function(b){l(b.options.enable,[b])&&(a=a.concat(b.getTouchAction()))}),U(a.join(" "))},preventDefaults:function(a){if(!Za){var b=a.srcEvent,c=a.offsetDirection;if(this.manager.session.prevented)return void b.preventDefault();var d=this.actions,e=q(d,bb),f=q(d,db),g=q(d,cb);return e||f&&c&Ha||g&&c&Ia?this.preventSrc(b):void 0}},preventSrc:function(a){this.manager.session.prevented=!0,a.preventDefault()}};var eb=1,fb=2,gb=4,hb=8,ib=hb,jb=16,kb=32;V.prototype={defaults:{},set:function(a){return h(this.options,a),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(a){if(f(a,"recognizeWith",this))return this;var b=this.simultaneous;return a=Y(a,this),b[a.id]||(b[a.id]=a,a.recognizeWith(this)),this},dropRecognizeWith:function(a){return f(a,"dropRecognizeWith",this)?this:(a=Y(a,this),delete this.simultaneous[a.id],this)},requireFailure:function(a){if(f(a,"requireFailure",this))return this;var b=this.requireFail;return a=Y(a,this),-1===s(b,a)&&(b.push(a),a.requireFailure(this)),this},dropRequireFailure:function(a){if(f(a,"dropRequireFailure",this))return this;a=Y(a,this);var b=s(this.requireFail,a);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(a){return!!this.simultaneous[a.id]},emit:function(a){function b(b){c.manager.emit(c.options.event+(b?W(d):""),a)}var c=this,d=this.state;hb>d&&b(!0),b(),d>=hb&&b(!0)},tryEmit:function(a){return this.canEmit()?this.emit(a):void(this.state=kb)},canEmit:function(){for(var a=0;a<this.requireFail.length;){if(!(this.requireFail[a].state&(kb|eb)))return!1;a++}return!0},recognize:function(a){var b=h({},a);return l(this.options.enable,[this,b])?(this.state&(ib|jb|kb)&&(this.state=eb),this.state=this.process(b),void(this.state&(fb|gb|hb|jb)&&this.tryEmit(b))):(this.reset(),void(this.state=kb))},process:function(){},getTouchAction:function(){},reset:function(){}},j(Z,V,{defaults:{pointers:1},attrTest:function(a){var b=this.options.pointers;return 0===b||a.pointers.length===b},process:function(a){var b=this.state,c=a.eventType,d=b&(fb|gb),e=this.attrTest(a);return d&&(c&Ba||!e)?b|jb:d||e?c&Aa?b|hb:b&fb?b|gb:fb:kb}}),j($,Z,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ja},getTouchAction:function(){var a=this.options.direction,b=[];return a&Ha&&b.push(db),a&Ia&&b.push(cb),b},directionTest:function(a){var b=this.options,c=!0,d=a.distance,e=a.direction,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&Ha?(e=0===f?Ca:0>f?Da:Ea,c=f!=this.pX,d=Math.abs(a.deltaX)):(e=0===g?Ca:0>g?Fa:Ga,c=g!=this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&e&b.direction},attrTest:function(a){return Z.prototype.attrTest.call(this,a)&&(this.state&fb||!(this.state&fb)&&this.directionTest(a))},emit:function(a){this.pX=a.deltaX,this.pY=a.deltaY;var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this._super.emit.call(this,a)}}),j(_,Z,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.scale-1)>this.options.threshold||this.state&fb)},emit:function(a){if(this._super.emit.call(this,a),1!==a.scale){var b=a.scale<1?"in":"out";this.manager.emit(this.options.event+b,a)}}}),j(aa,V,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[_a]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime>b.time;if(this._input=a,!d||!c||a.eventType&(Aa|Ba)&&!f)this.reset();else if(a.eventType&ya)this.reset(),this._timer=e(function(){this.state=ib,this.tryEmit()},b.time,this);else if(a.eventType&Aa)return ib;return kb},reset:function(){clearTimeout(this._timer)},emit:function(a){this.state===ib&&(a&&a.eventType&Aa?this.manager.emit(this.options.event+"up",a):(this._input.timeStamp=na(),this.manager.emit(this.options.event,this._input)))}}),j(ba,Z,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[bb]},attrTest:function(a){return this._super.attrTest.call(this,a)&&(Math.abs(a.rotation)>this.options.threshold||this.state&fb)}}),j(ca,Z,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:Ha|Ia,pointers:1},getTouchAction:function(){return $.prototype.getTouchAction.call(this)},attrTest:function(a){var b,c=this.options.direction;return c&(Ha|Ia)?b=a.velocity:c&Ha?b=a.velocityX:c&Ia&&(b=a.velocityY),this._super.attrTest.call(this,a)&&c&a.direction&&a.distance>this.options.threshold&&ma(b)>this.options.velocity&&a.eventType&Aa},emit:function(a){var b=X(a.direction);b&&this.manager.emit(this.options.event+b,a),this.manager.emit(this.options.event,a)}}),j(da,V,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[ab]},process:function(a){var b=this.options,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,f=a.deltaTime<b.time;if(this.reset(),a.eventType&ya&&0===this.count)return this.failTimeout();if(d&&f&&c){if(a.eventType!=Aa)return this.failTimeout();var g=this.pTime?a.timeStamp-this.pTime<b.interval:!0,h=!this.pCenter||I(this.pCenter,a.center)<b.posThreshold;this.pTime=a.timeStamp,this.pCenter=a.center,h&&g?this.count+=1:this.count=1,this._input=a;var i=this.count%b.taps;if(0===i)return this.hasRequireFailures()?(this._timer=e(function(){this.state=ib,this.tryEmit()},b.interval,this),fb):ib}return kb},failTimeout:function(){return this._timer=e(function(){this.state=kb},this.options.interval,this),kb},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ib&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ea.VERSION="2.0.4",ea.defaults={domEvents:!1,touchAction:$a,enable:!0,inputTarget:null,inputClass:null,preset:[[ba,{enable:!1}],[_,{enable:!1},["rotate"]],[ca,{direction:Ha}],[$,{direction:Ha},["swipe"]],[da],[da,{event:"doubletap",taps:2},["tap"]],[aa]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var lb=1,mb=2;fa.prototype={set:function(a){return h(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this},stop:function(a){this.session.stopped=a?mb:lb},recognize:function(a){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(a);var c,d=this.recognizers,e=b.curRecognizer;(!e||e&&e.state&ib)&&(e=b.curRecognizer=null);for(var f=0;f<d.length;)c=d[f],b.stopped===mb||e&&c!=e&&!c.canRecognizeWith(e)?c.reset():c.recognize(a),!e&&c.state&(fb|gb|hb)&&(e=b.curRecognizer=c),f++}},get:function(a){if(a instanceof V)return a;for(var b=this.recognizers,c=0;c<b.length;c++)if(b[c].options.event==a)return b[c];return null},add:function(a){if(f(a,"add",this))return this;var b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a},remove:function(a){if(f(a,"remove",this))return this;var b=this.recognizers;return a=this.get(a),b.splice(s(b,a),1),this.touchAction.update(),this},on:function(a,b){var c=this.handlers;return g(r(a),function(a){c[a]=c[a]||[],c[a].push(b)}),this},off:function(a,b){var c=this.handlers;return g(r(a),function(a){b?c[a].splice(s(c[a],b),1):delete c[a]}),this},emit:function(a,b){this.options.domEvents&&ha(a,b);var c=this.handlers[a]&&this.handlers[a].slice();if(c&&c.length){b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var d=0;d<c.length;)c[d](b),d++}},destroy:function(){this.element&&ga(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},h(ea,{INPUT_START:ya,INPUT_MOVE:za,INPUT_END:Aa,INPUT_CANCEL:Ba,STATE_POSSIBLE:eb,STATE_BEGAN:fb,STATE_CHANGED:gb,STATE_ENDED:hb,STATE_RECOGNIZED:ib,STATE_CANCELLED:jb,STATE_FAILED:kb,DIRECTION_NONE:Ca,DIRECTION_LEFT:Da,DIRECTION_RIGHT:Ea,DIRECTION_UP:Fa,DIRECTION_DOWN:Ga,DIRECTION_HORIZONTAL:Ha,DIRECTION_VERTICAL:Ia,DIRECTION_ALL:Ja,Manager:fa,Input:y,TouchAction:T,TouchInput:Q,MouseInput:M,PointerEventInput:N,TouchMouseInput:S,SingleTouchInput:O,Recognizer:V,AttrRecognizer:Z,Tap:da,Pan:$,Swipe:ca,Pinch:_,Rotate:ba,Press:aa,on:n,off:o,each:g,merge:i,extend:h,inherit:j,bindFn:k,prefixed:v}),"undefined"!=typeof module&&module.exports,a[c]=ea}(window,document,"Hammer"),LmvMatrix4=function(a){a?this.elements=new Float64Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]):this.elements=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])},LmvMatrix4.prototype={constructor:LmvMatrix4,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this.elements;return q[0]=a,q[4]=b,q[8]=c,q[12]=d,q[1]=e,q[5]=f,q[9]=g,q[13]=h,q[2]=i,q[6]=j,q[10]=k,q[14]=l,q[3]=m,q[7]=n,q[11]=o,q[15]=p,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(a){return this.elements.set(a.elements),this},makeRotationFromQuaternion:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},multiply:function(a){return this.multiplyMatrices(this,a)},multiplyMatrices:function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},multiplyToArray:function(a,b,c){var d=this.elements;return this.multiplyMatrices(a,b),c[0]=d[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],this},multiplyScalar:function(a){var b=this.elements;return b[0]*=a,b[4]*=a,b[8]*=a,b[12]*=a,b[1]*=a,b[5]*=a,b[9]*=a,b[13]*=a,b[2]*=a,b[6]*=a,b[10]*=a,b[14]*=a,b[3]*=a,b[7]*=a,b[11]*=a,b[15]*=a,this},determinant:function(){var a=this.elements,b=a[0],c=a[4],d=a[8],e=a[12],f=a[1],g=a[5],h=a[9],i=a[13],j=a[2],k=a[6],l=a[10],m=a[14],n=a[3],o=a[7],p=a[11],q=a[15];return n*(+e*h*k-d*i*k-e*g*l+c*i*l+d*g*m-c*h*m)+o*(+b*h*m-b*i*l+e*f*l-d*f*m+d*i*j-e*h*j)+p*(+b*i*k-b*g*m-e*f*k+c*f*m+e*g*j-c*i*j)+q*(-d*g*j-b*h*k+b*g*l+d*f*k-c*f*l+c*h*j)},transpose:function(){var a,b=this.elements;return a=b[1],b[1]=b[4],b[4]=a,a=b[2],b[2]=b[8],b[8]=a,a=b[6],b[6]=b[9],b[9]=a,a=b[3],b[3]=b[12],b[12]=a,a=b[7],b[7]=b[13],b[13]=a,a=b[11],b[11]=b[14],b[14]=a,this},flattenToArrayOffset:function(a,b){var c=this.elements;return a[b]=c[0],a[b+1]=c[1],a[b+2]=c[2],a[b+3]=c[3],a[b+4]=c[4],a[b+5]=c[5],a[b+6]=c[6],a[b+7]=c[7],a[b+8]=c[8],a[b+9]=c[9],a[b+10]=c[10],a[b+11]=c[11],a[b+12]=c[12],a[b+13]=c[13],a[b+14]=c[14],a[b+15]=c[15],
a},setPosition:function(a){var b=this.elements;return b[12]=a.x,b[13]=a.y,b[14]=a.z,this},getInverse:function(a,b){var c=this.elements,d=a.elements,e=d[0],f=d[4],g=d[8],h=d[12],i=d[1],j=d[5],k=d[9],l=d[13],m=d[2],n=d[6],o=d[10],p=d[14],q=d[3],r=d[7],s=d[11],t=d[15];c[0]=k*p*r-l*o*r+l*n*s-j*p*s-k*n*t+j*o*t,c[4]=h*o*r-g*p*r-h*n*s+f*p*s+g*n*t-f*o*t,c[8]=g*l*r-h*k*r+h*j*s-f*l*s-g*j*t+f*k*t,c[12]=h*k*n-g*l*n-h*j*o+f*l*o+g*j*p-f*k*p,c[1]=l*o*q-k*p*q-l*m*s+i*p*s+k*m*t-i*o*t,c[5]=g*p*q-h*o*q+h*m*s-e*p*s-g*m*t+e*o*t,c[9]=h*k*q-g*l*q-h*i*s+e*l*s+g*i*t-e*k*t,c[13]=g*l*m-h*k*m+h*i*o-e*l*o-g*i*p+e*k*p,c[2]=j*p*q-l*n*q+l*m*r-i*p*r-j*m*t+i*n*t,c[6]=h*n*q-f*p*q-h*m*r+e*p*r+f*m*t-e*n*t,c[10]=f*l*q-h*j*q+h*i*r-e*l*r-f*i*t+e*j*t,c[14]=h*j*m-f*l*m-h*i*n+e*l*n+f*i*p-e*j*p,c[3]=k*n*q-j*o*q-k*m*r+i*o*r+j*m*s-i*n*s,c[7]=f*o*q-g*n*q+g*m*r-e*o*r-f*m*s+e*n*s,c[11]=g*j*q-f*k*q-g*i*r+e*k*r+f*i*s-e*j*s,c[15]=f*k*m-g*j*m+g*i*n-e*k*n-f*i*o+e*j*o;var u=e*c[0]+i*c[4]+m*c[8]+q*c[12];if(0==u){var v="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(b)throw new Error(v);return console.warn(v),this.identity(),this}return this.multiplyScalar(1/u),this},scale:function(a){var b=this.elements,c=a.x,d=a.y,e=a.z;return b[0]*=c,b[4]*=d,b[8]*=e,b[1]*=c,b[5]*=d,b[9]*=e,b[2]*=c,b[6]*=d,b[10]*=e,b[3]*=c,b[7]*=d,b[11]*=e,this},makeTranslation:function(a,b,c){return this.set(1,0,0,a,0,1,0,b,0,0,1,c,0,0,0,1),this},makeRotationX:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(1,0,0,0,0,b,-c,0,0,c,b,0,0,0,0,1),this},makeRotationY:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,0,c,0,0,1,0,0,-c,0,b,0,0,0,0,1),this},makeRotationZ:function(a){var b=Math.cos(a),c=Math.sin(a);return this.set(b,-c,0,0,c,b,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(a,b){var c=Math.cos(b),d=Math.sin(b),e=1-c,f=a.x,g=a.y,h=a.z,i=e*f,j=e*g;return this.set(i*f+c,i*g-d*h,i*h+d*g,0,i*g+d*h,j*g+c,j*h-d*f,0,i*h-d*g,j*h+d*f,e*h*h+c,0,0,0,0,1),this},makeScale:function(a,b,c){return this.set(a,0,0,0,0,b,0,0,0,0,c,0,0,0,0,1),this},compose:function(a,b,c){return this.makeRotationFromQuaternion(b),this.scale(c),this.setPosition(a),this},transformPoint:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;return a.x=e[0]*b+e[4]*c+e[8]*d+e[12],a.y=e[1]*b+e[5]*c+e[9]*d+e[13],a.z=e[2]*b+e[6]*c+e[10]*d+e[14],a},transformDirection:function(a){var b=a.x,c=a.y,d=a.z,e=this.elements;a.x=e[0]*b+e[4]*c+e[8]*d,a.y=e[1]*b+e[5]*c+e[9]*d,a.z=e[2]*b+e[6]*c+e[10]*d;var f=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);if(f>0){var g=1/f;a.x*=g,a.y*=g,a.z*=g}return a},fromArray:function(a){return this.elements.set(a),this},toArray:function(){var a=this.elements;return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},clone:function(){return(new LmvMatrix4).fromArray(this.elements)}},!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.lmv_poly2tri=a()}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={version:"1.3.5"}},{}],2:[function(a,b,c){"use strict";var d=function(a,b){this.point=a,this.triangle=b||null,this.next=null,this.prev=null,this.value=a.x},e=function(a,b){this.head_=a,this.tail_=b,this.search_node_=a};e.prototype.head=function(){return this.head_},e.prototype.setHead=function(a){this.head_=a},e.prototype.tail=function(){return this.tail_},e.prototype.setTail=function(a){this.tail_=a},e.prototype.search=function(){return this.search_node_},e.prototype.setSearch=function(a){this.search_node_=a},e.prototype.findSearchNode=function(){return this.search_node_},e.prototype.locateNode=function(a){var b=this.search_node_;if(a<b.value){for(;b=b.prev;)if(a>=b.value)return this.search_node_=b,b}else for(;b=b.next;)if(a<b.value)return this.search_node_=b.prev,b.prev;return null},e.prototype.locatePoint=function(a){var b=a.x,c=this.findSearchNode(b),d=c.point.x;if(b===d){if(a!==c.point)if(a===c.prev.point)c=c.prev;else{if(a!==c.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");c=c.next}}else if(d>b)for(;(c=c.prev)&&a!==c.point;);else for(;(c=c.next)&&a!==c.point;);return c&&(this.search_node_=c),c},b.exports=e,b.exports.Node=d},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error(b||"Assert Failed")}b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.x=+a||0,this.y=+b||0,this._p2t_edge_list=null};e.prototype.toString=function(){return d.toStringBase(this)},e.prototype.toJSON=function(){return{x:this.x,y:this.y}},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.set_zero=function(){return this.x=0,this.y=0,this},e.prototype.set=function(a,b){return this.x=+a||0,this.y=+b||0,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},e.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},e.prototype.mul=function(a){return this.x*=a,this.y*=a,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.normalize=function(){var a=this.length();return this.x/=a,this.y/=a,a},e.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},e.negate=function(a){return new e(-a.x,-a.y)},e.add=function(a,b){return new e(a.x+b.x,a.y+b.y)},e.sub=function(a,b){return new e(a.x-b.x,a.y-b.y)},e.mul=function(a,b){return new e(a*b.x,a*b.y)},e.cross=function(a,b){return"number"==typeof a?"number"==typeof b?a*b:new e(-a*b.y,a*b.x):"number"==typeof b?new e(b*a.y,-b*a.x):a.x*b.y-a.y*b.x},e.toString=d.toString,e.compare=d.compare,e.cmp=d.compare,e.equals=d.equals,e.dot=function(a,b){return a.x*b.x+a.y*b.y},b.exports=e},{"./xy":11}],5:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.name="PointError",this.points=b=b||[],this.message=a||"Invalid Points!";for(var c=0;c<b.length;c++)this.message+=" "+d.toString(b[c])};e.prototype=new Error,e.prototype.constructor=e,b.exports=e},{"./xy":11}],6:[function(a,b,c){(function(b){"use strict";var d=b.poly2tri;c.noConflict=function(){return b.poly2tri=d,c},c.VERSION=a("../dist/version.json").version,c.PointError=a("./pointerror"),c.Point=a("./point"),c.Triangle=a("./triangle"),c.SweepContext=a("./sweepcontext");var e=a("./sweep");c.triangulate=e.triangulate,c.sweep={Triangulate:e.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(a,b,c){"use strict";function d(a){a.initTriangulation(),a.createAdvancingFront(),e(a),f(a)}function e(a){var b,c=a.pointCount();for(b=1;c>b;++b)for(var d=a.getPoint(b),e=g(a,d),f=d._p2t_edge_list,i=0;f&&i<f.length;++i)h(a,f[i],e)}function f(a){for(var b=a.front().head().next.triangle,c=a.front().head().next.point;!b.getConstrainedEdgeCW(c);)b=b.neighborCCW(c);a.meshClean(b)}function g(a,b){var c=a.locateNode(b),d=k(a,b,c);return b.x<=c.point.x+M&&l(a,c),m(a,d),d}function h(a,b,c){a.edge_event.constrained_edge=b,a.edge_event.right=b.p.x>b.q.x,j(c.triangle,b.p,b.q)||(u(a,b,c),i(a,b.p,b.q,c.triangle,b.q))}function i(a,b,c,d,e){if(!j(d,b,c)){var f=d.pointCCW(e),g=O(c,f,b);if(g===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,f,b]);var h=d.pointCW(e),k=O(c,h,b);if(k===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,h,b]);g===k?(d=g===N.CW?d.neighborCCW(e):d.neighborCW(e),i(a,b,c,d,e)):D(a,b,c,d,e)}}function j(a,b,c){var d=a.edgeIndex(b,c);if(-1!==d){a.markConstrainedEdgeByIndex(d);var e=a.getNeighbor(d);return e&&e.markConstrainedEdgeByPoints(b,c),!0}return!1}function k(a,b,c){var d=new J(b,c.point,c.next.point);d.markNeighbor(c.triangle),a.addToMap(d);var e=new K(b);return e.next=c.next,e.prev=c,c.next.prev=e,c.next=e,o(a,d)||a.mapTriangleToNodes(d),e}function l(a,b){var c=new J(b.prev.point,b.point,b.next.point);c.markNeighbor(b.prev.triangle),c.markNeighbor(b.triangle),a.addToMap(c),b.prev.next=b.next,b.next.prev=b.prev,o(a,c)||a.mapTriangleToNodes(c)}function m(a,b){for(var c=b.next;c.next&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.next;for(c=b.prev;c.prev&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.prev;b.next&&b.next.next&&n(b)&&r(a,b)}function n(a){var b=a.point.x-a.next.next.point.x,c=a.point.y-a.next.next.point.y;return H(c>=0,"unordered y"),b>=0||Math.abs(b)<c}function o(a,b){for(var c=0;3>c;++c)if(!b.delaunay_edge[c]){var d=b.getNeighbor(c);if(d){var e=b.getPoint(c),f=d.oppositePoint(b,e),g=d.index(f);if(d.constrained_edge[g]||d.delaunay_edge[g]){b.constrained_edge[c]=d.constrained_edge[g];continue}var h=p(e,b.pointCCW(e),b.pointCW(e),f);if(h){b.delaunay_edge[c]=!0,d.delaunay_edge[g]=!0,q(b,e,d,f);var i=!o(a,b);return i&&a.mapTriangleToNodes(b),i=!o(a,d),i&&a.mapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[g]=!1,!0}}}return!1}function p(a,b,c,d){var e=a.x-d.x,f=a.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*h,j=g*f,k=i-j;if(0>=k)return!1;var l=c.x-d.x,m=c.y-d.y,n=l*f,o=e*m,p=n-o;if(0>=p)return!1;var q=g*m,r=l*h,s=e*e+f*f,t=g*g+h*h,u=l*l+m*m,v=s*(q-r)+t*p+u*k;return v>0}function q(a,b,c,d){var e,f,g,h;e=a.neighborCCW(b),f=a.neighborCW(b),g=c.neighborCCW(d),h=c.neighborCW(d);var i,j,k,l;i=a.getConstrainedEdgeCCW(b),j=a.getConstrainedEdgeCW(b),k=c.getConstrainedEdgeCCW(d),l=c.getConstrainedEdgeCW(d);var m,n,o,p;m=a.getDelaunayEdgeCCW(b),n=a.getDelaunayEdgeCW(b),o=c.getDelaunayEdgeCCW(d),p=c.getDelaunayEdgeCW(d),a.legalize(b,d),c.legalize(d,b),c.setDelaunayEdgeCCW(b,m),a.setDelaunayEdgeCW(b,n),a.setDelaunayEdgeCCW(d,o),c.setDelaunayEdgeCW(d,p),c.setConstrainedEdgeCCW(b,i),a.setConstrainedEdgeCW(b,j),a.setConstrainedEdgeCCW(d,k),c.setConstrainedEdgeCW(d,l),a.clearNeighbors(),c.clearNeighbors(),e&&c.markNeighbor(e),f&&a.markNeighbor(f),g&&a.markNeighbor(g),h&&c.markNeighbor(h),a.markNeighbor(c)}function r(a,b){for(O(b.point,b.next.point,b.next.next.point)===N.CCW?a.basin.left_node=b.next.next:a.basin.left_node=b.next,a.basin.bottom_node=a.basin.left_node;a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!==a.basin.left_node){for(a.basin.right_node=a.basin.bottom_node;a.basin.right_node.next&&a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!==a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,s(a,a.basin.bottom_node))}}function s(a,b){if(!t(a,b)){l(a,b);var c;if(b.prev!==a.basin.left_node||b.next!==a.basin.right_node){if(b.prev===a.basin.left_node){if(c=O(b.point,b.next.point,b.next.next.point),c===N.CW)return;b=b.next}else if(b.next===a.basin.right_node){if(c=O(b.point,b.prev.point,b.prev.prev.point),c===N.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;s(a,b)}}}function t(a,b){var c;return c=a.basin.left_highest?a.basin.left_node.point.y-b.point.y:a.basin.right_node.point.y-b.point.y,a.basin.width>c?!0:!1}function u(a,b,c){a.edge_event.right?v(a,b,c):z(a,b,c)}function v(a,b,c){for(;c.next.point.x<b.p.x;)O(b.q,c.next.point,b.p)===N.CCW?w(a,b,c):c=c.next}function w(a,b,c){c.point.x<b.p.x&&(O(c.point,c.next.point,c.next.next.point)===N.CCW?x(a,b,c):(y(a,b,c),w(a,b,c)))}function x(a,b,c){l(a,c.next),c.next.point!==b.p&&O(b.q,c.next.point,b.p)===N.CCW&&O(c.point,c.next.point,c.next.next.point)===N.CCW&&x(a,b,c)}function y(a,b,c){O(c.next.point,c.next.next.point,c.next.next.next.point)===N.CCW?x(a,b,c.next):O(b.q,c.next.next.point,b.p)===N.CCW&&y(a,b,c.next)}function z(a,b,c){for(;c.prev.point.x>b.p.x;)O(b.q,c.prev.point,b.p)===N.CW?A(a,b,c):c=c.prev}function A(a,b,c){c.point.x>b.p.x&&(O(c.point,c.prev.point,c.prev.prev.point)===N.CW?C(a,b,c):(B(a,b,c),A(a,b,c)))}function B(a,b,c){O(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===N.CW?C(a,b,c.prev):O(b.q,c.prev.prev.point,b.p)===N.CW&&B(a,b,c.prev)}function C(a,b,c){l(a,c.prev),c.prev.point!==b.p&&O(b.q,c.prev.point,b.p)===N.CW&&O(c.point,c.prev.point,c.prev.prev.point)===N.CW&&C(a,b,c)}function D(a,b,c,d,e){var f=d.neighborAcross(e);H(f,"FLIP failed due to missing triangle!");var g=f.oppositePoint(d,e);if(d.getConstrainedEdgeAcross(e)){var h=d.index(e);throw new I("poly2tri Intersecting Constraints",[e,g,d.getPoint((h+1)%3),d.getPoint((h+2)%3)])}if(P(e,d.pointCCW(e),d.pointCW(e),g))if(q(d,e,f,g),a.mapTriangleToNodes(d),a.mapTriangleToNodes(f),e===c&&g===b)c===a.edge_event.constrained_edge.q&&b===a.edge_event.constrained_edge.p&&(d.markConstrainedEdgeByPoints(b,c),f.markConstrainedEdgeByPoints(b,c),o(a,d),o(a,f));else{var j=O(c,g,b);d=E(a,j,d,f,e,g),D(a,b,c,d,e)}else{var k=F(b,c,f,g);G(a,b,c,d,f,k),i(a,b,c,d,e)}}function E(a,b,c,d,e,f){var g;return b===N.CCW?(g=d.edgeIndex(e,f),d.delaunay_edge[g]=!0,o(a,d),d.clearDelaunayEdges(),c):(g=c.edgeIndex(e,f),c.delaunay_edge[g]=!0,o(a,c),c.clearDelaunayEdges(),d)}function F(a,b,c,d){var e=O(b,d,a);if(e===N.CW)return c.pointCCW(d);if(e===N.CCW)return c.pointCW(d);throw new I("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[b,d,a])}function G(a,b,c,d,e,f){var g=e.neighborAcross(f);H(g,"FLIP failed due to missing triangle");var h=g.oppositePoint(e,f);if(P(c,d.pointCCW(c),d.pointCW(c),h))D(a,c,h,g,h);else{var i=F(b,c,g,h);G(a,b,c,d,g,i)}}var H=a("./assert"),I=a("./pointerror"),J=a("./triangle"),K=a("./advancingfront").Node,L=a("./utils"),M=L.EPSILON,N=L.Orientation,O=L.orient2d,P=L.inScanArea,Q=L.isAngleObtuse;c.triangulate=d},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(a,b,c){"use strict";var d=a("./pointerror"),e=a("./point"),f=a("./triangle"),g=a("./sweep"),h=a("./advancingfront"),i=h.Node,j=.3,k=function(a,b){if(this.p=a,this.q=b,a.y>b.y)this.q=a,this.p=b;else if(a.y===b.y)if(a.x>b.x)this.q=a,this.p=b;else if(a.x===b.x)throw new d("poly2tri Invalid Edge constructor: repeated points!",[a]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},l=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};l.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var m=function(){this.constrained_edge=null,this.right=!1},n=function(a,b){b=b||{},this.triangles_=[],this.map_=[],this.points_=b.cloneArrays?a.slice(0):a,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new l,this.edge_event=new m,this.initEdges(this.points_)};n.prototype.addHole=function(a){this.initEdges(a);var b,c=a.length;for(b=0;c>b;b++)this.points_.push(a[b]);return this},n.prototype.AddHole=n.prototype.addHole,n.prototype.addHoles=function(a){var b,c=a.length;for(b=0;c>b;b++)this.initEdges(a[b]);return this.points_=this.points_.concat.apply(this.points_,a),this},n.prototype.addPoint=function(a){return this.points_.push(a),this},n.prototype.AddPoint=n.prototype.addPoint,n.prototype.addPoints=function(a){return this.points_=this.points_.concat(a),this},n.prototype.triangulate=function(){return g.triangulate(this),this},n.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},n.prototype.getTriangles=function(){return this.triangles_},n.prototype.GetTriangles=n.prototype.getTriangles,n.prototype.front=function(){return this.front_},n.prototype.pointCount=function(){return this.points_.length},n.prototype.head=function(){return this.head_},n.prototype.setHead=function(a){this.head_=a},n.prototype.tail=function(){return this.tail_},n.prototype.setTail=function(a){this.tail_=a},n.prototype.getMap=function(){return this.map_},n.prototype.initTriangulation=function(){var a,b=this.points_[0].x,c=this.points_[0].x,d=this.points_[0].y,f=this.points_[0].y,g=this.points_.length;for(a=1;g>a;a++){var h=this.points_[a];h.x>b&&(b=h.x),h.x<c&&(c=h.x),h.y>d&&(d=h.y),h.y<f&&(f=h.y)}this.pmin_=new e(c,f),this.pmax_=new e(b,d);var i=j*(b-c),k=j*(d-f);this.head_=new e(b+i,f-k),this.tail_=new e(c-i,f-k),this.points_.sort(e.compare)},n.prototype.initEdges=function(a,b){var c,d=a.length,e=b?a.length-1:a.length;for(c=0;e>c;++c)this.edge_list.push(new k(a[c],a[(c+1)%d]))},n.prototype.getPoint=function(a){return this.points_[a]},n.prototype.addToMap=function(a){this.map_.push(a)},n.prototype.locateNode=function(a){return this.front_.locateNode(a.x)},n.prototype.createAdvancingFront=function(){var a,b,c,d=new f(this.points_[0],this.tail_,this.head_);this.map_.push(d),a=new i(d.getPoint(1),d),b=new i(d.getPoint(0),d),c=new i(d.getPoint(2)),this.front_=new h(a,c),a.next=b,b.next=c,b.prev=a,c.prev=b},n.prototype.removeNode=function(a){},n.prototype.mapTriangleToNodes=function(a){for(var b=0;3>b;++b)if(!a.getNeighbor(b)){var c=this.front_.locatePoint(a.pointCW(a.getPoint(b)));c&&(c.triangle=a)}},n.prototype.removeFromMap=function(a){var b,c=this.map_,d=c.length;for(b=0;d>b;b++)if(c[b]===a){c.splice(b,1);break}},n.prototype.meshClean=function(a){for(var b,c,d=[a];b=d.pop();)if(!b.isInterior())for(b.setInterior(!0),this.triangles_.push(b),c=0;3>c;c++)b.constrained_edge[c]||d.push(b.getNeighbor(c))},b.exports=n},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b,c){this.points_=[a,b,c],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},f=d.toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"},e.prototype.getPoint=function(a){return this.points_[a]},e.prototype.GetPoint=e.prototype.getPoint,e.prototype.getPoints=function(){return this.points_},e.prototype.getNeighbor=function(a){return this.neighbors_[a]},e.prototype.containsPoint=function(a){var b=this.points_;return a===b[0]||a===b[1]||a===b[2]},e.prototype.containsEdge=function(a){return this.containsPoint(a.p)&&this.containsPoint(a.q)},e.prototype.containsPoints=function(a,b){return this.containsPoint(a)&&this.containsPoint(b)},e.prototype.isInterior=function(){return this.interior_},e.prototype.setInterior=function(a){return this.interior_=a,this},e.prototype.markNeighborPointers=function(a,b,c){var d=this.points_;if(a===d[2]&&b===d[1]||a===d[1]&&b===d[2])this.neighbors_[0]=c;else if(a===d[0]&&b===d[2]||a===d[2]&&b===d[0])this.neighbors_[1]=c;else{if(!(a===d[0]&&b===d[1]||a===d[1]&&b===d[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=c}},e.prototype.markNeighbor=function(a){var b=this.points_;a.containsPoints(b[1],b[2])?(this.neighbors_[0]=a,a.markNeighborPointers(b[1],b[2],this)):a.containsPoints(b[0],b[2])?(this.neighbors_[1]=a,a.markNeighborPointers(b[0],b[2],this)):a.containsPoints(b[0],b[1])&&(this.neighbors_[2]=a,a.markNeighborPointers(b[0],b[1],this))},e.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},e.prototype.pointCW=function(a){var b=this.points_;return a===b[0]?b[2]:a===b[1]?b[0]:a===b[2]?b[1]:null},e.prototype.pointCCW=function(a){var b=this.points_;return a===b[0]?b[1]:a===b[1]?b[2]:a===b[2]?b[0]:null},e.prototype.neighborCW=function(a){return a===this.points_[0]?this.neighbors_[1]:a===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},e.prototype.neighborCCW=function(a){return a===this.points_[0]?this.neighbors_[2]:a===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},e.prototype.getConstrainedEdgeCW=function(a){return a===this.points_[0]?this.constrained_edge[1]:a===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},e.prototype.getConstrainedEdgeCCW=function(a){return a===this.points_[0]?this.constrained_edge[2]:a===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},e.prototype.getConstrainedEdgeAcross=function(a){return a===this.points_[0]?this.constrained_edge[0]:a===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},e.prototype.setConstrainedEdgeCW=function(a,b){a===this.points_[0]?this.constrained_edge[1]=b:a===this.points_[1]?this.constrained_edge[2]=b:this.constrained_edge[0]=b},e.prototype.setConstrainedEdgeCCW=function(a,b){a===this.points_[0]?this.constrained_edge[2]=b:a===this.points_[1]?this.constrained_edge[0]=b:this.constrained_edge[1]=b},e.prototype.getDelaunayEdgeCW=function(a){return a===this.points_[0]?this.delaunay_edge[1]:a===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},e.prototype.getDelaunayEdgeCCW=function(a){return a===this.points_[0]?this.delaunay_edge[2]:a===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},e.prototype.setDelaunayEdgeCW=function(a,b){a===this.points_[0]?this.delaunay_edge[1]=b:a===this.points_[1]?this.delaunay_edge[2]=b:this.delaunay_edge[0]=b},e.prototype.setDelaunayEdgeCCW=function(a,b){a===this.points_[0]?this.delaunay_edge[2]=b:a===this.points_[1]?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b},e.prototype.neighborAcross=function(a){return a===this.points_[0]?this.neighbors_[0]:a===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},e.prototype.oppositePoint=function(a,b){var c=a.pointCW(b);return this.pointCW(c)},e.prototype.legalize=function(a,b){var c=this.points_;if(a===c[0])c[1]=c[0],c[0]=c[2],c[2]=b;else if(a===c[1])c[2]=c[1],c[1]=c[0],c[0]=b;else{if(a!==c[2])throw new Error("poly2tri Invalid Triangle.legalize() call");c[0]=c[2],c[2]=c[1],c[1]=b}},e.prototype.index=function(a){var b=this.points_;if(a===b[0])return 0;if(a===b[1])return 1;if(a===b[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},e.prototype.edgeIndex=function(a,b){var c=this.points_;if(a===c[0]){if(b===c[1])return 2;if(b===c[2])return 1}else if(a===c[1]){if(b===c[2])return 0;if(b===c[0])return 2}else if(a===c[2]){if(b===c[0])return 1;if(b===c[1])return 0}return-1},e.prototype.markConstrainedEdgeByIndex=function(a){this.constrained_edge[a]=!0},e.prototype.markConstrainedEdgeByEdge=function(a){this.markConstrainedEdgeByPoints(a.p,a.q)},e.prototype.markConstrainedEdgeByPoints=function(a,b){var c=this.points_;b===c[0]&&a===c[1]||b===c[1]&&a===c[0]?this.constrained_edge[2]=!0:b===c[0]&&a===c[2]||b===c[2]&&a===c[0]?this.constrained_edge[1]=!0:(b===c[1]&&a===c[2]||b===c[2]&&a===c[1])&&(this.constrained_edge[0]=!0)},b.exports=e},{"./xy":11}],10:[function(a,b,c){"use strict";function d(a,b,c){var d=(a.x-c.x)*(b.y-c.y),e=(a.y-c.y)*(b.x-c.x),f=d-e;return f>-g&&g>f?h.COLLINEAR:f>0?h.CCW:h.CW}function e(a,b,c,d){var e=(a.x-b.x)*(d.y-b.y)-(d.x-b.x)*(a.y-b.y);if(e>=-g)return!1;var f=(a.x-c.x)*(d.y-c.y)-(d.x-c.x)*(a.y-c.y);return g>=f?!1:!0}function f(a,b,c){var d=b.x-a.x,e=b.y-a.y,f=c.x-a.x,g=c.y-a.y;return 0>d*f+e*g}var g=1e-12;c.EPSILON=g;var h={CW:1,CCW:-1,COLLINEAR:0};c.Orientation=h,c.orient2d=d,c.inScanArea=e,c.isAngleObtuse=f},{}],11:[function(a,b,c){"use strict";function d(a){return"("+a.x+";"+a.y+")"}function e(a){var b=a.toString();return"[object Object]"===b?d(a):b}function f(a,b){return a.y===b.y?a.x-b.x:a.y-b.y}function g(a,b){return a.x===b.x&&a.y===b.y}b.exports={toString:e,toStringBase:d,compare:f,equals:g}},{}]},{},[6])(6)}),function(){"use strict";var a=Autodesk.Viewing;a.EventDispatcher=function(){},a.EventDispatcher.prototype={constructor:a.EventDispatcher,apply:function(b){b.addEventListener=a.EventDispatcher.prototype.addEventListener,b.hasEventListener=a.EventDispatcher.prototype.hasEventListener,b.removeEventListener=a.EventDispatcher.prototype.removeEventListener,b.fireEvent=a.EventDispatcher.prototype.fireEvent,b.dispatchEvent=a.EventDispatcher.prototype.fireEvent},addEventListener:function(a,b){void 0===this.listeners&&(this.listeners={}),"undefined"==typeof this.listeners[a]&&(this.listeners[a]=[]),this.listeners[a].push(b)},hasEventListener:function(a,b){if(void 0===this.listeners)return!1;var c=this.listeners;return void 0!==c[a]&&-1!==c[a].indexOf(b)?!0:!1},removeEventListener:function(a,b){if(void 0===this.listeners&&(this.listeners={}),this.listeners[a]instanceof Array)for(var c=this.listeners[a],d=0,e=c.length;e>d;d++)if(c[d]===b){c.splice(d,1);break}},fireEvent:function(a){if(void 0===this.listeners&&(this.listeners={}),"string"==typeof a&&(a={type:a}),!a.target)try{a.target=this}catch(b){}if(!a.type)throw new Error("event type unknown.");if(this.listeners[a.type]instanceof Array)for(var c=this.listeners[a.type].slice(),d=0;d<c.length;d++)c[d].call(this,a)}}}(),Autodesk.Viewing.FileLoader=function(a){this.viewer=a},Autodesk.Viewing.FileLoader.prototype.constructor=Autodesk.Viewing.FileLoader,Autodesk.Viewing.FileLoader.prototype.loadFile=function(a,b,c,d){return!1},function(){"use strict";var a=function(){function a(a,b,c){return e[a]?!1:(e[a]={loader:c,extensions:b},!0)}function b(a){return e[a]?e[a].loader:null}function c(a){return e[a]?(delete e[a],!0):!1}function d(a){a=a?a.toLowerCase():"";for(var b in e){var c=e[b];if(c)for(var d=0;d<c.extensions.length;d++)if(c.extensions[d].toLowerCase()===a)return c.loader}return null}var e={};return{registerFileLoader:a,getFileLoader:b,getFileLoaderForExtension:d,unregisterFileLoader:c}};Autodesk.Viewing.FileLoaderManager=new a}(),function(){function a(a){for(var b=0;b<f.length;++b)document.addEventListener(f[b],a,!1)}function b(a){for(var b=0;b<f.length;++b)document.removeEventListener(f[b],a,!1)}function c(b){this.viewer=b,this.bindFullscreenEventListener=this.fullscreenEventListener.bind(this),this.getMode()===d.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener)}var d=Autodesk.Viewing,e=Autodesk.Viewing.Private,f=["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"];d.ScreenMode={kNormal:0,kFullBrowser:1,kFullScreen:2},d.ScreenModeDelegate=c,c.prototype.uninitialize=function(){b(this.bindFullscreenEventListener),this.viewer=null},c.prototype.isModeSupported=function(a){return!0},c.prototype.setMode=function(a){var b=this.getMode();return a!==b&&this.isModeSupported(a)?(this.doScreenModeChange(b,a),this.onScreenModeChanged(b,a),!0):!1},c.prototype.getMode=function(){throw"Implement getMode() in derived class"},c.prototype.getNextMode=function(){var a,b=this.getMode(),c=d.ScreenMode;return b===c.kNormal&&this.isModeSupported(c.kFullBrowser)?a=c.kFullBrowser:b===c.kNormal&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kFullScreen)?a=c.kFullScreen:b===c.kFullBrowser&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kNormal)?a=c.kNormal:b===c.kFullScreen&&this.isModeSupported(c.kFullBrowser)&&(a=c.kFullBrowser),a},c.prototype.getEscapeMode=function(){return this.getMode()!==d.ScreenMode.kNormal?d.ScreenMode.kNormal:void 0},c.prototype.fullscreenEventListener=function(){if(inFullscreen())this.viewer.resize();else{var a=d.ScreenMode;this.doScreenModeChange(a.kFullScreen,a.kNormal),this.onScreenModeChanged(a.kFullScreen,a.kNormal)}},c.prototype.doScreenModeChange=function(a,b){throw"Implement doScreenModeChange() in derived class"},c.prototype.onScreenModeChanged=function(c,e){c===d.ScreenMode.kFullScreen?b(this.bindFullscreenEventListener):e===d.ScreenMode.kFullScreen&&a(this.bindFullscreenEventListener),this.viewer.resize(),this.viewer.fireEvent({type:d.FULLSCREEN_MODE_EVENT,mode:e})},d.ApplicationScreenModeDelegate=function(a){d.ScreenModeDelegate.call(this,a)},d.ApplicationScreenModeDelegate.prototype=Object.create(d.ScreenModeDelegate.prototype),d.ApplicationScreenModeDelegate.prototype.constructor=d.ApplicationScreenModeDelegate,d.ApplicationScreenModeDelegate.prototype.isModeSupported=function(a){return a!==d.ScreenMode.kFullBrowser},d.ApplicationScreenModeDelegate.prototype.getMode=function(){return inFullscreen()?d.ScreenMode.kFullScreen:d.ScreenMode.kNormal},d.ApplicationScreenModeDelegate.prototype.doScreenModeChange=function(a,b){var c=this.viewer.container;b===d.ScreenMode.kNormal?(c.classList.remove("viewer-fill-browser"),exitFullscreen()):b===d.ScreenMode.kFullScreen&&(c.classList.add("viewer-fill-browser"),launchFullscreen(c))},d.NullScreenModeDelegate=function(a){d.ScreenModeDelegate.call(this,a)},d.NullScreenModeDelegate.prototype=Object.create(d.ScreenModeDelegate.prototype),d.NullScreenModeDelegate.prototype.constructor=d.ScreenModeDelegate,d.NullScreenModeDelegate.prototype.isModeSupported=function(a){return!1},d.NullScreenModeDelegate.prototype.getMode=function(){return d.ScreenMode.kNormal},d.ScreenModeMixin=function(){},d.ScreenModeMixin.prototype={setScreenModeDelegate:function(a){this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),a?this.screenModeDelegateClass=a:null===a?this.screenModeDelegateClass=d.NullScreenModeDelegate:this.screenModeDelegateClass=d.ApplicationScreenModeDelegate},getScreenModeDelegate:function(){return this.screenModeDelegate||(this.screenModeDelegate=new this.screenModeDelegateClass(this)),this.screenModeDelegate},isScreenModeSupported:function(a){return this.getScreenModeDelegate().isModeSupported(a)},canChangeScreenMode:function(){return this.isScreenModeSupported(Autodesk.Viewing.ScreenMode.kNormal)},setScreenMode:function(a){var b=e.logger;if(b){var c={category:"screen_mode",value:a};b.log(c)}return this.getScreenModeDelegate().setMode(a)},getScreenMode:function(){return this.getScreenModeDelegate().getMode()},nextScreenMode:function(){var a=this.getScreenModeDelegate().getNextMode();return void 0!==a?this.setScreenMode(a):!1},escapeScreenMode:function(){var a=this.getScreenModeDelegate().getEscapeMode();return void 0!==a?this.setScreenMode(a):!1},apply:function(a){var b=d.ScreenModeMixin.prototype;a.setScreenModeDelegate=b.setScreenModeDelegate,a.getScreenModeDelegate=b.getScreenModeDelegate,a.isScreenModeSupported=b.isScreenModeSupported,a.canChangeScreenMode=b.canChangeScreenMode,a.setScreenMode=b.setScreenMode,a.getScreenMode=b.getScreenMode,a.nextScreenMode=b.nextScreenMode,a.escapeScreenMode=b.escapeScreenMode}}}(),function(){"use strict";var a=Autodesk.Viewing,b={METER:"m",CENTIMETER:"cm",MILLIMETER:"mm",FOOT:"ft",INCH:"in"};a.ModelUnits=b;var c=function(a){this.myData=a,this.sharedPath=null,this.propWorker=null};a.EventDispatcher.prototype.apply(c.prototype),c.prototype.constructor=c,c.prototype.setData=function(a){this.myData=a},c.prototype.getData=function(){return this.myData},c.prototype.getRoot=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.root:null},c.prototype.getRootId=function(){return this.myData&&this.myData.instanceTree?this.myData.instanceTree.getRootId():0},c.prototype.getBoundingBox=function(){return this.myData?this.myData.bbox:null},c.prototype.getUnitScale=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","model_units",null):this.getMetadata("distance unit","value",null)){case"meter":case"m":return 1;case"foot":case"ft":return.3048;case"inch":case"in":return.0254;case"centimeter":case"cm":return.01;case"millimeter":case"mm":return.001;default:return 1}},c.prototype.getUnitString=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","page_units",null):this.myData&&this.myData.overriddenUnits?this.myData.overriddenUnits:this.getMetadata("distance unit","value",null)){case"meter":case"m":return b.METER;case"foot":case"ft":return b.FOOT;case"inch":case"in":return b.INCH;case"centimeter":case"cm":return b.CENTIMETER;case"millimeter":case"mm":return b.MILLIMETER;
default:return null}},c.prototype.getDisplayUnit=function(){var a;switch(a=this.is2d()?this.getMetadata("page_dimensions","model_units",null)||this.getMetadata("page_dimensions","page_units",null):this.getMetadata("distance unit","value",null)){case"meter":case"m":return b.METER;case"foot":case"ft":return b.FOOT;case"inch":case"in":return b.INCH;case"centimeter":case"cm":return b.CENTIMETER;case"millimeter":case"mm":return b.MILLIMETER;default:return null}},c.prototype.getMetadata=function(a,b,c){if(this.myData){var d=this.myData.metadata;if(d){var e=d[a];if(void 0!==e){if(!b)return e;var f=e[b];if(void 0!==f)return f}}}return c},c.prototype.getDefaultCamera=function(){var a=this.myData;if(!a)return null;var b=null,c=a.cameras?a.cameras.length:0;if(c>0){var d=this.getMetadata("default camera","index",null);if(null!==d&&a.cameras[d])b=a.cameras[d];else{for(var e=0;c>e;e++){var f=a.cameras[e];if(f.isPerspective){b=f;break}}b||(b=a.cameras[0])}}return b},c.prototype.getUpVector=function(){return this.getMetadata("world up vector","XYZ",null)},c.prototype.geomPolyCount=function(){return this.myData?this.myData.geomPolyCount:null},c.prototype.instancePolyCount=function(){return this.myData?this.myData.instancePolyCount:null},c.prototype.getLayersRoot=function(){return this.is2d()?this.myData?this.myData.layersRoot:null:(console.warn("Autodesk.Viewing.Model.getLayersRoot is not yet implemented for 3D"),null)},c.prototype.is2d=function(){return!(!this.myData||!this.myData.is2d)},c.prototype.isLoadDone=function(){return!(!this.myData||!this.myData.loadDone)},c.prototype.isObjectTreeCreated=function(){return!!this.myData.instanceTree},c.prototype.getProperties=function(a,b,c){this.myData&&this.myData.propWorker.getProperties(a,b,c)},c.prototype.getBulkProperties=function(a,b,c,d){this.myData&&this.myData.propWorker.getBulkProperties(a,b,c,d)},c.prototype.getExternalIdMapping=function(a,b){this.myData&&this.myData.propWorker.getExternalIdMapping(a,b)},c.prototype.getObjectTree=function(a,b){!this.myData&&b?b():this.myData.propWorker.getObjectTree(a,b)},c.prototype.search=function(a,b,c,d){var e=this;this.isLoadDone()?this.myData.propWorker.searchProperties(a,d,b,c):this.getObjectTree(function(){e.myData.propWorker.searchProperties(a,d,b,c)})};var d=function(a){var b=.001,c=a;if(Math.abs(c[0])<b)if(Math.abs(c[4])>b)for(var d=0;4>d;d++){var e=c[d];c[d]=c[d+4],c[d+4]=e}else for(var d=0;4>d;d++){var e=c[d];c[d]=c[d+8],c[d+8]=e}if(Math.abs(c[5])<b)for(var d=4;8>d;d++){var e=c[d];c[d]=c[d+4],c[d+4]=e}},e=function(a,b,c,d){var e,f,g,h,i,j,k=!1;g=d[c[c.length-1]].x,h=d[c[c.length-1]].y,e=h>=b;for(var l=0,m=c.length;m>l;++l)i=d[c[l]].x,j=d[c[l]].y,f=j>=b,e!=f&&(j-b)*(g-i)>=(i-a)*(h-j)==f&&(k=!k),e=f,g=i,h=j;return k},f=function(a,b,c,d){for(var f=!1,g=0;g<c.length;g++)e(a,b,c[g],d)&&(f=!f);return f};c.prototype.getPageToModelTransform=function(a){var b=this.myData,c=b.metadata,e=c.page_dimensions,f=b.viewports[a];if(!f)return new THREE.Matrix4;b.viewportTransforms||(b.viewportTransforms=new Array(b.viewports.length));var g=b.viewportTransforms[a];if(g)return g;var h=new LmvMatrix4(!0).set(e.logical_width/e.page_width,0,0,e.logical_offset_x,0,e.logical_height/e.page_height,0,e.logical_offset_y,0,0,1,0,0,0,0,1),i=f.transform.slice();d(i);var j=new LmvMatrix4(!0);j.elements.set(i);var k=new LmvMatrix4(!0);return k.getInverse(j),k.multiply(h),b.viewportTransforms[a]=k,k},c.prototype.pageToModel=function(a,b,c){var d=.01,e=this.getPageToModelTransform(c),f=(new THREE.Vector3).set(a.x,a.y,0).applyMatrix4(e),g=(new THREE.Vector3).set(b.x,b.y,0).applyMatrix4(e),h=a.distanceTo(b),i=f.distanceTo(g);if(Math.abs(i-h)<d){for(var j=this.pointInClip(a,c),k=f.clone(),l=g.clone(),m=0;m<j.length;m++){var n=this.getPageToModelTransform(j[m]);if(f.set(a.x,a.y,0).applyMatrix4(n),g.set(b.x,b.y,0).applyMatrix4(n),i=f.distanceTo(g),Math.abs(i-h)>d)break}m>=j.length&&(f=k,g=l)}a.x=f.x,a.y=f.y,b.x=g.x,b.y=g.y},c.prototype.pointInClip=function(a,b){for(var c=this.myData.clips,d=[],e=0;e<c.length;e++)if(e!==b){for(var g=[],h=[],i=c[e].contourCounts,j=c[e].points,k=0,l=[],m=0;m<i.length;m++){for(var n=0;n<i[m];n++)g.push(k),k++;h.push(g),g=[]}for(var m=0;m<j.length;m+=2){var o={x:j[m],y:j[m+1]};l.push(o)}var p=f(a.x,a.y,h,l);p&&d.push(e)}return d},c.prototype.getTopoIndex=function(a){if(this.myData&&this.myData.fragments){var b=this.myData.fragments.topoIndexes;if(b)return b[a]}},c.prototype.getTopology=function(a){if(this.myData){var b=this.myData.topology;if(b){var c=b[a];if(c)return c}}},c.prototype.hasTopology=function(){if(this.myData){var a=this.myData.topology;if(a)return!0}},c.prototype.getAttributeToIdMap=function(a,b){var c=this;this.isLoadDone()?this.myData.propWorker.attributeToIdMap(a,b):this.getObjectTree(function(){c.myData.propWorker.attributeToIdMap(a,b)})},a.Model=c}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing.Private;a.inWorkerThread="undefined"!=typeof self&&"undefined"==typeof window,a.ViewingService={},a.ViewingService.generateUrl=function(b,c,d,e){if(0!==d.indexOf("urn:"))return d;var f=b+"/";return"items"!==c&&(d=d.substr(4)),f+="bubbles"===c&&0==a.env.indexOf("Autodesk")?d:c+"/"+d},a.ViewingService.get=function(b,c,d,e,f,g){function h(a){f(j.status,j.statusText,{url:d})}function i(a){200===j.status?e(j.response?j.response:j.responseText):h(a)}var g=g?g:{},d=a.ViewingService.generateUrl(b,c,d,g);g.queryParams&&(d=d+"?"+g.queryParams);var j=new XMLHttpRequest;try{var k=g.hasOwnProperty("asynchronous")?g.asynchronous:!0;if(j.open(g.noBody?"HEAD":"GET",d,k),g.hasOwnProperty("responseType")&&(j.responseType=g.responseType),j.withCredentials=!0,g.hasOwnProperty("withCredentials")&&(j.withCredentials=g.withCredentials),g.headers)for(var l in g.headers)j.setRequestHeader(l,g.headers[l]);k&&(j.onload=i,j.onerror=h,j.ontimeout=h),j.send(),g.skipAssetCallback||(a.inWorkerThread?self.postMessage({assetRequest:[d,g.headers,null]}):a.assets.push([d,g.headers,null])),k||i(null)}catch(m){f(j.status,j.statusText,{url:d,exception:m})}}}();var Xhr=function(){var a=function(a,b,c){this.xhr=new XMLHttpRequest,this.errorHandler=a,this.success=!1,this.viewing_url=c,this.auth=b};return a.prototype.generateUrl=function(a,b,c){var d=a.indexOf("urn:");if(0===d&&this.viewing_url){var e=c&&c.feature?c.feature:null;e?"render"==e?(a=a.substr(4),a=this.viewing_url+"/"+e+"/"+encodeURIComponent(a)):"bubbles"==e?(a=a.substr(4),a=this.viewing_url+"/"+e+"/"+encodeURIComponent(a)):"comments"==e?(a=a.substr(4),a=this.viewing_url+"/"+e+"/file/"+encodeURIComponent(a)):a=this.viewing_url+"/"+e+"/"+encodeURIComponent(a.substr(d)):a=this.viewing_url+"/items/"+encodeURIComponent(a.substr(d))}return b&&(a=a+"?"+b),a},a.prototype.addHeaders=function(a){for(var b in a)this.xhr.setRequestHeader(b,a[b])},a.prototype.get=function(a,b,c,d,e,f,g){var h=this.generateUrl(a,f,{feature:e,oss_url:g});try{this.xhr.open("GET",h,!!d),this.xhr.responseType=c,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),d&&(this.xhr.onload=d),this.addHeaders(b),this.xhr.send()}catch(i){return this.errorHandler&&this.errorHandler.networkFailure(h,i),null}return this.errorCheck(h,200),this.xhr.response},a.prototype.post=function(a,b,c,d,e,f){var g=this.generateUrl(a,null,{feature:f});b["Content-Type"]||(b["Content-Type"]="application/json");try{this.xhr.open("POST",g,!!e),this.xhr.responseType=d,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),e&&(this.xhr.onload=e),this.addHeaders(b),this.xhr.send(c)}catch(h){return this.errorHandler&&this.errorHandler.networkFailure(g,h),null}return this.errorCheck(g,200,201),this.xhr.response},a.prototype.getRange=function(a,b,c,d,e,f){var a=this.generateUrl(path);b.Range="bytes="+d+"-"+e;try{this.xhr.open("GET",a,!!f),this.xhr.responseType=c,this.success=!1,this.auth&&(this.xhr.withCredentials=!0),f&&(this.xhr.onload=f),this.addHeaders(b),this.xhr.send()}catch(g){return this.errorHandler&&this.errorHandler.networkFailure(a,g),null}return this.errorCheck(a,206),this.xhr.response},a.prototype.head=function(a){var a=this.generateUrl(path);try{this.xhr.open("GET",a,!1),this.success=!1,this.auth&&(this.xhr.withCredentials=!0),this.addHeaders([]),this.xhr.send()}catch(b){return this.errorHandler&&this.errorHandler.networkFailure(a,b),null}this.errorCheck(a,200);var c=[];return c["Accept-Ranges"]=this.xhr.getResponseHeader("Accept-Ranges"),c["Content-Length"]=this.xhr.getResponseHeader("Content-Length"),c},a.prototype.errorCheck=function(a,b){if(4===this.xhr.readyState&&this.xhr.status){var c;for(c=1;c<arguments.length&&this.xhr.status!==arguments[c];c++);c===arguments.length&&this.errorHandler?this.errorHandler.unsuccessfulResponse(a,this.xhr.status,this.xhr.statusText):this.success=!0}else this.success=!0},a}(),XhrErrorHandler=function(){var a=function(a){this.host=a,this.ignoreFileNotFound=!1};return a.prototype.networkFailure=function(a,b){this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FAILURE,"Network failure",{url:a,exception:b.toString(),stack:b.stack})},a.prototype.unsuccessfulResponse=function(a,b,c){403==b?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED,"Access denied to remote resource",{url:a,httpStatus:b,httpStatusText:c}):404==b?this.ignoreFileNotFound||this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND,"Remote resource not found",{url:a,httpStatus:b,httpStatusText:c}):b>=500&&600>b?this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR,"Server error when accessing resource",{url:a,httpStatus:b,httpStatusText:c}):this.host.raiseError(Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE,"Unhandled response code from server",{url:a,httpStatus:b,httpStatusText:c})},a}();if("undefined"!=typeof window){var RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,webrtcDetectedBrowser=null,webrtcDetectedVersion=null;if(navigator.mozGetUserMedia)webrtcDetectedBrowser="firefox",webrtcDetectedVersion=parseInt(navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]),RTCPeerConnection=mozRTCPeerConnection,RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn")&&(-1!==a.indexOf("transport=udp")||-1===a.indexOf("?transport"))){var f=a.split("?");d={url:f[0],credential:c,username:b}}return d},attachMediaStream=function(a,b){console.log("Attaching media stream"),a.mozSrcObject=b,a.play()},reattachMediaStream=function(a,b){console.log("Reattaching media stream"),a.mozSrcObject=b.mozSrcObject,a.play()},MediaStream.prototype.getVideoTracks=function(){return[]},MediaStream.prototype.getAudioTracks=function(){return[]};else if(navigator.webkitGetUserMedia){var match=navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./);webrtcDetectedBrowser="chrome",webrtcDetectedVersion=match?parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2]):40,createIceServer=function(a,b,c){var d=null,e=a.split(":");if(0===e[0].indexOf("stun"))d={url:a};else if(0===e[0].indexOf("turn"))if(28>webrtcDetectedVersion){var f=a.split("turn:");d={url:"turn:"+b+"@"+f[1],credential:c}}else d={url:a,credential:c,username:b};return d},RTCPeerConnection=webkitRTCPeerConnection,getUserMedia=navigator.webkitGetUserMedia.bind(navigator),attachMediaStream=function(a,b){"undefined"!=typeof a.srcObject?a.srcObject=b:"undefined"!=typeof a.mozSrcObject?a.mozSrcObject=b:"undefined"!=typeof a.src?a.src=URL.createObjectURL(b):console.log("Error attaching stream to element.")},reattachMediaStream=function(a,b){a.src=b.src},webkitMediaStream.prototype.getVideoTracks||(webkitMediaStream.prototype.getVideoTracks=function(){return this.videoTracks},webkitMediaStream.prototype.getAudioTracks=function(){return this.audioTracks}),webkitRTCPeerConnection.prototype.getLocalStreams||(webkitRTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},webkitRTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})}else console.log("Browser does not appear to be WebRTC-capable")}!function(){"use strict";function a(a,b){function e(){return c.config.userName&&c.config.userName.length?c.config.userName:p?p.slice(0,5):"Unknown"}function f(a){switch(a.type){case"txt":j(a);break;case"joinok":i(a);break;case"join_error":break;case"sessionId":stderr("Connect successful, your id is: "+a.id),p=a.id;break;case"joined":a.userStatus="joined",g(a);break;case"left":a.userStatus="left",h(a);break;case"camera":case"pointer":break;default:stderr(a)}var b=a.roomId,c={type:o[a.type],data:a,channelId:b};u.dispatchEvent(c)}function g(a){if(a.user.name&&a.user.name.length||(a.user.name=a.user.id.slice(0,5)),a.roomId){var b=t[a.roomId];b?(b.users.push(a.user),stderr(a.user+" joined room "+a.roomId)):stderr("Channel "+a.roomId+" does not exist for socket "+p)}}function h(a){stderr(a.user+" left room "+a.room);for(var b in t){for(var c=t[b].users,d=-1,e=0;e<c.length;e++)if(c[e].id==a.user){d=e;break}-1!=d&&c.splice(d,1),delete t[b].userSet[a.user]}}function i(a){var b=t[a.roomId];stderr("joined channel "+a.roomId),a.users&&a.users.length?b.users=a.users:b.users=[];for(var c=0;c<b.users.length;c++)b.users[c].name&&b.users[c].name.length||(b.users[c].name=b.users[c].id.slice(0,5));var d=e(),f=Autodesk.Viewing.i18n.translate("you"),g={id:p,name:d+" ("+f+")",isSelf:!0,status:0};b.userSet[p]||(b.users.push(g),b.userSet[p]=g),0!=g.id.indexOf(d)&&u.sendChatMessage("/nick "+d,a.roomId)}function j(a){if(0==a.msg.indexOf("/nick ")){var b=u.getUserById(a.from,a.roomId),c=a.msg.slice(6);if(c.length&&(b.name=c,b.id==p)){var d=Autodesk.Viewing.i18n.translate("you");b.name+=" ("+d+")"}u.dispatchEvent({type:"userListChange",data:a,channelId:a.roomId})}}function k(a){r<q.length?(stderr("Connect failed, trying another server..."),n.disconnect(),n=null,r++,u.connect(u.sessionID)):u.dispatchEvent({type:"socketError",data:a})}function l(a){u.dispatchEvent({type:"socketError",data:a})}function m(a){r=0;for(var b in s)u.join(b)}var n,o={camera:"cameraChange",pointer:"pointerMove",joystick:"joystick",state:"viewerState",txt:"chatReceived",joinok:"userListChange",sessionId:"connectSucceeded",joined:"userListChange",left:"userListChange","private":"privateMessage",join_error:"socketError"},p=null,q=Array.isArray(a)?a:[a],r=0,s={},t={},u=this;this.connect=function(a){return n?void 0:"undefined"!=typeof window.WebSocket?(d||(d="undefined"!=typeof lmv_io?lmv_io:io),this.sessionID=a,n=d.connect(q[r]+"?sessionID="+a,{path:b,forceNew:!0}),n.on("connect",m),n.on("message",f),n.on("connect_error",k),n.on("error",l),!0):!1},this.join=function(a){return n&&n.connected?(delete s[a],t[a]={id:a,users:[],userSet:{}},void n.emit("join",{roomId:a,name:e()})):void(s[a]=1)},this.disconnect=function(){n&&(n.disconnect(),n=null,t={},p=null)},this.sendMessage=function(a,b,c){var d={type:a,from:p,msg:b,roomId:c};n.emit("message",d)},this.sendPrivateMessage=function(a,b){var c={type:"private",target:a,from:p,msg:b};n.emit("message",c)},this.sendChatMessage=function(a,b){var c={type:"txt",from:p,msg:a,roomId:b};n.emit("message",c),f(c)},this.getUserById=function(a,b){for(var c=t[b].users,d=0;d<c.length;d++)if(c[d].id==a)return c[d];return null},this.getLocalId=function(){return p},this.getChannelInfo=function(a){return t[a]},this.isConnected=function(){return n}}var b=Autodesk.Viewing,c=b.Private;c.config={userName:""},c.setUserName=function(a){c.config.userName=a};var d;a.prototype.constructor=a,b.EventDispatcher.prototype.apply(a.prototype);var e={};a.GetInstance=function(a,b){a||(a=c.EnvironmentConfigurations[c.env].LMV.RTC),Array.isArray(a)||(a=[a]);var d=e[a[0]];return d?d:(d=new c.MessageClient(a,b),e[a[0]]=d,d)},Autodesk.Viewing.Private.MessageClient=a}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing,b=a.Private;b.P2PClient=function(a){function b(a){try{j=new RTCPeerConnection(s),j.onicecandidate=function(a){a.candidate?p.sendPrivateMessage(k,{type:"candidate",label:a.candidate.sdpMLineIndex,id:a.candidate.sdpMid,candidate:a.candidate.candidate}):stderr("End of candidates.")},j.ondatachannel=function(a){stderr("Data channel added."),n=a.channel,n.onmessage=g,o.dispatchEvent({type:"dataChannelAdded",data:a.channel})},j.onaddstream=function(a){stderr("Remote stream added."),m=a.stream,o.dispatchEvent({type:"remoteStreamAdded",data:a.stream})},j.onremovestream=function(a){stderr("Remote stream removed. Event: ",a),m=null,o.dispatchEvent({type:"remoteStreamRemoved",data:a.stream})},a&&(n=j.createDataChannel("sendDataChannel",{reliable:!1,ordered:!1}),n.onmessage=g)}catch(b){return stderr("Failed to create PeerConnection, exception: "+b.message),void alert("Cannot create RTCPeerConnection object.")}}function c(a){stderr("createOffer() error: ",e)}function d(a){if(j.setLocalDescription(a),p.sendPrivateMessage(k,a),r.length){for(var b=0;b<r.length;b++)j.addIceCandidate(r[b]);r=[]}}function f(a){for(var b=a.split("\n"),c=!1,d=!1,e=!1,f=0;f<b.length;f++)0==b[f].indexOf("a=mid:data")&&(c=!0),0==b[f].indexOf("a=mid:video")&&(e=!0),0==b[f].indexOf("a=mid:audio")&&(d=!0);return c&&!e&&!d}function g(a){var b=JSON.parse(a.data);switch(b.type){case"camera":o.dispatchEvent({type:"cameraChange",data:b});break;case"joystick":o.dispatchEvent({type:"joystick",data:b});break;case"state":o.dispatchEvent({type:"viewerState",data:b})}}function h(a){var b=a.data.msg;if(stderr("Client received message:"+JSON.stringify(b)),"offer"!=b.type||q)if("answer"===b.type&&q)j.setRemoteDescription(new RTCSessionDescription(b));else if("candidate"===b.type){var c=new RTCIceCandidate({sdpMLineIndex:b.label,candidate:b.candidate});q?j.addIceCandidate(c):r.push(c)}else"bye"===b&&q&&(o.dispatchEvent({type:"remoteHangup",data:null}),stderr("Session terminated."),i());else stderr("Received offer. Accepting."),o.receiveCall(a.data)}function i(){q=!1,j.close(),j=null,l=null,m=null,k=null}var j,k,l,m,n,o=this,p=a,q=!1,r=[],s={iceServers:[{url:"stun:stun.l.google.com:19302"}]},t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},u={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}};p.addEventListener("privateMessage",h),this.hangup=function(){stderr("Hanging up."),q&&(p.sendPrivateMessage(k,"bye"),i())},this.initUserMedia=function(a){function b(b){stderr("Adding local stream."),a&&a(b),o.dispatchEvent({type:"localStreamAdded",data:b})}function c(a){stderr("getUserMedia error: ",a)}var d={video:!0,audio:!0};window.getUserMedia(d,b,c),stderr("Getting user media with constraints",d)},this.callUser=function(a,e){return k?void stderr("Already in a call. Ignoring call request."):(k=a,stderr("Calling user "+k),void(e?(b(!0),q=!0,stderr("Sending data channel offer to peer"),j.createOffer(d,c)):this.initUserMedia(function(a){l=a,q||"undefined"==typeof l||(b(!1),j.addStream(l),q=!0,stderr("Sending audio/video offer to peer"),j.createOffer(d,c))})))},this.receiveCall=function(a){k=a.from,k||(k=a.senderId);var c=a.msg.sdp;f(c)?(b(!0),q=!0,j.setRemoteDescription(new RTCSessionDescription(a.msg)),stderr("Sending data-only answer to peer."),j.createAnswer(d,null,u)):this.initUserMedia(function(c){l=c,q||"undefined"==typeof l||(b(!1),j.addStream(l),q=!0),j.setRemoteDescription(new RTCSessionDescription(a.msg)),stderr("Sending audio+video answer to peer."),j.createAnswer(d,null,t)})},this.getCurrentCallTarget=function(){return k},this.dataChannel=function(){return n}},b.P2PClient.prototype.constructor=b.P2PClient,Autodesk.Viewing.EventDispatcher.prototype.apply(b.P2PClient.prototype)}(),function(){"use strict";function a(a){if(this.queue=[],a.eventCallback&&(this.callback=a.eventCallback),this.sessionId=a.sessionId,!this.sessionId){var c=Date.now()+"";this.sessionId=parseFloat((1e4*Math.random()|0)+""+c.substring(4))}this.endpoint=a.endpoint?a.endpoint+"/logs":null,this.flushThreshold=a.flushThreshold||10;var d=this;d.ready=!1,d.retries=0,this.lastFlushTime=Date.now(),this.heartbeat=null;var e={category:"viewer_start",touch:isTouchDevice(),env:b.env,referer:window.location.href,version:LMV_VIEWER_VERSION,patch:LMV_VIEWER_PATCH,build_type:LMV_BUILD_TYPE};this.log(e)}var b=Autodesk.Viewing.Private;a.prototype.setupWS=function(){var a=this;if(a.reconnectPending=!1,this.endpoint){stderr("Opening web socket.");var b=function(){a.ready=!0,a.lastConnectTime=Date.now(),stderr("Web socket opened successfully."),a.retries>0&&a.socket.send({category:"reconnect",sessionId:this.sessionId}),a.flush()},c=function(){a.reconnectPending||a.xhr||(a.ready=!1,a.retries<3?(stderr("Attempting web socket reconnect."),a.retries++,a.reconnectPending=!0,setTimeout(function(){a.setupWS()},5e3)):(stderr("Giving up on web sockets. Trying POST."),a.setupXHR()))},d=function(a){console.log(a.message),c()},e=function(b){var d=Date.now();d-a.lastConnectTime>6e4?(stderr("Web socket closed due to inactivity."),a.socket=null,a.ready=!1,a.retries=0):c()};try{this.socket=new WebSocket("wss://"+this.endpoint,"lmv-log-v1"),this.socket.onopen=b,this.socket.onerror=d,this.socket.onclose=e,this.socket.onmessage=function(a){console.log(a.data)}}catch(f){a.setupXHR()}}},a.prototype.setupXHR=function(){this.socket=null,this.xhr=new XMLHttpRequest,this.ready=!0,this.retries=0,this.flush();var a=this;this.heartbeat&&clearInterval(this.heartbeat),this.heartbeat=setInterval(function(){a.flush()},6e4),"undefined"!=typeof window&&window.addEventListener("beforeunload",function(){a.log({category:"viewer_stop"},!0)})},a.prototype.flush=function(){if(!(this.retries>2)&&this.queue.length&&this.ready){var a=this,b=this.queue;this.queue=[];var c=JSON.stringify(b);if(this.socket)try{this.socket.send(c)}catch(d){}else if(this.endpoint)try{var e=this.xhr;e.open("POST","https://"+this.endpoint,!0),e.send(c),e.onreadystatechange=function(){4==e.readyState&&200!==e.status&&(a.retries++,a.queue.unshift(b))}}catch(d){}else stderr(this.queue);this.lastFlushTime=Date.now()}},a.prototype.log=function(a,c){b.offline||(this.callback&&this.callback(a),this.retries>2||(a.timestamp=Date.now(),a.sessionId=this.sessionId,this.queue.push(a),this.socket||this.ready?(this.socket||this.queue.length>this.flushThreshold||a.timestamp-this.lastFlushTime>6e4||c)&&this.flush():this.setupWS()))},Autodesk.Viewing.Private.Logger=a}();var Autocam=Autocam||function(a,b){function c(b){t=!0,a.target.copy(q.center),a.pivot.copy(q.pivot),a.worldup?a.worldup.copy(q.sceneUpDirection):a.up.copy(q.sceneUpDirection),q.cameraChangedCallback&&q.cameraChangedCallback(b),t=!1}function d(a,b){var c=a.clone();return Math.abs(c.clone().dot(b))<Number.MIN_VALUE?(c.normalize(),c):(c=e(a,b),c.length()<Number.MIN_VALUE&&(c=f(b)),c.normalize(),c)}function e(a,b){b.normalize();var c=a.clone().dot(b),d=b.clone().multiplyScalar(c);return d=a.clone().sub(d)}function f(a){for(var b=new THREE.Vector3(0,0,0),c=[new THREE.Vector3(0,1,0),new THREE.Vector3(1,0,0),new THREE.Vector3(0,0,1),new THREE.Vector3(0,1,1),new THREE.Vector3(1,0,1),new THREE.Vector3(1,1,0),new THREE.Vector3(1,1,1)],d=0;7>d;d++)if(Math.abs(c[d].dot(a))<Number.MIN_VALUE){b=c[d];break}return b}function g(a,b){var c=new THREE.Vector2(0,0);return c.x=a/window.innerWidth,c.y=b/window.innerHeight,c}function h(b){b.y=Math.abs(b.y-window.innerHeight);var c,d,e=a.position,f=q.center,g=f.clone().sub(e),h=a.up,i=g.clone().cross(h),j=g.clone().length(),k=j*Math.tan(THREE.Math.degToRad(a.leftFov)),l=j*Math.tan(THREE.Math.degToRad(a.rightFov)),m=j*Math.tan(THREE.Math.degToRad(a.topFov)),n=j*Math.tan(THREE.Math.degToRad(a.bottomFov)),o=k+l,p=m+n,r=b.x*o/window.innerWidth,s=r-k,t=b.y*p/window.innerHeight,u=t-n;return h=h.clone().normalize().clone().multiplyScalar(u),i=i.clone().normalize().clone().multiplyScalar(s),q.ortho?(c=e.clone().add(i).clone().add(h),d=g):(c=e,d=g.clone().add(h).clone().add(i)),{rayO:c,rayD:d}}function i(a,b,c){var d,e,f,g;d=e=f=g=0;var h=0,i=null,j=null,k=q.snapOrbitDeadZone,l=q.orbitMultiplier;return"h"==a?(d=q.snapOrbitThresholdH,e=q.snapOrbitAccelerationAX,f=q.snapOrbitAccelerationBX,g=1-q.snapOrbitAccelerationPointX,j=q.lockDeltaX,i=q.lockedX):(d=q.snapOrbitThresholdV,e=q.snapOrbitAccelerationAY,f=q.snapOrbitAccelerationBY,g=1-q.snapOrbitAccelerationPointY,j=q.lockDeltaY,i=q.lockedY),i?(j+=c,-k>j?(h=(j+k)*l*1/f,i=!1):j>k&&(h=(j-k)*l*1/f,i=!1)):(h=Math.abs(b)>d?c*l:Math.abs(b)>g*d?c*b>0?c*l*e:c*l*1/e:c*b>0?c*l*f:c*l*1/f,h*b>0&&Math.abs(h)>Math.abs(b)&&(this.lockDeltaX=this.lockDeltaY=0,i=!0,h=b)),h}function j(){return q.combined}function k(a,b){var c=30,d=!1,e=window.innerWidth,f=a.x%e,g=window.innerHeight,h=a.y%g,i=f>0?f-b.x:e+f-b.x,j=h>0?h-b.y:g+h-b.y;return Math.abs(i)<c&&Math.abs(j)<c&&(d=!0),d}function l(a,b,c){c.x=(a.x-b.x)/window.innerWidth,a.x=b.x+(a.x-b.x)%window.innerWidth,c.y=(a.y-b.y)/window.innerHeight,a.y=b.y+(a.y-b.y)%window.innerHeight}function m(a,b,c){if(!O||!a){if(a){var d=30,e=new THREE.Vector2,f=b.x,g=b.y;l(b,c,e),M=window.innerWidth*e.x,N=window.innerHeight*e.y,f<c.x?f-=2*d:f+=2*d,g<c.y?g-=2*d:g+=2*d}O=a}}function n(a,b,c){if(0===b)return 0;var d=a,e=q.saveEye.clone().sub(worldUp.clone().multiplyScalar(c+d)),f=q.saveEye.clone().sub(worldUp.clone().multiplyScalar(c)),g=0,h=(q.maxSceneBound-q.minSceneBound)/1e3;q.topLimit&&b>0?(g=q.maxSceneBound-h,q.topLimit=!1):q.bottomLimit&&0>b?(g=q.minSceneBound+h,q.bottomLimit=!1):g=e.dot(worldUp);var i=f.dot(worldUp);return g<q.minSceneBound?i<q.minSceneBound&&(q.bottomLimit=!0,d=0):g>q.maxSceneBound&&i>q.maxSceneBound&&(q.topLimit=!0,d=0),d}function o(a){var b=Math.pow(a,2);0>a&&(b=-b);var c=g(0,b),d=q.maxSceneBound-q.minSceneBound,e=.01*d;c.y*=e;var f=q.userHeightSpeed*c.y;return f=n(f,a,q.m_amount)}function p(a){var b=q.sceneFrontDirection.clone().cross(q.sceneUpDirection),c=Math.abs(Math.abs(a.dot(q.sceneUpDirection))-1),d=Math.abs(Math.abs(a.dot(q.sceneFrontDirection))-1),e=Math.abs(Math.abs(a.dot(b))-1);return 1e-5>c||1e-5>d||1e-5>e}var q=this,r=null,s=null,t=!1;this.cube=null,this.camera=a,this.renderer="WEBGL",this.startState={},this.navApi=b,this.orthographicFaces=!1,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null;var u,v=Date.now(),w=!1;this.dtor=function(){this.cube=null,this.cameraChangedCallback=null,this.pivotDisplayCallback=null,this.canvas=null},this.showPivot=function(a){this.pivotDisplayCallback&&this.pivotDisplayCallback(a)},this.setWorldUpVector=function(a){t||a&&a.lengthSq()>0&&!a.normalize().equals(this.sceneUpDirection)&&(this.sceneUpDirection.copy(a),this.sceneFrontDirection.copy(this.getWorldFrontVector()),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.cube&&requestAnimationFrame(this.cube.render))},this.getWorldUpVector=function(){return this.sceneUpDirection.clone()},this.getWorldRightVector=function(){var a=this.sceneUpDirection.clone();return Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},this.getWorldFrontVector=function(){var a=this.getWorldUpVector();return a.cross(this.getWorldRightVector()).normalize()},this.goToView=function(a){if(!this.navApi.getIsLocked()){var b={position:a.position.clone(),up:a.up.clone(),center:a.center.clone(),pivot:a.pivot.clone(),fov:a.fov,worldUp:a.worldUp.clone(),isOrtho:a.isOrtho};q.elapsedTime=0,this.animateTransition(b)}},this.getCurrentView=function(){return{position:a.position.clone(),up:a.up.clone(),center:this.center.clone(),pivot:this.pivot.clone(),fov:a.fov,worldUp:this.sceneUpDirection.clone(),isOrtho:a.isPerspective===!1}},this.setCurrentViewAsHome=function(a){a?(this.navApi.setRequestFitToView(!0),w=!0):this.homeVector=this.getCurrentView()},this.setHomeViewFrom=function(a){var b=a.pivot?a.pivot:this.center,c=a.target?a.target:this.pivot,d=a.worldup?a.worldup:this.sceneUpDirection;this.homeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),isOrtho:a.isPerspective===!1},this.originalHomeVector={position:a.position.clone(),up:a.up.clone(),center:c.clone(),pivot:b.clone(),fov:a.fov,worldUp:d.clone(),worldFront:this.sceneFrontDirection.clone(),isOrtho:a.isPerspective===!1}},this.toPerspective=function(){a.isPerspective||(a.toPerspective(),c(!1))},this.toOrthographic=function(){a.isPerspective&&(a.toOrthographic(),c(!1))},this.setOrthographicFaces=function(a){this.orthographicFaces=a},this.goHome=function(){this.navApi.getIsLocked()||(this.navApi.setPivotSetFlag(!1),this.goToView(this.homeVector))},this.resetHome=function(){this.homeVector.position.copy(this.originalHomeVector.position),this.homeVector.up.copy(this.originalHomeVector.up),this.homeVector.center.copy(this.originalHomeVector.center),this.homeVector.pivot.copy(this.originalHomeVector.pivot),this.homeVector.fov=this.originalHomeVector.fov,this.homeVector.worldUp.copy(this.originalHomeVector.worldUp),this.homeVector.isOrtho=this.originalHomeVector.isOrtho,this.goHome()},this.getView=function(){return this.center.clone().sub(a.position)},this.setCameraUp=function(b){var c=this.dir.clone(),d=c.cross(b).normalize();0===d.lengthSq()&&(c.copy(this.dir),b.z>b.y?c.y+=1e-4:c.z+=1e-4,d=c.cross(b).normalize()),a.up.copy(d).cross(this.dir).normalize()},function S(){requestAnimationFrame(S);var a=Date.now();u=a-v,v=a}(),this.ortho=!1,this.center=a.target?a.target.clone():new THREE.Vector3(0,0,0),this.pivot=a.pivot?a.pivot.clone():this.center.clone(),this.sceneUpDirection=a.worldup?a.worldup.clone():a.up.clone(),this.sceneFrontDirection=this.getWorldFrontVector(),this.dir=this.getView(),this.setCameraUp(a.up),this.saveCenter=this.center.clone(),this.savePivot=this.pivot.clone(),this.saveEye=a.position.clone(),this.saveUp=a.up.clone();var z,A,B,C;this.cubeFront=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),this.setHomeViewFrom(a);var D,E,F=new THREE.Quaternion,G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Quaternion;this.userPanSpeed=.5,this.userLookSpeed=2,this.userHeightSpeed=5,this.walkMultiplier=1,this.userZoomSpeed=1.015,this.orbitMultiplier=5,this.currentlyAnimating=!1,a.keepSceneUpright=!0,this.preserveOrbitUpDirection=!0,this.alignOrbitUpDirection=!0,this.constrainOrbitHorizontal=!1,this.constrainOrbitVertical=!1,this.doCustomOrbit=!1,this.snapOrbitDeadZone=.045,this.snapOrbitThresholdH=this.snapOrbitThresholdV=THREE.Math.degToRad(15),this.snapOrbitAccelerationAX=this.snapOrbitAccelerationAY=1.5,this.snapOrbitAccelerationBX=this.snapOrbitAccelerationBY=2,this.snapOrbitAccelerationPointX=this.snapOrbitAccelerationPointY=.5,this.alignDirTable=new Array(26),this.alignDirTable[0]=new THREE.Vector3(-1,0,0),this.alignDirTable[1]=new THREE.Vector3(1,0,0),this.alignDirTable[2]=new THREE.Vector3(0,-1,0),this.alignDirTable[3]=new THREE.Vector3(0,1,0),this.alignDirTable[4]=new THREE.Vector3(0,0,-1),this.alignDirTable[5]=new THREE.Vector3(0,0,1),this.alignDirTable[6]=new THREE.Vector3(-1,-1,0),this.alignDirTable[7]=new THREE.Vector3(-1,1,0),this.alignDirTable[8]=new THREE.Vector3(1,-1,0),this.alignDirTable[9]=new THREE.Vector3(1,1,0),this.alignDirTable[10]=new THREE.Vector3(0,-1,-1),this.alignDirTable[11]=new THREE.Vector3(0,-1,1),this.alignDirTable[12]=new THREE.Vector3(0,1,-1),this.alignDirTable[13]=new THREE.Vector3(0,1,1),this.alignDirTable[14]=new THREE.Vector3(-1,0,-1),this.alignDirTable[15]=new THREE.Vector3(1,0,-1),this.alignDirTable[16]=new THREE.Vector3(-1,0,1),this.alignDirTable[17]=new THREE.Vector3(1,0,1),this.alignDirTable[18]=new THREE.Vector3(-1,-1,-1),this.alignDirTable[19]=new THREE.Vector3(-1,-1,1),this.alignDirTable[20]=new THREE.Vector3(-1,1,-1),this.alignDirTable[21]=new THREE.Vector3(-1,1,1),this.alignDirTable[22]=new THREE.Vector3(1,-1,-1),this.alignDirTable[23]=new THREE.Vector3(1,-1,1),this.alignDirTable[24]=new THREE.Vector3(1,1,-1),this.alignDirTable[25]=new THREE.Vector3(1,1,1),this.combined=!1,this.useSnap=!1,this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,
this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0),this.topLimit=!1,this.bottomLimit=!1,this.minSceneBound=0,this.maxSceneBound=0;var J={destinationPercent:1,duration:1,zoomToFitScene:!0,useOffAxis:!1};this.shotParams=J;var K,L;this.zoomDelta=new THREE.Vector2;var M,N,O,P=0,Q=new THREE.Vector3,R=new THREE.Vector3;this.rewindParams={history:[],startTime:void 0,thumbnailSize:56,thumbnailGapSize:12,maxHistorySize:25,snappingEnabled:!0,timelineIndex:0,timelineIndexSlide:0,open:!1,openLocation:new THREE.Vector2(0,0),openBracket:new THREE.Vector2(0,0),openBracketA:new THREE.Vector2(0,0),openBracketB:new THREE.Vector2(0,0),openLocationOrigin:new THREE.Vector2(0,0),locationOffset:new THREE.Vector2(0,0),snapOffset:new THREE.Vector2(0,0),slideOffset:new THREE.Vector2(0,0),snapped:!0,resetWeights:!1,recordEnabled:!1,elementIsRecording:!1},this.viewCubeMenuOpen=!1,this.menuSize=new THREE.Vector2(0,0),this.menuOrigin=new THREE.Vector2(0,0),a.lookAt(this.center),this.setCube=function(a){this.cube=a},this.loadObject=function(a,b,c){loader=new THREE.JSONLoader,loader.load(a,function(a,d){var e=new THREE.MeshPhongMaterial(d);mesh=new THREE.Mesh(a,e),mesh.scale=b,mesh.position.copy(c),mesh.geometry.computeBoundingBox();var f=mesh.geometry.boundingBox.clone();R.set(f.max.x,f.max.y,f.max.z),Q.set(f.min.x,f.min.y,f.min.z),R.multiply(b),Q.multiply(b),scene.add(mesh),objects.push(mesh)})},this.sync=function(b){b.isPerspective!==a.isPerspective&&(b.isPerspective?a.toPerspective():(a.toOrthographic(),b.saveFov&&(a.saveFov=b.saveFov))),a.fov=b.fov,a.position.copy(b.position),b.target&&(this.center.copy(b.target),a.target.copy(b.target)),b.pivot&&(this.pivot.copy(b.pivot),a.pivot.copy(b.pivot)),this.dir.copy(this.center).sub(a.position),this.setCameraUp(b.up);var c=b.worldup?b.worldup:b.up;c.distanceToSquared(this.sceneUpDirection)>1e-4&&this.setWorldUpVector(c),w&&!this.navApi.getTransitionActive()&&(w=!1,this.setCurrentViewAsHome(!1)),this.cube&&requestAnimationFrame(this.cube.render)},this.refresh=function(){this.cube&&this.cube.refreshCube()},THREE.Box2.prototype.setCenter=function(a){var b=new THREE.Vector2(Math.abs(this.max.x-this.min.x)/2,Math.abs(this.max.y-this.min.y)/2);return this.min.copy(a).sub(b),this.max.copy(a).add(b),this},THREE.Box2.prototype.getIcon2DCoords=function(a,b){var c=this.center;b.set((a.x-c.x)/(this.size().x/2),(a.y-c.y)/(this.size().y/2))},THREE.Matrix3.prototype.makeRotationFromQuaternion=function(a){var b=this.elements,c=a.x,d=a.y,e=a.z,f=a.w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[3]=k-r,b[6]=l+q,b[1]=k+r,b[4]=1-(j+o),b[7]=n-p,b[2]=l-q,b[5]=n+p,b[8]=1-(j+m),this},THREE.Quaternion.prototype.setFromRotationMatrix3=function(a){var b,c=a.elements,d=c[0],e=c[3],f=c[6],g=c[1],h=c[4],i=c[7],j=c[2],k=c[5],l=c[8],m=d+h+l;return m>0?(b=.5/Math.sqrt(m+1),this.w=.25/b,this.x=(k-i)*b,this.y=(f-j)*b,this.z=(g-e)*b):d>h&&d>l?(b=2*Math.sqrt(1+d-h-l),this.w=(k-i)/b,this.x=.25*b,this.y=(e+g)/b,this.z=(f+j)/b):h>l?(b=2*Math.sqrt(1+h-d-l),this.w=(f-j)/b,this.x=(e+g)/b,this.y=.25*b,this.z=(i+k)/b):(b=2*Math.sqrt(1+l-d-h),this.w=(g-e)/b,this.x=(f+j)/b,this.y=(i+k)/b,this.z=.25*b),this},THREE.Quaternion.prototype.rotate=function(a){var b=(new THREE.Matrix4).makeRotationFromQuaternion(this),c=b.elements,d=(new THREE.Matrix3).set(c[0],c[1],c[2],c[4],c[5],c[6],c[8],c[9],c[10]);return a.applyMatrix3(d)},THREE.Vector3.prototype.findAngleWith=function(a,b){var c=0,d=this.clone().normalize().clone().dot(a.clone().normalize()),e=this.clone().cross(a).clone().normalize();if(e.clone().length()<Number.MIN_VALUE)c=d>0?0:180;else{var f=e.clone().dot(b.clone().normalize());b=f>0?e:-e;var g=(new THREE.Quaternion).setFromAxisAngle(b,90*THREE.Math.degToRad);g=g.clone().rotate(a).clone().normalize().clone().dot(this),c=Math.acos(d)*THREE.Math.radToDeg,Math.abs(c-90)<Number.MIN_VALUE&&(c=90),(90>c&&d*g>0||c>90&&0>d*g||90==c&&g>0)&&(c=-1*c)}return c=THREE.Math.degToRad(c)},"contains"in String.prototype||(String.prototype.contains=function(a,b){return-1!==String.prototype.indexOf.call(this,a,b)}),Math.linearClamp=function(a,b,c){return b>=a?0:a>=c?1:(a-b)/(c-b)},Math.easeClamp=function(a,b,c){if(b>=a)return 0;if(a>=c)return 1;var d=(a-b)/(c-b);return.5*(Math.sin((d-.5)*Math.PI)+1)},Math.linearInterp=function(a,b,c){return b*(1-a)+c*a},Math.equalityClamp=function(a,b,c){return b>=a?b:a>=c?c:a},Math.round2=function(a){return Math.round(100*a)/100},Math.round1=function(a){return Math.round(10*a)/10},this.animateTransition=function(b){if(b){var d=!1,e=0;if(this.setCameraOrtho(b.isOrtho),q.elapsedTime>=J.duration)return e=1,q.center.copy(b.center),q.pivot.copy(b.pivot),a.position.copy(b.position),a.up.copy(b.up),b.isOrtho||(a.fov=b.fov),d=!b.worldUp.equals(this.sceneUpDirection),d&&this.setWorldUpVector(b.worldUp),this.currentlyAnimating=!1,c(d),this.showPivot(!1),this.cube&&requestAnimationFrame(this.cube.render),this.addHistoryElement(),void this.navApi.setTransitionActive(!1);this.currentlyAnimating=!0,this.showPivot(!0),this.navApi.setTransitionActive(!0);var f=J.destinationPercent;e=Math.easeClamp(q.elapsedTime/J.duration,0,f);var g=1-e;q.elapsedTime+=u/500;var h=q.center.clone().multiplyScalar(g).add(b.center.clone().multiplyScalar(e)),i=a.position.clone().multiplyScalar(g).add(b.position.clone().multiplyScalar(e)),j=a.up.clone().multiplyScalar(g).add(b.up.clone().multiplyScalar(e)),k=a.pivot.clone().multiplyScalar(g).add(b.pivot.clone().multiplyScalar(e)),l=this.sceneUpDirection.clone().multiplyScalar(g).add(b.worldUp.clone().multiplyScalar(e)),m=a.fov*g+b.fov*e;q.center.copy(h),q.pivot.copy(k),a.position.copy(i),a.up.copy(j),b.isOrtho||(a.fov=m),d=l.distanceToSquared(this.sceneUpDirection)>1e-4,d&&this.setWorldUpVector(l),a.lookAt(q.center),c(d),this.cube&&requestAnimationFrame(this.cube.render),requestAnimationFrame(function(){q.animateTransition(b)})}},this.sphericallyInterpolateTransition=function(b){var d,e,f,g=0;if(this.currentlyAnimating=!0,this.navApi.setTransitionActive(!0),q.elapsedTime>=J.duration)g=1,this.currentlyAnimating=!1;else{var h=J.destinationPercent;g=Math.easeClamp(q.elapsedTime/J.duration,0,h),q.elapsedTime+=u/500}if(1===g)e=L.position,d=L.center,f=L.up;else{var i=new THREE.Matrix3,j=F.clone();j.slerp(G,g),i.makeRotationFromQuaternion(j);var k=Math.linearInterp(g,D,E),l=i.elements;d=K.center.clone().multiplyScalar(1-g).add(L.center.clone().multiplyScalar(g)),e=d.clone().sub(new THREE.Vector3(l[0],l[1],l[2]).multiplyScalar(k)),f=new THREE.Vector3(l[3],l[4],l[5])}q.center.copy(d),a.position.copy(e),a.up.copy(f),q.navApi.getUsePivotAlways()||q.pivot.copy(d),a.lookAt(q.center),this.currentlyAnimating===!0?(this.showPivot(!0),requestAnimationFrame(function(){q.sphericallyInterpolateTransition(b)})):(this.navApi.setTransitionActive(!1),this.showPivot(!1),this.addHistoryElement(),this.orthographicFaces&&this.isFaceView()&&this.setCameraOrtho(!0),b&&b()),c(!1),this.cube&&requestAnimationFrame(this.cube.render)},this.getOrientation=function(){if(this.cube){var b=Math.round1(a.up.x),c=Math.round1(a.up.y),d=Math.round1(a.up.z),e=this.sceneFrontDirection.clone(),f=this.sceneUpDirection.clone(),g=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();e.x=Math.round1(e.x),e.y=Math.round1(e.y),e.z=Math.round1(e.z),f.x=Math.round1(f.x),f.y=Math.round1(f.y),f.z=Math.round1(f.z),g.x=Math.round1(g.x),g.y=Math.round1(g.y),g.z=Math.round1(g.z);var h=g.clone().multiplyScalar(-1),i=f.clone().multiplyScalar(-1),j=e.clone().multiplyScalar(-1);switch(this.cube.currentFace){case"front":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"right":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"left";if(e.x==b&&e.y==c&&e.z==d)return"right";break;case"left":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"left";if(j.x==b&&j.y==c&&j.z==d)return"right";break;case"back":if(f.x==b&&f.y==c&&f.z==d)return"up";if(i.x==b&&i.y==c&&i.z==d)return"down";if(h.x==b&&h.y==c&&h.z==d)return"right";if(g.x==b&&g.y==c&&g.z==d)return"left";break;case"top":if(j.x==b&&j.y==c&&j.z==d)return"down";if(e.x==b&&e.y==c&&e.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left";break;case"bottom":if(e.x==b&&e.y==c&&e.z==d)return"down";if(j.x==b&&j.y==c&&j.z==d)return"up";if(g.x==b&&g.y==c&&g.z==d)return"right";if(h.x==b&&h.y==c&&h.z==d)return"left"}}},this.setCameraOrtho=function(b){b&&a.isPerspective&&a.toOrthographic(),b||a.isPerspective||a.toPerspective()},this.resetOrientation=function(){this.setCameraOrtho(this.originalHomeVector.isOrtho),this.sceneUpDirection.copy(this.originalHomeVector.worldUp),this.sceneFrontDirection.copy(this.originalHomeVector.worldFront),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.setCameraUp(this.sceneUpDirection),c(!0)},this.setCurrentViewAsFront=function(){this.cube&&(this.cube.currentFace="front"),this.sceneUpDirection.copy(a.up.clone()),this.sceneFrontDirection.copy(this.getView()).normalize(),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),this.orthographicFaces&&this.setCameraOrtho(!0),c(!0)},this.setCurrentViewAsTop=function(){this.cube&&(this.cube.currentFace="top"),this.sceneUpDirection.copy(this.getView()).multiplyScalar(-1).normalize(),this.sceneFrontDirection.copy(a.up),this.cubeFront.copy(this.sceneFrontDirection).cross(this.sceneUpDirection).normalize(),c(!0)},this.calculateCubeTransform=function(b){var c=this.sceneUpDirection.clone(),d=this.sceneFrontDirection.clone(),e=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize();K=a.clone(),K.center=q.center.clone(),K.pivot=q.pivot.clone(),L=a.clone(),L.center=q.center.clone(),L.pivot=q.pivot.clone();var f=new THREE.Vector3(0,0,0);b.contains("back")&&(f=f.add(d)),b.contains("front")&&(f=f.sub(d)),b.contains("top")&&(f=f.add(c)),b.contains("bottom")&&(f=f.sub(c)),b.contains("right")&&(f=f.add(e)),b.contains("left")&&(f=f.sub(e));var g=c,h=f.clone().normalize();if(1-Math.abs(h.dot(c))<Number.MIN_VALUE)for(var i=this.getView().normalize(),j=[d.clone(),d.clone().negate(),e.clone(),e.clone().negate()],k=h.dot(c)>0?1:-1,l=i.clone().add(a.up.clone().multiplyScalar(k)).normalize(),m=-2,n=0;4>n;n++){var o=l.dot(j[n]);o>m&&(m=o,g=j[n].multiplyScalar(k))}E=D=this.getView().length(),L.position.copy(L.center.clone().add(f.multiplyScalar(E/f.length()))),L.up.copy(g);var p=K.center.clone().sub(K.position).normalize(),r=p.clone().cross(K.up).normalize(),s=r.clone().cross(p).normalize(),t=new THREE.Matrix3;t.set(p.x,s.x,r.x,p.y,s.y,r.y,p.z,s.z,r.z),F.setFromRotationMatrix3(t),p=L.center.clone().sub(L.position).normalize(),r=p.clone().cross(L.up).normalize(),s=r.clone().cross(p).normalize(),t.set(p.x,s.x,r.x,p.y,s.y,r.y,p.z,s.z,r.z),H.setFromAxisAngle(p,0),I.setFromAxisAngle(s,0),G.setFromRotationMatrix3(t),G.multiply(H).multiply(I).normalize()},this.centerShot=function(b){(!K||b)&&(q.elapsedTime=0,K=L=a.clone(),K.center=q.center);var d=q.pivot.clone(),e=d.clone().sub(K.position),f=K.center.clone().sub(K.position).normalize(),g=K.up.clone(),h=f.clone().cross(g).normalize();g=h.clone().cross(f).normalize();var i=h.clone().multiplyScalar(h.dot(e)),j=g.clone().multiplyScalar(g.dot(e)),k=i.clone().add(j);L.position.copy(K.position.clone().add(k)),L.center=d,L.pivot=d;var l=0;if(q.elapsedTime>=J.duration)l=1;else{var m=J.destinationPercent;l=Math.easeClamp(q.elapsedTime/J.duration,0,m),q.elapsedTime+=u/2e3}var n=a.position.clone().multiplyScalar(1-l).add(L.position.clone().multiplyScalar(l)),o=q.center.clone().multiplyScalar(1-l).add(L.center.clone().multiplyScalar(l)),p=q.pivot.clone().multiplyScalar(1-l).add(L.pivot.clone().multiplyScalar(l));a.position.copy(n),q.center.copy(o),q.pivot.copy(p),a.lookAt(q.center),c(!1),1===l?this.addHistoryElement():requestAnimationFrame(function(){q.centerShot(!1)})},this.levelShot=function(){var b=this.getView(),c=b.length(),d=this.sceneUpDirection.clone(),e=a.up.clone().normalize(),f=b.normalize(),g=f.dot(d);if(1-Math.abs(g)>Number.MIN_VALUE){var h=f.clone().cross(d);f=d.clone().cross(h),f.normalize()}else f=e.clone();f.multiplyScalar(c);var i={center:f.add(a.position),up:d,position:a.position,pivot:q.center.clone().add(f),fov:a.fov,worldUp:d};q.elapsedTime=0,q.animateTransition(i)},this.fitToWindow=function(){var b=this.getView(),c=a.up.clone();b.normalize(),c.normalize(),L=a.clone(),L.center=q.center,c=d(c,b),c.normalize(),L.up.copy(c);var e=b.clone().cross(c);e.normalize();var f=Q.clone(),g=R.clone(),h=[f,g],i=new THREE.Vector3(g.x-f.x,g.y-f.y,g.z-f.z);h[2]=new THREE.Vector3(g.x,f.y,g.z),h[3]=new THREE.Vector3(g.x,f.y,f.z),h[4]=new THREE.Vector3(g.x,g.y,f.z),h[5]=new THREE.Vector3(f.x,g.y,g.z),h[6]=new THREE.Vector3(f.x,g.y,f.z),h[7]=new THREE.Vector3(f.x,f.y,g.z);for(var j=0;8>j;j++){var k=h[j].clone().sub(a.position);h[j].setX(k.clone().dot(e)),h[j].setY(k.clone().dot(c)),h[j].setZ(k.clone().dot(b))}var l,m,n,o,p=THREE.Math.degToRad(a.topFov),r=THREE.Math.degToRad(a.bottomFov),s=THREE.Math.degToRad(a.leftFov),t=THREE.Math.degToRad(a.rightFov);l=s>=0?Number.MAX_VALUE:Number.MIN_VALUE,m=t>=0?Number.MAX_VALUE:Number.MIN_VALUE,n=p>=0?Number.MAX_VALUE:Number.MIN_VALUE,o=r>=0?Number.MAX_VALUE:Number.MIN_VALUE;for(var u=1/Math.tan(t),v=-1/Math.tan(s),w=1/Math.tan(p),x=-1/Math.tan(r),y=0;8>y;y++){var z=h[y].clone(),A=z.z-v*z.x;l=s>=0?Math.min(l,A):Math.max(l,A),A=z.z-u*z.x,m=t>=0?Math.min(m,A):Math.max(m,A),A=z.z-w*z.y,n=p>=0?Math.min(n,A):Math.max(n,A),A=z.z-x*z.y,o=r>=0?Math.min(o,A):Math.max(o,A)}var B=(m-l)/(v-u),C=v*B+l,D=(o-n)/(w-x),E=w*D+n,F=0;if(E>=C){var G=(p-r)/2;if(Math.abs(G)>Number.MIN_VALUE){var H=1/Math.tan(G);D=D-E/H+C/H}F=C}else{var I=(t-s)/2;if(Math.abs(I)>Number.MIN_VALUE){var J=1/Math.tan(I);B=B-C/J+E/J}F=E}var K=new THREE.Vector3(B,D,F),M=e.clone().multiplyScalar(K.x),N=c.clone().multiplyScalar(K.y),O=b.clone().multiplyScalar(K.z);K=M.clone().add(N.clone().add(O)),L.position.add(K);var P=i.clone().sub(L.position).dot(b);L.center=L.position.clone().add(b.multiplyScalar(P)),L.pivot=i.clone();var S={center:L.center,up:L.up,position:L.position,pivot:L.pivot,fov:a.fov,worldUp:q.sceneUpDirection.clone()};q.elapsedTime=0,q.animateTransition(S)},this.updatePivotPosition=function(b){var c,d,e=new THREE.Vector3(b.x/window.innerWidth*2-1,2*-(b.y/window.innerHeight)+1,.5);if(e=e.unproject(a),c=new THREE.Raycaster(a.position,e.sub(a.position).normalize()),d=c.intersectObjects(objects),"zoom"==q.mode)if(void 0!==d[0]){var f=d[0].point;q.pivot.copy(f)}else{var g=h(b);q.pivot.copy(g.rayO.clone().add(g.rayD))}else if(void 0!==d[0]){wheel.cursorImage("pivot");var f=d[0].point;q.isMouseDown||q.pivot.copy(f)}else wheel.cursorImage("SWInvalidArea")},this.onDrawHeight=function(b,c,d,e,f){var g=86,h=new THREE.Vector3(0,1,0),i=a.position.clone().dot(h),j=Math.linearClamp(i,q.minSceneBound,q.maxSceneBound),k=j-.5;s&&(s.find("img#updownImageA").remove(),s.prepend('<img src="'+f+'SWheighthandleA.png" id="updownImageA" style="position:fixed; z-index:9999; top:'+(d-g*k)+"px; left:"+c+'px;"/>'),e||s.prepend('<img src="'+f+'SWheighthandleI.png" id="updownImageI" style="position:fixed; z-index:9998; top:'+(d-g*k)+"px; left:"+c+'px;"/>'))},this.drawDropdownMenu=function(a,b,c,d,e,f,g){var h=0;if(r)f.appendChild(r);else{r=document.createElement("div"),r.className="dropDownMenu",r.style.top="100px",r.style.left="-400px";for(var i=0,j=0,k=0;k<a.length;k++){var l;if(null===a[k])l=document.createElement("li"),l.style.height="1px",i+=1,l.style.backgroundColor="#E0E0E0";else{var m=Autodesk.Viewing.i18n.translate(a[k]);if(j=m.length>j?m.length:j,c[k]){l=document.createElement("div");var n=document.createElement("input"),o=document.createElement("label");n.type="radio",n.className="dropDownMenuCheck",o.innerHTML=m,o.className="dropDownMenuCheckText",l.appendChild(n),l.appendChild(o),l.className="dropDownMenuCheckbox"}else l=document.createElement("li"),l.textContent=m,l.className=b[k]?"dropDownMenuItem":"dropDownMenuItemDisabled";l.id="menuItem"+h,h++,i+=25,l.setAttribute("data-i18n",a[k])}r.appendChild(l)}f.appendChild(r),r.style.minWidth=Math.max(256,7.4*j)+"px";var p=r.getBoundingClientRect().width;this.menuSize.x=p,this.menuSize.y=i}h=0;for(var k=0;k<a.length;k++)if(null!==a[k]){if(c[k]){var q="menuItem"+h,s=document.getElementById(q);s&&(s.children[0].checked=c[k]())}h++}var t=e-15,u=d+1,v=this.canvas.getBoundingClientRect();u+this.menuSize.x>v.right&&(u=d-this.menuSize.x-1),t+this.menuSize.y>v.bottom&&(t=v.bottom-this.menuSize.y),t-=g.y,u-=g.x,r.style.top=t+"px",r.style.left=u+"px",this.menuOrigin.x=u,this.menuOrigin.y=t},this.removeDropdownMenu=function(a){a.removeChild(r)},this.isFaceView=function(){var b=this.center.clone().sub(a.position).normalize();return p(b)&&p(a.up)},this.startInteraction=function(a,b){this.startCursor=new THREE.Vector2(a,b),this.startState={saveCenter:this.center.clone(),saveEye:this.camera.position.clone(),savePivot:this.pivot.clone(),saveUp:this.camera.up.clone()},this.lockDeltaX=0,this.lockedX=!1,this.lastSnapRotateX=0,this.lockDeltaY=0,this.lockedY=!1,this.lastSnapRotateY=0,this.lastSnapDir=new THREE.Vector3(0,0,0)},this.orbit=function(b,d,e,f){if(!this.navApi.getIsLocked()&&this.currentlyAnimating!==!0){var h="wheel";if(q.orthographicFaces&&!a.isPerspective&&(a.toPerspective(),f&&f.saveEye.copy(this.camera.position)),f&&(h="cube"),"cube"==h?(this.saveCenter.copy(f.saveCenter),this.saveEye.copy(f.saveEye),this.savePivot.copy(f.savePivot),this.saveUp.copy(f.saveUp),this.useSnap=!0,this.doCustomOrbit=!0):(this.saveCenter.copy(this.center),this.savePivot.copy(this.pivot),this.saveEye.copy(a.position),this.saveUp.copy(a.up),this.useSnap=!1,this.doCustomOrbit=!1),j()&&void 0==A&&(A=this.saveCenter.clone(),z=this.saveEye.clone(),C=this.savePivot.clone(),B=this.saveUp.clone()),this.preserveOrbitUpDirection){var k=g(b.x-d.x,b.y-d.y),l=g(e.x,e.y),m=this.sceneUpDirection.clone(),n=this.sceneFrontDirection.clone(),o=this.sceneFrontDirection.clone().cross(this.sceneUpDirection).normalize(),p=j()?C:this.savePivot,r=j()?z:this.saveEye,s=j()?A:this.saveCenter,t=j()?B:this.saveUp,u=p.clone().sub(r).normalize(),v=s.clone().sub(r).normalize(),w=v.clone().cross(t),x=r.clone().sub(p).length(),y=r.clone().sub(s).length(),D=u.clone().multiplyScalar(-1),E=v.clone().multiplyScalar(-1),F=w,G=t.clone(),H=0,I=0;if(!this.constrainOrbitHorizontal){var J=m.dot(this.saveUp),K=.009;-K>J&&(k.x=-k.x,l.x=-l.x);var L=0;L=j()?l.x*this.orbitMultiplier:this.useSnap?this.lastSnapRotateX+i("h",H,-l.x):k.x*this.orbitMultiplier,this.lastSnapRotateX=L;var M=(new THREE.Quaternion).setFromAxisAngle(m,-L);D.applyQuaternion(M),E.applyQuaternion(M),F.applyQuaternion(M),G.applyQuaternion(M)}if(!this.constrainOrbitVertical){var N=n.clone().multiplyScalar(n.dot(F)),O=o.clone().multiplyScalar(o.dot(F)),P=N.clone().add(O);P.clone().normalize();var Q=0;if(j())Q=l.y*this.orbitMultiplier;else{var R=i("v",I,l.y);Q=this.useSnap?this.lastSnapRotateY+R:k.y*this.orbitMultiplier}var S=(new THREE.Quaternion).setFromAxisAngle(P,-Q);if(this.navApi.getOrbitPastWorldPoles())D.applyQuaternion(S).normalize(),E.applyQuaternion(S).normalize(),G.applyQuaternion(S).normalize();else{var T=G.clone();T.applyQuaternion(S).normalize();var U=m.dot(T);if(0>U){var V=E.clone();V.applyQuaternion(S).normalize();var W=V.angleTo(m);Math.abs(W)>.5*Math.PI&&(W-=W>0?Math.PI:-Math.PI),Q-=W,S.setFromAxisAngle(P,-Q),D.applyQuaternion(S).normalize(),E.applyQuaternion(S).normalize(),G.applyQuaternion(S).normalize()}else D.applyQuaternion(S).normalize(),E.applyQuaternion(S).normalize(),G.applyQuaternion(S).normalize()}this.lastSnapRotateY=Q}var X=D.multiplyScalar(x).add(p);a.position.copy(X),a.up.copy(G),this.center.copy(X),this.center.sub(E.multiplyScalar(y)),j()&&(A.copy(this.center),z.copy(a.position),C.copy(this.pivot),B.copy(a.up))}a.lookAt(this.center),c(!1)}},this.endInteraction=function(){},this.look=function(b){if(!this.navApi.getIsLocked()){var d=g(b.x,b.y),e=this.userLookSpeed,f=this.getView(),h=a.up,i=f.clone().cross(h).normalize(),j=this.sceneUpDirection.clone(),k=d.clone();k.x*=Math.PI,k.y*=Math.PI/a.aspect,k.multiplyScalar(e);var l=(new THREE.Quaternion).setFromAxisAngle(i,-k.y);if(a.keepSceneUpright&&!this.navApi.getOrbitPastWorldPoles()){var m=h.clone();if(m.applyQuaternion(l).normalize(),m.dot(j)<0){var n=f.clone();n.applyQuaternion(l);var o=n.angleTo(j);Math.abs(o)>.5*Math.PI&&(o-=o>0?Math.PI:-Math.PI),k.y-=o,l.setFromAxisAngle(i,-k.y)}}f=l.clone().rotate(f),h=l.clone().rotate(h),h.normalize();var p=a.keepSceneUpright?j:h,q=(new THREE.Quaternion).setFromAxisAngle(p,-k.x);f=q.clone().rotate(f),h=q.clone().rotate(h),this.center.copy(f.add(a.position)),a.up.copy(h),a.lookAt(this.center),c(!1)}},this.pan=function(b){if(!this.navApi.getIsLocked()){b=g(b.x,b.y);var d=this.getView(),e=a.up.clone().cross(d),f=d.clone().cross(e);e.normalize(),f.normalize(),d.normalize();var h=this.pivot.clone().sub(a.position),i=d.clone().dot(h),j=i*(Math.tan(THREE.Math.degToRad(a.leftFov))+Math.tan(THREE.Math.degToRad(a.rightFov))),k=i*(Math.tan(THREE.Math.degToRad(a.topFov))+Math.tan(THREE.Math.degToRad(a.bottomFov))),l=b.x*Math.abs(j),m=b.y*Math.abs(k),n=new THREE.Vector3,o=e.clone().multiplyScalar(l),p=f.clone().multiplyScalar(m);n=o.clone().add(p).clone().multiplyScalar(this.userPanSpeed),a.position.add(n),this.center.add(n),a.lookAt(this.center),c(!1)}},this.zoom=function(b){if(!this.navApi.getIsLocked()){var d=this.userZoomSpeed,e=Number.MAX_VALUE,f=b.x+b.y,g=Math.pow(d,f),h=this.pivot.clone().sub(this.pivot.clone().sub(this.saveEye).clone().multiplyScalar(g)),i=h.clone().add(q.D.clone().multiplyScalar(q.D.clone().dot(this.pivot.clone().sub(h).clone())));if(!(g>=e)){if(f>0){var j=0;Math.pow(d,f-j);if(j>f)return void(P=0);a.position.copy(h),this.center.copy(i);var k=h.clone().sub(this.saveEye).dot(q.D);k>e?(a.position.copy(this.saveEye.sub(q.D).clone().multiplyScalar(e)),P=e>0?-1:0):P=-(k/e)}else a.position.copy(h),this.center.copy(i);a.lookAt(this.center),c(!1)}}},this.walk=function(b,d,e,f,h){if(!this.navApi.getIsLocked()){var i=this.sceneUpDirection.clone(),j=this.sceneFrontDirection.clone(),l=this.sceneFrontDirection.clone().cross(this.sceneUpDirection),n=!0,o=.01;k(b,d)?(wheel.cursorImage("SWWalk"),m(!0,b,d),x=d.x,y=d.y):m(!1,b,d),x=b.x,y=b.y;var p=g(x-d.x,y-d.y),q=-p.x,r=-p.y,s=0>q?-1:1,t=0>r?-1:1,u=Math.abs(q),v=Math.abs(r),w=new THREE.Vector2(30,30);w=g(w.x,w.y),u=k(b,d)?0:Math.abs(q)-w.x,v=k(b,d)?0:Math.abs(r)-w.y;var z=.25;u/=z,v/=z,u=1>u?Math.easeClamp(u,0,1):Math.pow(u,1),v=1>v?Math.easeClamp(v,0,1):Math.pow(v,1);var A=u>0?u*s:0,B=v>0?v*t:0,C=this.getView(),D=C.length();C.normalize();var E=C.clone().cross(a.up);E.normalize();var F=l.clone().multiplyScalar(l.clone().dot(C)),G=j.clone().multiplyScalar(j.clone().dot(C)),H=G.clone().add(F);H=H.clone().length()>Number.MIN_VALUE?H.normalize():a.up;var I=1,J=B*(this.walkMultiplier*I),K=n?H:C;if(n){var L=Math.cos(.65);1!=L&&(i.clone().dot(a.up)<-Number.MIN_VALUE&&i.clone().dot(C)<-L||i.clone().dot(a.up)>Number.MIN_VALUE&&i.clone().dot(C)>L)&&(K=-K)}var M=-A*this.walkMultiplier*.05,N=a.up;n&&((i.clone().dot(a.up)<-Number.MIN_VALUE||Math.abs(i.clone().dot(a.up))<Number.MIN_VALUE&&i.clone().dot(C)>Number.MIN_VALUE)&&(M=-M),N=i);var O=(new THREE.Quaternion).setFromAxisAngle(N,M);O.normalize(),C=O.clone().rotate(C),C.normalize(),a.up.copy(O.clone().rotate(a.up)),a.up.normalize(),a.position.add(K.clone().multiplyScalar(J)),this.center.copy(a.position.clone().add(C.clone().multiplyScalar(D))),K=n?i:a.up,K.normalize(),0===J&&(J=o),a.lookAt(this.center),c(!1)}},this.updown=function(b){if(!this.navApi.getIsLocked()){var d=b,e=o(d);q.m_amount+=e;var f=new THREE.Vector3(0,1,0),g=q.saveEye.clone().sub(f.clone().multiplyScalar(q.m_amount)),h=g.clone().dot(f);a.position.copy(g),h<q.minSceneBound&&a.position.add(f.clone().multiplyScalar(q.minSceneBound-h)),h>q.maxSceneBound&&a.position.add(f.clone().multiplyScalar(q.maxSceneBound-h)),this.center.copy(a.position.clone().add(q.saveCenter.clone().sub(q.saveEye))),a.lookAt(this.center),c(!1)}},this.addHistoryElement=function(){},this.addIntermediateHistoryElement=function(){this.rewindParams.snapped?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.slideOffset.x>0?this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex):this.rewindParams.history=this.rewindParams.history.slice(0,this.rewindParams.timelineIndex+1),this.addHistoryElement()},this.clearHistory=function(){this.rewindParams.history.length=0,this.rewindParams.timelineIndex=0,this.rewindParams.timelineIndexSlide=0,this.rewindParams.resetWeights=!0},this.openTimeline=function(a){this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights&&(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=this.rewindParams.snappingEnabled),0===this.rewindParams.history.length&&this.addHistoryElement();for(var b=0;b<this.rewindParams.history.length;b++){var c=b-this.rewindParams.timelineIndex,d=this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize;this.rewindParams.history[b].thumbnailBounds.setCenter(new THREE.Vector2(a.x+c*d,a.y).add(this.rewindParams.slideOffset)),this.rewindParams.resetWeights&&(this.rewindParams.history[b].weight=b==this.rewindParams.timelineIndex?1:0)}this.rewindParams.resetWeights&&(this.rewindParams.resetWeights=!1);var d=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize);if(this.rewindParams.open=!0,this.rewindParams.openLocation=a.clone(),this.rewindParams.openLocationOrigin=a.clone(),this.rewindParams.openBracket=a.clone(),this.rewindParams.openBracketA=new THREE.Vector2(d,a.y),this.rewindParams.openBracketB=new THREE.Vector2(window.innerWidth-d,a.y),this.rewindParams.openBracketA.x>this.rewindParams.openBracketB.x){var e=this.rewindParams.openBracketA.x;this.rewindParams.openBracketA.x=this.rewindParams.openBracketB.x,this.rewindParams.openBracketB.x=e}this.rewindParams.locationOffset=new THREE.Vector2(0,0),this.rewindParams.snapOffset=new THREE.Vector2(0,0)},this.slideTimeline=function(a){if(this.rewindParams.open&&0!==this.rewindParams.history.length){var b=a.clone().add(this.rewindParams.locationOffset),c=2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),d=c,e=window.innerWidth-c,f=this.rewindParams.history[0].thumbnailBounds.center().x,g=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x,h=0;if(b.x<this.rewindParams.openBracketA.x){h=b.x-this.rewindParams.openBracketA.x;var i=f-h;i>d&&(h=Math.min(h+(i-d),0))}if(b.x>this.rewindParams.openBracketB.x){h=b.x-this.rewindParams.openBracketB.x;var j=g-h;e>j&&(h=Math.max(h+(j-e),0))}this.rewindParams.openLocation.x+=h,this.rewindParams.openBracketA.x+=h,this.rewindParams.openBracketB.x+=h,this.rewindParams.openBracket.x=b.x-(this.rewindParams.openLocation.x-this.rewindParams.openLocationOrigin.x);var k=new THREE.Vector2(-h,0),l=b.clone().sub(this.rewindParams.openLocation.clone().sub(this.rewindParams.openLocationOrigin));k.x+=this.rewindParams.snapOffset.x,this.rewindParams.snapOffset.x=0;var m=!1;if(this.rewindParams.snappingEnabled)for(var n=4,o=16,p=0;p<this.rewindParams.history.length;p++){var q=this.rewindParams.history[p].thumbnailBounds.center().add(k);if(Math.abs(q.x-l.x)<n||this.rewindParams.snapped&&Math.abs(q.x-l.x)<o){m=!0,0!==h?(this.rewindParams.snapOffset.x=q.x-l.x,k.x-=this.rewindParams.snapOffset.x):this.rewindParams.openBracket.x+=q.x-l.x,l.x=q.x;break}}this.rewindParams.snapped=m;for(var r=-1,s=0,t=0;t<this.rewindParams.history.length;t++){var u=this.rewindParams.history[t].thumbnailBounds.clone();if(this.rewindParams.history[t].thumbnailBounds.setCenter(this.rewindParams.history[t].thumbnailBounds.center().add(k)),this.rewindParams.history[t].thumbnail){var v=this.rewindParams.history[t].thumbnailBounds.center().x-this.rewindParams.thumbnailSize/2;$("#rewindFrame"+t).css("left",v),$("#rewindBorder"+t).css("left",v-4)}var w=new THREE.Vector2(2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize),2*(this.rewindParams.thumbnailGapSize+this.rewindParams.thumbnailSize));u.setFromCenterAndSize(u.center(),w);var x=new THREE.Vector2(0,0);u.getIcon2DCoords(l,x);var y=1-Math.abs(Math.equalityClamp(x.x,-1,1));this.rewindParams.history[t].weight=y,0===t&&l.x<u.center().x&&(this.rewindParams.history[t].weight=1),t===this.rewindParams.history.length-1&&l.x>u.center().x&&(this.rewindParams.history[t].weight=1),s+=this.rewindParams.history[t].weight,this.rewindParams.history[t].weight>r&&(r=this.rewindParams.history[t].weight,this.rewindParams.snappingEnabled&&1==this.rewindParams.history[t].weight?(this.rewindParams.slideOffset.x=0,this.rewindParams.snapped=!0):this.rewindParams.slideOffset.x=this.rewindParams.history[t].thumbnailBounds.center().x-l.x,this.rewindParams.timelineIndexSlide=t)}for(var z=0;z<this.rewindParams.history.length;z++)this.rewindParams.history[z].weight=this.rewindParams.history[z].weight/s;var A=this.rewindParams.history[0].thumbnailBounds.center().x,B=this.rewindParams.history[this.rewindParams.history.length-1].thumbnailBounds.center().x;this.rewindParams.openBracket.x<A?(this.rewindParams.locationOffset.x+=A-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=A):this.rewindParams.openBracket.x>B&&(this.rewindParams.locationOffset.x+=B-this.rewindParams.openBracket.x,this.rewindParams.openBracket.x=B)}},this.shiftBackOneElement=function(){0!==this.rewindParams.history.length&&(this.rewindParams.timelineIndex>0||0!==this.rewindParams.slideOffset.x)&&((this.rewindParams.snapped||this.rewindParams.slideOffset.x>0)&&this.rewindParams.timelineIndex--,this.rewindParams.timelineIndexSlide=this.rewindParams.timelineIndex,this.rewindParams.resetWeights=!0,q.elapsedTime=0,this.animateToRewindIndex())},this.animateToRewindIndex=function(){var b=this.rewindParams.timelineIndex,d=0;if(q.elapsedTime>=J.duration)d=1;else{var e=J.destinationPercent;d=Math.easeClamp(q.elapsedTime/J.duration,0,e),q.elapsedTime+=u/500}q.center.copy(q.center.clone().multiplyScalar(1-d).clone().add(this.rewindParams.history[b].camera.center.clone().multiplyScalar(d))),a.position.copy(a.position.clone().multiplyScalar(1-d).clone().add(this.rewindParams.history[b].camera.position.clone().multiplyScalar(d))),a.up.copy(this.rewindParams.history[b].camera.up),q.pivot.copy(q.center),a.lookAt(q.center),c(!1),this.cube&&requestAnimationFrame(this.cube.render),1!==d&&requestAnimationFrame(function(){q.animateToRewindIndex()})},this.closeTimeline=function(){this.rewindParams.timelineIndex!=this.rewindParams.timelineIndexSlide&&(this.rewindParams.timelineIndex=this.rewindParams.timelineIndexSlide),this.rewindParams.open=!1},this.getInterpolatedCamera=function(){var b=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,1,1e4);b.center=new THREE.Vector3(0,0,0),b.pivot=new THREE.Vector3(0,0,0),b.leftFov=0,b.rightFov=0,b.topFov=0,b.bottomFov=0,b.up.set(0,0,0);for(var d=0;d<this.rewindParams.history.length;d++){var e=this.rewindParams.history[d].camera,f=this.rewindParams.history[d].weight;b.center.add(e.center.clone().multiplyScalar(f)),b.position.add(e.position.clone().multiplyScalar(f)),b.up.add(e.up.clone().multiplyScalar(f)),b.rotation.add(e.rotation.clone().multiplyScalar(f)),b.pivot.add(e.pivot.clone().multiplyScalar(f)),b.leftFov+=e.leftFov*f,b.rightFov+=e.rightFov*f,b.topFov+=e.topFov*f,b.bottomFov+=e.bottomFov*f}a.position.copy(b.position),a.up.copy(b.up),a.rotation=b.rotation,a.leftFov=b.leftFov,a.rightFov=b.rightFov,a.topFov=b.topFov,a.bottomFov=b.bottomFov,q.center.copy(b.center),q.pivot.copy(b.pivot),a.lookAt(q.center),a.up.normalize(),c(!1)}};if(Autocam.ViewCube=function(a,b,c,d){function e(a,b){var c={};
return 0===a.type.indexOf("touch")?a.touches.length>0?(c.clientX=a.touches[0].clientX,c.clientY=a.touches[0].clientY,c.pageX=a.touches[0].pageX,c.pageY=a.touches[0].pageY,c.screenX=a.touches[0].screenX,c.screenY=a.touches[0].screenY,c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY,c.which=h.navApi.getUseLeftHandedInput()?3:1):c=b.prevCoords:(c.clientX=a.clientX,c.clientY=a.clientY,c.pageX=a.pageX,c.pageY=a.pageY,c.screenX=a.screenX,c.screenY=a.screenY,c.which=a.which,T?(c.movementX=a.movementX||a.mozMovementX||a.webkitMovementX||0,c.movementY=a.movementY||a.mozMovementY||a.webkitMovementY||0):(c.movementX=c.screenX-b.prevX,c.movementY=c.screenY-b.prevY)),b.prevX=c.screenX,b.prevY=c.screenY,b.prevCoords=c,c}var f=Autodesk.Viewing.Private,g=this,h=b,i=b.camera;b.setCube(this),g.currentFace="front";var j,k,l,m,n,o,p=["top,front","top right","top,left","top,back","bottom,front","bottom,right","bottom,left","bottom,back","left,front","front,right","right,back","back,left"],q=["front,top,right","back,top,right","front,top,left","back,top,left","front,bottom,right","back,bottom,right","front,bottom,left","back,bottom,left"],r=["Go Home",null,"Orthographic","Perspective","Perspective with Ortho Faces",null,"Set current view as Home","Focus and set as Home","Reset Home",null,"Set current view as Front","Set current view as Top","Reset orientation"],s=[!0,null,!0,!0,!0,null,!0,!0,!0,null,!0,!0,!0],t=[null,null,function(){return!h.orthographicFaces&&!i.isPerspective},function(){return!h.orthographicFaces&&i.isPerspective},function(){return h.orthographicFaces},null,null,null,null,null,null,null,null];g.camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),g.camera.position.copy(i.position),g.center=new THREE.Vector3(0,0,0),g.camera.lookAt(g.center);var u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=[],J=[],K=[],L=[],M=[],N=null,O=null,P=null,Q=0,R=0,S=!0,T=!1,U=!1,V=!1,W=-1!=navigator.userAgent.search("Chrome"),X=-1!=navigator.platform.search("Win32"),Y=!1,Z=!1,$=[];this.width=0,this.height=0,this.animSpeed=500,this.animate=!0,this.compass=!1,this.viewScaleFactorCompass=1.5,this.viewScale=1,this.draggable=!0,this.wantHomeButton=!1,this.wantRollArrows=!0,this.wantContextMenu=!0,this.inactiveOpacity=.5;var _=function(a){var b=a.getBoundingClientRect();return{x:b.left,y:b.top,w:b.width,h:b.height}},aa=function(a){a.preventDefault(),a.stopPropagation(),U=document.pointerLockElement===c||document.mozPointerLockElement===c||document.webkitPointerLockElement===c},ba=function(){var a=c.getBoundingClientRect();g.width=a.width,g.height=a.height,H=_(c),A=g.width/2,B=g.height/2,o=new THREE.PerspectiveCamera(70,g.height/g.width,1,1e4),o.position.set(0,0,500),j=new THREE.Scene,k=new THREE.Scene,l=new THREE.Scene,m=new THREE.Scene,n=new THREE.Scene,S=!0,Q=200,g.viewScale=3.5*Q;var b=THREE.LinearFilter,e=Autodesk.Viewing.Private.getResourceUrl,f="res/textures/",i=d||f,p=(new THREE.DDSLoader).load(e(i+"VCcrossRGBA8small.dds"));p.minFilter=p.maxFilter=b;var q=THREE.ShaderLib.cube,r=new THREE.ShaderMaterial({fragmentShader:q.fragmentShader,vertexShader:q.vertexShader,uniforms:THREE.UniformsUtils.clone(q.uniforms),depthWrite:!1});r.uniforms.tCube.value=p;var s=new THREE.BoxGeometry(Q,Q,Q,4,4,4),t=new THREE.BoxGeometry(Q+1,Q+1,Q+1,4,4,4);u=new THREE.Mesh(s,r),u.position.set(0,0,0),k.add(u);var I=fa(e(f+"VCedge1.png"));I.minFilter=I.maxFilter=b,v=new THREE.Mesh(t,new THREE.MeshBasicMaterial({map:I,overdraw:!1,transparent:!0,shading:THREE.SmoothShading})),v.position.set(0,0,0),m.add(v);var K=Q,M=new THREE.Geometry,N=new THREE.Vector3(-30,0,0),O=new THREE.Vector3(30,0,0),P=new THREE.Vector3(0,-30,0);M.vertices.push(N),M.vertices.push(O),M.vertices.push(P),M.faces.push(new THREE.Face3(1,0,2)),M.computeFaceNormals();var R=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),U=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),V=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),W=new THREE.MeshBasicMaterial({overdraw:!0,color:14540253,transparent:!1,opacity:1,shading:THREE.FlatShading}),X=new THREE.PlaneBufferGeometry(.5*Q,.3*Q,2,2),Y=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),Z=new THREE.Mesh(M,R),ba=new THREE.Mesh(X,Y);Z.position.set(0,K,0),ba.position.set(0,.9*K,.1);var ca=new THREE.Mesh(M,U),da=new THREE.Mesh(X,Y);ca.position.set(0,-K,0),da.position.set(0,.9*-K,.1),ca.rotation.z+=Math.PI,da.rotation.z+=Math.PI;var ea=new THREE.Mesh(M,V),ha=new THREE.Mesh(X,Y);ea.position.set(K,0,0),ha.position.set(.9*K,0,.1),ea.rotation.z-=Math.PI/2,ha.rotation.z-=Math.PI/2;var ia=new THREE.Mesh(M,W),ka=new THREE.Mesh(X,Y);ia.position.set(-K,0,0),ka.position.set(.9*-K,0,.1),ia.rotation.z+=Math.PI/2,ka.rotation.z+=Math.PI/2,z=new THREE.Object3D,z.position.set(0,0,0),z.add(Z),z.add(ca),z.add(ea),z.add(ia),n.add(ba),n.add(da),n.add(ha),n.add(ka),n.add(z),J.push(ba),J.push(da),J.push(ha),J.push(ka);var la=new THREE.PlaneBufferGeometry(Q/3,Q/3,2,2),ma=new THREE.MeshBasicMaterial({map:fa(e(f+"VChome.png")),transparent:!0,shading:THREE.FlatShading});w=new THREE.Mesh(la,ma),w.position.set(-Q,Q,0),F=L.length,n.add(w),L.push(w);var oa=new THREE.PlaneBufferGeometry(1.5*Q,1.5*Q,2,2),pa=new THREE.MeshBasicMaterial({map:fa(e(f+"VCarrows.png")),shading:THREE.FlatShading,transparent:!0}),qa=new THREE.Mesh(oa,pa);qa.position.set(.5*Q+20,.5*Q+20,0);var ra=new THREE.PlaneBufferGeometry(.6*Q,.45*Q,2,2),sa=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),ta=new THREE.Mesh(ra,sa);ta.position.set(.5*Q+20,Q+20,.1);var ua=new THREE.PlaneBufferGeometry(.45*Q,.6*Q,2,2),va=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),wa=new THREE.Mesh(ua,va);wa.position.set(Q+20,.5*Q+20,.1),n.add(qa),n.add(ta),n.add(wa),C=L.length,L.push(ta),D=L.length,L.push(wa),E=L.length,L.push(qa);var xa=new THREE.PlaneBufferGeometry(Q/2.3,Q/2.3,2,2),ya=new THREE.MeshBasicMaterial({map:fa(e(f+"VCcontext.png")),transparent:!0,shading:THREE.FlatShading});y=new THREE.Mesh(xa,ya),y.position.set(Q,-Q,0),G=L.length,n.add(y),L.push(y);var za=new THREE.Geometry;za.vertices.push(new THREE.Vector3(0,0,0)),za.vertices.push(new THREE.Vector3(-Q/2,-Q/2-20,-Q/2)),za.vertices.push(new THREE.Vector3(Q/2,-Q/2-20,-Q/2)),za.vertices.push(new THREE.Vector3(Q/2,-Q/2-20,Q/2)),za.vertices.push(new THREE.Vector3(-Q/2,-Q/2-20,Q/2)),za.faces.push(new THREE.Face3(4,3,2)),za.faces.push(new THREE.Face3(4,2,1));var Aa;Aa=new THREE.MeshBasicMaterial({color:0,transparent:!0,opacity:.5}),x=new THREE.Mesh(za,Aa),j.add(x),ga(),"CANVAS"===h.renderer.toUpperCase()?g.renderer=new THREE.CanvasRenderer:"WEBGL"===h.renderer.toUpperCase()?g.renderer=new FireflyWebGLRenderer({alpha:!0,antialias:!0}):(console.log("Incorrect use of Autocam.renderer property"),g.renderer=new THREE.CanvasRenderer),g.useTransparency(!0),g.setSize(g.width,g.height),g.camera.topFov=g.camera.bottomFov=g.camera.fov/2,g.camera.leftFov=g.camera.rightFov=g.camera.aspect*g.camera.fov/2,g.renderer.autoClear=!1,g.renderer.setSize(g.width,g.height),g.renderer.sortObjects=!1,c.appendChild(g.renderer.domElement),c.addEventListener("touchstart",ja,!1),c.addEventListener("mousedown",ja,!1),c.addEventListener("mousemove",na,!1),T=!1,T&&(document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock,c.requestPointerLock=c.requestPointerLock||c.mozRequestPointerLock||c.webkitRequestPointerLock,document.addEventListener("pointerlockchange",aa,!1),document.addEventListener("mozpointerlockchange",aa,!1),document.addEventListener("webkitpointerlockchange",aa,!1)),$.push(fa(e(f+"VChomeS.png"))),$.push(fa(e(f+"VCarrowsS0.png"))),$.push(fa(e(f+"VCarrowsS1.png"))),$.push(fa(e(f+"VChome.png"))),$.push(fa(e(f+"VCarrows.png"))),$.push(fa(e(f+"VCcontext.png"))),$.push(fa(e(f+"VCcontextS.png")))},ca=function(){h.navApi.getIsLocked()||(c.style.opacity="1.0",Z=!1),requestAnimationFrame(g.render)},da=function(a){if(Z||h.viewCubeMenuOpen||h.navApi.getIsLocked())h.navApi.getIsLocked()||(c.style.opacity=1);else{var b=Math.max(4*Math.abs((a.clientX-H.x)/H.w-.5)-1,0),d=Math.max(4*Math.abs((a.clientY-H.y)/H.h-.5)-1,0),e=Math.max(0,Math.min(Math.sqrt(b*b+d*d),1));c.style.opacity=1-e*(1-g.inactiveOpacity)}},ea=function(){h.viewCubeMenuOpen||(c.style.opacity=g.inactiveOpacity,Z=!0,requestAnimationFrame(g.render))},fa=function(a){var b=new Image,c=auth&&(-1===a.indexOf("://")||-1!==a.indexOf(window.location.host));c?b.crossOrigin="use-credentials":b.crossOrigin="anonymous";var d=new THREE.Texture(b);return b.onload=function(){d.needsUpdate=!0,R++,R>=11&&requestAnimationFrame(g.render)},b.src=a,d},ga=function(){var a,b=[],c=[];b[0]=ra(0,0),b[1]=ra(0,Math.PI/2),b[2]=ra(0,-Math.PI/2),b[3]=ra(0,Math.PI),b[4]=ra(Math.PI/2,0),b[5]=ra(Math.PI/2,Math.PI/2),b[6]=ra(Math.PI/2,-Math.PI/2),b[7]=ra(Math.PI/2,Math.PI),c[0]=qa(0,0,0),c[1]=qa(0,Math.PI/2,0),c[2]=qa(0,-Math.PI/2,0),c[3]=qa(0,Math.PI,0),c[4]=qa(Math.PI/2,0,0),c[5]=qa(Math.PI/2,Math.PI/2,0),c[6]=qa(Math.PI/2,-Math.PI/2,0),c[7]=qa(Math.PI/2,Math.PI,0),c[8]=qa(0,0,Math.PI/2),c[9]=qa(0,0,-Math.PI/2),c[10]=qa(-Math.PI/2,0,-Math.PI/2),c[11]=qa(-Math.PI,0,-Math.PI/2),I.push(pa(0,0)),I[0].name="front",K.push(I[0]),M.push(I[0]),l.add(I[0]),I.push(pa(0,Math.PI/2)),I[1].name="right",K.push(I[1]),M.push(I[1]),l.add(I[1]),I.push(pa(0,Math.PI)),I[2].name="back",K.push(I[2]),M.push(I[2]),l.add(I[2]),I.push(pa(0,-Math.PI/2)),I[3].name="left",K.push(I[3]),M.push(I[3]),l.add(I[3]),I.push(pa(Math.PI/2,0)),I[4].name="bottom",K.push(I[4]),M.push(I[4]),l.add(I[4]),I.push(pa(-Math.PI/2,0)),I[5].name="top",K.push(I[5]),M.push(I[5]),l.add(I[5]),a=I.length;var d;for(d=0;d<b.length;d++)I.push(b[d]),I[a+d].name=q[d],l.add(I[a+d]),K.push(I[a+d]),M.push(I[a+d]);for(a=I.length,d=0;d<c.length;d++)I.push(c[d]),I[a+d].name=p[d],l.add(I[a+d]),K.push(I[a+d]),M.push(I[a+d])},ha=function(a,b,c){var d,e,f=new THREE.Vector3;return f.copy(a),f=f.unproject(b),d=new THREE.Raycaster(b.position,f.sub(b.position).normalize()),e=d.intersectObjects(c)},ia=function(a,b){var c=a.clientX-b.x,d=a.clientY-b.y;return c=c/b.w*2-1,d=(b.h-d)/b.h*2-1,new THREE.Vector3(c,d,.5)},ja=function(a){if(a.preventDefault(),a.stopPropagation(),!h.navApi.getIsLocked()&&!h.currentlyAnimating){var b=e(a,g);H=_(c),c.removeEventListener("mousemove",na,!1),document.addEventListener("mouseup",ma,!1),document.addEventListener("touchend",ma,!1),h.navApi.getUsePivotAlways()||(h.pivot.copy(h.center),h.navApi.setPivotPoint(h.center),h.navApi.setPivotSetFlag(!1)),h.startInteraction(b.pageX,b.pageY);var d,f;0==h.rewindParams.history.length&&h.addHistoryElement(),h.rewindParams.snapped&&h.rewindParams.timelineIndex+1==h.rewindParams.history.length||h.addIntermediateHistoryElement();var i=h.navApi.getUseLeftHandedInput()?1:3;if(b.which!==i){if(g.animSpeed<=0)return void console.error("animSpeed cannot be 0 or less, use ViewCube.animate flag to turn on and off animation");f=ia(b,H),d=ha(f,g.camera,M),d.length>0&&(ua(),g.draggable&&(document.addEventListener("mousemove",ka,!1),document.addEventListener("touchmove",ka,!1),T&&(c.requestPointerLock(),V=W&&X)))}}},ka=function(a){if(a.preventDefault(),a.stopPropagation(),g.animSpeed<=0)return document.removeEventListener("mousemove",ka,!1),document.removeEventListener("touchmove",ka,!1),void console.error("animSpeed cannot be 0 or less");if(!h.currentlyAnimating){var b=e(a,g);if(T&&V&&(V=!1,b.movementX=b.movementY=0),U&&(b.movementX>300||b.movementY>300)&&(b.movementX=0,b.movementY=0),b.movementX===b.movementY&&0===b.movementX)return void(h.currentlyAnimating=!1);S=!1,Y=!0,h.showPivot(!0),h.currentCursor=new THREE.Vector2(b.pageX,b.pageY),h.orbit(h.currentCursor,h.startCursor,new THREE.Vector3(-b.movementX,b.movementY,0),h.startState),g.camera.lookAt(g.center),requestAnimationFrame(g.render)}},la=function(a){a||(document.removeEventListener("mouseup",ma,!1),document.removeEventListener("touchend",ma,!1)),document.removeEventListener("mousemove",ka,!1),document.removeEventListener("touchmove",ka,!1),c.addEventListener("mousemove",na,!1),U&&document.exitPointerLock()},ma=function(a){a.preventDefault(),a.stopPropagation();var b,d,j;if(h.currentlyAnimating||Y)return h.endInteraction(),h.showPivot(!1),Y=!1,void la(!1);var k=e(a,g);if(h.viewCubeMenuOpen){var l=k.clientX-H.x,m=k.clientY-H.y;if(h.menuOrigin.x<=l&&l<=h.menuOrigin.x+h.menuSize.x&&h.menuOrigin.y<=m&&m<=h.menuOrigin.y+h.menuSize.y){var n=Math.floor((m-5-h.menuOrigin.y)/25),p=function(a){f.logger&&f.logger.log({category:"navigation",name:a})};switch(n){case 0:p("home"),h.goHome();break;case 1:p("setortho"),h.setOrthographicFaces(!1),h.toOrthographic();break;case 2:p("setpersp"),h.setOrthographicFaces(!1),h.toPerspective();break;case 3:h.setOrthographicFaces(!0),S?h.toOrthographic():h.toPerspective();break;case 4:p("sethome"),h.setCurrentViewAsHome(!1);break;case 5:p("focushome"),h.setCurrentViewAsHome(!0);break;case 6:p("resethome"),h.resetHome();break;case 7:p("setfront"),h.setCurrentViewAsFront();break;case 8:p("settop"),h.setCurrentViewAsTop();break;case 9:h.resetOrientation()}}return h.viewCubeMenuOpen=!1,h.removeDropdownMenu(c),(k.clientX<H.x||k.clientX>H.w+H.x||k.clientY<H.y||k.clientY>H.h+H.y)&&ea(),g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave),void la(!1)}var q=h.navApi.getUseLeftHandedInput()?1:3;if(k.which===q)return h.viewCubeMenuOpen=!0,h.drawDropdownMenu(r,s,t,k.clientX,k.clientY,c,H),void la(!0);var u=ia(k,H);if(b=ha(u,g.camera,M),d=ha(u,o,J),j=ha(u,o,L),d.length>0&&S){var v=h.getOrientation();switch(g.currentFace){case"front":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case"right":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case"left":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case"back":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[1]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[2]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[3]&&(h.calculateCubeTransform("top"),g.currentFace="top");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("bottom"),g.currentFace="bottom"):d[0].object===J[1]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[2]?(h.calculateCubeTransform("top"),g.currentFace="top"):d[0].object===J[3]&&(h.calculateCubeTransform("bottom"),g.currentFace="bottom")}break;case"top":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front")}break;case"bottom":switch(v){case"up":d[0].object===J[0]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[1]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[2]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[3]&&(h.calculateCubeTransform("left"),g.currentFace="left");break;case"right":d[0].object===J[0]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[1]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[2]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[3]&&(h.calculateCubeTransform("front"),g.currentFace="front");break;case"down":d[0].object===J[0]?(h.calculateCubeTransform("back"),g.currentFace="back"):d[0].object===J[1]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[2]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[3]&&(h.calculateCubeTransform("right"),g.currentFace="right");break;case"left":d[0].object===J[0]?(h.calculateCubeTransform("left"),g.currentFace="left"):d[0].object===J[1]?(h.calculateCubeTransform("right"),g.currentFace="right"):d[0].object===J[2]?(h.calculateCubeTransform("front"),g.currentFace="front"):d[0].object===J[3]&&(h.calculateCubeTransform("back"),g.currentFace="back")}}h.elapsedTime=0,h.sphericallyInterpolateTransition()}if(j.length>0){if(h.elapsedTime=0,g.wantHomeButton&&j[0].object===L[F])return h.goHome(),void la(!1);if(g.wantContextMenu&&j[0].object===L[G])return h.viewCubeMenuOpen=!0,h.drawDropdownMenu(r,s,t,k.clientX,k.clientY,c,H),void la(!0);if(g.wantRollArrows&&S&&(j[0].object===L[C]||j[0].object===L[D])){var w=j[0].object===L[D],x={center:h.center.clone(),position:i.position.clone(),pivot:i.pivot.clone(),fov:i.fov,worldUp:h.sceneUpDirection.clone(),isOrtho:i.isPerspective===!1},y=h.center.clone().sub(i.position).normalize();w?x.up=i.up.clone().cross(y):(x.up=i.up.clone().multiplyScalar(-1),x.up.cross(y)),x.up.normalize(),h.elapsedTime=0,h.animateTransition(x)}}b.length>0&&(g.currentFace=b[0].object.name,h.orthographicFaces&&-1!==g.currentFace.indexOf(",")&&h.setCameraOrtho(!1),h.calculateCubeTransform(g.currentFace),h.elapsedTime=0,g.mouseMoveSave=a,h.sphericallyInterpolateTransition(function(){g.mouseMoveSave&&g.processMouseMove(g.mouseMoveSave)})),la(!1)};this.processMouseMove=function(a){var b,c,d;if(h.viewCubeMenuOpen||h.currentlyAnimating)return void(g.mouseMoveSave=a);g.mouseMoveSave=null;var f=e(a,g),i=ia(f,H);if(b=ha(i,g.camera,K),c=ha(i,o,J),d=ha(i,o,L),N&&!Y&&(N.material.color.setHex(14540253),N=null,requestAnimationFrame(g.render)),c.length>0&&!Y){N=c[0].object;for(var j=z.children.length;--j>=0;)if(N===J[j]){N=z.children[j],N.material.color.setHex(45055);break}requestAnimationFrame(g.render)}O&&!Y&&(O.material.opacity=0,O=null,requestAnimationFrame(g.render)),b.length>0&&!Y&&(O=b[0].object,O.material.opacity=.3,requestAnimationFrame(g.render)),d.length>0&&!Y?P!==d[0].object&&(g.wantHomeButton&&d[0].object===L[F]?(P=d[0].object,L[F].material.map=$[0]):g.wantRollArrows&&d[0].object===L[C]?(P=d[0].object,L[E].material.map=$[1]):g.wantRollArrows&&d[0].object===L[D]?(P=d[0].object,L[E].material.map=$[2]):g.wantContextMenu&&d[0].object===L[G]?(P=d[0].object,L[G].material.map=$[6]):g.wantHomeButton&&P===L[F]?(P=null,L[F].material.map=$[3]):!g.wantRollArrows||P!==L[C]&&P!==L[D]&&P!==L[E]?g.wantContextMenu&&P===L[G]&&(P=null,L[G].material.map=$[5]):(P=null,L[E].material.map=$[4]),requestAnimationFrame(g.render)):null===P||Y||(g.wantHomeButton&&P===L[F]?(P=null,L[F].material.map=$[3]):!g.wantRollArrows||P!==L[C]&&P!==L[D]&&P!==L[E]?g.wantContextMenu&&P===L[G]&&(P=null,L[G].material.map=$[5]):(P=null,L[E].material.map=$[4]),requestAnimationFrame(g.render))};var na=function(a){h.navApi.getIsLocked()||g.processMouseMove(a)},oa=function(){H=_(c),g.width=c.offsetWidth,g.height=c.offsetHeight,A=g.width/2,B=g.height/2,g.camera.aspect=g.width/g.height,g.camera.updateProjectionMatrix(),g.camera.topFov=g.camera.bottomFov=g.camera.fov/2,g.camera.leftFov=g.camera.rightFov=g.camera.aspect*g.camera.fov/2,g.renderer.setSize(g.width,g.height),requestAnimationFrame(g.render)},pa=function(a,b){var c,d=45,e=60,f=d+e,g=new THREE.Geometry,h=new THREE.Vector3(0,0,0),i=new THREE.Vector3(e,-e,f),j=new THREE.Vector3(e,e,f),k=new THREE.Vector3(-e,e,f),l=new THREE.Vector3(-e,-e,f);return g.vertices.push(h),g.vertices.push(i),g.vertices.push(j),g.vertices.push(k),g.vertices.push(l),g.faces.push(new THREE.Face3(1,2,3)),g.faces.push(new THREE.Face3(1,3,4)),g.applyMatrix((new THREE.Matrix4).makeRotationX(a)),g.applyMatrix((new THREE.Matrix4).makeRotationY(b)),g.computeFaceNormals(),g.computeVertexNormals(),c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),new THREE.Mesh(g,c)},qa=function(a,b,c){var d,e,f=45,g=60,h=f+g,i=new THREE.Geometry,j=new THREE.Vector3(g,h,h),k=new THREE.Vector3(-g,h,h),l=new THREE.Vector3(-g,g,h),m=new THREE.Vector3(g,g,h),n=new THREE.Vector3(g,h,g),o=new THREE.Vector3(-g,h,g),p=new THREE.Vector3(-g,h,h),q=new THREE.Vector3(g,h,h);return i.vertices.push(j),i.vertices.push(k),i.vertices.push(l),i.vertices.push(m),i.vertices.push(n),i.vertices.push(o),i.vertices.push(p),i.vertices.push(q),i.faces.push(new THREE.Face3(0,1,2)),i.faces.push(new THREE.Face3(0,2,3)),i.faces.push(new THREE.Face3(4,5,6)),i.faces.push(new THREE.Face3(4,6,7)),i.applyMatrix((new THREE.Matrix4).makeRotationX(a)),i.applyMatrix((new THREE.Matrix4).makeRotationY(b)),i.applyMatrix((new THREE.Matrix4).makeRotationZ(c)),i.computeFaceNormals(),i.computeVertexNormals(),d=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),e=new THREE.Mesh(i,d)},ra=function(a,b){var c,d,e=45,f=60,g=e+f,h=new THREE.Geometry,i=new THREE.Vector3(g,g,g),j=new THREE.Vector3(f,g,g),k=new THREE.Vector3(f,f,g),l=new THREE.Vector3(g,f,g),m=new THREE.Vector3(g,g,f),n=new THREE.Vector3(g,g,g),o=new THREE.Vector3(g,f,g),p=new THREE.Vector3(g,f,f),q=new THREE.Vector3(g,g,g),r=new THREE.Vector3(g,g,f),s=new THREE.Vector3(f,g,f),t=new THREE.Vector3(f,g,g);return h.vertices.push(i),h.vertices.push(j),h.vertices.push(k),h.vertices.push(l),h.vertices.push(m),h.vertices.push(n),h.vertices.push(o),h.vertices.push(p),h.vertices.push(q),h.vertices.push(r),h.vertices.push(s),h.vertices.push(t),h.faces.push(new THREE.Face3(0,1,2)),h.faces.push(new THREE.Face3(0,2,3)),h.faces.push(new THREE.Face3(4,5,6)),h.faces.push(new THREE.Face3(4,6,7)),h.faces.push(new THREE.Face3(8,9,10)),h.faces.push(new THREE.Face3(8,10,11)),h.applyMatrix((new THREE.Matrix4).makeRotationX(a)),h.applyMatrix((new THREE.Matrix4).makeRotationY(b)),h.computeFaceNormals(),h.computeVertexNormals(),c=new THREE.MeshBasicMaterial({overdraw:!0,opacity:0,color:45055,transparent:!0}),d=new THREE.Mesh(h,c)},sa=function(a){var b=h.cubeFront.clone(),c=h.sceneUpDirection.clone(),d=b.clone().cross(c);c.copy(d).cross(b),b.normalize(),c.normalize(),d.normalize();var e=new THREE.Vector3(b.x,c.x,d.x).multiplyScalar(a.x);return e.add(new THREE.Vector3(b.y,c.y,d.y).multiplyScalar(a.y)),e.add(new THREE.Vector3(b.z,c.z,d.z).multiplyScalar(a.z)),e};this.render=function(){var a=g.compass?g.viewScaleFactorCompass*g.viewScale:g.viewScale,b=h.center.clone().sub(i.position).normalize(),c=i.up.normalize();b=sa(b),c=sa(c),g.camera.position.copy(b),g.camera.position.multiplyScalar(-a/g.camera.position.length()),g.camera.up=c.normalize(),g.camera.lookAt(g.center),ta();var d=g.renderer;d&&(d.clear(),d.render(j,g.camera),d.render(k,g.camera),d.render(m,g.camera),d.render(l,g.camera),d.render(n,o))};var ta=function(){S=h.isFaceView(),!S||Z||h.currentlyAnimating?ua():va(),Z?wa():xa(),Z?ya():za()},ua=function(){n.remove(z),L[E].material.opacity=0,L[G].material.opacity=0},va=function(){n.add(z);var a=g.wantRollArrows?1:0;L[E].material.opacity=a,L[G].material.opacity=a},wa=function(){y.material.opacity=0},xa=function(){y.material.opacity=g.wantContextMenu?1:0},ya=function(){w.material.opacity=0},za=function(){w.material.opacity=g.wantHomeButton?1:0};this.refreshCube=function(){oa()},this.setSize=function(a,b){if(g.width=a,g.height=b,c.children.length>1)for(var d=1;d<c.children.length;d++)c.children[d].style.bottom=(g.height/5).toString()+"px";oa()},this.useTransparency=function(a){Z=a,a?(c.onmouseover=ca,c.onmousemove=da,c.onmouseout=ea,ea()):(c.onmouseover=null,c.onmouseout=null,c.onmousemove=null,c.style.opacity="1.0")},this.dtor=function(){this.renderer=null},ba()},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,ZERO:48,SEMICOLONMOZ:59,EQUALSMOZ:61,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,LCOMMAND:91,RCOMMAND:93,DASHMOZ:109,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,DASHMOZNEW:173,SEMICOLON:186,EQUALS:187,COMMA:188,DASH:189,PERIOD:190,SLASH:191,LBRACKET:219,RBRACKET:221,SINGLEQUOTE:222,COMMANDMOZ:224},Autodesk.Viewing.ToolController=function(a,b,c,d,e){function f(a,c){return b.navigation.getUseLeftHandedInput()&&0===a||h&&1===a||g&&!j&&0===a&&c.ctrlKey}this.domElement=b.canvasWrap,this.selector=a.selector,this.autocam=c,this.lastClickX=-1,this.lastClickY=-1,this.scrollInputEnabled=!0;var g=-1!=navigator.userAgent.search("Mac OS"),h=-1!=navigator.userAgent.search("Firefox"),i=-1!==navigator.userAgent.search("Chrome"),j=-1!==navigator.userAgent.search("Safari")&&!i,k=(2*Math.PI,0),m=2,n=2,o=500,p={},q=[],r=!1,s=-1,t=-1,u=!1,v=null,w=void 0,x=!1,y={},z=this,A=Autodesk.Viewing.KeyCode;this.__registerToolByName=function(a,b){p[b]=a},this.registerTool=function(a){var b=a.getNames();if(!b||0==b.length)return console.log("Cannot register tool with no name."),!1;for(var c=!1,e=0;e<b.length;++e)"default"!==b[e]&&(this.__registerToolByName(a,b[e]),c=!0);return a.utilities=d,a.controller=this,a.register&&a.register(),c},this.deregisterTool=function(a){this.deactivateTool(a.getName());var b=a.getNames();if(!b||0==b.length)return!1;for(var c=b.length;--c>=0;)this.__deregisterToolName(b[c]);return a.deregister&&a.deregister(),a.utilities=null,a.controller=null,!0},this.__deregisterToolName=function(a){function b(a){for(var b=q.length;--b>=0;)q[b].activeName===a&&(p[a].deactivate(a),q.splice(b,1))}a in p&&(b(a),delete p[a])},this.getTool=function(a){return p[a]},this.getActiveToolName=function(){var a=q.length;return a>0?q[a-1].activeName:"default"},this.getActiveTool=function(){return q.length?q[l-1]:p["default"]},this.activateTool=function(c){if(r)return!1;var d=p[c];if(d){var e=null;return q.length&&"intercept"===q[q.length-1].activeName&&(e=q.pop()),d.activeName=c,q.push(d),d.activate(c,b),e&&q.push(e),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:c,tool:d,active:!0}),a.log({category:"tool_changed",name:c}),!0}return stderr("activateTool not found: "+c),!1},this.deactivateTool=function(a){if(r)return!1;for(var c=q.length;--c>=0;)if(q[c].activeName===a)return q.splice(c,1),p[a].deactivate(a),b.fireEvent({type:Autodesk.Viewing.TOOL_CHANGE_EVENT,toolName:a,tool:q[c],active:!1}),!0;return stderr("deactivateTool not found: "+a),!1},this.getToolNames=function(){return Object.keys(p)},this.setDefaultTool=function(a){var b=this.getDefaultTool();return a&&a!==b?(this.__registerToolByName(a,"default"),b&&b.deactivate("default"),a.activate("default"),!0):!1},this.getDefaultTool=function(){return p["default"]},this.setDefaultTool(e),this.setIsLocked=function(a){var b=r;return r=!!a,b},this.getIsLocked=function(){return r},this.__checkCursor=function(){for(var a=null,c=q.length;--c>=0;){var d=q[c];if(d.getCursor&&(a=d.getCursor()))break}a||(a="auto"),v!=a&&(b.canvas.style.cursor=a,v=a)},
this.update=function(a){this.__checkCursor();var c=!1;d&&d.update()&&(c=!0);for(var e=q.length;--e>=0;){var f=q[e];f.update&&f.update(a)&&(c=!0)}if(b.navigation.getCamera().dirty?(b.navigation.updateCamera(),c=!0,this.cameraUpdated=!0):this.cameraUpdated=!1,c)b.navigation.updateCamera(),this.moveDelay=Date.now()+150;else if(0!==this.moveDelay){var g=this.moveDelay-Date.now();g>0?c=!0:this.moveDelay=0}return c},this.__clientToCanvasCoords=function(b,c,d){var e=a.canvas.getBoundingClientRect(),f=e.width,g=e.height,h=b.clientX-e.left,i=b.clientY-e.top;b.canvasX=h,b.canvasY=i,b.normalizedX=h/f*2-1,b.normalizedY=(g-i)/g*2-1,c&&c.set(h/f,i/g,0),d&&d.set(h,i)},this.__invokeStack=function(a,b,c){for(var d=q.length;--d>=0;){var e=q[d];if(e[a]&&e[a](b,c))return!0}var f=this.getDefaultTool();return f[a]&&f[a](b,c)?!0:!1},this.distributeEvent=function(a,b,c){return this.__invokeStack(a,b,c)},this.handleResize=function(){b.navigation.setScreenViewport(b.container.getBoundingClientRect());for(var a=q.length;--a>=0;){var c=q[a];c.handleResize&&c.handleResize()}},this.handleSingleClick=function(a){var b=this.applyButtonMappings(a);this.lastClickX=a.clientX,this.lastClickY=a.clientY,this.__invokeStack("handleSingleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleClick=function(a){var b=this.applyButtonMappings(a);this.__invokeStack("handleDoubleClick",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleSingleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleSingleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleDoubleTap=function(a){this.lastClickX=a.canvasX,this.lastClickY=a.canvasY,this.__invokeStack("handleDoubleTap",a)&&(a.preventDefault(),a.stopPropagation())},this.handleWheelInput=function(a,b){this.__invokeStack("handleWheelInput",a)&&(b.preventDefault(),b.stopPropagation())},this.applyButtonMappings=function(a){var c=a.button;return"buttons"in a&&(a.firefoxSpoof?c=k:!u||1&a.buttons?c===m&&1&a.buttons&&(c=k,a.firefoxSpoof=u=!0):(a.firefoxSpoof=!0,u=!1,c=k)),b.navigation.getUseLeftHandedInput()&&(c=c===k?m:c===m?k:c),c},this.applyKeyMappings=function(a,b){switch(a.keyCode){case A.LCOMMAND:case A.RCOMMAND:case A.COMMANDMOZ:return g&&a.metaKey&&a.shiftKey?null:A.CONTROL;case A.SHIFT:return b&&g&&a.metaKey?null:A.SHIFT;case A.EQUALSMOZ:return A.EQUALS;case A.DASHMOZNEW:case A.DASHMOZ:return A.DASH}return a.keyCode},this.handleKeyDown=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleKeyUp=function(a){var b=this.applyKeyMappings(a,!0);b&&this.__invokeStack("handleKeyUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonDown=function(a,b){this.__invokeStack("handleButtonDown",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleButtonUp=function(a,b){this.__invokeStack("handleButtonUp",a,b)&&(a.preventDefault(),a.stopPropagation())},this.handleMouseMove=function(a){this.__invokeStack("handleMouseMove",a)&&(a.preventDefault(),a.stopPropagation())},this.handleBlur=function(a){this.__invokeStack("handleBlur",a)&&(a.preventDefault(),a.stopPropagation())},this.keydown=function(a){if(!(!z.domElement.contains(w)||document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement)){if(document.activeElement){var b=document.activeElement.getAttribute("contenteditable");if("true"===b||""===b)return}g&&a.metaKey&&a.keyCode!=A.LCOMMAND&&a.keyCode!=A.RCOMMAND||z.handleKeyDown(a)}},this.keyup=function(a){g&&a.metaKey&&a.keyCode!=A.LCOMMAND&&a.keyCode!=A.RCOMMAND||z.handleKeyUp(a)},this.mousedown=function(a){function b(a){var d=z.applyButtonMappings(a);d===c&&(document.removeEventListener("mouseup",b),z.mouseup(a))}_isIE11&&inFullscreen()||document.activeElement.blur(),z.__clientToCanvasCoords(a);var c=z.applyButtonMappings(a);if(z.handleButtonDown(a,c),s=a.canvasX,t=a.canvasY,f(c,a)){var d=y,e=void 0!==d.time&&a.timeStamp-d.time<o,g=void 0!==d.x&&void 0!==d.y&&Math.abs(d.x-a.canvasX)<=n&&Math.abs(d.y-a.canvasY)<=n;(!e||!g||d.clickCount&&2<=d.clickCount)&&(d.clickCount=0),d.clickCount?1===d.clickCount&&(d.clickCount=2):(d.clickCount=1,d.x=a.canvasX,d.y=a.canvasY,d.time=a.timeStamp)}document.addEventListener("mouseup",b,!1),z.registerWindowMouseMove()},this.mousemove=function(a){z.__clientToCanvasCoords(a);var b=s-a.canvasX,c=t-a.canvasY;(Math.abs(b)>n||Math.abs(c)>n)&&(s=-1,t=-1),z.handleMouseMove(a)},this.mouseup=function(a){z.__clientToCanvasCoords(a);var b=z.applyButtonMappings(a);z.handleButtonUp(a,b);var c=s-a.canvasX,d=t-a.canvasY;if(s=-1,t=-1,Math.abs(c)<=n&&Math.abs(d)<=n&&z.handleSingleClick(a),f(b,a)){var e=y;2===e.clickCount&&(z.handleDoubleClick(a),e.clickCount=0,e.x=void 0,e.y=void 0,e.time=void 0)}z.unregisterWindowMouseMove()},this.doubleclick=function(a){z.__clientToCanvasCoords(a),s=a.canvasX,t=a.canvasY,z.handleDoubleClick(a)},this.mousewheel=function(a){if(z.scrollInputEnabled){var b=0;a.wheelDelta?b=a.wheelDelta/40:a.detail&&(b=-a.detail),z.handleWheelInput(b,a)}},this.blur=function(a){z.handleBlur(a)},this.mouseover=function(a){w=a.target},this.registerWindowMouseMove=function(){window.addEventListener("mousemove",z.mousemove),window.addEventListener("mouseover",z.mouseover),z.domElement.removeEventListener("mousemove",z.mousemove),z.domElement.removeEventListener("mouseover",z.mouseover)},this.unregisterWindowMouseMove=function(){window.removeEventListener("mousemove",z.mousemove),window.removeEventListener("mouseover",z.mouseover),z.domElement.addEventListener("mousemove",z.mousemove),z.domElement.addEventListener("mouseover",z.mouseover)},this.enableMouseButtons=function(a){a&&!x?(this.domElement.addEventListener("mousedown",this.mousedown),this.domElement.addEventListener("dblclick",this.doubleclick),this.domElement.addEventListener("mousemove",this.mousemove),this.domElement.addEventListener("mouseover",this.mouseover)):!a&&x&&(this.domElement.removeEventListener("mousedown",this.mousedown),this.domElement.removeEventListener("dblclick",this.doubleclick),this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover));var b=x;return x=a,b},this.enableMouseButtons(!0),this.domElement.addEventListener("mousewheel",this.mousewheel,!1),this.domElement.addEventListener("DOMMouseScroll",this.mousewheel,!1),window.addEventListener("keydown",this.keydown,!1),window.addEventListener("keyup",this.keyup,!1),window.addEventListener("blur",this.blur,!1),this.uninitialize=function(){x&&(this.domElement.removeEventListener("mousemove",this.mousemove),this.domElement.removeEventListener("mouseover",this.mouseover),window.removeEventListener("mousemove",z.mousemove),window.removeEventListener("mouseover",z.mouseover)),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup),window.removeEventListener("blur",this.blur),this.domElement=null,this.selector=null,this.autocam=null,p=null,q=null,z=null,d=null,b=null,a=null,w=null},this.set2DMode=function(a){},this.setAutocam=function(a){},this.syncCamera=function(){},this.recordHomeView=function(){var a=b.navigation.getCamera();c.sync(a),c.setHomeViewFrom(a)},this.setMouseWheelInputEnabled=function(a){this.scrollInputEnabled=a}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ViewingUtilities=function(a,b,c){function d(a){var b=500,c=32512,d=.6,e=0,f=new THREE.SphereGeometry(1),g=new THREE.MeshPhongMaterial({color:c,ambient:c,opacity:d,transparent:!0}),h=new THREE.Mesh(f,g),i=a;i.createOverlayScene("pivot"),h.visible=!1,this.shown=function(){return h.visible},this.show=function(a,c,f){h.scale.x=c,h.scale.y=c,h.scale.z=c,h.position.set(a.x,a.y,a.z),g.opacity=d,h.visible=!0,i.addOverlay("pivot",h),i.invalidate(!1,!1,!0),e=f?Date.now()+b:0},this.hide=function(){h.visible&&(h.visible=!1,i.removeOverlay("pivot",h),i.invalidate(!1,!1,!0),e=0)},this.fade=function(){if(e>0){var a=e-Date.now();if(0>=a)return this.hide(),!0;var c=a/b*d;return g.opacity=c,!0}return!1},this.fading=function(){return e>0}}function e(a,b,c){var d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()}this.autocam=b,this.viewerImpl=a;var f=5,g=c.getCamera(),h={},i={},j=new d(this.viewerImpl);this.transitionView=function(a,d,f,h,i,j){i=i||c.getWorldUpVector();var k=j?e(a,d,i):h;k||(k=g.up);var l={position:a,center:d,pivot:d,fov:f,up:k,worldUp:i,isOrtho:g.isPerspective===!1};b.goToView(l)},this.goHome=function(){this.viewerImpl.log({category:"navigation",name:"home"}),b.goHome()},this.getHitPoint=function(a,b){b=1-b,a=2*a-1,b=2*b-1;var c=new THREE.Vector3(a,b,1),d=this.viewerImpl.hitTestViewport(c,!1);return d?d.intersectPoint:null},this.activatePivot=function(a){var b=g.isPerspective?c.getPivotPlaneDistance():c.getEyeVector().length(),d=c.getVerticalFov(),e=2*b*Math.tan(THREE.Math.degToRad(.5*d)),h=c.getScreenViewport(),i=window.devicePixelRatio||1,k=f*e/(h.height*i);j.show(c.getPivotPoint(),k,a)},this.pivotActive=function(a,b){return a=a&&!c.getIs2D(),b=b||!1,!a&&j.shown()?void j.hide():void(a&&this.activatePivot(b))},this.pivotUpdate=function(){j.shown()&&j.fade()&&this.viewerImpl.invalidate(!1,!1,!0)},this.setPivotPoint=function(a,b,d){c.setPivotPoint(a),b||c.setTarget(a),d&&c.setPivotSetFlag(!0),this.setTemporaryPivot(null),c.getIs2D()||j.shown()&&this.activatePivot(j.fading())},this.savePivot=function(a){a||(a="default"),h[a]=c.getPivotPoint(),i[a]=c.getPivotSetFlag()},this.restorePivot=function(a){if(a||(a="default"),h[a]){var b=i[a];this.setPivotPoint(h[a],!0,b),b||c.setPivotSetFlag(!1),delete h[a],delete i[a]}},this.setTemporaryPivot=function(a){if(a){var b=c.getPivotPoint(),d=c.getPivotSetFlag();this.setPivotPoint(a,!0,d),h.TEMP=b,i.TEMP=d}else delete h.TEMP,delete i.TEMP},this.removeTemporaryPivot=function(){this.restorePivot("TEMP")},this.getBoundingBox=function(a){return this.viewerImpl.getFitBounds(a)},this.fitToView=function(a){this.viewerImpl.log({category:"navigation",name:"fit"});var b=c.fitBounds(a,this.viewerImpl.getFitBounds(!1));return this.activatePivot(!0),b},this.update=function(){c.getRequestFitToView()&&!c.getTransitionActive()&&(c.setRequestFitToView(!1),this.fitToView()),c.getRequestHomeView()&&!c.getTransitionActive()&&(c.setRequestHomeView(!1),this.goHome());var a=c.getRequestTransition();return a&&!c.getTransitionActive()&&(c.setRequestTransition(!1),this.transitionView(a.position,a.coi,a.fov,a.up,a.worldUp,a.reorient)),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.DefaultHandler=function(a,b,c){this.clickConfig=null,this.getNames=function(){return["default"]},this.getName=function(){return this.getNames()[0]},this.setClickBehavior=function(a){this.clickConfig=a},this.getClickBehavior=function(){return this.clickConfig},this.activate=function(a){},this.deactivate=function(a){},this.handleAction=function(b,d){for(var e=0;e<b.length;++e)switch(b[e]){case"selectOnly":a.selector&&d&&a.selector.setSelection([d.dbId],d.model);break;case"deselectAll":a.selector&&a.selector.setSelection([]);break;case"selectToggle":a.selector&&d&&a.selector.toggleSelection(d.dbId,d.model);break;case"isolate":d&&a.isolate(d.dbId);break;case"showAll":a.showAll();break;case"setCOI":d&&d.intersectPoint&&(c.setPivotPoint(d.intersectPoint,!0,!0),c.pivotActive(!0,!0));break;case"hide":d&&a.hide(d.dbId);break;case"show":d&&a.show(d.dbId);break;case"toggleVisibility":d&&a.toggleVisibility(d.dbId);break;case"focus":a.selector&&(d?a.selector.setSelection([d.dbId],d.model):a.selector.setSelection([]),c.fitToView())}},this.handleSingleClick=function(b,d){var e=b.ctrlKey||b.metaKey,f=b.shiftKey,g=b.altKey;if(0===d){var h=new THREE.Vector3(b.normalizedX,b.normalizedY,1),i=a.hitTestViewport(h,!1),j="click";e&&(j+="Ctrl"),f&&(j+="Shift"),g&&(j+="Alt");var k=i?"onObject":"offObject";if(this.clickConfig&&this.clickConfig[j]&&this.clickConfig[j][k])return this.handleAction(this.clickConfig[j][k],i),!0}else if(1===d&&f&&!g&&!e){var h=new THREE.Vector3(b.normalizedX,b.normalizedY,1),i=a.hitTestViewport(h,!1);if(i&&i.intersectPoint)return c.setPivotPoint(i.intersectPoint,!0,!0),c.pivotActive(!0,!0),!0}return!1},this.handleDoubleClick=function(d,e){if(a.selector&&0===e){var f=new THREE.Vector3(d.normalizedX,d.normalizedY,1),g=a.hitTestViewport(f,!1);return g?a.selector.setSelection([g.dbId],g.model):a.selector.clearSelection(),c.fitToView(),!0}return 1===e?(b.fitBounds(!1,c.getBoundingBox(!0)),b.setPivotSetFlag(!1),!0):!1},this.handleSingleTap=function(c){if(c.clientX=c.pointers[0].clientX,c.clientY=c.pointers[0].clientY,a.api.triggerSingleTapCallback(c),c.hasOwnProperty("pointers")&&2===c.pointers.length)return b.setRequestHomeView(!0),!0;if(a.selector){var d=new THREE.Vector3(c.normalizedX,c.normalizedY,1),e=a.hitTestViewport(d,!1);return e?(a.selector.setSelection([e.dbId],e.model),a.api.triggerSelectionChanged([e.dbId])):(a.selector.clearSelection(),a.api.triggerSelectionChanged(null)),!0}return!1},this.handleDoubleTap=function(b){b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerDoubleTapCallback(b);var d=this.handleSingleTap(b,0);return c.fitToView(),d},this.handlePressHold=function(b){return"press"===b.type?(b.clientX=b.pointers[0].clientX,b.clientY=b.pointers[0].clientY,a.api.triggerContextMenu(b)):!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.GestureHandler=function(a){var b=a.navigation,c=["gestures"],d=this,e=!0,f=!0,g=null,h=isTouchDevice();b.setIsTouchDevice(h),h&&(g=new Hammer.Manager(a.canvasWrap,{recognizers:[[Hammer.Pan,{event:"drag",pointers:1}],[Hammer.Tap,{event:"doubletap",taps:2,interval:300,threshold:6,posThreshold:30}],[Hammer.Tap,{event:"doubletap2",pointers:2,taps:2,interval:300,threshold:6,posThreshold:40}],[Hammer.Tap,{event:"singletap2",pointers:2,threshold:3}],[Hammer.Tap,{event:"singletap",threshold:2}],[Hammer.Press,{event:"press",time:500}],[Hammer.Pan,{event:"drag3",pointers:3,threshold:15}],[Hammer.Pan,{event:"pan",pointers:2,threshold:20}],[Hammer.Pinch,{enable:!0,threshold:.05}],[Hammer.Rotate,{enable:!0,threshold:7}]],inputClass:Hammer.TouchInput}),a.canvasWrap.addEventListener("touchstart",this.onTouchStart,!1)),this.onTouchStart=function(a){a.preventDefault()},this.getNames=function(){return c},this.getName=function(){return c[0]},this.__clientToCanvasCoords=function(a){var c,d,e=b.getScreenViewport(),f=e.width,g=e.height;a.hasOwnProperty("center")?(c=a.center.x-e.left,d=a.center.y-e.top):(c=a.pointers[0].clientX-e.left,d=a.pointers[0].clientY-e.top),a.canvasX=c,a.canvasY=d,a.normalizedX=c/f*2-1,a.normalizedY=(g-d)/g*2-1},this.distributeGesture=function(a){function b(a,b){return-1!==a.indexOf(b,a.length-b.length)}d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleGesture",a)&&a.preventDefault(),b(a.type,"end")&&g.stop()},this.onSingleTap=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleSingleTap",a)&&a.preventDefault()},this.onDoubleTap=function(a){d.__clientToCanvasCoords(a),d.controller.distributeEvent("handleDoubleTap",a)&&a.preventDefault()},this.onPressHold=function(a){d.__clientToCanvasCoords(a),"press"===a.type?e=d.controller.enableMouseButtons(!1):d.controller.enableMouseButtons(e),d.controller.distributeEvent("handlePressHold",a)&&a.preventDefault()},this.activate=function(a){g&&(g.on("dragstart dragmove dragend",this.distributeGesture),g.on("singletap",this.onSingleTap),g.on("singletap2",this.onSingleTap),g.on("doubletap",this.onDoubleTap),g.on("doubletap2",this.onDoubleTap),g.on("press pressup",this.onPressHold),g.on("drag3start drag3move drag3end",this.distributeGesture),f&&(g.on("panstart panmove panend",this.distributeGesture),g.on("pinchstart pinchmove pinchend",this.distributeGesture),g.on("rotatestart rotatemove rotateend",this.distributeGesture)),g.get("doubletap2").recognizeWith("doubletap"),g.get("singletap2").recognizeWith("singletap"),g.get("singletap").requireFailure("doubletap"))},this.deactivate=function(a){g&&(g.off("dragstart dragmove dragend",this.distributeGesture),g.off("singletap",this.onSingleTap),g.off("singletap2",this.onSingleTap),g.off("doubletap",this.onDoubleTap),g.off("doubletap2",this.onDoubleTap),g.off("press pressup",this.onPressHold),g.off("drag3start drag3move drag3end",this.distributeGesture),f&&(g.off("panstart panmove panend",this.distributeGesture),g.off("pinchstart pinchmove pinchend",this.distributeGesture),g.off("rotatestart rotatemove rotateend",this.distributeGesture)))},this.update=function(){return!1},this.handleBlur=function(a){return!1},this.disableTwoFingerSwipe=function(){f=!1,g&&(g.remove(Hammer.Pan),g.remove(Hammer.Pinch),g.remove(Hammer.Rotate),g.off("panstart panmove panend",this.distributeGesture),g.off("pinchstart pinchmove pinchend",this.distributeGesture),g.off("rotatestart rotatemove rotateend",this.distributeGesture))}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.OrbitDollyPanTool=function(a,b){function c(){var a=qa;return X===V&&!a.SHIFT&&!(a.ALT^a.CONTROL)||X===V&&a.SHIFT&&a.CONTROL||X===U&&!a.SHIFT&&!a.CONTROL||X===U&&a.ALT||X===U&&a.CONTROL&&!a.ALT||X===T&&a.SHIFT&&!a.CONTROL&&!a.ALT||"pan"===B&&X!==U&&!a.ALT&&!("pinch"===C)||a.SPACE}function d(){var a=qa;return X===V&&a.SHIFT&&!a.ALT&&!a.CONTROL||X===V&&a.ALT&&!a.SHIFT&&!a.CONTROL||"dolly"===B&&!a.ALT&&!("pinch"===C)}function e(){var a=qa;return!(a.CONTROL||a.ALT||a.SHIFT||X!==V&&X!==U)}function f(){return X===U&&qa.SHIFT?A[1]:d()||0!==ca.z?e()?"pan":"dolly":c()?"pan":"pan"===C||"pinch"===C?"dollypan":B}function g(){var a=w.getPivotPoint().sub(w.getPosition());return a.dot(w.getEyeVector())<=0}function h(a,b){var c={left:0,top:0,width:window.innerWidth,height:window.innerHeight};ja.set((a-.5*c.width-c.left)/(.5*c.width),(.5*c.height+c.top-b)/(.5*c.height),0);var d=ja.length();return ma?d<Math.SQRT1_2?ja.z=Math.sqrt(1-d*d):ja.z=.5/d:d>1?ja.normalize():ja.z=Math.sqrt(1-d*d),fa.copy(x.position).sub(x.pivot),ha.copy(x.up).setLength(ja.y),ha.add(ia.copy(x.up).cross(fa).setLength(ja.x)),ha.add(fa.setLength(ja.z)),ha}function i(){fa.subVectors(x.position,x.pivot),ga.subVectors(x.position,x.target);var a=ga.length();ga.normalize();var b=Math.acos(da.dot(ea)/da.length()/ea.length());b&&(b*=u,ka.crossVectors(da,ea).normalize(),la.setFromAxisAngle(ka,-b),fa.applyQuaternion(la),x.up.applyQuaternion(la),ea.applyQuaternion(la),ga.applyQuaternion(la),na?da.copy(ea):(la.setFromAxisAngle(ka,b*(oa-1)),da.applyQuaternion(la))),x.position.addVectors(x.pivot,fa),x.target.subVectors(x.position,ga.multiplyScalar(a)),x.dirty=!0}function j(a,b){return-1!==a.indexOf(b,a.length-b.length)}function k(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY;return Math.sqrt(b*b+c*c)}var l,m,n=this,o=.001,p=1e-5,q=1.5,r=.01,s=20,t=100,u=2,v=-1!=navigator.userAgent.search("Mac OS"),w=b.navigation,x=w.getCamera(),y=["orbit","freeorbit","dolly","pan"],z=y[0],A=[z],B=z,C=null,D=1,E=1,F=0,G=0,H=0,I=0,J=!1,K=null,L=!1,M=0,N=null,O=null,P={SHIFT:16,CONTROL:17,ALT:18,SPACE:32,PAGEUP:33,PAGEDOWN:34,LEFT:37,UP:38,RIGHT:39,DOWN:40,ZERO:48,EQUALS:187,DASH:189},Q=-5,R=-4,S=-1,T=0,U=1,V=2,W=3,X=Q,Y=new THREE.Vector3,Z=new THREE.Vector3,$=new THREE.Vector2,_=new THREE.Vector2,aa=new THREE.Vector2,ba=new THREE.Vector2,ca=new THREE.Vector3,da=new THREE.Vector3,ea=new THREE.Vector3,fa=new THREE.Vector3,ga=new THREE.Vector3,ha=new THREE.Vector3,ia=new THREE.Vector3,ja=new THREE.Vector3,ka=new THREE.Vector3,la=new THREE.Quaternion,ma=!1,na=!0,oa=.2,pa=[!1,!1,!1,!1,!1,!1],qa={SHIFT:0,ALT:0,CONTROL:0,SPACE:0},ra=.6,sa=5,ta=.025,ua=.01,va=.6,wa=1,xa=sa,ya=ta;this.getNames=function(){return y},this.getName=function(){return y[0]},this.activate=function(a){A.push(a),B=a},this.deactivate=function(a){var b=A.length-1;b>0&&A[b]===a&&(A.pop(),B=A[b-1])},this.adjustDollyLookSpeed=function(a){0===a?(ya=ta,xa=sa):(ya*=a>0?1.1:.9,xa*=a>0?1.1:.9,1e-6>ya&&(ya=1e-6),1e-6>xa&&(xa=1e-6))},this.getDollySpeed=function(a){var b=w.getEyeVector(),c=w.getPosition(),d=a.clone().sub(c).dot(b.normalize()),e=d*ya;return Math.abs(e)<ua?0>e?-ua:ua:e},this.getLookSpeed=function(){return xa},this.coiIsActive=function(){return w.getPivotSetFlag()&&w.isPointVisible(w.getPivotPoint())},this.adjustSpeed=function(a){this.adjustDollyLookSpeed(a),this.utilities.autocam&&(this.utilities.autocam.orbitMultiplier=this.getLookSpeed())},this.initTracking=function(a,b){var c;if(x.isPerspective){c=.5*(x.near+x.far);var d=this.utilities.getHitPoint(a,b),e=w.getPosition();if(d&&d.sub){var f=d.sub(e),g=w.getEyeVector().normalize();c=Math.abs(g.dot(f))}else{var h=w.getPivotSetFlag()&&w.isPointVisible(w.getPivotPoint());if(h){var i=w.getPivotPlaneDistance();i>p&&(c=i)}}}else c=w.getEyeVector().length();wa=c},this.initOrbit=function(){this.utilities.setTemporaryPivot(g()?w.getTarget():null)},this.getCursor=function(){switch(z){case"freeorbit":case"orbit":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto";case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return null},this.getMotionDelta=function(a,b){var c=w&&w.getReverseZoomDirection()?-q:q;v&&(c*=-1),pa[0]&&(Z.x+=r,aa.x+=s),pa[1]&&(Z.x-=r,aa.x-=s),pa[2]&&(Z.y+=r,aa.y+=s),pa[3]&&(Z.y-=r,aa.y-=s),pa[4]&&(Z.z+=c),pa[5]&&(Z.z-=c);var d=Z.x-Y.x,e=Z.y-Y.y,f=Z.z-Y.z;Math.abs(d)<o&&(d=0),Math.abs(e)<o&&(e=0),Math.abs(f)<o&&(f=0),a.set(d,e,f),b&&b.set(aa.x-_.x,aa.y-_.y)},this.stepMotionDelta=function(a,b){b?(Y.x+=a.x*ra,Y.y+=a.y*ra,Y.z+=a.z*ra):Y.copy(Z),_.copy(aa)},this.update=function(){var a,c=!1,d=!1;this.getMotionDelta(ca,ba);var e=ca.x,f=ca.y,g=ca.z;if(J||this.checkInteractionMode(),J=X>S,J&&this.controller.setIsLocked(!0),0!==e||0!==f||0!==g){switch(z){case"orbit":this.utilities.autocam&&this.utilities.autocam.startState&&(ba.x=-ba.x,K&&this.utilities.autocam.orbit(aa,K,ba.multiplyScalar(u),this.utilities.autocam.startState));break;case"freeorbit":i();break;case"dolly":var h,j,k;g*=va,X>=T?(f=-f,g=Math.abs(e)>Math.abs(f)?e:f,g*=t,e=0,f=0,j=k=.5):(a=w.getScreenViewport(),j=l/a.width,k=m/a.height),h=!w.getIs2D()&&w.getZoomTowardsPivot()?this.coiIsActive()?w.getPivotPoint():w.getWorldPoint(.5,.5):w.getWorldPoint(j,k),w.dollyFromPoint(g*this.getDollySpeed(h),h);break;case"pan":w.panRelative(-e,f,wa);break;case"dollypan":(0!==e||0!==f)&&w.panRelative(-e,f,wa),a=w.getScreenViewport(),j=l/a.width,k=m/a.height,h=w.getWorldPoint(j,k);var n=w.getPosition(),o=w.getIs2D()?n.sub(h).length():wa,q=F/G-1,r=q*o;w.dollyFromPoint(r,h);var s=new THREE.Vector3,v=new THREE.Quaternion,A=w.getCameraUpVector(),B=s.copy(x.position).sub(x.target).normalize();v.setFromAxisAngle(B,H),A.applyQuaternion(v),w.setWorldUpVector(A,!0),F=G,E=D,wa=o+r}d=!0}return this.stepMotionDelta(ca,"pan"!==z&&"dollypan"!==z),X===S&&Math.abs(g)<p&&(this.interactionEnd(S),c=!0,d=!0),(qa.SHIFT||qa.ALT)&&-1!==y.indexOf(b.getActiveNavigationTool())&&(d=!0),!L&&(c||X>Q)&&(X>S&&(Y.copy(Z),this.utilities.removeTemporaryPivot()),this.utilities.autocam.endInteraction(),X=Q,J&&this.controller.setIsLocked(!1),J=!1,K=null,C=null),d?this.utilities.pivotActive(w.getPivotSetFlag(),S>=X):this.utilities.pivotUpdate(),x.dirty},this.checkInteractionMode=function(){var a=f();a!==z&&(z=a,("pan"===z&&X>S||"dollypan"===z)&&this.initTracking(Y.x,Y.y))},this.interactionStart=function(a,b){(b||a>X)&&(X=a,L=!0,a>S&&("pan"===z&&this.initTracking(Y.x,Y.y),"orbit"===z&&this.initOrbit()),this.utilities.pivotActive(w.getPivotSetFlag(),a===S),this.utilities.autocam&&(this.utilities.autocam.sync(x),this.utilities.autocam.startInteraction(_.x,_.y),K=_.clone()))},this.interactionCheck=function(){(pa[0]||pa[1]||pa[2]||pa[3]||pa[4]||pa[5]||qa.SHIFT||qa.CONTROL||qa.ALT||qa.SPACE)&&this.interactionStart(R,!0)},this.interactionEnd=function(a){a===X&&(a!==S&&this.utilities.pivotActive(!1),L=!1)},this.handleWheelInput=function(b){if(this.isDragging)return!1;if(w.getIs2D()){var c=w.getScreenViewport(),d=a.intersectGround(l+c.width,m+c.height);this.utilities.setPivotPoint(d,!0,!0)}w.getReverseZoomDirection()&&(b*=-1),Z.z+=b,M+=b;var e=Date.now();return N||(N=e),O=e,0!=b&&this.interactionStart(S),!0},this.resetKeys=function(){this.autoMove(-1,!1),qa.SHIFT=0,qa.CONTROL=0,qa.ALT=0,qa.SPACE=0},this.autoMove=function(a,b){b&&this.isDragging||(0>a?pa[0]=pa[1]=pa[2]=pa[3]=pa[4]=pa[5]=b:pa[a]=b,b||this.interactionEnd(R),this.interactionCheck())},this.updateModifierState=function(a){qa.CONTROL=v&&a.metaKey||a.ctrlKey?1:0,qa.SHIFT=a.shiftKey?1:0,qa.ALT=a.altKey?1:0},this.handleKeyDown=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case P.EQUALS:this.adjustSpeed(1),c=!0;break;case P.DASH:this.adjustSpeed(-1),c=!0;break;case P.ZERO:this.adjustSpeed(0),c=!0;break;case P.LEFT:this.autoMove(0,!0),c=!0;break;case P.RIGHT:this.autoMove(1,!0),c=!0;break;case P.PAGEUP:this.autoMove(2,!0),c=!0;break;case P.PAGEDOWN:this.autoMove(3,!0),c=!0;break;case P.UP:this.autoMove(4,!0),c=!0;break;case P.DOWN:this.autoMove(5,!0),c=!0;break;default:return!1}return this.isDragging||this.interactionStart(R),c},this.handleKeyUp=function(a,b){this.updateModifierState(a);var c=!1;switch(b){case P.LEFT:this.autoMove(0,!1),c=!0;break;case P.RIGHT:this.autoMove(1,!1),c=!0;break;case P.PAGEUP:this.autoMove(2,!1),c=!0;break;case P.PAGEDOWN:this.autoMove(3,!1),c=!0;break;case P.UP:this.autoMove(4,!1),c=!0;break;case P.DOWN:this.autoMove(5,!1),c=!0;break;default:return!1}return c&&(this.interactionEnd(R),L||this.interactionCheck()),c},this.handleDollyPan=function(a){l=a.canvasX,m=a.canvasY;var b=w.getScreenViewport();aa.x=$.x+a.deltaX,aa.y=$.y+a.deltaY,Z.x=aa.x/b.width,Z.y=aa.y/b.height,G=k(a);var c=THREE.Math.degToRad(a.rotation);H=c-I,Math.abs(H)>1&&(c=0,H=0),I=c,j(a.type,"start")&&(F=G,E=1),D=a.scale},this.handleGesture=function(a){switch(a.type){case"dragstart":return C="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===C?this.handleMouseMove(a):!1;case"dragend":return"drag"===C?(this.handleButtonUp(a,0),C=null,!0):!1;case"panstart":return C="pan",this.isDragging=!0,Y.x=.5*(a.normalizedX+1),Y.y=1-.5*(a.normalizedY+1),$.set(a.canvasX,a.canvasY),_.set(a.canvasX,a.canvasY),this.interactionStart(W),this.handleDollyPan(a),!0;case"panmove":return"pan"===C?this.handleDollyPan(a):!1;case"panend":return"pan"===C?(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(W),!0):!1;case"pinchstart":return this.isDragging=!0,C="pinch",Y.x=.5*(a.normalizedX+1),Y.y=1-.5*(a.normalizedY+1),$.set(a.canvasX,a.canvasY),_.set(a.canvasX,a.canvasY),this.interactionStart(W),this.handleDollyPan(a),!0;case"pinchmove":return"pinch"===C?this.handleDollyPan(a):!1;case"pinchend":return"pinch"===C?(this.isDragging=!1,this.handleDollyPan(a),this.interactionEnd(W),!0):!1}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),Y.x=.5*(a.normalizedX+1),Y.y=1-.5*(a.normalizedY+1),_.set(a.canvasX,a.canvasY),Z.copy(Y),aa.copy(_),da.copy(h(a.canvasX,a.canvasY)),ea.copy(da),l=a.canvasX,m=a.canvasY,this.isDragging=!0,this.interactionStart(b),!0},this.handleButtonUp=function(a,b){return this.updateModifierState(a),Z.x=.5*(a.normalizedX+1),Z.y=1-.5*(a.normalizedY+1),aa.set(a.canvasX,a.canvasY),ea.copy(h(a.canvasX,a.canvasY)),da.copy(ea),l=a.canvasX,m=a.canvasY,this.interactionEnd(b),this.isDragging=!1,!0},this.handleMouseMove=function(b){return this.updateModifierState(b),this.isDragging?(Z.x=.5*(b.normalizedX+1),Z.y=1-.5*(b.normalizedY+1),aa.set(b.canvasX,b.canvasY),ea.copy(h(b.canvasX,b.canvasY)),l=b.canvasX,m=b.canvasY,!0):(Y.x=.5*(b.normalizedX+1),Y.y=1-.5*(b.normalizedY+1),_.set(b.canvasX,b.canvasY),Z.x=Y.x,Z.y=Y.y,aa.copy(_),l=b.canvasX,m=b.canvasY,a.rolloverObject(l,m),!1)},this.handleBlur=function(a){this.resetKeys(),this.interactionEnd(X)},b.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,function(a){n.handleBlur(a)})},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.HotGestureTool=function(a){var b=(-1!=navigator.userAgent.search("Mac OS"),a.navigation),c=(b.getCamera(),["hottouch"]),d={SHIFT:0,ALT:0,CONTROL:0},e=null,f=null,g=!1,h=!1,i=null,j={SHIFT:16,CONTROL:17,ALT:18,ESCAPE:27,LCOMMAND:91,RCOMMAND:93,COMMANDMOZ:224},k="worldup",l="fov";this.getNames=function(){return c},this.getName=function(){return c[0]},this.activate=function(a){},this.deactivate=function(a){},this.__checkStart=function(){i&&(this.controller.distributeEvent("handleGesture",i),i=null)},this.update=function(){if(this.controller.getIsLocked())return!1;var b=a.getActiveNavigationTool(),c=g===!1&&h===!0,d=g===!0&&h===!1;if(c||d){var i=c?k:l;if(b===i)return!1;if(b===e)return a.setActiveNavigationTool(i),e=i,this.__checkStart(),!1;f=b,a.setActiveNavigationTool(i),e=i,this.__checkStart()}else e&&(a.setActiveNavigationTool(f),e=null,f=null);return!1},this.resetKeys=function(){d.SHIFT=0,d.CONTROL=0,d.ALT=0},this.updateModifierState=function(a){d.CONTROL=a.ctrlKey?1:0,d.SHIFT=a.shiftKey?1:0,d.ALT=a.altKey?1:0},this.handleGesture=function(a){if(a===i)return!1;switch(a.type){case"drag3start":i=a,g=!0;break;case"drag3move":break;case"drag3end":g=!1;break;case"rotatestart":i=a,h=!0;break;case"rotatemove":break;case"rotateend":h=!1}return!1},this.handleKeyDown=function(a,b){switch(this.updateModifierState(a),b){case j.SHIFT:d.SHIFT=1;break;case j.CONTROL:d.CONTROL=1;break;case j.ALT:d.ALT=1}return!1},this.handleKeyUp=function(a,b){switch(this.updateModifierState(a),b){case j.SHIFT:d.SHIFT=0;break;case j.CONTROL:d.CONTROL=0;break;case j.ALT:d.ALT=0}return!1},this.handleButtonDown=function(a,b){return this.updateModifierState(a),!1},this.handleButtonUp=function(a,b){return this.updateModifierState(a),!1},this.handleMouseMove=function(a){return this.updateModifierState(a),!1},this.handleBlur=function(a){return this.resetKeys(),!1}},AutodeskNamespace("Autodesk.Viewing.Private"),
Autodesk.Viewing.HotkeyManager=function(){function a(){return p}function b(){return p[0]}function c(a,b){return a-b}function d(a,b,d){var e=k.some(function(b){return b.id===a});if(e)return!1;for(var f=0;f<b.length;f++)k.push({id:a,keys:b[f].keycodes.sort(c).join(),onPress:b[f].onPress,onRelease:b[f].onRelease,options:d||{}});return!0}function e(a){for(var b=!1,c=k.length-1;c>=0;c--)k[c].id===a&&(k.splice(c,1),b=!0);return b}function f(){var a,b,c=l.join();for(b=0;b<n.length;)a=n[b],a.keys===c?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],a.keys!==c?m.splice(b,1):b++}function g(a,b){if(-1===l.indexOf(b)){for(var c=l.join(),d=l.slice(0),e=0;e<l.length&&l[e]<b;)e++;l.splice(e,0,b);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}}function h(a,b){var c=l.join(),d=l.slice(0),e=l.indexOf(b);e>-1&&l.splice(e,1);var g=l.join(),h=l.slice(0);f();var i,j=[],o=[];for(e=k.length-1;e>=0;e--)i=k[e],i.keys===c&&i.onRelease?j.unshift(i):i.keys===g&&i.onPress&&o.unshift(i);for(e=j.length-1;e>=0&&(i=j[e],!i.onRelease(d));e--)i.options.tryUntilSuccess&&n.unshift(i);for(e=o.length-1;e>=0&&(i=o[e],!i.onPress(h));e--)i.options.tryUntilSuccess&&m.unshift(i)}function i(){var a,b;for(b=0;b<n.length;)a=n[b],a.onRelease(a.keys.split())===!0?n.splice(b,1):b++;for(b=0;b<m.length;)a=m[b],a.onPress(a.keys.split())===!0?m.splice(b,1):b++;return!1}function j(){for(var a=l.length-1;a>=0;a--)h(null,l[a])}var k=[],l=[],m=[],n=[],o=Autodesk.Viewing.KeyCode,p=["hotkeys"];return{pushHotkeys:d,popHotkeys:e,handleKeyDown:g,handleKeyUp:h,handleBlur:j,getName:b,getNames:a,activate:function(){},deactivate:function(){},update:i,KEYCODES:o}},Autodesk.Viewing.theHotkeyManager=new Autodesk.Viewing.HotkeyManager,AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.FovTool=function(a){function b(a){return 0>a&&a>-3?-3:a>0&&3>a?3:a}var c=.001,d=1e-5,e=-1,f=.6,g=100,h=a.navigation,i=h.getCamera(),j=["fov"],k=!1,l=0,m=null,n=null,o=!1,p=0,q=-5,r=-1,s=0,t=2,u=q,v=new THREE.Vector3,w=new THREE.Vector3,x=new THREE.Vector3,y=null;this.getNames=function(){return j},this.getName=function(){return j[0]},this.activate=function(a){p=0},this.deactivate=function(a){u=q},this.getCursor=function(){return 0!==p&&u===q?null:"url(data:image/x-icon;base64,AAACAAEAGBgAAAAAAACICQAAFgAAACgAAAAYAAAAMAAAAAEAIAAAAAAAYAkAABMLAAATCwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAACEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAnAwMD/yEhIf8AAABmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAGknJyf/goKC/8/Pz/8aGhr/AAAALQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////AAAA/wAAAAAAAAAAAAAAAAAAAAAAAABTFBQU/2lpaf/MzMz///////////+Wlpb/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAOAAAAKFTU1P/t7e3////////////8PDw////////////AQEB/wAAAAEAAAAAAAAAFAAAAH0KCgr/AAAAYwAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAjCwsL/6Ghof/t7e3///////Dw8P9MTEz/LS0t//Pz8///////Ghoa/wAAABoAAAANDQ0N/319ff+rq6v/Y2Nj/wAAAK8AAABGAAAA////////////AAAA/wAAAF0hISH/jIyM////////////sLCw/xEREf8AAACHAAAArKysrP//////V1dX/wAAAFcAAABSUlJS//f39///////8PDw/6+vr/86Ojr/LS0t////////////FRUV/1xcXP/Gxsb/+Pj4//Hx8f9MTEz/AAAAsAAAAEcAAAAAAAAAZ2dnZ///////pKSk/wAAAKQAAACtra2t///////////////////////m5ub/kZGR/wAAAP8AAAD/q6ur//Hx8f//////vb29/x0dHf8AAACIAAAAAAAAAAAAAAAAAAAAOjo6Ov//////5+fn/wAAAOcAAADd3d3d////////////////////////////+/v7/9bW1v/i4uL//v7+//Pz8/9hYWH/AAAAvQAAAFQAAAAAAAAAAAAAAAAAAAAAAAAAJycnJ//6+vr//////wMDA/8AAADv7+/v/////////////////////////////////////////////////7y8vP8ODg7/AAAAKwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJiYmJv/6+vr//////wkJCf8AAADv7+/v//////////////////////////////////f39//9/f3//////+np6f+UlJT/GBgY/wAAAH0AAAACAAAAAAAAAAAAAAAAAAAAKSkpKf///////v7+/w0NDf8AAADd3d3d////////////////////////////29vb/39/f/+Xl5f/5+fn////////////5ubm/1RUVP8CAgL/AAAAPwAAAAAAAAAAAAAAOTk5Of//////8PDw/wgICP8AAAChoaGh/////////////////+np6f+YmJj/QkJC/wAAAP8AAAD/UFBQ/7e3t//39/f///////////+oqKj/EBAQ/wAAAIgAAAAAAAAAZ2dnZ///////29vb/wEBAf8AAAA4NTU1/9zc3P/t7e3/tbW1/01NTf8AAACYAAAA////////////AwMD/wsLC/9oaGj/y8vL////////////8fHx/zg4OP8AAACWAAAApaWlpf//////n5+f/wAAAJ8AAAAAAAAAczg4OP9LS0v/EhIS/wAAAE0AAAAAAAAA////////////FRUV/wAAABUAAABoJSUl/4GBgf/i4uL///////////9+fn7/Pz8///b29v//////SkpK/wAAAEoAAAAAAAAAAAAAADgAAABLAAAAEgAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAJQAAAIE8PDz/np6e//z8/P/////////////////8/Pz/CQkJ/wAAAAkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAA8DAwM/09PT/+7u7v///////////+QkJD/AAAAkwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////Dw8P/wAAAA8AAAAAAAAAAAAAAAAAAAAAAAAADAAAAFIYGBj/aGho/729vf8WFhb/AAAAJwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////FRUV/wAAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAQEB/w8PD/8AAABUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA////////////DAwM/wAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlgAAAP8AAAD/AAAAlgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8x/h/nO/4fw1D+HwFy/h4BRu4YAHOGEABkAAAAXAAAIFwAAOBnAAHgIAAD4GUAAOB4AABgXAAAIGMAAABtggAAVMYYAHT+HgE7/g8BcP4Pw2/+D+dc/h//XP///2c=), auto"},this.getMotionDelta=function(a){var b=w.x-v.x,d=w.y-v.y,e=w.z-v.z;Math.abs(b)<c&&(b=0),Math.abs(d)<c&&(d=0),Math.abs(e)<c&&(e=0),a.set(b,d,e)},this.stepMotionDelta=function(a,b){b?(v.x+=a.x*f,v.y+=a.y*f,v.z+=a.z*f):v.copy(w)},this.getAccumulatedWheelDelta=function(){var a=Date.now(),c=0;return n&&a-n>g?(c=b(l),l=0,m=null,n=null,o=!1):m&&a-m>g&&(o?Math.abs(l)>=3&&(c=l,l=0):(c=b(l),o=!0,l=0)),c},this.update=function(){var a=!1,b=u>q;if(u>q){this.controller.setIsLocked(!0),this.getMotionDelta(x);var c=x.x,f=x.y,g=x.z;if(0!==c||0!==f||0!==g)if(b=!0,u>=s)f=-f,g=Math.abs(c)>Math.abs(f)?c:f,0!==g&&(g*=e,h.setVerticalFov(h.getVerticalFov()*(1+g),!0));else{var j=this.getAccumulatedWheelDelta()/3;0!==j&&h.setFocalLength(h.getFocalLength()+j,!0)}this.stepMotionDelta(x,!0),u===r&&Math.abs(g)<d&&(this.interactionEnd(r),a=!0)}return b?this.utilities.pivotActive(h.getPivotSetFlag(),!0):this.utilities.pivotUpdate(),!k&&(a||u>q)&&(u>r&&v.copy(w),u=q,this.controller.setIsLocked(!1)),i.dirty},this.interactionStart=function(a,b){(b||a>u)&&(u=a,k=!0),h.toPerspective()},this.interactionEnd=function(a){a===u&&(a!==r&&this.utilities.pivotActive(!1),k=!1)},this.handleWheelInput=function(a){if(u>r)return!1;h.getReverseZoomDirection()&&(a*=-1),w.z+=a,l+=a;var b=Date.now();return m||(m=b),n=b,0!=a&&this.interactionStart(r),!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return this.handleButtonUp(a,0);case"drag3start":return y="drag",this.handleButtonDown(a,0);case"drag3move":return"drag"===y?this.handleMouseMove(a):!1;case"drag3end":return"drag"===y&&this.handleButtonUp(a,0),y=null,!1}return!1},this.handleButtonDown=function(a,b){return p+=1<<b,b!==t?(v.x=.5*(a.normalizedX+1),v.y=1-.5*(a.normalizedY+1),w.copy(v),this.interactionStart(b),!0):!1},this.handleButtonUp=function(a,b){return p-=1<<b,b!==t?(w.x=.5*(a.normalizedX+1),w.y=1-.5*(a.normalizedY+1),this.interactionEnd(b),!0):!1},this.handleMouseMove=function(a){return w.x=.5*(a.normalizedX+1),w.y=1-.5*(a.normalizedY+1),u>r},this.handleBlur=function(a){return this.interactionEnd(u),!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.WorldUpTool=function(a,b){function c(a,b){function c(a,b){var c=Math.abs(a-b);return c>m?c:Math.min(m-c,c)}function d(a,b){var c=p(a);return c.distanceToSquared(b)<o?!0:(D.set(-b.x,-b.y,-b.z),c.distanceToSquared(D)<o)}function g(a,b){for(var e=Y+Z+2*Math.PI/180,f=0;6>f;++f)if(S[f]!==_)for(var g=f+1;6>g;++g)if(S[g]!==_){var h=c(S[f],S[g]);if(e>h){if(a[f]<a[g]&&!d(f,b)||d(g,b)){S[f]=_;break}S[g]=_}}}function i(a){return a>m?a:0>=a?a+Math.PI:a-Math.PI}function j(a,b,c){var d=a.clone().normalize(),e=new Array(3),f=new Array(6);e[0]=l(1,0,0,d),e[1]=l(0,1,0,d),e[2]=l(0,0,1,d);var h,j=b.clone().cross(d).normalize();for(h=0;3>h;++h){var k=e[h];f[h]=k.length(),f[h]<aa?S[h]=_:(k.multiplyScalar(1/f[h]),S[h]=Math.atan2(j.dot(k),b.dot(k)))}for(S[3]=i(S[0]),S[4]=i(S[1]),S[5]=i(S[2]),f[3]=f[0],f[4]=f[1],f[5]=f[2],g(f,c),h=0;6>h;++h)if(S[h]!==_){var m=D.set(0,0,1);E.setFromAxisAngle(m,S[h]);var n=D.set(0,.54,0);n.applyQuaternion(E),Q[h].position.copy(n),Q[h].visible=!0}else Q[h].visible=!1}function k(){O=new THREE.Object3D;var a=new THREE.RingGeometry(.5-.01*H,.5,60),b=new THREE.Mesh(a,B);K=b;var c=.007*H,d=new THREE.BoxGeometry(.93,c,c),e=new THREE.BoxGeometry(c,.93,c),f=new THREE.BoxGeometry(c,c,.93);L=new THREE.Mesh(d,B),M=new THREE.Mesh(e,B),N=new THREE.Mesh(f,B),O.add(L),O.add(M),O.add(N),P=new THREE.Mesh(new THREE.CircleGeometry(.005),B),O.add(P),Q=new Array(6),R=new Array(6);for(var g=0;6>g;++g){var h=.005*H,i=.0025*H;Q[g]=new THREE.Mesh(new THREE.CircleGeometry(h,16),B),R[g]=new THREE.Mesh(new THREE.CircleGeometry(i,16),B),R[g].visible=!1,Q[g].add(R[g]),b.add(Q[g])}return O.add(b),O}function n(a,b,c,d,e){return O||(O=k()),h.orient(K,b,F.position,d),j(c,e,d),O.scale.x=a,O.scale.y=a,O.scale.z=a,O.position.copy(b),O}function p(a){if(C.set(0,0,0),a>=0){var b=a>=3?-1:1;a%=3,0===a&&(C.x=b),1===a&&(C.y=b),2===a&&(C.z=b)}return V&&C.multiplyScalar(-1),C}function q(a,b){for(var d=c(S[0],a),e=0,f=1;6>f;++f){var g=c(S[f],a);d>g&&(d=g,e=f)}return T=d,b>d?e:-1}function r(a){h.setIsLocked(!1),h.setWorldUpVector(a,!0),h.setIsLocked(!0)}function s(a){if(0!==a){var b=30*Math.PI/180,c=D.copy(F.position).sub(J).normalize();E.setFromAxisAngle(c,a);var d=h.getWorldUpVector(),e=Math.abs(c.angleTo(d));(b>e||Math.PI-e<b)&&d.copy(h.getCameraUpVector()),d.applyQuaternion(E),r(d)}}function t(){if(!W){var a=q(U,Y);if(a>=0)return T=0,W=!0,U=S[a],p(a)}return!1}function u(){if(W){var a=q(U,Z);if(0>a)return W=!1,!0;T=0}return!1}function v(a,b,c,d){var e=b>a;if(e){var f=p(c);return f.distanceToSquared(d)<o}return!1}function w(a,b){var d=a.dot(b),e=0>d;e&&(b=b.clone().multiplyScalar(-1)),h.orient(P,J,F.position,b),P.position.copy(b.multiplyScalar(.495));for(var f=!1,g=W?Z:Y,i=0;6>i;++i){var j=c(S[i],U),k=v(j,g,i,a);k&&(f=!0);var l=k?4:3*(1-3*j/Math.PI);1>l&&(l=1),l*=H,R[i].visible=k;var m=Q[i];m.scale.x=l,m.scale.y=l,m.scale.z=l}return L.visible=f,M.visible=f,N.visible=f,f}function x(a){U+=a,U>Math.PI?U-=m:U<=-Math.PI&&(U=m+U);var b=t();if(b)X=U,r(b);else if(u()){var c=U-X;s(c),X=0}else{if(W)return!1;s(a)}return!0}var y=12303291,z=30,A=2*Math.tan(THREE.Math.degToRad(.5*z)),B=new THREE.MeshPhongMaterial({color:y,ambient:y,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1}),C=new THREE.Vector3,D=new THREE.Vector3,E=new THREE.Quaternion,F=new THREE.PerspectiveCamera(z,b.aspect,b.near,b.far),G=b,H=1,I=1,J=null,K=null,L=null,M=null,N=null,O=null,P=null,Q=null,R=null,S=new Array(6),T=0,U=0,V=!1,W=!0,X=0,Y=5*Math.PI/180,Z=7*Math.PI/180,$=1,_=1e3,aa=.1;a.createOverlayScene("roll",null,null,F),this.updateRollCamera=function(a,b){F.position.copy(G.position),F.quaternion.copy(G.quaternion),F.up.copy(G.up),F.aspect=G.aspect,a&&b&&(F.near=b-a,F.far=b+a),F.updateProjectionMatrix()},this.isSnapped=function(){return W},this.resize=function(){var a=$*A,b=a*G.aspect,c=(G.aspect<1?b:a)*I;O.scale.x=c,O.scale.y=c,O.scale.z=c},this.start=function(b,c){this.updateHUD(b,c),a.addOverlay("roll",O)},this.updateHUD=function(a,b){J=a,e>b?b=e:b>f&&(b=f),I=b,H=f/b;var c=C.copy(a).sub(G.position);$=c.length();var d=$*A,g=d*G.aspect,i=(G.aspect<1?g:d)*b;this.updateRollCamera(i,$);var j=h.getWorldUpVector(),k=h.getCameraUpVector();n(i,a,c,j,k),U=0,X=0;var l=j.dot(k);V=0>l,W=w(j,k)},this.handleRoll=function(a,b,c){if(this.updateRollCamera(),w(h.getWorldUpVector(),h.getCameraUpVector()),0!==a||0!==b){var d=c.x-a-.5,e=c.y-b-.5,f=c.x-.5,g=c.y-.5;return x(Math.atan2(g,f)-Math.atan2(e,d))}return!1},this.handleRollTouch=function(a){this.updateRollCamera(),w(h.getWorldUpVector(),h.getCameraUpVector());var b=a-U;return Math.abs(b)>.001?x(b):!1},this.end=function(){a.removeOverlay("roll",O)}}function d(a){var b=a.pointers[1].clientX-a.pointers[0].clientX,c=a.pointers[1].clientY-a.pointers[0].clientY,d=Math.sqrt(b*b+c*c),e=h.getScreenViewport();return d/Math.min(e.width,e.height)}var e=.35,f=.8,g=.65,h=b.navigation,i=h.getCamera(),j=["worldup"],k=this,l=function(){var a=new THREE.Vector3;return function(b,c,d,e){var f=new THREE.Vector3(b,c,d),g=e.dot(f);return a.copy(e),a.multiplyScalar(g),f.sub(a)}}(),m=2*Math.PI,n=.001,o=1e-5,p=!1,q=!1,r=!1,s=new c(a,i),t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3,w=null,x=0,y={x:.5,y:.5},z=1;this.getNames=function(){return j},this.getName=function(){return j[0]},this.activate=function(a){b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),r=!1},this.deactivate=function(a){s.end(),h.setIsLocked(!1),b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),this.utilities.restorePivot(),w=null,p=!1,r=!1},this.getCursor=function(){return"auto"},this.getMotionDelta=function(a){var b=u.x-t.x,c=u.y-t.y,d=u.z-t.z;Math.abs(b)<n&&(b=0),Math.abs(c)<n&&(c=0),Math.abs(d)<n&&(d=0),a.set(b,c,d)},this.stepMotionDelta=function(){t.copy(u)},this.update=function(){if(!r){var a=h.getEyeVector(),b=.5*(i.near+i.far);a.normalize().multiplyScalar(b);var c=a.add(i.position);this.utilities.savePivot(),this.utilities.setPivotPoint(c,!0,!0),this.utilities.pivotActive(!0);var d=g;s.start(c,d),r=!0}var e=q;this.getMotionDelta(v);var f=v.x,j=v.y,k=v.z;return(q||"roll"===w||p&&(0!==f||0!==j||0!==k))&&(q="roll"===w?s.handleRollTouch(x):s.handleRoll(f,j,u)),this.stepMotionDelta(),i.dirty&&(e=!0),e},this.handleResize=function(){s.resize(),q=!0},this.handleGesture=function(a){switch(a.type){case"dragstart":return w="drag",this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return w=null,this.handleButtonUp(a,0);case"rotatestart":return h.setIsLocked(!0),b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),w="roll",x=THREE.Math.degToRad(a.rotation),y={x:.5*(a.normalizedX+1),y:1-.5*(a.normalizedY+1)},z=d(a),!0;case"rotatemove":return x=THREE.Math.degToRad(a.rotation),"roll"===w;case"rotateend":return h.setIsLocked(!1),b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.handleCameraChange),x=THREE.Math.degToRad(a.rotation),w=null,!1}return!1},this.handleWheelInput=function(a){return!0},this.handleCameraChange=function(){var a=h.getEyeVector(),b=.5*(i.near+i.far);a.normalize().multiplyScalar(b);var c=a.add(i.position);s.updateHUD(c,g)},this.handleButtonDown=function(a,c){return t.x=.5*(a.normalizedX+1),t.y=1-.5*(a.normalizedY+1),u.copy(t),p=!0,w=null,h.setIsLocked(!0),this.controller.setIsLocked(!0),b.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,k.handleCameraChange),!0},this.handleButtonUp=function(a,c){return u.x=.5*(a.normalizedX+1),u.y=1-.5*(a.normalizedY+1),p=!1,q=!0,h.setIsLocked(!1),this.controller.setIsLocked(!1),b.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,k.handleCameraChange),!0},this.handleMouseMove=function(a){return u.x=.5*(a.normalizedX+1),u.y=1-.5*(a.normalizedY+1),!0},this.handleBlur=function(a){return p=!1,w=null,!1}},AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.ToolInterface=function(){this.names=["unnamed"],this.getNames=function(){return this.names},this.getName=function(){return this.names[0]},this.register=function(){},this.deregister=function(){},this.activate=function(a,b){},this.deactivate=function(a){},this.update=function(){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},function(){"use strict";function a(a,b){function d(){return b.getData().instanceTree}function e(){}function f(c){var e=d();if(m[c]>0)m[c]--,0==m[c]&&a.highlightObjectNode(b,c,!1);else if(m[c]<0)throw"Selection State machine broken. Negatively selected object!";e&&e.enumNodeChildren(c,function(a){f(a)},!1)}function g(c,e){var f=d();m[c]?m[c]++:(a.highlightObjectNode(b,c,!0,e),m[c]=1),f&&f.enumNodeChildren(c,function(a){g(a,!0)},!1)}function h(a){return void 0!==a&&l.selectedObjectIds[a]?!0:void 0}function i(a){var b=d();if(!b||(a=b.findNodeForSelection(a,l.selectionMode),b.isNodeSelectable(a))){var c=h(a);c||(l.selectedObjectIds[a]=a,l.selectionCount++,g(a))}}function j(a){var b=h(a);b&&(f(a),l.selectedObjectIds[a]=0,l.selectionCount--)}function k(a){if(l.selectionCount!==a.length)return!1;for(var b=0;b<a.length;b++)if(!h(a[b]))return!1;return!0}var l=this;this.selectedObjectIds={},this.selectionCount=0,this.selectionMode=c.SelectionMode.LEAF_OBJECT;var m={};this.getInstanceTree=d,this.getSelectionLength=function(){return l.selectionCount},this.getSelection=function(){var a=[],b=l.selectedObjectIds;for(var c in b)if(b[c]){var d=parseInt(c);a.push(d)}return a},this.clearSelection=function(a){if(this.selectionCount>0){var b=l.selectedObjectIds;for(var c in b){var d=parseInt(c);void 0!==d&&f(d)}l.selectedObjectIds={},l.selectionCount=0,a||e()}},this.deselectInvisible=function(){var a=!1,b=l.selectedObjectIds,c=d();for(var f in b){var g=parseInt(f),h=c.isNodeHidden(g);g&&h&&(j(g),a=!0)}return a&&e(),a},this.toggleSelection=function(a){return a?(h(a)?j(a):i(a),void e()):void console.error("Attempting to select node 0.")},this.setSelectionMode=function(a){this.clearSelection(!0),this.selectionMode=a},this.setSelection=function(a){if(!k(a)&&(this.clearSelection(!0),null!=a&&0!==a.length)){for(var b=0;b<a.length;b++)i(a[b]);e()}},this.getSelectionBounds=function(){var a=new THREE.Box3,c=new THREE.Box3,e=d(),f=b.getFragmentList(),g=l.selectedObjectIds;for(var h in g){var i=parseInt(h);e.enumNodeFragments(i,function(b){f.getWorldBounds(b,c),a.union(c)},!0)}return a},this.getSelectionVisibility=function(){var a=!1,b=!1,c=l.selectedObjectIds;for(var e in c){var f=parseInt(e);if(f){var g=d();if(g&&g.isNodeHidden(f)?b=!0:a=!0,a&&b)break}}return{hasVisible:a,hasHidden:b}},this.dtor=function(){this.selectedObjectIds=null}}function b(b){function d(){g.length>1&&stderr("This selection call does not yet support multiple models.")}function e(){for(var a=[],d=0;d<g.length;d++){var e=[],f=[],h=g[d].selector.selectedObjectIds,i=g[d].selector.getInstanceTree();for(var j in h)if(h[j]){var k=parseInt(j);k&&(e.push(k),i&&i.enumNodeFragments(k,function(a){f.push(a)},!1))}e.length&&a.push({fragIdsArray:f,dbIdArray:e,nodeArray:e,model:g[d]})}var l;1===g.length&&(l={type:c.SELECTION_CHANGED_EVENT,fragIdsArray:a[0]?a[0].fragIdsArray:[],dbIdArray:a[0]?a[0].dbIdArray:[],nodeArray:a[0]?a[0].dbIdArray:[],model:g[0]},b.api.fireEvent(l)),l={type:c.AGGREGATE_SELECTION_CHANGED_EVENT,selections:a},b.api.fireEvent(l)}function f(){for(var a=!1,b=0;b<g.length;b++)a=g[b].selector.deselectInvisible()||a;a&&e()}var g=[];this.addModel=function(c){-1==g.indexOf(c)&&(c.selector=new a(b,c),g.push(c))},this.removeModel=function(a){var b=g.indexOf(a);a.selector=null,g.splice(b,1)},this.getSelectionLength=function(){return d(),g[0].selector.getSelectionLength()},this.getSelection=function(){return d(),g.length>1&&console.warn("Use getAggregateSelection instead of getSelection when there are multiple models in the scene."),g[0].selector.getSelection()},this.getAggregateSelection=function(){for(var a=[],b=0;b<g.length;b++){var c=g[b].selector.getSelection();c&&c.length&&a.push({model:g[b],selection:c})}return a},this.clearSelection=function(a){for(var b=0;b<g.length;b++)g[b].selector.clearSelection(a);a||e()},this.toggleSelection=function(a,b){b||(d(),b=g[0]),b.selector.toggleSelection(a),e()},this.setSelectionMode=function(a){for(var b=0;b<g.length;b++)g[b].selector.setSelectionMode(a)},this.setSelection=function(a,b){if(a&&0!==a.length){if(b)for(var c=0;c<g.length;c++)g[c]!==b&&g[c].selector.clearSelection();else d(),b=g[0];b.selector.setSelection(a)}else this.clearSelection();e()},this.getSelectionBounds=function(){if(1==g.length)return g[0].selector.getSelectionBounds();for(var a=new THREE.Box3,b=0;b<g.length;b++){var c=g[b].selector.getSelectionBounds();a.union(c)}return a},this.getSelectionVisibility=function(){return d(),g[0].selector.getSelectionVisibility()},this.dtor=function(){for(var a=0;a<g.length;a++)g[a].selector.dtor()},b.api.addEventListener(c.ISOLATE_EVENT,function(a){f()}),b.api.addEventListener(c.HIDE_EVENT,function(a){f()})}var c=Autodesk.Viewing,d=c.Private;d.Selector=a,d.MultiModelSelector=b}(),function(){"use strict";function a(a){this.viewer=a,this.models=[]}var b=Autodesk.Viewing,c=function(a,b){this.viewerImpl=a,this.model=b,this.isolatedNodes=[],this.hiddenNodes=[]};c.prototype.getInstanceTree=function(){return this.model?this.model.getData().instanceTree:null},c.prototype.getIsolatedNodes=function(){return this.isolatedNodes.slice(0)},c.prototype.getHiddenNodes=function(){return this.hiddenNodes.slice(0)},c.prototype.isolate=function(a){var b=this.getInstanceTree().getRootId(),c="number"==typeof a&&a===b||"object"==typeof a&&a.dbId===b;a&&!c?this.isolateMultiple(Array.isArray(a)?a:[a]):this.isolateNone()},c.prototype.isolateNone=function(){this.model.setAllVisibility(!0),this.viewerImpl.sceneUpdated(!0);var a=this.model?this.model.getRootId():null;a&&this.setVisibilityOnNode(a,!0),this.hiddenNodes=[],this.isolatedNodes=[],this.viewerImpl.invalidate(!0);var c={type:b.ISOLATE_EVENT,nodeIdArray:[],model:this.model};this.viewerImpl.api.fireEvent(c)},c.prototype.isolateMultiple=function(a){if(a&&0!=a.length){var c=this.model.getRootId();c&&this.setVisibilityOnNode(c,!1),this.model.setAllVisibility(!1),this.viewerImpl.sceneUpdated(!0),this.isolatedNodes=a.slice(0),this.hiddenNodes=[];for(var d=0;d<a.length;d++)this.setVisibilityOnNode(a[d],!0);var e={type:b.ISOLATE_EVENT,nodeIdArray:a,model:this.model};this.viewerImpl.api.fireEvent(e)}else this.isolateNone();this.viewerImpl.invalidate(!0)},c.prototype.hide=function(a){var c;if(Array.isArray(a)){for(var d=0;d<a.length;++d)this.setVisibilityOnNode(a[d],!1);a.length>0&&(c={type:b.HIDE_EVENT,nodeIdArray:a})}else this.setVisibilityOnNode(a,!1),c={type:b.HIDE_EVENT,nodeIdArray:[a]};c&&this.viewerImpl.api.fireEvent(c)},c.prototype.show=function(a){var c;if(Array.isArray(a)){for(var d=0;d<a.length;++d)this.setVisibilityOnNode(a[d],!0);a.length>0&&(c={type:b.SHOW_EVENT,nodeIdArray:a})}else this.setVisibilityOnNode(a,!0),c={type:b.SHOW_EVENT,nodeIdArray:[a]};c&&this.viewerImpl.api.fireEvent(c)},c.prototype.toggleVisibility=function(a){var c=this.getInstanceTree().isNodeHidden(a);this.setVisibilityOnNode(a,c);var d={type:c?b.SHOW_EVENT:b.HIDE_EVENT,nodeIdArray:[a]};this.viewerImpl.api.fireEvent(d)},c.prototype.setVisibilityOnNode=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getInstanceTree(),f=!b;e?e.enumNodeChildren(a,function(a){e.setNodeHidden(a,f),e.enumNodeFragments(a,function(a){d.setVisibility(a,b)},!1)},!0):d.setVisibility(a,b),c.sceneUpdated(!0),this.updateNodeVisibilityTracking(a,b)},c.prototype.updateNodeVisibilityTracking=function(a,b){var c=b;if(this.isolatedNodes.length>0){var d=this.isolatedNodes.indexOf(a);c&&-1===d?this.isolatedNodes.push(a):c||-1===d||this.isolatedNodes.splice(d,1)}else{var e=this.hiddenNodes.indexOf(a);c||-1!==e?c&&-1!==e&&this.hiddenNodes.splice(e,1):this.hiddenNodes.push(a)}var f=this.getInstanceTree();f&&f.root&&f.root.dbId===a&&(b?(this.isolatedNodes=[],this.hiddenNodes=[]):(this.isolatedNodes=[],this.hiddenNodes=[a]))},c.prototype.setNodeOff=function(a,b){var c=this.viewerImpl,d=this.model,e=this.getInstanceTree();e?e.enumNodeChildren(a,function(a){e.setNodeOff(a,b),e.enumNodeFragments(a,function(a){d.getFragmentList().setFragOff(a,b)},!1)},!0):d.getFragmentList().setFragOff(a,b),c.sceneUpdated(!0)},b.Private.VisibilityManager=c,a.prototype.addModel=function(a){-1==this.models.indexOf(a)&&(a.visibilityManager=new c(this.viewer,a),this.models.push(a))},a.prototype.removeModel=function(a){var b=this.models.indexOf(a);a.visibilityManager=null,this.models.splice(b,1)},a.prototype.warn=function(){this.models.length>1&&stderr("This selection call does not yet support multiple models.")},a.prototype.getIsolatedNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getIsolatedNodes()},a.prototype.getHiddenNodes=function(a){return a||(this.warn(),a=this.models[0]),a.visibilityManager.getHiddenNodes()},a.prototype.isolate=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.isolate(a)},a.prototype.hide=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.hide(a)},a.prototype.show=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.show(a)},a.prototype.toggleVisibility=function(a,b){b||(this.warn(),b=this.models[0]),b.visibilityManager.toggleVisibility(a)},a.prototype.setVisibilityOnNode=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setVisibilityOnNode(a,b)},a.prototype.setNodeOff=function(a,b,c){c||(this.warn(),c=this.models[0]),c.visibilityManager.setNodeOff(a,b)},b.Private.MultiModelVisibilityManager=a}(),!LMV_WORKER_URL)var LMV_WORKER_URL="src/workers/MainWorker.js";if(void 0==ENABLE_INLINE_WORKER)var ENABLE_INLINE_WORKER=!1;!function(){"use strict";var a=Autodesk.Viewing,b=a.Private,c=null,d=!1,e=[];b.initWorkerScript=function(a,f){if(ENABLE_INLINE_WORKER&&!c){if(e.push({successCB:a}),d)return;var g=new XMLHttpRequest,h=LMV_WORKER_URL,i=b.getResourceUrl(LMV_WORKER_URL);i&&(h=i),g.open("GET",h,!0),g.withCredentials=!1,g.onload=function(){d=!1;var a;window.URL=window.URL||window.webkitURL;try{a=new Blob([g.responseText],{type:"application/javascript"})}catch(b){a=new BlobBuilder,a.append(g.responseText),a=a.getBlob()}c=URL.createObjectURL(a);var f=e.concat();e=[];for(var h=0;h<f.length;++h)f[h].successCB&&f[h].successCB()},d=!0,g.send()}else a&&a()},b.createWorker=function(){return ENABLE_INLINE_WORKER?new Worker(c):new Worker(b.getResourceUrl(LMV_WORKER_URL))},b.createWorkerWithIntercept=function(){function a(a){if(!d)return null;for(var b=0;b<d.length;++b)if(d[b].arg===a){var c=d[b].callback;return d.splice(b,1),0===d.length&&(d=null),c}return null}var c=b.createWorker();c.checkEvent=function(a){return a.data&&a.data.assetRequest?(b.assets&&b.assets.push(a.data.assetRequest),!0):!1};var d=[];return c.addEventListenerWithIntercept=function(a){var b=function(b){c.checkEvent(b)||a(b)};return d||(d=[]),d.push({arg:a,callback:b}),c.addEventListener("message",b,!1),b},c.removeEventListenerWithIntercept=function(b){var d=a(b);d&&c.removeEventListener("message",d,!1)},c.clearAllEventListenerWithIntercept=function(){if(d)for(var a=d.concat(),b=0;b<a.length;++b)c.removeEventListenerWithIntercept(a[b].arg)},c}}(),function(){"use strict";function a(a){var b=a.data;if(b&&b.debug)return void stderr(b.message);if(b.cbId){var c=l[b.cbId];b&&b.error?c[1]&&c[1](b.error):c[0]&&c[0](b.result),delete l[b.cbId]}}function b(a,b){var c=k++;return l[c]=[a,b],c}var c="GET_PROPERTIES",d="SEARCH_PROPERTIES",e="BUILD_EXTERNAL_ID_MAPPING",f="GET_OBJECT_TREE",g="ATTRIBUTES_MAP",h=Autodesk.Viewing,i=h.Private,j=function(a,b,c){this.sharedDbPath=a,this.propWorker=null,this.eventTarget=c,this.model=b,this.svf=b.getData(),this.domainParam=auth?"domain="+encodeURIComponent(window.location.origin):""};j.prototype.dtor=function(){this.propWorker&&(this.propWorker.clearAllEventListenerWithIntercept(),this.propWorker.terminate(),this.propWorker=null)};var k=1,l={};j.prototype.load=function(){var c=this,d=function(a){var b=a.instanceTree,d=a.instanceBoxes;b?(c.svf.instanceTree=new i.InstanceTree(b,d,a.objectCount,a.maxTreeDepth),c.svf.fragToNodeDone=!0):a.objectCount&&(c.svf.hasObjectProperties=a.objectCount),c.eventTarget.fireEvent({type:h.OBJECT_TREE_CREATED_EVENT,svf:c.svf,model:c.model})},e=function(a){c.propertyDbError=a,c.eventTarget.fireEvent({type:h.OBJECT_TREE_UNAVAILABLE_EVENT,svf:c.svf,model:c.model})};if(this.svf.instanceTree&&this.svf.instanceBoxes){var g=this.svf;return void setTimeout(function(){d(g)},0)}var j=b(d,e),k=i.pathToURL(this.svf.basePath);this.sharedDbPath&&!this.svf.propertydb.values.length&&(k=this.sharedDbPath,stderr("Using shared property db: "+k));var l={operation:f,url:k,propertydb:this.svf.propertydb,headers:h.HTTP_REQUEST_HEADERS,fragToDbId:this.svf.fragments.fragId2dbId,fragBoxes:this.svf.fragments.boxes,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,cbId:j,queryParams:this.domainParam};this.propWorker||(this.propWorker=i.createWorkerWithIntercept(),this.propWorker.addEventListenerWithIntercept(a)),this.propWorker.postMessage(l)},j.prototype.asyncPropertyOperation=function(a,c,d){var e=this;if(e.svf.instanceTree||e.svf.hasObjectProperties)a.cbId=b(c,d),this.propWorker.postMessage(a);else if(e.propertyDbError)d&&d(e.propertyDbError);else{var f=function(b){e.eventTarget.removeEventListener(h.OBJECT_TREE_CREATED_EVENT,f),e.eventTarget.removeEventListener(h.OBJECT_TREE_UNAVAILABLE_EVENT,f),b.svf.instanceTree||b.svf.hasObjectProperties||e.propertyDbError?e.asyncPropertyOperation(a,c,d):d&&d({code:h.UNKNOWN_FAILURE,msg:"Failed to load properties"})};e.eventTarget.addEventListener(h.OBJECT_TREE_CREATED_EVENT,f),e.eventTarget.addEventListener(h.OBJECT_TREE_UNAVAILABLE_EVENT,f)}},j.prototype.getProperties=function(a,b,d){this.asyncPropertyOperation({operation:c,dbId:a},b,d)},j.prototype.getBulkProperties=function(a,b,d,e){this.asyncPropertyOperation({operation:c,dbIds:a,propFilter:b},d,e)},j.prototype.searchProperties=function(a,b,c,e){this.asyncPropertyOperation({operation:d,searchText:a,attributeNames:b},c,e)},j.prototype.getExternalIdMapping=function(a,b){this.asyncPropertyOperation({operation:e},a,b)},j.prototype.getObjectTree=function(a,b){var c=this;if(c.svf.instanceTree)a(c.svf.instanceTree);else if(c.propertyDbError||"hasObjectProperties"in c.svf)b&&b(c.propertyDbError);else{var d=function(){c.eventTarget.removeEventListener(h.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.removeEventListener(h.OBJECT_TREE_UNAVAILABLE_EVENT,d),c.getObjectTree(a,b)};c.eventTarget.addEventListener(h.OBJECT_TREE_CREATED_EVENT,d),c.eventTarget.addEventListener(h.OBJECT_TREE_UNAVAILABLE_EVENT,d)}},j.prototype.attributeToIdMap=function(a,b){this.asyncPropertyOperation({operation:g},a,b)},i.PropDbLoader=j}(),function(){"use strict";var a=isMobileDevice()?2:6,b="LOAD_GEOMETRY",c="LOAD_SVF",d="LOAD_SVF_CONTD",e=Autodesk.Viewing,f=Autodesk.Viewing.Private,g=function(a){this.viewer3DImpl=a,this.next_pack=0,this.loading=!1,this.loadedPacksCount=0,this.loadedPacks=[],this.tmpMatrix=new THREE.Matrix4,this.logger=f.logger,this.loadTime=0,this.domainParam=auth?"domain="+encodeURIComponent(window.location.origin):"",this.onDemandLoading=!1,this.cullGeometryOnLoading=!1,this.pageOutGeometryEnabled=!1};g.prototype.dtor=function(){if(this.svf=null,this.options=null,this.svfWorker&&(this.svfWorker.clearAllEventListenerWithIntercept(),this.svfWorker.terminate(),this.svfWorker=null),this.pack_workers){for(var a=0;a<this.pack_workers.length;a++)this.pack_workers[a].clearAllEventListenerWithIntercept(),this.pack_workers[a].terminate();
this.pack_workers=null}},f.pathToURL=function(a){if(-1!==a.indexOf("://")||0===a.indexOf("urn:"))return a;var b=window.location.pathname,c=b.lastIndexOf("/");b=b.substr(0,c+1);var d=window.location.protocol+"//"+window.location.host+b+a;return d},g.prototype.loadFile=function(a,b,c,d){if(this.loading)return console.log("Loading of SVF already in progress. Ignoring new request."),!1;this.dtor(),this.viewer3DImpl.model&&!b.globalOffset&&(b.globalOffset=this.viewer3DImpl.model.getData().globalOffset);var e=a.indexOf("urn:");if(-1!=e){a=decodeURIComponent(a);var g=a.substr(e,a.substr(e).indexOf("/"));stderr("Extracted URN: "+g);var h=g.lastIndexOf(":");this.svfUrn=g.substr(h+1)}else this.svfUrn=a;this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a,this.options=b;var i=this;return f.initWorkerScript(function(){i.loadSvfCB(a,b,c,d)}),!0},g.prototype.interceptManifest=void 0,g.prototype.loadSvfCB=function(b,g,h,i){this.t0=(new Date).getTime(),this.failedToLoadSomeGeometryPacks=null;var j=this,k={url:f.pathToURL(b),headers:e.HTTP_REQUEST_HEADERS,objectIds:g.ids,globalOffset:g.globalOffset,placementTransform:g.placementTransform,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam,bvhOptions:g.bvhOptions||{isWeakDevice:isAndroidDevice()||isIOSDevice()}},l=this.svfWorker=f.createWorkerWithIntercept(),m=function(b){var c=function(){l.clearAllEventListenerWithIntercept(),l.terminate(),j.svfWorker=null,l=null};if(b.data&&b.data.manifest)j.interceptManifest(b.data.manifest),k.operation=d,k.manifest=b.data.manifest,l.postMessage(k);else if(b.data&&b.data.svf){var g=j.svf=b.data.svf;if(j.failedToLoadSomeGeometryPacks&&(i&&i(j.failedToLoadSomeGeometryPacks.code,j.failedToLoadSomeGeometryPacks.msg),j.failedToLoadSomeGeometryPacks=null),j.onSvfLoadDone(g),h&&h(j.model),j.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:g,model:j.model}),j.svf.loadDone=!1,!j.svf.metadata.gltf){var m=g.geompacks.length;if(0==m)j.onGeomLoadDone();else if(g.fragments.length>f.FRAGS_PERSISTENT_MAX_COUNT?(j.onDemandLoading=f.onDemandLoading,j.cullGeometryOnLoading=f.cullGeometryOnLoading):(j.onDemandLoading=!1,j.cullGeometryOnLoading=!1),stderr("SVF on demand loading: "+j.onDemandLoading),stderr("SVF culling geometry on loading: "+j.cullGeometryOnLoading),j.onDemandLoading)j.loadedPacksCount=0;else if(m)for(var n=Math.min(m,a),o=0;n>o;o++){var p=g.geompacks[o];p.loading=!0,j.loadGeometryPack(p.id,p.uri),j.next_pack=o+1}}1==b.data.progress&&(j.loading=!1,c()),g.fragments.polygonCounts||(g.fragments.polygonCounts=new Int32Array(g.fragments.length))}else b.data&&b.data.bvh?(j.svf.bvh||(j.svf.bvh=b.data.bvh,j.model.setBVH(new NodeArray(j.svf.bvh.nodes,j.svf.bvh.useLeanNodes),j.svf.bvh.primitives,j.options.bvhOptions),j.viewer3DImpl.invalidate(!1,!0)),1==b.data.progress&&(j.loading=!1,c())):b.data&&b.data.mesh?(j.processReceivedMesh(b.data),1===b.data.progress&&(j.onGeomLoadDone(),j.loading=!1,c())):b.data&&b.data.progress?1==b.data.progress&&(j.loading=!1,c()):b.data&&b.data.error?(j.loading=!1,c(),i&&i(b.data.error.code,b.data.error.msg,b.data.error.args.httpStatus,b.data.error.args.httpStatusText)):b.data&&b.data.debug?stderr(b.data.message):(stderr("SVF download failed."),j.loading=!1,c())};return l.addEventListenerWithIntercept(m),k.operation=c,k.interceptManifest=!!this.interceptManifest,l.postMessage(k),!0},g.prototype.loadGeometryPackOnDemand=function(c){var d=this;if(d.onDemandLoading){var g=d.svf.geompacks[c];if(!g.loading){var h,i=function(a){if(a.data&&a.data.mesh){if(d.processReceivedMesh(a.data),a.data.progress>=1){d.pack_workers[a.data.workerId].queued-=1,d.svf.geompacks[a.data.packId].loading=!1;var b=d.model.geomPacksMissingLastFrame(),c=b.indexOf(a.data.packId);c>=0&&b.splice(c,1);for(var e=!0,f=0;f<d.pack_workers.length;f++)if(0!=d.pack_workers[f].queued){e=!1;break}-1==d.loadedPacks.indexOf(a.data.packId)&&d.loadedPacks.push(a.data.packId),e&&0==d.model.geomPacksMissingLastFrame().length&&(d.loadedPacks.length==d.svf.geompacks.length?d.onGeomLoadDone():d.onGeomPackFilesLoadDone())}}else if(a.data&&a.data.progress){d.pack_workers[a.data.workerId].queued-=1,d.loadedPacksCount++;var g,i=null,b=d.model.geomPacksMissingLastFrame();for(h=0;h<b.length&&(g=b[h],i=d.svf.geompacks[g],i.loading);++h);i&&!i.loading&&d.loadGeometryPackOnDemand(g),d.viewer3DImpl.signalProgress(100*d.loadedPacks.length/d.svf.geompacks.length)}else a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?d.failedToLoadSomeGeometryPacks={code:a.data.error.code,msg:a.data.error.msg}:(d.pack_workers[a.data.workerId].queued-=2,d.svf.geompacks[a.data.packId].loading=!1)};if(!this.pack_workers)for(this.pack_workers=[],h=0;a>h;h++){var j=f.createWorkerWithIntercept();j.addEventListenerWithIntercept(i),j.queued=0,this.pack_workers.push(j)}var k=0,l=this.pack_workers[0].queued;for(h=1;a>h;h++)this.pack_workers[h].queued<l&&(k=h,l=this.pack_workers[h].queued);if(l>2)return void d.model.addGeomPackMissingLastFrame(c);var m,n,o=g.uri;m=this.pack_workers[k],m.queued+=2,n=k,g.loading=!0,d.svf.partPacksLoadDone=!1;var p=f.pathToURL(this.svf.basePath+o),q={operation:b,url:p,packId:parseInt(c),headers:e.HTTP_REQUEST_HEADERS,workerId:n,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam};m.postMessage(q)}}},g.prototype.loadGeometryPack=function(c,d){var g,h,i,j,k=this,l=function(b){if(b.data&&b.data.mesh){if(k.processReceivedMesh(b.data),b.data.progress>=1){k.pack_workers[b.data.workerId].queued-=1,k.loadedPacksCount++,k.viewer3DImpl.signalProgress(100*k.loadedPacksCount/k.svf.geompacks.length);var c=!0;for(j=0;j<k.pack_workers.length;j++)if(0!=k.pack_workers[j].queued){c=!1;break}if(c){for(j=0;a>j;j++)k.pack_workers[j].clearAllEventListenerWithIntercept(),k.pack_workers[j].terminate();k.pack_workers=null}k.svf.fragments.numLoaded==k.svf.fragments.length&&k.onGeomLoadDone()}}else if(b.data&&b.data.progress){if(k.pack_workers[b.data.workerId].queued-=1,k.next_pack<k.svf.geompacks.length){var d=null,e=k.model.geomPacksMissingLastFrame();for(i=0;i<e.length&&(d=k.svf.geompacks[e[i]],!d||d.loading);++i);if(!d||d.loading)for(;k.next_pack<k.svf.geompacks.length&&(d=k.svf.geompacks[k.next_pack++],d.loading););d&&!d.loading?(d.loading=!0,k.loadGeometryPack(d.id,d.uri)):(k.viewer3DImpl.modelQueue().enforceBvh=!1,k.svf.fragments.packIds=null)}}else b.data&&b.data.debug?stderr(b.data.message):b.data&&b.data.error?k.failedToLoadSomeGeometryPacks={code:b.data.error.code,msg:b.data.error.msg}:k.pack_workers[b.data.workerId].queued-=2};if(!this.pack_workers)for(this.pack_workers=[],i=0;a>i;i++){var m=f.createWorkerWithIntercept();m.addEventListenerWithIntercept(l),m.queued=0,this.pack_workers.push(m)}var n=0,o=this.pack_workers[0].queued;for(i=1;a>i;i++)this.pack_workers[i].queued<o&&(n=i,o=this.pack_workers[i].queued);g=this.pack_workers[n],g.queued+=2,h=n;var p=f.pathToURL(this.svf.basePath+d),q={operation:b,url:p,packId:parseInt(c),headers:e.HTTP_REQUEST_HEADERS,workerId:h,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam};g.postMessage(q)},g.prototype.processReceivedMesh=function(a){var b=a.packId+":"+a.meshIndex,c=this.svf,d=c.fragments,e=d.mesh2frag[b];if(void 0===e)return void stderr("Mesh "+b+" was not referenced by any fragments.");if(Array.isArray(e)||(e=[e]),this.cullGeometryOnLoading){for(var g=!0,h=0;h<e.length;++h){if(e[h]<f.FRAGS_PERSISTENT_COUNT){g=!1;break}if(g=g&&this.viewer3DImpl.modelQueue().checkCull(e[h],!0,!0),!g)break}if(g)return void(a.mesh=null)}BufferGeometryUtils.meshToGeometry(a);var i=e.length,j=this.model,k=j.getFragmentList().getGeometryId(e[0]),l=j.getGeometryList().addGeometry(a.geometry,i,k);this.cullGeometryOnLoading&&i>1&&null==j.getFragmentList().geomidsmap[l]&&(j.getFragmentList().geomidsmap[l]={n:i,t:0});for(var m=a.geometry.attributes.index.array||a.geometry.ib,n=m.length/3,h=0;h<e.length;h++){var o=0|e[h];j.getFragmentList().getOriginalWorldMatrix(o,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var p=d.materials[o].toString();d.polygonCounts&&(d.polygonCounts[o]=n);var q=this.viewer3DImpl.createThreeMesh(this.model,a.geometry,p,this.tmpMatrix);j.activateFragment(o,q,!!this.options.placementTransform)}this.onDemandLoading||(d.mesh2frag[b]=null),d.numLoaded+=e.length,c.geomPolyCount>c.nextRepaintPolys&&(c.numRepaints++,c.nextRepaintPolys+=1e4*Math.pow(1.5,c.numRepaints),this.viewer3DImpl.invalidate(!1,!0))},g.prototype.onSvfLoadDone=function(a){a.geomPolyCount=0,a.instancePolyCount=0,a.geomMemory=0,a.fragments.numLoaded=0,a.meshCount=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.nextRepaintPolys=1e4,a.numRepaints=0,a.urn=this.svfUrn,a.basePath="";var b=this.currentLoadPath.lastIndexOf("/");-1!=b&&(a.basePath=this.currentLoadPath.substr(0,b+1));var c=Date.now();this.loadTime+=c-this.t0,stderr("SVF load: "+(c-this.t0));var d=this.model=new f.RenderModel(a);d.initialize(this),d.loader=this;var e=!(this.onDemandLoading&&(isAndroidDevice()||isIOSDevice()));e&&this.loadPropertyDb();var g=this.viewer3DImpl.matman().convertMaterials(a);if(this.t0=c,a.bbox=(new THREE.Box3).copy(a.bbox),a.cameras)for(var h=0;h<a.cameras.length;h++){var i=a.cameras[h];i.position=(new THREE.Vector3).copy(i.position),i.target=(new THREE.Vector3).copy(i.target),i.up=(new THREE.Vector3).copy(i.up)}if(a.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT&&this.viewer3DImpl.matman().loadTextures(a),stderr("scene bounds: "+JSON.stringify(a.bbox)),this.logger){var j={category:"metadata_load_stats",urn:a.urn,has_topology:!!a.topology,has_animations:!!a.animations,cameras:a.cameras?a.cameras.length:0,lights:a.lights?a.lights.length:0,materials:g};this.logger.log(j)}this.viewer3DImpl.signalProgress(5,"Hold on, getting the model..."),this.viewer3DImpl.invalidate(!1,!1)},g.prototype.addTransparencyFlagsToMaterials=function(a){for(var b in a){var c=a[b],d=c.userassets;if(d){var e=c.materials,f=e[d[0]];c.transparent=f.transparent}}},g.prototype.makeBVH=function(a){var b=performance.now(),c=a.materials?a.materials.materials:null;c&&this.addTransparencyFlagsToMaterials(c),a.bvh=new BVHBuilder(a.fragments,c),a.bvh.build(this.options.bvhOptions||{isWeakDevice:isAndroidDevice()||isIOSDevice()});var d=performance.now();stderr("BVH build time: "+(d-b))},g.prototype.onGeomPackFilesLoadDone=function(){stderr("Part of geom pack files are load done."),this.svf.partPacksLoadDone=!0,this.viewer3DImpl.invalidate(!1,!0)},g.prototype.onGeomLoadDone=function(){function a(a){var b={command:"assets",data:a};window.webkit.messageHandlers.callbackHandler.postMessage(b)}this.svf.loadDone=!0,this.svf.proteinMaterials&&PROTEIN_ROOT&&PRISM_ROOT||this.viewer3DImpl.matman().loadTextures(this.svf),this.onDemandLoading||(this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null);var b=Date.now(),c="Fragments load time: "+(b-this.t0);if(this.loadTime+=b-this.t0,(!this.svf.bvh||this.options.placementTransform)&&(this.makeBVH(this.svf),this.model.setBVH(this.svf.bvh.nodes,this.svf.bvh.primitives,this.options.bvhOptions)),stderr(c),this.logger){var d={category:"model_load_stats",is_f2d:!1,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,fragments_count:this.model.getFragmentList().getCount(),urn:this.svfUrn};this.logger.log(d,!0)}f.assets&&window.webkit&&(a(f.assets),f.assets=null),this.currentLoadPath=null,this.viewer3DImpl.onLoadComplete(this.model)},g.prototype.loadPropertyDb=function(){this.svf.propWorker=new f.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propWorker.load()},f.SvfLoader=g,e.FileLoaderManager.registerFileLoader("svf",["svf","gltf","glb"],f.SvfLoader)}(),function(){"use strict";function a(a){this.viewer3DImpl=a,this.loading=!1,this.tmpMatrix=new THREE.Matrix4,this.logger=f.logger,this.loadTime=0,this.domainParam=auth?"domain="+encodeURIComponent(window.location.origin):""}var b="PARSE_F2D",c="STREAM_F2D",d="PARSE_F2D_FRAME",e=Autodesk.Viewing,f=Autodesk.Viewing.Private;a.prototype.dtor=function(){this.svf=null,this.options=null,this.parsingWorker&&(this.parsingWorker.terminate(),this.parsingWorker=null),this.streamingWorker&&(this.streamingWorker.terminate(),this.streamingWorker=null)},a.prototype.loadFile=function(a,b,c,d){if(this.loading)return console.log("Loading of SVF already in progress. Ignoring new request."),!1;this.dtor();var e=a.indexOf("urn:");if(-1!=e){a=decodeURIComponent(a);var g=a.substr(e,a.substr(e).indexOf("/"));stderr("Extracted URN: "+g);var h=g.lastIndexOf(":");this.svfUrn=g.substr(h+1)}else this.svfUrn=a;this.sharedDbPath=b.sharedPropertyDbPath,this.currentLoadPath=a,this.options=b,this.options.placementTransform?this.modelScale=this.options.placementTransform.getMaxScaleOnAxis():this.modelScale=1,this.isf2d=!0;var i=this;return f.initWorkerScript(function(){i.loadFydoCB(a,b,c,d)}),!0},a.prototype.loadFydoCB=function(a,g,h,i){this.t0=Date.now();var j=f.pathToURL(a),k=this.streamingWorker=f.createWorker(),l=this.parsingWorker=f.createWorker(),m=this,n=function(a){if(a.data&&"F2DBLOB"==a.data.type){var c={operation:b,data:a.data.buffer,metadata:a.data.metadata,manifest:a.data.manifest,basePath:a.data.basePath,f2dLoadOptions:{modelSpace:g.modelSpace,bgColor:g.bgColor},url:j};l.postMessage(c,[c.data]),k.terminate()}else if(a.data&&"F2DSTREAM"==a.data.type){var c={operation:d,data:a.data.frames,url:j,f2dLoadOptions:{modelSpace:g.modelSpace,bgColor:g.bgColor}};a.data.metadata&&(c.metadata=a.data.metadata,c.manifest=a.data.manifest),a.data.finalFrame&&(c.finalFrame=!0),a.data.progress&&m.viewer3DImpl.signalProgress(100*a.data.progress),l.postMessage(c,c.data?[c.data]:void 0),a.data.finalFrame&&k.terminate()}else a.data&&"F2DAssetURL"==a.data.type?f.assets=f.assets.concat(a.data.urls):a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,k.terminate(),i&&i.call(this,a.data.error.code,a.data.error.msg,a.data.error.args.httpStatus,a.data.error.args.httpStatusText)):(stderr("F2D download failed."),m.loading=!1,k.terminate())},o=function(a){if(a.data&&a.data.f2d){var b=m.svf=a.data.f2d;l.terminate(),stderr("Num polylines: "+b.numPolylines),stderr("Line segments: "+b.numLineSegs),stderr("Circular arcs: "+b.numCircles),stderr("Ellipitcal arcs:"+b.numEllipses),stderr("Plain triangles:"+b.numTriangles),stderr("Total # of op codes generated by fydo.parse: "+b.opCount),m.onSvfLoadDone(m.svf),h&&h(m.model),m.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:m.svf,model:m.model});for(var c=0;c<b.meshes.length;c++)m.processReceivedMesh2D(b.meshes[c],c);b.meshes=null,m.onGeomLoadDone(),m.loading=!1}else if(a.data&&a.data.f2dframe){var d=0;if(a.data.meshes){var f=a.data.bbox;m.svf.bbox=new THREE.Box3(f.min,f.max),d=a.data.baseIndex}else m.svf=a.data.f2dframe,d=a.data.baseIndex;var b=m.svf;if(b.fragments&&b.fragments.initialized||(m.onSvfLoadDone(b),h&&h(m.model),m.viewer3DImpl.api.fireEvent({type:e.MODEL_ROOT_LOADED_EVENT,svf:b,model:m.model})),a.data.meshes&&a.data.meshes.length)for(var c=0;c<a.data.meshes.length;c++)m.processReceivedMesh2D(a.data.meshes[c],d+c);if(a.data.finalFrame){var g=a.data.cumulativeProps;for(var j in g)b[j]=g[j];m.onGeomLoadDone(),m.loading=!1,l.terminate()}}else a.data&&a.data.progress||(a.data&&a.data.debug?stderr(a.data.message):a.data&&a.data.error?(m.loading=!1,l.terminate(),stderr("Error while parsing F2d: "+JSON.stringify(a.data.error.args)),i&&i.call(this,a.data.error.code,a.data.error.msg,a.data.error.args.httpStatus,a.data.error.args.httpStatusText)):(stderr("F2D download failed."),m.loading=!1,l.terminate()))};k.addEventListener("message",n,!1),l.addEventListener("message",o,!1);var p={operation:c,url:j,headers:e.HTTP_REQUEST_HEADERS,objectIds:g.ids,auth:auth,viewing_url:VIEWING_URL,oss_url:OSS_URL,queryParams:this.domainParam};return k.postMessage(p),!0},a.prototype.processReceivedMesh=function(a){var b=a.packId+":"+a.meshIndex,c=this.svf,d=c.fragments,e=d.mesh2frag[b];if(void 0===e)return void stderr("Mesh "+b+" was not referenced by any fragments.");Array.isArray(e)||(e=[e]),BufferGeometryUtils.meshToGeometry(a);for(var f=e.length,g=this.model,h=(g.getGeometryList().addGeometry(a.geometry,f),a.geometry.attributes.index.array||a.geometry.ib),i=h.length/3,j=0;j<e.length;j++){var k=0|e[j];g.getFragmentList().getOriginalWorldMatrix(k,this.tmpMatrix),this.options.placementTransform&&(this.tmpMatrix=(new THREE.Matrix4).multiplyMatrices(this.options.placementTransform,this.tmpMatrix));var l=d.materials[k].toString();d.polygonCounts&&(d.polygonCounts[k]=i);var m=this.viewer3DImpl.createThreeMesh(this.model,a.geometry,l,this.tmpMatrix);g.activateFragment(k,m)}d.mesh2frag[b]=null,d.numLoaded+=e.length;var n=d.numLoaded;c.geomPolyCount>c.nextRepaintPolys&&(c.numRepaints++,c.nextRepaintPolys+=1e4*Math.pow(1.5,c.numRepaints),this.viewer3DImpl.invalidate(!1,!0)),n%20==0&&this.viewer3DImpl.invalidate(!1,!0)},a.prototype.processReceivedMesh2D=function(a,b){var c={mesh:a,is2d:!0,packId:"0",meshIndex:b},d="0:"+b,e=this.svf.fragments,f=Object.keys(c.mesh.dbIds).map(function(a){return parseInt(a)});e.fragId2dbId[b]=f;for(var g=0;g<f.length;g++){var h=f[g],i=e.dbId2fragId[h];Array.isArray(i)?i.push(b):"undefined"!=typeof i?e.dbId2fragId[h]=[i,b]:e.dbId2fragId[h]=b}e.mesh2frag[d]=b,a.material.modelScale=this.modelScale,e.materials[b]=this.viewer3DImpl.matman().create2DMaterial(this.svf,a.material),e.length++,this.processReceivedMesh(c)},a.prototype.onSvfLoadDone=function(a){a.fragments={},a.fragments.mesh2frag={},a.fragments.materials=[],a.fragments.fragId2dbId=[],a.fragments.dbId2fragId=[],a.fragments.length=0,a.fragments.initialized=!0,a.geomPolyCount=0,a.instancePolyCount=0,a.geomMemory=0,a.fragments.numLoaded=0,a.meshCount=0,a.gpuNumMeshes=0,a.gpuMeshMemory=0,a.nextRepaintPolys=1e4,a.numRepaints=0,a.urn=this.svfUrn,a.basePath="";var b=this.currentLoadPath.lastIndexOf("/");-1!=b&&(a.basePath=this.currentLoadPath.substr(0,b+1));var c=Date.now();this.loadTime+=c-this.t0,stderr("SVF load: "+(c-this.t0)),this.t0=c,a.bbox=(new THREE.Box3).copy(a.bbox);var d=this.model=new f.RenderModel(a);if(d.initialize(this),d.loader=this,stderr("scene bounds: "+JSON.stringify(a.bbox)),this.logger){var e={category:"metadata_load_stats",urn:a.urn,layers:a.layerCount};this.logger.log(e)}this.viewer3DImpl.signalProgress(5,"Hold on, getting the model..."),this.viewer3DImpl.invalidate(!1,!1)},a.prototype.onGeomLoadDone=function(){function a(a){var b={command:"assets",data:a};window.webkit.messageHandlers.callbackHandler.postMessage(b)}this.svf.loadDone=!0,this.svf.fragments.entityIndexes=null,this.svf.fragments.mesh2frag=null;var b=Date.now(),c="Fragments load time: "+(b-this.t0);if(this.loadTime+=b-this.t0,this.loadPropertyDb(),stderr(c),this.logger){var d={category:"model_load_stats",is_f2d:!0,has_prism:this.viewer3DImpl.matman().hasPrism,load_time:this.loadTime,geometry_size:this.model.getGeometryList().geomMemory,meshes_count:this.model.getGeometryList().geoms.length,urn:this.svfUrn};this.logger.log(d,!0)}f.assets&&window.webkit&&(a(f.assets),f.assets=null),this.currentLoadPath=null,this.isf2d=void 0,this.viewer3DImpl.onLoadComplete(this.model)},a.prototype.loadPropertyDb=function(){this.svf.propWorker=new f.PropDbLoader(this.sharedDbPath,this.model,this.viewer3DImpl.api),this.svf.propWorker.load()},f.F2DLoader=a,e.FileLoaderManager.registerFileLoader("f2d",["f2d"],f.F2DLoader)}(),function(a){"use strict";function b(a,b){var c=b||65536;this.useInstancing=a,this.stride=12,this.vb=new ArrayBuffer(4*this.stride*(this.useInstancing?c/4:c)),this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.vcount=0,this.ib=this.useInstancing?null:new Uint16Array(c),this.icount=0,this.minx=this.miny=1/0,this.maxx=this.maxy=-(1/0),this.dbIds={},this.numEllipticals=0,this.numCirculars=0,this.numTriangleGeoms=0}var c=2*Math.PI,d=0,e=1,f=2,g=3,h=4,i=5,j=0,k=1,l=2,m=3,n=6,o=7,p=8,q=9,r=[0,1,3,0,3,2];b.prototype.expandStride=function(){},b.prototype.addToBounds=function(a,b){a<this.minx&&(this.minx=a),a>this.maxx&&(this.maxx=a),b<this.miny&&(this.miny=b),b>this.maxy&&(this.maxy=b)},b.prototype.setCommonVertexAttribs=function(a,b,c,d,e,f,g,h){b=255&b,c=255&c,h=255&h,f=65535&f,g=65535&g,this.vbi[a+p]=b|c<<8|h<<16,this.vbi[a+n]=d,this.vbi[a+o]=e,this.vbi[a+q]=f|g<<16,this.dbIds[e]=1},b.prototype.addVertexTriangleGeom=function(a,b,c,d,e,f,g,h,k,l){for(var m=this.vcount,n=this.vbf,o=this.useInstancing?1:4,p=0;o>p;p++){var q=(m+p)*this.stride;n[q]=a,n[q+1]=b,n[q+2]=c,n[q+3]=d,n[q+4]=e,n[q+5]=f,this.setCommonVertexAttribs(q,j+p,i,g,h,k,l,0),this.vcount++}return m},b.prototype.addVertexLine=function(a,b,c,d,f,g,h,i,k,l,m){for(var n=this.vcount,o=this.vbf,p=this.useInstancing?1:4,q=0;p>q;q++){var r=(n+q)*this.stride;o[r]=a,o[r+1]=b,o[r+2]=c,o[r+3]=d,o[r+4]=.5*g,o[r+5]=f,this.setCommonVertexAttribs(r,j+q,e,h,i,k,l,m),this.vcount++}return n},b.prototype.addVertexTexQuad=function(a,b,c,d,e,f,g,i,k){for(var l=this.vcount,m=this.vbf,n=this.useInstancing?1:4,o=0;n>o;o++){var p=(l+o)*this.stride;m[p]=a,m[p+1]=b,m[p+2]=e,m[p+3]=c,m[p+4]=d,this.setCommonVertexAttribs(p,j+o,h,f,g,i,k,0),this.vcount++}return l},b.prototype.addVertexArc=function(a,b,c,d,e,h,i,k,l,m,n,o){for(var p=this.vcount,q=this.vbf,r=e==h?f:g,s=this.useInstancing?1:4,t=0;s>t;t++){var u=(p+t)*this.stride;q[u]=a,q[u+1]=b,q[u+2]=c,q[u+3]=d,q[u+4]=.5*k,q[u+5]=e,r===g&&(q[u+10]=h,q[u+11]=i),this.setCommonVertexAttribs(u,j+t,r,l,m,n,o,0),this.vcount++}return p},b.prototype.addVertex=function(a,b,c,e,f,g){if(!this.useInstancing){var h=this.vcount,i=this.stride*h,j=this.vbf;return j[i]=a,j[i+1]=b,this.setCommonVertexAttribs(i,0,d,c,e,f,g,0),this.vcount++,h}},b.prototype.addVertexPolytriangle=function(a,b,c,d,e,f){this.useInstancing||(this.addVertex(a,b,c,d,e,f),this.addToBounds(a,b))},b.prototype.addIndices=function(a,b){if(!this.useInstancing){var c=this.ib,d=this.icount;if(d+a.length>=c.length){for(var e=new Uint16Array(2*c.length),f=0;d>f;++f)e[f]=c[f];this.ib=c=e}for(var f=0;f<a.length;++f)c[d+f]=b+a[f];this.icount+=a.length}},b.prototype.finalizeQuad=function(a){this.useInstancing||this.addIndices(r,a)},b.prototype.addSegment=function(a,b,c,d,e,f,g,h,i,j,k){var l=c-a,m=d-b,n=l||m?Math.atan2(m,l):0,o=l||m?Math.sqrt(l*l+m*m):0,p=this.addVertexLine(a,b,n,o,e,f,g,h,i,j,k);this.finalizeQuad(p),this.addToBounds(a,b),this.addToBounds(c,d)},b.prototype.addTriangleGeom=function(a,b,c,d,e,f,g,h,i,j){this.numTriangleGeoms++;var k=this.addVertexTriangleGeom(a,b,c,d,e,f,g,h,i,j);this.finalizeQuad(k),this.addToBounds(a,b),this.addToBounds(c,d),this.addToBounds(e,f)},b.prototype.addArc=function(a,b,d,e,f,g,h,i,j,k,l,m){f==g?this.numCirculars++:this.numEllipticals++;var n=s(d,e);d=n.start,e=n.end,0==d&&0==e&&(e=c);var o=Math.abs(d-e);if(o>1e-4&&Math.abs(o-c)>1e-4){var p=a+f*Math.cos(d),q=b+g*Math.sin(d);this.addSegment(p,q,p,q,0,i,j,k,l,m);var r=a+f*Math.cos(e),t=b+g*Math.sin(e);this.addSegment(r,t,r,t,0,i,j,k,l,m)}else this.addToBounds(a-f,b-g),this.addToBounds(a+f,b+g);var u=this.addVertexArc(a,b,d,e,f,g,h,i,j,k,l,m);this.finalizeQuad(u);var o,p,q,r,t},b.prototype.addTexturedQuad=function(a,b,c,d,e,f,g,h,i){var j=this.addVertexTexQuad(a,b,c,d,e,f,g,h,i);this.finalizeQuad(j);var k=.5*Math.cos(e),l=.5*Math.sin(e),m=Math.abs(c*k)+Math.abs(d*l),n=Math.abs(c*l)+Math.abs(d*k);this.addToBounds(a-m,b-n),this.addToBounds(a+m,b+n)},b.prototype.isFull=function(a){a=a||3;var b=this.useInstancing?4:1;return this.vcount*b+a>32767},b.prototype.toMesh=function(){var a={};a.vb=new Float32Array(this.vb.slice(0,this.vcount*this.stride*4)),a.vbstride=this.stride;var b=this.useInstancing?1:0;if(a.vblayout={fields1:{offset:0,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},fields2:{offset:3,itemSize:3,bytesPerItem:4,divisor:b,normalize:!1},color4b:{offset:n,itemSize:4,bytesPerItem:1,divisor:b,normalize:!0},dbId4b:{offset:o,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},flags4b:{offset:p,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1},layerVp4b:{offset:q,itemSize:4,bytesPerItem:1,divisor:b,normalize:!1}},this.stride>10&&(a.vblayout.extraParams={offset:10,itemSize:2,bytesPerItem:4,divisor:b,normalize:!1}),this.useInstancing){a.numInstances=this.vcount;var c=new Int32Array([j,k,l,m]);a.vblayout.instFlags4b={offset:0,itemSize:4,bytesPerItem:1,divisor:0,normalize:!1},a.vblayout.instFlags4b.array=c.buffer;a.indices=new Uint16Array(r)}else a.indices=new Uint16Array(this.ib.buffer.slice(0,2*this.icount));a.dbIds=this.dbIds;var d=this.maxx-this.minx,e=this.maxy-this.miny,f=Math.max(d,e);a.boundingBox={min:{x:this.minx,y:this.miny,z:.001*-f},max:{x:this.maxx,y:this.maxy,z:.001*f}};a.boundingSphere={center:{x:.5*(this.minx+this.maxx),y:.5*(this.miny+this.maxy),z:0},radius:.5*Math.sqrt(d*d+e*e)};return a};var s=function(a,b){function d(){function d(a,b){return Math.abs(a-b)<.001}d(a,0)&&(a=0),d(b,0)&&(b=0),d(a,c)&&(a=c),d(b,c)&&(b=c)}if(d(),a>b)for(;a>c;)a-=c,b-=c;else for(;b>c;)a-=c,b-=c;return d(),0>a&&b>0&&(a+=c),{start:a,end:b}};a.VertexBufferBuilder=b}(Autodesk.Viewing.Private),NodeArray.prototype.setLeftChild=function(a,b){this.nodesI[a*this.node_stride+6]=b},NodeArray.prototype.getLeftChild=function(a){return this.nodesI[a*this.node_stride+6]},NodeArray.prototype.setPrimStart=function(a,b){this.is_lean_node?this.nodesI[a*this.node_stride+6]=b:this.nodesI[a*this.node_stride+8]=b},NodeArray.prototype.getPrimStart=function(a){return this.is_lean_node?this.nodesI[a*this.node_stride+6]:this.nodesI[a*this.node_stride+8]},NodeArray.prototype.setPrimCount=function(a,b){this.nodesS[a*this.node_stride_short+14]=b},NodeArray.prototype.getPrimCount=function(a){return this.nodesS[a*this.node_stride_short+14]},NodeArray.prototype.setFlags=function(a,b,c,d){this.nodesS[a*this.node_stride_short+15]=d<<3|c<<2|3&b},NodeArray.prototype.getFlags=function(a){return this.nodesS[a*this.node_stride_short+15]},NodeArray.prototype.setBox0=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b[0],d[c+1]=b[1],d[c+2]=b[2],d[c+3]=b[3],d[c+4]=b[4],d[c+5]=b[5]},NodeArray.prototype.getBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},NodeArray.prototype.setBoxThree=function(a,b){var c=a*this.node_stride,d=this.nodesF;d[c]=b.min.x,d[c+1]=b.min.y,d[c+2]=b.min.z,d[c+3]=b.max.x,d[c+4]=b.max.y,d[c+5]=b.max.z},NodeArray.prototype.makeEmpty=function(a){var b=a*this.node_stride,c=this.nodesI;c[b+6]=-1,c[b+7]=0,this.is_lean_node||(c[b+8]=-1)},NodeArray.prototype.realloc=function(a){if(this.nodeCount+a>this.nodeCapacity){var b=0|3*this.nodeCapacity/2;b<this.nodeCount+a&&(b=this.nodeCount+a);var c=new ArrayBuffer(b*this.bytes_per_node),d=new Int32Array(c);d.set(this.nodesI),this.nodeCapacity=b,this.nodesRaw=c,this.nodesF=new Float32Array(c),this.nodesI=d,this.nodesS=new Uint16Array(c)}},NodeArray.prototype.nextNodes=function(a){this.realloc(a);var b=this.nodeCount;this.nodeCount+=a;for(var c=0;a>c;c++)this.makeEmpty(b+c);return b},NodeArray.prototype.getRawData=function(){return this.nodesRaw.slice(0,this.nodeCount*this.bytes_per_node)};var BOX_STRIDE=6,POINT_STRIDE=3,BOX_EPSILON=1e-5,BOX_SCALE_EPSILON=1e-5,MAX_DEPTH=15,MAX_BINS=16,BVHModule=function(){"use strict";function a(a,b,c,d){a[b]=.5*(c[d]+c[d+3]),a[b+1]=.5*(c[d+1]+c[d+4]),a[b+2]=.5*(c[d+2]+c[d+5])}function b(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[3]<b[c]&&(a[3]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[4]<b[c+1]&&(a[4]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[5]<b[c+2]&&(a[5]=b[c+2])}function c(a,b,c){a[0]>b[c]&&(a[0]=b[c]),a[1]>b[c+1]&&(a[1]=b[c+1]),a[2]>b[c+2]&&(a[2]=b[c+2]),a[3]<b[c+3]&&(a[3]=b[c+3]),a[4]<b[c+4]&&(a[4]=b[c+4]),a[5]<b[c+5]&&(a[5]=b[c+5])}function d(a,b){a[0]>b[0]&&(a[0]=b[0]),a[1]>b[1]&&(a[1]=b[1]),a[2]>b[2]&&(a[2]=b[2]),a[3]<b[3]&&(a[3]=b[3]),a[4]<b[4]&&(a[4]=b[4]),a[5]<b[5]&&(a[5]=b[5])}function e(a,b,c,d){for(var e=0;3>e;e++)a[b+e]=c[d+3+e]-c[d+e]}function f(a,b){a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5]}function g(a){a[0]=s,a[1]=s,a[2]=s,a[3]=-s,a[4]=-s,a[5]=-s}function h(a,b){var c=a[b+3]-a[b],d=a[b+4]-a[b+1],e=a[b+5]-a[b+2];return 0>c||0>d||0>e?0:2*(c*d+d*e+e*c)}function i(a){var b=a[3]-a[0],c=a[4]-a[1],d=a[5]-a[2];return 0>b||0>c||0>d?0:2*(b*c+c*d+d*b)}function j(){this.vb_left=new Float32Array(6),this.vb_right=new Float32Array(6),this.cb_left=new Float32Array(6),this.cb_right=new Float32Array(6),this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1}function k(){this.box_bbox=new Float32Array(6),this.box_centroid=new Float32Array(6),this.num_prims=0}function l(){this.BL=new Float32Array(6),this.CL=new Float32Array(6),this.NL=0,this.AL=0}function m(a,d,e,f,g,h,i){for(var j=a.centroids,k=a.primitives,l=a.boxes,m=i*(1-BOX_SCALE_EPSILON)/h[f],n=g[f],o=a.sort_prims,p=d;e>=p;p++){var q=0|k[p],r=m*(j[3*q+f]-n),s=0|r;0>s?s=0:s>=i&&(s=i-1),o[p]=s,t[s].num_prims++,c(t[s].box_bbox,l,6*q),b(t[s].box_centroid,j,3*q)}}function n(a,b,c,e,g,h,j){if(h[e]<a.scene_epsilon)return void(j.best_cost=1/0);var k=MAX_BINS;k>c-b+1&&(k=c-b+1);for(var l=0;k>l;l++)t[l].reset();for(var l=0;k-1>l;l++)v[l].reset();for(j.num_bins=k,m(a,b,c,e,g,h,k),f(v[0].BL,t[0].box_bbox),f(v[0].CL,t[0].box_centroid),v[0].AL=i(v[0].BL),v[0].NL=t[0].num_prims,l=1;k-1>l;l++){var n=t[l],o=v[l];f(o.BL,v[l-1].BL),d(o.BL,n.box_bbox),o.AL=i(o.BL),f(o.CL,v[l-1].CL),d(o.CL,n.box_centroid),o.NL=v[l-1].NL+n.num_prims}l=k-1,f(w,t[l].box_bbox),f(x,t[l].box_centroid);var p=i(w),q=t[l].num_prims,r=l,s=p*q+v[l-1].AL*v[l-1].NL;for(f(j.vb_right,w),f(j.cb_right,t[l].box_centroid),f(j.vb_left,v[l-1].BL),f(j.cb_left,v[l-1].CL),j.num_left=v[l-1].NL,l-=1;l>=1;l--){var n=t[l];d(w,n.box_bbox),d(x,n.box_centroid),p=i(w),q+=n.num_prims;var u=p*q+v[l-1].AL*v[l-1].NL;s>=u&&(s=u,r=l,f(j.vb_right,w),f(j.cb_right,x),f(j.vb_left,v[l-1].BL),f(j.cb_left,v[l-1].CL),j.num_left=v[l-1].NL)}j.best_split=r,j.best_cost=s}function o(a,b,c,d,e,f,g){var h,i,j=a.primitives,k=a.sort_prims,l=0,m=0|b,n=0|g.best_split;for(h=b;c>=h;h++){var o=0|j[h],p=k[h];n>p?j[m++]=o:k[l++]=o}for(i=0;l>i;i++)j[m+i]=k[i]}function p(a,c,d,f,h,i,j,k){var l=a.primitives,m=a.centroids,n=h-f+1;n>a.frags_per_inner_node&&(n=a.frags_per_inner_node),n>k&&(n=k),c.setPrimStart(d,f),c.setPrimCount(d,n),f+=n,g(i);for(var o=f;h>=o;o++)b(i,m,3*l[o]);e(j,0,i,0);var p=0;return j[1]>j[0]&&(p=1),j[2]>j[p]&&(p=2),p}function q(a,b,c,d,f,g,h,i){e(y,0,g,0);var k=a.nodes,l=h?a.frags_per_leaf_node_transparent:a.frags_per_leaf_node,m=h?a.frags_per_inner_node_transparent:a.frags_per_inner_node,q=a.max_polys_per_node,r=0;y[1]>y[0]&&(r=1),y[2]>y[r]&&(r=2),k.setBox0(b,f);var s=0,t=0;if(a.polygonCounts)for(var u=c;d>=u&&(s+=a.polygonCounts[a.primitives[u]],t++,!(s>q));u++);var v=d-c+1,w=l>=v&&q>s||1===v;if(w||i>MAX_DEPTH||y[r]<a.scene_epsilon)return k.setLeftChild(b,-1),k.setPrimStart(b,c),k.setPrimCount(b,d-c+1),void k.setFlags(b,0,0,h?1:0);m&&(r=p(a,k,b,c,d,g,y,t),c+=k.getPrimCount(b));var x=new j;if(n(a,c,d,r,g,y,x),x.num_bins<0)return void k.setPrimCount(b,k.getPrimCount(b)+d-c+1);o(a,c,d,r,g,y,x);var z=k.nextNodes(2),A=.5*(x.vb_left[3+r]+x.vb_left[r]),B=.5*(x.vb_right[3+r]+x.vb_right[r]);k.setFlags(b,r,B>A?0:1,h?1:0),k.setLeftChild(b,z),a.recursion_stack.push([a,z+1,c+x.num_left,d,x.vb_right,x.cb_right,h,i+1]),a.recursion_stack.push([a,z,c,c+x.num_left-1,x.vb_left,x.cb_left,h,i+1])}function r(d){var f=d.boxv_o,h=d.boxc_o,i=d.boxv_t,j=d.boxc_t;g(f),g(h),g(i),g(j);for(var k=d.centroids,l=d.boxes,m=0,n=d.prim_count;n>m;m++)a(k,3*m,l,6*m),m>=d.first_transparent?(b(j,k,3*m),c(i,l,6*m)):(b(h,k,3*m),c(f,l,6*m));e(y,0,d.boxv_o,0);var o=Math.max(y[0],y[1],y[2]);d.scene_epsilon=BOX_EPSILON*o}var s=1/0;j.prototype.reset=function(){this.num_left=0,this.best_split=-1,this.best_cost=-1,this.num_bins=-1},k.prototype.reset=function(){this.num_prims=0,g(this.box_bbox),g(this.box_centroid)},l.prototype.reset=function(){this.NL=0,this.AL=0,g(this.BL),g(this.CL)};for(var t=[],u=0;MAX_BINS>u;u++)t.push(new k);
for(var v=[],u=0;MAX_BINS-1>u;u++)v.push(new l);var w=new Float32Array(6),x=new Float32Array(6),y=new Float32Array(3);return{bvh_subdivide:q,compute_boxes:r,box_area:h}}();BVHBuilder.prototype.sortPrimitives=function(){for(var a=new Float32Array(this.work_buf),b=this.materialDefs,c=this.materials,d=this.primitives,e=0,f=0,g=this.prim_count;g>f;f++){d[f]=f;var h=b&&b[c[f]]?b[c[f]].transparent:!1;h&&e++,i?(a[f]=BVHModule.box_area(this.boxes,BOX_STRIDE*f),h&&(a[f]=-a[f])):a[f]=h?-1:1}var i=!1;if(i)Array.prototype.sort.call(this.primitives,function(b,c){return a[c]-a[b]});else if(e&&e<this.prim_count){for(var j=new Int32Array(e),k=0,l=0,f=0,g=this.prim_count;g>f;f++)a[f]>=0?d[k++]=d[f]:j[l++]=d[f];d.set(j,this.prim_count-e)}this.first_transparent=this.prim_count-e},BVHBuilder.prototype.build=function(a){function b(b,c){a.hasOwnProperty(b)?d[b]=a[b]:d[b]=c}var c=a&&!!a.useSlimNodes,d=this;if(c)b("frags_per_leaf_node",1),b("frags_per_inner_node",0),b("frags_per_leaf_node_transparent",1),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",1/0);else{var e=a.isWeakDevice?.5:1;b("frags_per_leaf_node",0|32*e),b("frags_per_inner_node",0|this.frags_per_leaf_node),b("frags_per_leaf_node_transparent",this.frags_per_leaf_node),b("frags_per_inner_node_transparent",0),b("max_polys_per_node",0|1e4*e)}if(this.nodes&&this.nodes.is_lean_node==c)this.nodes.nodeCount=0;else{for(var f=this.prim_count/this.frags_per_leaf_node,g=1;f>g;)g*=2;this.nodes=new NodeArray(g,a?a.useSlimNodes:!1)}this.sortPrimitives(),BVHModule.compute_boxes(this);var h=this.nodes.nextNodes(2);for(BVHModule.bvh_subdivide(this,h,0,this.first_transparent-1,this.boxv_o,this.boxc_o,!1,0);this.recursion_stack.length;){var i=this.recursion_stack.pop();BVHModule.bvh_subdivide(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])}for(BVHModule.bvh_subdivide(this,h+1,this.first_transparent,this.prim_count-1,this.boxv_t,this.boxc_t,!0,0);this.recursion_stack.length;){var i=this.recursion_stack.pop();BVHModule.bvh_subdivide(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7])}},function(){"use strict";var a=(Autodesk.Viewing,Autodesk.Viewing.Private),b=(2*Math.PI,0),c=1,d=2,e=3,f=4,g=5,h=7,i=8,j=9;a.VertexBufferReader=function(a){this.vb=a.vb.buffer,this.vbf=new Float32Array(this.vb),this.vbi=new Int32Array(this.vb),this.stride=a.vbstride,this.vcount=this.vbf.length/this.stride,this.useInstancing=!1},a.VertexBufferReader.prototype.getDbIdAt=function(a){return this.vbi[a*this.stride+h]},a.VertexBufferReader.prototype.getVertexFlagsAt=function(a){return this.vbi[a*this.stride+i]},a.VertexBufferReader.prototype.getLayerIndexAt=function(a){return 65535&this.vbi[a*this.stride+j]},a.VertexBufferReader.prototype.getViewportIndexAt=function(a){return this.vbi[a*this.stride+j]>>16&65535},a.VertexBufferReader.prototype.decodeLineAt=function(a,b,c,d){if(d.onLineSegment){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=f+i*Math.cos(h),k=g+i*Math.sin(h);d.onLineSegment(f,g,j,k,c)}},a.VertexBufferReader.prototype.decodeCircularArcAt=function(a,b,c,d){if(d.onCircularArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5];d.onCircularArc(f,g,h,i,j,c)}},a.VertexBufferReader.prototype.decodeEllipticalArcAt=function(a,b,c,d){if(d.onEllipticalArc){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1],h=this.vbf[e+2],i=this.vbf[e+3],j=this.vbf[e+5],k=this.vbf[e+10],l=this.vbf[e+11];d.onEllipticalArc(f,g,h,i,j,k,l,c)}},a.VertexBufferReader.prototype.decodeTriangleVertex=function(a,b,c,d){if(d.onTriangleVertex){var e=this.stride*a,f=this.vbf[e],g=this.vbf[e+1];d.onTriangleVertex(f,g,c)}},a.VertexBufferReader.prototype.enumGeomsForObject=function(a,h){for(var i=0;i<this.vcount;){var j=this.getVertexFlagsAt(i),k=j>>8&255,l=this.getLayerIndexAt(i),m=this.getViewportIndexAt(i);if(this.getDbIdAt(i)===a)switch(k){case b:this.decodeTriangleVertex(i,l,m,h);break;case c:this.decodeLineAt(i,l,m,h);break;case d:this.decodeCircularArcAt(i,l,m,h);break;case e:this.decodeEllipticalArcAt(i,l,m,h);break;case f:break;case g:}i+=this.useInstancing||k==b?1:4}}}();var OUTSIDE=0,INTERSECTS=1,CONTAINS=2;!function(){"use strict";function a(){this.frustum=new THREE.Frustum,this.viewProj=new THREE.Matrix4,this.viewDir=[0,0,1],this.ar=1,this.viewport=new THREE.Vector3(1,1,1),this.areaConv=1,this.areaCullThreshold=1}a.prototype.reset=function(a){this.viewProj.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse),this.frustum.setFromMatrix(this.viewProj);var b=a.matrixWorldInverse.elements;this.ar=a.aspect,this.viewDir[0]=-b[2],this.viewDir[1]=-b[6],this.viewDir[2]=-b[10],this.areaConv=a.clientWidth*a.clientHeight/4},a.prototype.projectedArea=function(){function a(){c||(c=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],d=new THREE.Box2)}function b(a,b){var c=a.x,d=a.y,e=a.z,f=b.elements,g=f[3]*c+f[7]*d+f[11]*e+f[15];0>g&&(g=-g);var h=1/g;a.x=(f[0]*c+f[4]*d+f[8]*e+f[12])*h,a.y=(f[1]*c+f[5]*d+f[9]*e+f[13])*h}var c,d;return function(e){a();var f=this.viewProj;c[0].set(e.min.x,e.min.y,e.min.z),c[1].set(e.min.x,e.min.y,e.max.z),c[2].set(e.min.x,e.max.y,e.min.z),c[3].set(e.min.x,e.max.y,e.max.z),c[4].set(e.max.x,e.min.y,e.min.z),c[5].set(e.max.x,e.min.y,e.max.z),c[6].set(e.max.x,e.max.y,e.min.z),c[7].set(e.max.x,e.max.y,e.max.z);for(var g=0;8>g;g++)b(c[g],f);return d.makeEmpty(),d.setFromPoints(c),d.min.x<-1&&(d.min.x=-1),d.min.x>1&&(d.min.x=1),d.min.y<-1&&(d.min.y=-1),d.min.y>1&&(d.min.y=1),d.max.x>1&&(d.max.x=1),d.max.x<-1&&(d.max.x=-1),d.max.y>1&&(d.max.y=1),d.max.y<-1&&(d.max.y=-1),(d.max.x-d.min.x)*(d.max.y-d.min.y)}}(),a.prototype.estimateDepth=function(a){var b=this.viewProj.elements,c=a.min.x,d=a.min.y,e=a.min.z,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]),g=(b[2]*c+b[6]*d+b[10]*e+b[14])*f;c=a.max.x,d=a.max.y,e=a.max.z,f=1/(b[3]*c+b[7]*d+b[11]*e+b[15]);var h=(b[2]*c+b[6]*d+b[10]*e+b[14])*f;return Math.min(g,h)},a.prototype.intersectsBox=function(){function a(){b||(b=new THREE.Vector3,c=new THREE.Vector3)}var b,c;return function(d){a();for(var e=this.frustum.planes,f=0,g=0;6>g;g++){var h=e[g];b.x=h.normal.x>0?d.min.x:d.max.x,c.x=h.normal.x>0?d.max.x:d.min.x,b.y=h.normal.y>0?d.min.y:d.max.y,c.y=h.normal.y>0?d.max.y:d.min.y,b.z=h.normal.z>0?d.min.z:d.max.z,c.z=h.normal.z>0?d.max.z:d.min.z;var i=h.distanceToPoint(b),j=h.distanceToPoint(c);if(0>i&&0>j)return OUTSIDE;i>0&&j>0&&f++}return 6==f?CONTAINS:INTERSECTS}}(),Autodesk.Viewing.Private.FrustumIntersector=a}();var VBIntersector=function(){"use strict";function a(){g||(g=new THREE.Matrix4,h=new THREE.Ray,i=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3)}function b(b,c,d){a();var e=b.geometry;if(e){var f=b.material,l=f?f.side:THREE.FrontSide,m=e.attributes;g.getInverse(b.matrixWorld),h.copy(c.ray).applyMatrix4(g);var n,o,p,q=c.precision;if(void 0!==m.index){var r=m.index.array||e.ib,s=e.vb?e.vb:m.position.array,t=e.vb?e.vbstride:3,u=e.offsets;u&&0!==u.length||(u=[{start:0,count:r.length,index:0}]);for(var v=0,w=u.length;w>v;++v)for(var x=u[v].start,y=u[v].count,z=u[v].index,A=x,B=x+y;B>A;A+=3){n=z+r[A],o=z+r[A+1],p=z+r[A+2],i.fromArray(s,n*t),j.fromArray(s,o*t),k.fromArray(s,p*t);var C;if(C=l===THREE.BackSide?h.intersectTriangle(k,j,i,!0):h.intersectTriangle(i,j,k,l!==THREE.DoubleSide),null!==C){C.applyMatrix4(b.matrixWorld);var D=c.ray.origin.distanceTo(C);q>D||D<c.near||D>c.far||d.push({distance:D,point:C,face:new THREE.Face3(n,o,p,THREE.Triangle.normal(i,j,k)),faceIndex:null,fragId:b.fragId,dbId:b.dbId})}}}else for(var s=e.vb?e.vb:m.position.array,t=e.vb?e.vbstride:3,A=0,E=0,B=s.length;B>A;A+=3,E+=9){if(n=A,o=A+1,p=A+2,i.fromArray(s,n*t),j.fromArray(s,o*t),k.fromArray(s,p*t),f.side===THREE.BackSide)var C=h.intersectTriangle(k,j,i,!0);else var C=h.intersectTriangle(i,j,k,f.side!==THREE.DoubleSide);if(null!==C){C.applyMatrix4(b.matrixWorld);var D=c.ray.origin.distanceTo(C);q>D||D<c.near||D>c.far||d.push({distance:D,point:C,face:new THREE.Face3(n,o,p,THREE.Triangle.normal(i,j,k)),faceIndex:null,fragId:b.fragId,dbId:b.dbId})}}}}function c(b,c,d){a();var e=c.linePrecision,f=e*e,i=b.geometry;if(i){g.getInverse(b.matrixWorld),h.copy(c.ray).applyMatrix4(g);var j=new THREE.Vector3,k=new THREE.Vector3,l=new THREE.Vector3,m=new THREE.Vector3,n=b.mode===THREE.LineStrip?1:2;if(i instanceof THREE.BufferGeometry){var o=i.attributes;if(void 0!==o.index){var p=i.ib?i.ib:o.index.array,q=i.vb?i.vb:o.position.array,r=i.vb?i.vbstride:3,s=i.offsets;s&&0!==s.length||(s=[{start:0,count:p.length,index:0}]);for(var t=0;t<s.length;t++)for(var u=s[t].start,v=s[t].count,w=s[t].index,x=u;u+v-1>x;x+=n){var y=w+p[x],z=w+p[x+1];j.fromArray(q,y*r),k.fromArray(q,z*r);var A=h.distanceSqToSegment(j,k,m,l);if(!(A>f)){var B=h.origin.distanceTo(m);B<c.near||B>c.far||d.push({distance:B,point:l.clone().applyMatrix4(b.matrixWorld),face:null,faceIndex:null,fragId:b.fragId,dbId:b.dbId})}}}else for(var q=i.vb?i.vb:o.position.array,r=i.vb?i.vbstride:3,x=0;x<q.length/r-1;x+=n){j.fromArray(q,r*x),k.fromArray(q,r*x+r);var A=h.distanceSqToSegment(j,k,m,l);if(!(A>f)){var B=h.origin.distanceTo(m);B<c.near||B>c.far||d.push({distance:B,point:l.clone().applyMatrix4(b.matrixWorld),face:null,faceIndex:null,fragId:b.fragId,dbId:b.dbId})}}}}}function d(a,d,e){a.isLine?c(a,d,e):b(a,d,e)}function e(a,b,c,f){if(a instanceof THREE.Mesh?d(a,b,c):a.raycast(b,c),f===!0)for(var g=a.children,h=0,i=g.length;i>h;h++)e(g[h],b,c,!0)}function f(a,b,c,d){e(a,b,c,d),c.sort(l)}var g,h,i,j,k,l=function(a,b){return a.distance-b.distance};return{meshRayCast:b,lineRayCast:c,rayCast:d,intersectObject:f}}(),BufferGeometryUtils=function(){"use strict";function a(a,b,c){var d;if(b.array)d=new THREE.BufferAttribute(b.array,b.itemSize);else{var e=a+"|"+b.bytesPerItem+"|"+b.normalize+"|"+b.isPattern+"|"+b.divisor+"|"+b.offset;if(d=i[e])return d;d=new THREE.BufferAttribute(void 0,b.itemSize),i[e]=d}return d.bytesPerItem=b.bytesPerItem,d.normalize=b.normalize,d.isPattern=b.isPattern,c&&(d.divisor=b.divisor),b.array||(b.hasOwnProperty("offset")?d.itemOffset=b.offset:stderr("VB attribute is neither interleaved nor separate. Something is wrong with the buffer specificaiton.")),d}function b(a){var b="";for(var c in a.attributes)b+=c+"|";var d=j[b];return d?d:(d=Object.keys(a.attributes),j[b]=d,d)}function c(){f=new THREE.BufferAttribute(void 0,1),g=function(){THREE.BufferGeometry.call(this),this.uuid=null,this.name=null,this.numInstances=void 0,this.streamingDraw=!1,this.streamingIndex=!1,this.svfid=void 0,this.vb=null,this.vbbuffer=void 0,this.ib=null,this.ibbuffer=void 0,this.vaos=void 0,this.vbNeedsUpdate=!1,this.vbstride=0,this.byteSize=0,this.attributesKeys=void 0,this.__webglInit=!1},g.prototype=Object.create(THREE.BufferGeometry.prototype),g.prototype.constructor=g}function d(){return g||c(),new g}function e(c){var e=c.mesh,g=d();g.byteSize=0,g.vb=e.vb,g.vbbuffer=void 0,g.vbNeedsUpdate=!0,g.byteSize+=e.vb.byteLength,g.vbstride=e.vbstride,e.isLines&&(g.isLines=e.isLines),c.is2d&&(g.is2d=!0),g.numInstances=e.numInstances;for(var i in e.vblayout){var j=e.vblayout[i];g.attributes[i]=a(i,j,g.numInstances)}h.memoryOptimizedLoading?(g.attributes.index=f,g.ib=e.indices,g.ibbuffer=void 0):g.addAttribute("index",new THREE.BufferAttribute(e.indices,1)),g.attributesKeys=b(g),g.byteSize+=e.indices.byteLength,e.vb.length/e.vbstride>65535&&stderr("Mesh with >65535 vertices. It will fail to draw."),g.boundingBox=(new THREE.Box3).copy(e.boundingBox),g.boundingSphere=(new THREE.Sphere).copy(e.boundingSphere),g.drawcalls=null,g.offsets=null,c.geometry=g,c.mesh=null}var f,g,h=Autodesk.Viewing.Private,i={},j={};return{meshToGeometry:e}}();!function(){"use strict";function a(a){this.geoms=[null],this.numGeomsInMemory=0,this.geomMemory=0,this.gpuMeshMemory=0,this.gpuNumMeshes=0,this.geomPolyCount=0,this.instancePolyCount=0,this.is2d=a.is2d(),this.svf=a.getData();var c=this.svf.geomMetadata?this.svf.geomMetadata.primCounts.length:0;if(this.geomBoxes=new Float32Array(6*Math.max(1,c)),this.svf.packFileTotalSize){var d=this.svf.packFileTotalSize-3*this.svf.primitiveCount*2;d<=b.GPU_MEMORY_LIMIT&&c<b.GPU_OBJECT_LIMIT&&(this.svf.disableStreaming=!0)}}var b=Autodesk.Viewing.Private;a.prototype.getGeometry=function(a){return this.geoms[a]},a.prototype.addGeometry=function(a,c,d){var e=b.GPU_MEMORY_LIMIT,f=2*e,g=b.GPU_OBJECT_LIMIT;if(this.isf2d&&(f*=2),this.disableStreaming||this.gpuMeshMemory<e&&this.geoms.length<g)a.streamingDraw=!1,a.streamingIndex=!1;else if(this.gpuMeshMemory>=f)a.streamingDraw=!0,a.streamingIndex=!0;else{var h;h=this.is2d?100001:a.byteSize*(c||1),1e5>h&&(a.streamingDraw=!0,a.streamingIndex=!0)}if(a.streamingDraw||(this.gpuMeshMemory+=a.byteSize,this.gpuNumMeshes+=1),this.numGeomsInMemory++,(void 0===d||0>=d)&&(d=this.geoms.length),this.geoms[d]=a,this.geomBoxes.length/6<this.geoms.length){var i=new Float32Array(6*(3*this.geoms.length/2));i.set(this.geomBoxes),this.geomBoxes=i}var j=a.boundingBox;this.geomBoxes[6*d]=j.min.x,this.geomBoxes[6*d+1]=j.min.y,this.geomBoxes[6*d+2]=j.min.z,this.geomBoxes[6*d+3]=j.max.x,this.geomBoxes[6*d+4]=j.max.y,this.geomBoxes[6*d+5]=j.max.z,b.memoryOptimizedLoading&&!this.is2d&&(a.boundingBox=null,a.boundingSphere=null),this.geomMemory+=a.byteSize;var k=a.attributes.index.array||a.ib,l=k.length/3;return this.svf.geomPolyCount=this.geomPolyCount+=l,this.instancePolyCount+=l*(c||1),a.svfid=d,d},a.prototype.removeGeometry=function(a){var b=this.getGeometry(a);if(!b)return 0;var c=b.byteSize;return this.geoms[a]=null,this.numGeomsInMemory--,c},a.prototype.getModelBox=function(a,b){if(!this.geoms[a])return void b.makeEmpty();var c=6*a,d=this.geomBoxes;b.min.x=d[c],b.min.y=d[c+1],b.min.z=d[c+2],b.max.x=d[c+3],b.max.y=d[c+4],b.max.z=d[c+5]},a.prototype.dispose=function(a){for(var b=0,c=this.geoms.length;c>b;b++)this.geoms[b]&&a.deallocateGeometry(this.geoms[b])},a.prototype.printStats=function(){stderr("Total geometry size: "+this.geomMemory/1048576+" MB"),stderr("Number of meshes: "+this.geoms.length),stderr("Num Meshes on GPU: "+this.gpuNumMeshes),stderr("Net GPU geom memory used: "+this.gpuMeshMemory)},Autodesk.Viewing.Private.GeometryList=a}(),function(){"use strict";function a(a,b,c,d){this.root=a,this.rootId=a.dbId,this.maxDepth=d,this.boxes=b,this.objectCount=c,this.nodeflags=new Int32Array(c+1),this.numHidden=0,this.numOff=0,this.createDbIdToNodeMapping()}var b=0,c=2,d=3,e=4,f=5,g=6,h=7,i=536870912,j=1073741824,k=2147483648,l=Autodesk.Viewing;l.SelectionMode={LEAF_OBJECT:0,FIRST_OBJECT:1,LAST_OBJECT:2},a.prototype.createDbIdToNodeMapping=function(){if(this.root){this.dbIdToNode=new Array(this.objectCount+1);var a=this.dbIdToNode,c=this.nodeflags;!function d(e){e.dbId>=c.length&&console.warn("unexpected dbId "+e.dbId),a[e.dbId]=e;var f=e.children,h=e.flags;if(void 0!==h)c[e.dbId]=h;else{var i=f?b:g;e.flags=c[e.dbId]=i}if(f)for(var j=0;j<f.length;j++)d(f[j])}(this.root)}},a.prototype.setFlagNode=function(a,b,c){var d=this.nodeflags[a];return!!(d&b)==c?!1:(c?this.nodeflags[a]=d|b:this.nodeflags[a]=d&~b,!0)},a.prototype.setFlagGlobal=function(a,b){var c=this.nodeflags,d=0,e=c.length;if(b)for(;e>d;d++)c[d]=c[d]|a;else for(var f=~a;e>d;d++)c[d]=c[d]&f},a.prototype.setNodeOff=function(a,b){var c=this.setFlagNode(a,j,b);return c&&(b?this.numOff++:this.numOff--),c},a.prototype.isNodeOff=function(a){return!!(this.nodeflags[a]&j)},a.prototype.setNodeHidden=function(a,b){var c=this.setFlagNode(a,k,b);return c&&(b?this.numHidden++:this.numHidden--),c},a.prototype.isNodeHidden=function(a){return!!(this.nodeflags[a]&k)},a.prototype.getNodeType=function(a){return this.nodeflags[a]&h},a.prototype.isNodeSelectable=function(a){return!(this.nodeflags[a]&i)},a.prototype.getNodeParentId=function(a){return this.dbIdToNode[a].parent},a.prototype.getRootId=function(){return this.rootId},a.prototype.getNodeName=function(a){return this.dbIdToNode[a].name},a.prototype.getChildCount=function(a){var b=this.dbIdToNode[a];return b&&b.children?b.children.length:0},a.prototype.enumNodeFragments=function(a,b,c){function d(a){var e=f.dbIdToNode[a];if(void 0!==e){var g=e.fragIds;if(void 0!==g){Array.isArray(g)||b(g);for(var h=0;h<g.length;++h)b(g[h])}c&&f.enumNodeChildren(a,function(a){d(a)})}}var e;e="number"==typeof a?a:a.dbId;var f=this;d(e)},a.prototype.enumNodeChildren=function(a,b,c){function d(a){var e=f.dbIdToNode[a];if(void 0!==e){if(!e.children)return;for(var g=0;g<e.children.length;g++){var h=e.children[g].dbId;b(h),c&&d(h)}}}var e;e="number"==typeof a?a:a.dbId;var f=this;c&&b(e),d(e)},a.prototype.findNodeForSelection=function(a,b){if(b===l.SelectionMode.LEAF_OBJECT)return a;var g=a;if(b===l.SelectionMode.FIRST_OBJECT){for(var h=[],i=a;i;)h.push(i),i=this.getNodeParentId(i);for(var j=h.length-1;j>=0;j--){var k=this.getNodeType(h[j]);if(k!==f&&k!==c&&k!==d){g=h[j];break}}}else if(b===l.SelectionMode.LAST_OBJECT)for(var i=a;i;){var k=this.getNodeType(i);if(k===e){g=i;break}i=this.getNodeParentId(i)}return g},Autodesk.Viewing.Private.InstanceTree=a}();var MESH_VISIBLE=1,MESH_HIGHLIGHTED=2,MESH_HIDE=4,MESH_ISLINE=8,MESH_MOVED=16,MESH_TRAVERSED=32,MESH_RENDERFLAG=128;if(function(){"use strict";function a(a,b,d){this.fragments=a,this.svfLoader=d;var e=this.fragments.length;this.geoms=b,this.isFixedSize=this.fragments.length>0,this.isFixedSize?(this.boxes=this.fragments.boxes,this.transforms=this.fragments.transforms,this.useThreeMesh=!c.memoryOptimizedLoading):(this.boxes=null,this.transforms=null,this.useThreeMesh=!0),0>=e&&(e=1),this.vizmeshes=new Array(e),this.vizflags=new Uint8Array(e),this.geomids=new Int32Array(e),this.materialids=new Int32Array(e),this.materialmap={},this.reachLimit=!1,this.traversedGeom=[],this.culledGeom=[],this.geomidsmap={},this.animxforms=null;for(var f=0;e>f;f++)this.vizflags[f]=1,this.geomids[f]=-1;this.allVisible=!0,this.allVisibleDirty=!1,this.nextAvailableFragID=e}function b(a,b){this.frags=a,this.fragId=b,this.scale=null,this.quaternion=null,this.position=null}var c=Autodesk.Viewing.Private;a.prototype.getNextAvailableFragmentId=function(){return this.nextAvailableFragID++},a.prototype.fragmentsHaveBeenAdded=function(){return this.vizflags.length>this.fragments.length},a.prototype.getSvfMaterialId=function(a){var b=this.getMaterial(a);return b?b.svfMatId:void 0},a.prototype.requireGeometry=function(a){var b=null,c=this.geomids[a];if(c>=0&&(b=this.geoms.getGeometry(c)),null==b&&!this.reachLimit){var d=this.fragments.packIds[a];this.svfLoader.loadGeometryPackOnDemand(d)}return b},a.prototype.setMesh=function(a,b,c){var d=this.vizmeshes[a];if(d&&d.parent&&d.parent.remove(d),this.vizflags.length<=a){this.isFixedSize&&(console.warn("Attempting to resize a fragments list that was initialized with fixed data. This will have a performance impact."),this.isFixedSize=!1);var e=Math.ceil(1.5*this.vizflags.length);this.useThreeMesh&&e<this.vizmeshes.length&&(e=this.vizmeshes.length);var f=new Uint8Array(e);if(f.set(this.vizflags),this.vizflags=f,this.transforms){var g=new Float32Array(12*e);g.set(this.transforms),this.transforms=g}if(this.boxes){var h=new Float32Array(6*e);h.set(this.boxes),this.boxes=h}if(this.geomids){var i=new Int32Array(e);i.set(this.geomids),this.geomids=i}if(this.materialids){var j=new Int32Array(e);j.set(this.materialids),this.materialids=j}}if(this.useThreeMesh?(this.vizmeshes[a]=b,b.fragId=a,b.dbId=0|this.fragments.fragId2dbId[a]):(this.geomids[a]=b.geometry.svfid,this.materialids[a]=b.material.id,this.materialmap[b.material.id]||(this.materialmap[b.material.id]=b.material)),this.vizflags[a]=1|(b.isLine?MESH_ISLINE:0),c){var k=b.matrixWorld,l=12*a,m=k.elements,n=this.transforms;n[l]=m[0],n[l+1]=m[1],n[l+2]=m[2],n[l+3]=m[4],n[l+4]=m[5],n[l+5]=m[6],n[l+6]=m[8],n[l+7]=m[9],n[l+8]=m[10],n[l+9]=m[12],n[l+10]=m[13],n[l+11]=m[14];var o=new THREE.Box3;b.geometry&&b.geometry.boundingBox?o.copy(b.geometry.boundingBox):this.geoms.getModelBox(this.geomids[a],o),o.applyMatrix4(k);var p=6*a,q=this.boxes;q[p]=o.min.x,q[p+1]=o.min.y,q[p+2]=o.min.z,q[p+3]=o.max.x,q[p+4]=o.max.y,q[p+5]=o.max.z}},a.prototype.isFlagSet=function(a,b){return!!(this.vizflags[a]&b)},a.prototype.setFlagFragment=function(a,b,c){var d=this.vizflags[a];return!!(d&b)==c?!1:(c?this.vizflags[a]=d|b:this.vizflags[a]=d&~b,!0)},a.prototype.setFlagGlobal=function(a,b){var c=this.vizflags,d=0,e=c.length;if(b)for(;e>d;d++)c[d]=c[d]|a;else for(var f=~a;e>d;d++)c[d]=c[d]&f},a.prototype.hideLines=function(a){var b=MESH_HIDE,c=this.vizflags,d=0,e=c.length;if(a)for(;e>d;d++)c[d]&MESH_ISLINE&&(c[d]=c[d]|b);else for(var f=~b;e>d;d++)c[d]&MESH_ISLINE&&(c[d]=c[d]&f);this.allVisibleDirty=!0},a.prototype.isFragVisible=function(a){return 1==(3&this.vizflags[a])},a.prototype.isFragOff=function(a){return!!(this.vizflags[a]&MESH_HIDE)},a.prototype.isLine=function(a){return!!(this.vizflags[a]&MESH_ISLINE)},a.prototype.areAllVisible=function(){if(this.allVisibleDirty){for(var a=this.vizflags,b=!0,c=0,d=a.length;d>c;c++)if(0===(1&a[c])){b=!1;break}this.allVisible=b,this.allVisibleDirty=!1}return this.allVisible},a.prototype.getVizmesh=function(){function a(){b||(b=new THREE.Mesh(void 0,void 0,!0),b.isTemp=!0,b.dbId=0,b.fragId=-1)}var b;return function(c){return this.useThreeMesh?this.vizmeshes[c]:(a(),b.geometry=this.getGeometry(c),b.material=this.getMaterial(c),b.dbId=this.getDbIds(c),b.fragId=c,b.visible=!0,b.isLine=this.isLine(c),b.hide=this.isFragOff(c),this.getWorldMatrix(c,b.matrixWorld),b)}}(),a.prototype.getMaterialId=function(a){return this.useThreeMesh?this.vizmeshes[a].material.id:this.materialids[a]},a.prototype.getMaterial=function(a){return this.useThreeMesh?this.vizmeshes[a].material:this.materialmap[this.materialids[a]]},a.prototype.getGeometry=function(a){return this.useThreeMesh?this.vizmeshes[a].geometry:this.geoms.getGeometry(this.geomids[a])},a.prototype.getGeometryId=function(a){return this.useThreeMesh?a:this.geomids[a]},a.prototype.setMaterial=function(a,b){this.useThreeMesh?this.vizmeshes[a].material=b:(this.materialids[a]=b.id,this.materialmap[b.id]=b)},a.prototype.getCount=function(){return this.vizflags.length},a.prototype.getDbIds=function(a){return this.fragments.fragId2dbId[a]},a.prototype.dispose=function(a){var b={type:"dispose"};if(this.useThreeMesh)for(var c={type:"removed"},d=0;d<this.vizmeshes.length;d++){var e=this.vizmeshes[d];e&&(e.dispatchEvent(c),e.geometry.dispatchEvent(b))}else this.geoms.dispose(a)},a.prototype.setVisibility=function(a,b){this.setFlagFragment(a,MESH_VISIBLE,b),this.allVisibleDirty=!0},a.prototype.setFragOff=function(a,b){this.setFlagFragment(a,MESH_HIDE,b),this.allVisibleDirty=!0},a.prototype.setAllVisibility=function(a){this.setFlagGlobal(MESH_VISIBLE,a),this.allVisible=a,this.allVisibleDirty=!1},a.prototype.updateAnimTransform=function(a,b,c,d){var e=this.animxforms;if(!e){var f=this.getCount();e=this.animxforms=new Float32Array(10*f);for(var g=0;f>g;g++){var h=10*g;e[h]=1,e[h+1]=1,e[h+2]=1,e[h+3]=0,e[h+4]=0,e[h+5]=0,e[h+6]=1,e[h+7]=0,e[h+8]=0,e[h+9]=0}}var h=10*a,i=!1;b&&(e[h]=b.x,e[h+1]=b.y,e[h+2]=b.z,i=!0),c&&(e[h+3]=c.x,e[h+4]=c.y,e[h+5]=c.z,e[h+6]=c.w,i=!0),d&&(e[h+7]=d.x,e[h+8]=d.y,e[h+9]=d.z,i=!0),this.setFlagFragment(a,MESH_MOVED,i),i||(e[h]=1,e[h+1]=1,e[h+2]=1,e[h+3]=0,e[h+4]=0,e[h+5]=0,e[h+6]=1,e[h+7]=0,e[h+8]=0,e[h+9]=0)},a.prototype.getAnimTransform=function(a,b,c,d){if(!this.animxforms)return!1;if(!this.isFlagSet(a,MESH_MOVED))return!1;var e=10*a,f=this.animxforms;return b&&(b.x=f[e],b.y=f[e+1],b.z=f[e+2]),c&&(c.x=f[e+3],c.y=f[e+4],c.z=f[e+5],c.w=f[e+6]),d&&(d.x=f[e+7],d.y=f[e+8],d.z=f[e+9]),!0},a.prototype.getOriginalWorldMatrix=function(a,b){var c=12*a,d=b.elements,e=this.transforms;if(e)d[0]=e[c],d[1]=e[c+1],d[2]=e[c+2],d[3]=0,d[4]=e[c+3],d[5]=e[c+4],d[6]=e[c+5],d[7]=0,d[8]=e[c+6],d[9]=e[c+7],d[10]=e[c+8],d[11]=0,d[12]=e[c+9],d[13]=e[c+10],d[14]=e[c+11],d[15]=1;else if(this.useThreeMesh){var f=this.getVizmesh(a);f?b.copy(f.matrixWorld):b.identity()}else b.identity()},a.prototype.getWorldMatrix=function(){function a(){b=new THREE.Matrix4,c=new THREE.Vector3,d=new THREE.Quaternion,e=new THREE.Vector3}var b,c,d,e;return function(f,g){b||a(),this.getOriginalWorldMatrix(f,g),this.isFlagSet(f,MESH_MOVED)&&(this.getAnimTransform(f,e,d,c),b.compose(c,d,e),g.multiplyMatrices(b,g))}}(),a.prototype.getWorldBounds=function(){function a(){b=new THREE.Matrix4}var b;return function(c,d){if(b||a(),this.boxes&&!this.isFlagSet(c,MESH_MOVED)){var e=this.boxes,f=6*c;return d.min.x=e[f],d.min.y=e[f+1],d.min.z=e[f+2],d.max.x=e[f+3],d.max.y=e[f+4],void(d.max.z=e[f+5])}if(this.getWorldMatrix(c,b),this.useThreeMesh){var g=this.getVizmesh(c);g&&g.geometry&&d.copy(g.geometry.boundingBox)}else this.geoms.getModelBox(this.geomids[c],d);d.empty()||d.applyMatrix4(b)}}(),Autodesk.Viewing.Private.FragmentList=a,b.prototype.getWorldMatrix=function(a){return this.frags.getWorldMatrix(this.fragId,a)},b.prototype.getWorldBounds=function(a){return this.frags.getWorldBounds(this.fragId,a)},b.prototype.getAnimTransform=function(){return this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0)),this.frags.getAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},b.prototype.updateAnimTransform=function(){return this.scale||(this.scale=new THREE.Vector3(1,1,1),this.quaternion=new THREE.Quaternion(0,0,0,1),this.position=new THREE.Vector3(0,0,0)),this.frags.updateAnimTransform(this.fragId,this.scale,this.quaternion,this.position)},b.prototype.getMaterial=function(){return this.frags.getMaterial(this.fragId)},b.prototype.setMaterial=function(a){return this.frags.setMaterial(this.fragId,a)},Autodesk.Viewing.Private.FragmentPointer=b}(),function(){"use strict";function a(){e||(e=new THREE.Box3)}function b(b,c,d,e){this.frags=b,this.indices=c,this.start=d,this.count=e,this.lastItem=d,this.overrideMaterial=null,this.sortDone=!1,this.avgFrameTime=void 0,this.numAdded=0,this.boundingBox=new THREE.Box3,this.boundingBoxHidden=new THREE.Box3,this.sortObjects=!1,this.sortDone=!1,this.depths=null,this.indicesView=null,this.frustumCulled=!0,this.forceVisible=!1,this.renderImmediate=!b.useThreeMesh,this.renderImportance=0,a()}function c(a,b,c){var d,e=127&b[c];switch(a){case RENDER_HIDDEN:d=!(e&MESH_VISIBLE);break;case RENDER_HIGHLIGHTED:d=e&MESH_HIGHLIGHTED;break;default:d=1==(e&(MESH_VISIBLE|MESH_HIGHLIGHTED|MESH_HIDE))}return b[c]=e|(d?MESH_RENDERFLAG:0),d}function d(a,b,c,d){var f=!1;return c.getWorldBounds(d,e),a&&!b.intersectsBox(e)&&(f=!0),f}var e,f=Autodesk.Viewing.Private;b.prototype.getIndices=function(){return Array.isArray(this.indices)?this.indices[0]:this.indices},b.prototype.sortByMaterial=function(){if(!(this.numAdded<this.count)){var a=this.frags,b=this.getIndices();b||stderr("Only indexed RenderSubsets can be sorted.");var c=b.subarray(this.start,this.start+this.count);Array.prototype.sort.call(c,function(b,c){var d=a.getMaterialId(b),e=a.getMaterialId(c);return void 0===d?e?1:0:void 0===e?-1:d-e}),this.numAdded=0,this.sortDone=!0}},b.prototype.sortByDepth=function(){function a(a,b){c.getGeometry(a)?(c.getWorldBounds(a,g),h[b]=f.estimateDepth(g)):h[b]=-(1/0)}function b(a,b){return h[b]-h[a]}var c,d,f,g,h;return function(i){c=this.frags,d=this.getIndices(),f=i,g=e,d||stderr("Only indexed RenderSubsets can be sorted."),(!this.indicesView||this.indicesView.length<this.count)&&(this.indicesView=d.subarray(this.start,this.start+this.count)),(!this.depths||this.depths.length<this.count)&&(this.depths=new Float32Array(this.count)),h=this.depths,this.forEachNoMesh(a),Array.prototype.sort.call(this.indicesView,b)}}(),b.prototype.onFragmentAdded=function(){return function(a){this.frags.getWorldBounds(a,e),this.boundingBox.union(e),this.sortDone=!1,this.lastItem<=a&&(this.lastItem=a+1,this.numAdded++)}}(),f.pageOutGeometryEnabled?b.prototype.forEach=function(a,b,c){for(var d=this.getIndices(),e=this.frags,g=e.getCount()>f.FRAGS_PERSISTENT_MAX_COUNT,h=this.start,i=this.lastItem;i>h;h++){var j=d?d[h]:h;if(g){if(e.isFlagSet(j,MESH_TRAVERSED)&&b==MESH_RENDERFLAG)continue;var k=e.getVizmesh(j);if(!c&&b&&e.isFlagSet(j,b))if(k.geometry){if(b==MESH_RENDERFLAG&&e.setFlagFragment(j,MESH_TRAVERSED,!0),j>f.FRAGS_PERSISTENT_COUNT){var l=e.geomids[j],m=!0,n=e.geomidsmap[l];null!=n&&(n.t++,m=n.n==n.t),m&&e.traversedGeom.push(l)}}else k.geometry=e.requireGeometry(j)}else var k=e.getVizmesh(j);!(c||k&&k.geometry)||b&&!e.isFlagSet(j,b)||a(k,j)}}:b.prototype.forEach=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=this.start,g=this.lastItem;g>f;f++){var h=d?d[f]:f,i=e.getVizmesh(h);!(c||i&&i.geometry)||b&&!e.isFlagSet(h,b)||a(i,h)}},b.prototype.forEachNoMesh=function(a,b,c){for(var d=this.getIndices(),e=this.frags,f=this.start,g=this.lastItem;g>f;f++){var h,i=d?d[f]:f;if(e.useThreeMesh){var j=e.getVizmesh(i);j&&(h=j.geometry)}else h=e.getGeometry(i);!c&&!h||b&&!e.isFlagSet(i,b)||a(i,f-this.start)}},b.prototype.raycast=function(){return function(a,b,c){if(a.ray.isIntersectionBox(this.boundingBox)!==!1){var d=this,f=e;this.forEach(function(e,g){if(c&&c.length){var h=0|d.frags.getDbIds(g);if(-1===c.indexOf(h))return}d.frags.getWorldBounds(g,f),a.ray.isIntersectionBox(f)&&VBIntersector.rayCast(e,a,b)},MESH_VISIBLE)}}}(),b.prototype.calculateBounds=function(){function a(a){f.getWorldBounds(a,g);var e=b[a];1&e?c.union(g):d.union(g)}var b,c,d,f,g;return function(){this.boundingBox.makeEmpty(),this.boundingBoxHidden.makeEmpty(),b=this.frags.vizflags,c=this.boundingBox,d=this.boundingBoxHidden,f=this.frags,g=e,this.forEachNoMesh(a)}}(),f.pageOutGeometryEnabled||f.onDemandLoading?b.prototype.applyVisibility=function(){function a(a,l){if(!a&&b.useThreeMesh)return void(i&&i(l));var m=d(j,g,b,l);if(m){if(a?a.visible=!1:stderr("Unexpected null mesh"),e[l]=e[l]&~MESH_RENDERFLAG,l>f.FRAGS_PERSISTENT_COUNT){var n=b.geomids[l];if(b.geoms.getGeometry(n)){var o=b.geomidsmap[n];o||b.culledGeom.push(n)}}}else{var p=c(h,e,l);a&&(a.visible=!!p),k=k&&!p}}var b,e,g,h,i,j,k;return function(c,d,f){k=!0,g=d,h=c,i=f;var l=g.intersectsBox(h===RENDER_HIDDEN?this.boundingBoxHidden:this.boundingBox);return l===OUTSIDE?k:(e=this.frags.vizflags,b=this.frags,j=l!==CONTAINS,this.forEach(a,null,i),k)}}():b.prototype.applyVisibility=function(){function a(a,b){if(!a&&e.useThreeMesh||!a.geometry)return void(i&&i(b));var l=d(j,g,e,b);if(l)return a?a.visible=!1:stderr("Unexpected null mesh"),void(f[b]=f[b]&~MESH_RENDERFLAG);var m=c(h,f,b);a&&(a.visible=!!m),k=k&&!m}function b(a){if(!e.getGeometryId(a))return void(i&&i(a));var b=d(j,g,e,a);if(b)return void(f[a]=f[a]&~MESH_RENDERFLAG);var l=c(h,f,a);k=k&&!l}var e,f,g,h,i,j,k;return function(c,d,l){k=!0,g=d,h=c,i=l;var m=g.intersectsBox(h===RENDER_HIDDEN?this.boundingBoxHidden:this.boundingBox);return m===OUTSIDE?k:(f=this.frags.vizflags,e=this.frags,j=m!==CONTAINS,l||e.useThreeMesh?this.forEach(a,null,i):this.forEachNoMesh(b,null),k)}}(),f.RenderBatch=b}(),function(){"use strict";function a(a){for(var d=a.getFragmentList(),e=d.getCount(),f=0,g=[new Int32Array(e)],h=0;e>h;h++)g[0][h]=h;var i=c;a.is2d()&&(i/=6),(isIOSDevice()||isAndroidDevice())&&(i/=3),i=0|i;for(var j=i>0?i:c,k=0|(e+j-1)/j,l=new Array(k),h=0;k>h;h++){var m=h*j,n=l[h]=new b.RenderBatch(d,g,m,j),o=m+j;o>e&&(o=e),n.lastItem=o}this.addFragment=function(a){if(g[0].length<=a){var c=2*g[0].length;a>=c&&(c=a+1);var e=new Int32Array(c);e.set(g[0]),g[0]=e,this.visibleBoundsDirty=!0}g[0][a]=a;var f=0|a/j;if(l){var h=l[f];h||(l[f]=h=new b.RenderBatch(d,g,f*j,j))}h&&h.onFragmentAdded(a)},this.reset=function(){f=0},this.nextBatch=function(){if(f==l.length)return null;var a=l[f++];return a.renderImportance=0,a},this.getVisibleBounds=function(a,b){for(var c=0;c<l.length;c++)l[c].calculateBounds(),a.union(l[c].boundingBox),b.union(l[c].boundingBox),b.union(l[c].boundingBoxHidden)},this.rayCast=function(a,b,c){for(var d=0;d<l.length;d++)l[d].raycast(a,b,c)},this.getSceneCount=function(){return l.length},this.getGeomScenes=function(){return l},this.done=function(){return f===l.length}}var b=Autodesk.Viewing.Private,c=333;b.ModelIteratorLinear=a;
}(),function(){"use strict";function a(){function a(a){var b=l[a],c=f;if(m)for(;c>e&&l[k[c-1]]>b;)k[c]=k[c-1],c--;else for(;c>e&&l[k[c-1]]<b;)k[c]=k[c-1],c--;k[c]=a,f++}function c(a){var b=h.getLeftChild(a);-1!==b&&(c(b),c(b+1)),p.makeEmpty(),-1!==b&&(h.getBoxThree(b,q),p.union(q),h.getBoxThree(b+1,q),p.union(q));var d=h.getPrimCount(a);d&&(p.union(j[a].boundingBox),p.union(j[a].boundingBoxHidden)),h.setBoxThree(a,p)}var d,e,f,g,h=null,i=null,j=null,k=null,l=null,m=1,n=!0,o=!1,p=new THREE.Box3,q=new THREE.Box3,r=!1;this.initialize=function(a,c,e,f){d=a.getFragmentList(),f&&f.hasOwnProperty("prioritize_screen_size")&&(n=f.prioritize_screen_size),i=e,j=new Array(c.nodeCount),h=c,k=new Int32Array(c.nodeCount+1),l=new Float32Array(c.nodeCount);for(var g=0;g<c.nodeCount;g++){var m=c.getPrimCount(g);m&&(j[g]=new b.RenderBatch(d,i,c.getPrimStart(g),m),j[g].lastItem=j[g].start+m,j[g].numAdded=m,8&c.getFlags(g)&&(j[g].sortObjects=!0),c.getBoxThree(g,j[g].boundingBox))}},this.addFragment=function(a,b){},this.reset=function(a){g=a,e=0,f=0,k[f++]=0,o=!1,r=!1},this.nextBatch=function(){for(o||e!==f||(k[f++]=1,o=!0);e!==f;){var b=m||o?k[--f]:k[e++];h.getBoxThree(b,p);var c=g.intersectsBox(p);if(c!==OUTSIDE){var d=h.getLeftChild(b),i=-1!==d;if(i){var q=h.getFlags(b),s=g.viewDir[3&q]<0?1:0,t=q>>2&1,u=q>>3&1,v=m||o?1:0,w=0,x=0;if(n&&!o){var y=d+t,z=d+1-t;h.getBoxThree(y,p),l[y]=w=g.projectedArea(p),h.getBoxThree(z,p),l[z]=x=g.projectedArea(p),w>0&&a(y),x>0&&a(z)}else{s^v^u&&(t=1-t);var y=d+t,z=d+1-t;k[f++]=y,l[y]=-1,k[f++]=z,l[z]=-1}}var A=h.getPrimCount(b);if(0!==A){var B=j[b];return B.renderImportance=g.projectedArea(B.boundingBox),B}}o||e!==f||(k[f++]=1,o=!0)}return r=!0,null},this.getVisibleBounds=function(a,b){for(var d=0;d<j.length;d++){var e=j[d];e&&(e.calculateBounds(),a.union(e.boundingBox),b.union(e.boundingBox),b.union(e.boundingBoxHidden))}c(0),c(1)},this.rayCast=function(a,b,c){for(var d=[1,0],e=new THREE.Vector3;d.length;){var f=d.pop();h.getBoxThree(f,p);var g=a.ray.intersectBox(p,e);if(null!==g){var i=h.getLeftChild(f);-1!==i&&(d.push(i),d.push(i+1));var k=h.getPrimCount(f);if(0!==k){var l=j[f];l.raycast(a,b,c)}}}},this.getSceneCount=function(){return j.length},this.getGeomScenes=function(){return j},this.done=function(){return r}}var b=Autodesk.Viewing.Private;b.ModelIteratorBVH=a}(),function(){"use strict";function a(a){function e(a){var b=f.getFragmentList().fragments.packIds[a];-1==v.indexOf(b)&&v.push(b)}b.Model.call(this,a);var f=this,g=new THREE.Box3,h=new THREE.Box3,i=new THREE.Box3,j=0,k=0;this.visibleBoundsDirty=!1,this.enforceBvh=!1,this.id=d++;var l,m,n,o,p,q,r,s=!1,t=0,u=c.PAGEOUT_NONE,v=[];this.getGeometryList=function(){return l},this.getFragmentList=function(){return m},this.initialize=function(a){l=new c.GeometryList(this);var b=this.getData().fragments;m=new c.FragmentList(b,l,a);var d=this.getBoundingBox();d&&(g.copy(d),h.copy(d)),p=n=new c.ModelIteratorLinear(this)},this.dtor=function(a){this.getFragmentList().dispose(a)},this.activateFragment=function(a,b,c){m.setMesh(a,b,c),p.addFragment(a),m.getWorldBounds(a,i),g.union(i),h.union(i)},this.setFragment=function(a,b){return void 0===a&&(a=this.getFragmentList().getNextAvailableFragmentId()),m.setMesh(a,b,!0),n&&n.addFragment(a),o&&!m.fragmentsHaveBeenAdded()&&o.addFragment(a),m.getWorldBounds(a,i),g.union(i),h.union(i),a},this.setBVH=function(a,b,d){p=o=new c.ModelIteratorBVH,p.initialize(this,a,b,d)},this.resetIterator=function(a,b,d,e){if(t=0,e){v=[],u=c.PAGEOUT_NONE;var f=this.getFragmentList();f.traversedGeom=[],f.culledGeom=[];for(var g=f.vizflags.length,h=0;g>h;++h)f.setFlagFragment(h,MESH_TRAVERSED,!1);for(var i in f.geomidsmap)f.geomidsmap.hasOwnProperty(i)&&(f.geomidsmap[i].t=0)}return s=!1,o&&!m.fragmentsHaveBeenAdded()&&(s=!0),p=s?o:n,k=0,r=d,q=b,p.reset(b),p},this.nextBatch=function(){for(;;){var a=p.nextBatch();if(k++,!a)return null;this.is2d()||(a.sortObjects&&!this.getFragmentList().useThreeMesh?a.sortByDepth(q):a.sortDone||a.sortByMaterial());var b=a.applyVisibility(r,q,this.getFragmentList().fragments.packIds?e:null);if(!b)return a}},this.getVisibleBounds=function(a){return this.visibleBoundsDirty&&(g.makeEmpty(),h.makeEmpty(),p.getVisibleBounds(g,h,a),this.visibleBoundsDirty=!1),a?h:g},this.rayIntersect=function(a,b,c){this.visibleBoundsDirty&&this.getVisibleBounds();var d=[];if(c&&c.length>0){var e=this.getData().instanceTree,f=[];if(e)for(var g=0;g<c.length;g++)e.enumNodeFragments(c[g],function(a){f.push(a)},!0);else f=c;if(f.length>2)p.rayCast(a,d,c);else for(var g=0;g<f.length;g++){var h=m.getVizmesh(f[g]);if(h){var i=VBIntersector.rayCast(h,a,d);i&&d.push(i)}}}else p.rayCast(a,d);if(!d.length)return null;d.sort(function(a,b){return a.distance-b.distance});for(var j,g=0;g<d.length;g++){var k=d[g].fragId;if(!this.is2d()){var l=this.isFragVisible(k);if(l){var n=m.getMaterial(k);if(b&&n.transparent)continue;j=d[g];var o=d[g].point,q=!1;if(n.cutplanes)for(var r=0;r<n.cutplanes.length;r++)q=q||n.cutplanes[r].dot(new THREE.Vector4(o.x,o.y,o.z,1))>1e-6;if(!q)break;j=null}}}return j&&(j.model=this),j},this.setHighlighted=function(a,b){var c=m.setFlagFragment(a,MESH_HIGHLIGHTED,b);return c&&(b?j++:j--),c},this.setVisibility=function(a,b){m.setVisibility(a,b),this.visibleBoundsDirty=!0},this.setAllVisibility=function(a){m.setAllVisibility(a),this.visibleBoundsDirty=!0},this.hideLines=function(a){m.hideLines(a)},this.hasHighlighted=function(){return!!j},this.isFragVisible=function(a){return m.isFragVisible(a)},this.areAllVisible=function(){return m.areAllVisible()},this.getGeomScenes=function(){return p.getGeomScenes()},this.getRenderProgress=function(){return k/p.getSceneCount()},this.pageOutStatus=function(){return u},this.pageOutIfNeeded=function(a){var b=this.getGeometryList(),d=this.getFragmentList(),e=b.numGeomsInMemory;if(e>c.GEOMS_COUNT_LIMIT){var f,g,h=0,i=0,j=0,k=c.GEOMS_PAGEOUT_COUNT,f=d.culledGeom.length;for(f=f>k?k:f,j=0;f>j;j++){g=d.culledGeom[j];var l=b.removeGeometry(g);l>0&&(h+=l,i++)}if(d.culledGeom.splice(0,f),k-=f,k>0){var f=d.traversedGeom.length;for(j=f>k?f-k:0;f>j;++j){g=d.traversedGeom[j];var l=b.removeGeometry(g);l>0&&(h+=l,i++)}f=f>k?k:f,d.traversedGeom.splice(-f,f)}if(e=b.numGeomsInMemory,a&&e>c.GEOMS_COUNT_LIMIT){for(f=b.geoms.length,j=0;f>j;++j){var l=b.removeGeometry(j);if(l>0&&(h+=l,i++),b.numGeomsInMemory<c.GEOMS_COUNT_LIMIT)break}stderr("A force page out occur. ")}if(t+=i,stderr("Unload: "+i+" , Size: "+h/1048576+"MB. Remaining: "+b.numGeomsInMemory),b.numGeomsInMemory>c.GEOMS_COUNT_LIMIT)return d.reachLimit=!0,v=[],c.PAGEOUT_FAIL}return d.reachLimit=!1,c.PAGEOUT_SUCCESS},this.frameUpdatePaging=function(a){var b=this.getFragmentList(),d=c.pageOutGeometryEnabled&&b.getCount()>c.FRAGS_PERSISTENT_MAX_COUNT;d&&!a&&(u==c.PAGEOUT_FAIL?b.traversedGeom.length>.5*c.GEOMS_PAGEOUT_COUNT&&(u=this.pageOutIfNeeded()):u=this.pageOutIfNeeded()),p.done()&&d&&(u=this.pageOutIfNeeded(),u==c.PAGEOUT_FAIL&&0==t&&this.pageOutIfNeeded(!0))},this.geomPacksMissingLastFrame=function(){return v},this.addGeomPackMissingLastFrame=function(a){-1==v.indexOf(a)&&v.push(a)}}var b=Autodesk.Viewing,c=b.Private,d=1;a.prototype=Object.create(b.Model.prototype),a.prototype.constructor=a,c.RenderModel=a}(),function(){"use strict";function a(){var a=!1,c=!1,d=0,e=null,f=!0,g=[],h=[],i=new THREE.Box3,j=new b.FrustumIntersector,k=new THREE.Raycaster,l=RENDER_NORMAL,m=!1,n=0,o=performance;this.checkCull=function(){var a=new THREE.Box3;return function(b,c,d){if(g[0].getFragmentList().getWorldBounds(b,a),c&&!j.intersectsBox(a))return!0;if(d){var e=j.projectedArea(a);if(e*=j.areaConv,e<j.areaCullThreshold)return!0}return!1}}(),this.addModel=function(a){g.push(a),h.length=g.length},this.removeModel=function(a){var b=g.indexOf(a);return b>=0&&g.splice(b,1),h.length=g.length,b>=0},this.isEmpty=function(){return 0===g.length},this.needsRender=function(){return a},this.resetNeedsRender=function(){a=!1},this.renderSome=function(i,j){var k,l=o.now(),n=0===d;for(f&&n&&!m&&(e=null,m=!0);;){for(var p=0,q=h[0],r=1;r<h.length;r++){var s=h[r];null!==s&&(q||(p=r,q=s),s.renderImportance>q.renderImportance&&(p=r,q=s))}var t=!1;if(q){h[p]=g[p].nextBatch(),i(q),d++,k=o.now();var u=k-l;l=k,void 0===q.avgFrameTime?q.avgFrameTime=u:q.avgFrameTime=.8*q.avgFrameTime+.2*u,j-=q.avgFrameTime;var v=!1;if(f&&n&&null!==e?q==e&&(v=!0):0>=j&&(v=!0),v){t=!0;break}}if(!q){c=!0;break}if(t)break}f&&n&&null==e&&(e=q);for(var r=0;r<g.length;r++)g[r].frameUpdatePaging(n)===b.PAGEOUT_FAIL&&(a=!0);return(c||!n)&&(e=null,m=!1),j},this.reset=function(a,b,e){if(n++,c=!1,l=b,d=0,this.resetNeedsRender(),j.reset(a),g.length)for(var f=0;f<g.length;f++)g[f].resetIterator(a,j,b,e),h[f]=g[f].nextBatch()},this.isDone=function(){return c||this.isEmpty()},this.setAllVisibility=function(a){for(var b=0;b<g.length;b++)g[b].setAllVisibility(a)},this.hideLines=function(a){for(var b=0;b<g.length;b++)g[b].hideLines(a)},this.hasHighlighted=function(){for(var a=0;a<g.length;a++)if(g[a].hasHighlighted())return!0;return!1},this.areAllVisible=function(){for(var a=0;a<g.length;a++)if(!g[a].areAllVisible())return!1;return!0},this.invalidateVisibleBounds=function(){for(var a=0;a<g.length;a++)g[a].visibleBoundsDirty=!0},this.getVisibleBounds=function(a){if(1===g.length)return g[0].getVisibleBounds(a);i.makeEmpty();for(var b=0;b<g.length;b++)i.union(g[b].getVisibleBounds(a));return i},this.rayIntersect=function(a,b,c,d){if(k.set(a,b),g.length>1){for(var e=[],f=0;f<g.length;f++)if(!g[f].is2d()){var h=g[f].rayIntersect(k,c,d);h&&e.push(h)}return e.length?(e.sort(function(a,b){return a.distance-b.distance}),e[0]):null}return!g.length||g[0].is2d()?null:g[0].rayIntersect(k,c,d)},this.getRenderProgress=function(){return g[0].getRenderProgress()},this.getFragmentList=function(){return g[0].getFragmentList()},this.getGeometryList=function(){return g[0].getGeometryList()},this.getSceneCount=function(){return g[0].getSceneCount()},this.getModels=function(){return g},this.getGeomScenes=function(){return g[0].getGeomScenes()},this.geomPacksMissingLastFrame=function(){return g[0].geomPacksMissingLastFrame()},this.explode=function(a){if(g.length){for(var b=0;b<g.length;b++){var c=g[b],d=c.getData(),e=c.getVisibleBounds(!0).center(),f=c.getFragmentList(),h=new THREE.Vector3;if(a*=2,d.instanceTree&&d.instanceTree.boxes&&0!==a){var i=a*(d.instanceTree.maxDepth-1)+1,j=0|i,k=i-j,l=d.instanceTree.boxes;!function t(b,c,e,g,i,m,n,o){var p=2*a;c==j&&(p*=k);var q=6*b,r=.5*(l[q]+l[q+3]),s=.5*(l[q+1]+l[q+4]),u=.5*(l[q+2]+l[q+5]);if(c>0&&j>=c){var v=(r-e)*p,w=(s-g)*p,x=(u-i)*p;m+=v,n+=w,o+=x}d.instanceTree.enumNodeChildren(b,function(a){t(a,c+1,r,s,u,m,n,o)},!1),d.instanceTree.enumNodeFragments(b,function(a){h.x=m,h.y=n,h.z=o,f.updateAnimTransform(a,null,null,h)},!1)}(d.instanceTree.getRootId(),0,e.x,e.y,e.x,0,0,0)}else for(var m=f.fragments.boxes,n=0,o=f.getCount();o>n;n++)if(0==a)f.updateAnimTransform(n);else{var p=6*n,q=.5*(m[p]+m[p+3]),r=.5*(m[p+1]+m[p+4]),s=.5*(m[p+2]+m[p+5]);q=a*(q-e.x),r=a*(r-e.y),s=a*(s-e.z),h.x=q,h.y=r,h.z=s,f.updateAnimTransform(n,null,null,h)}}this.invalidateVisibleBounds()}}}var b=Autodesk.Viewing.Private;b.RenderScene=a}(),function(){"use strict";var a=function(a,b){this.textureID=void 0!==b?b:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(a.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)}),this.renderToScreen=!1,this.enabled=!0,this.clear=!1,this.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1);var c=new THREE.BufferGeometry,d=new Float32Array(9);d[0]=-1,d[1]=-1,d[2]=0,d[3]=3,d[4]=-1,d[5]=0,d[6]=-1,d[7]=3,d[8]=0;var e=new Float32Array(6);e[0]=0,e[1]=0,e[2]=2,e[3]=0,e[4]=0,e[5]=2;var f=new Float32Array(9);f[0]=0,f[1]=0,f[2]=1,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=1,c.addAttribute("position",new THREE.BufferAttribute(d,3)),c.addAttribute("normal",new THREE.BufferAttribute(f,3)),c.addAttribute("uv",new THREE.BufferAttribute(e,2)),this.quad=new THREE.Mesh(c,this.material),this.scene=new THREE.Scene,this.scene.add(this.quad)};a.prototype={render:function(a,b,c,d){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=c),this.renderToScreen||!b?a.render(this.scene,this.camera):a.render(this.scene,this.camera,b,this.clear)}},Autodesk.Viewing.Shaders.LmvShaderPass=a}(),FireflyWebGLProgram=function(){var a=0,b=function(a){var b,c,d=[];for(var e in a)b=a[e],b!==!1&&(c="#define "+e+" "+b,d.push(c));return d.join("\n")},c=function(a,b,c){for(var d={},e=0,f=c.length;f>e;e++){var g=c[e];d[g]=a.getUniformLocation(b,g)}return d},d=function(a,b,c){for(var d={},e=0,f=c.length;f>e;e++){var g=c[e];d[g]=a.getAttribLocation(b,g)}return d},e=function(a,b,c,d,e){var f=d?"1.0-":"",g="texture2D("+a+", (UV))",h="";return e=e||"vec4(0.0)",b&&c?h="((UV).x < 0.0 || (UV).x > 1.0 || (UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : ":b?h="((UV).x < 0.0 || (UV).x > 1.0) ? "+e+" : ":c&&(h="((UV).y < 0.0 || (UV).y > 1.0) ? "+e+" : "),"#define GET_"+a.toUpperCase()+"(UV) ("+h+f+g+")"};return function(f,g,h,i){var j=f,k=j.context,l=h.defines,m=h.__webglShader.uniforms,n=h.attributes,o=h.__webglShader.vertexShader,p=h.__webglShader.fragmentShader,q=h.index0AttributeName;void 0===q&&i.morphTargets===!0&&(q="position");var r="SHADOWMAP_TYPE_BASIC";i.shadowMapType===THREE.PCFShadowMap?r="SHADOWMAP_TYPE_PCF":i.shadowMapType===THREE.PCFSoftShadowMap&&(r="SHADOWMAP_TYPE_PCF_SOFT");var s="ENVMAP_TYPE_CUBE",t="ENVMAP_MODE_REFLECTION",u="ENVMAP_BLENDING_MULTIPLY";i.envMap;var v,w,x=f.gammaFactor>0?f.gammaFactor:1,y=b(l),z=k.createProgram();h instanceof THREE.RawShaderMaterial?(v="",w=""):(v=["precision "+i.precision+" float;","precision "+i.precision+" int;",y,i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,i.mrtNormals?"#define MRT_NORMALS":"",i.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,"#define NUM_CUTPLANES "+i.numCutplanes,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+t:"",i.irradianceMap?"#define USE_IRRADIANCEMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.useFragDepthExt?"#define USE_LOGDEPTHBUF_EXT":"",i.packedNormals?"#define UNPACK_NORMALS":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","#ifdef UNPACK_NORMALS","attribute vec2 normal;","#else","attribute vec3 normal;","#endif","attribute vec2 uv;","attribute vec2 uv2;","#ifdef PRISMWOOD","attribute vec3 uvw;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif",""].join("\n"),w=[i.bumpMap||i.normalMap?"#extension GL_OES_standard_derivatives : enable":"",!i.mrtIdBuffer&&!i.mrtNormals||"undefined"!=typeof _isIE11&&_isIE11?"":"#extension GL_EXT_draw_buffers : enable",i.mrtIdBuffer?"#define gl_FragColor gl_FragData[0]":"",i.haveTextureLod?"#define HAVE_TEXTURE_LOD":"",y,"#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_HEMI_LIGHTS "+i.maxHemiLights,"#define MAX_SHADOWS "+i.maxShadows,"#define NUM_CUTPLANES "+i.numCutplanes,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",j.gammaInput?"#define GAMMA_INPUT":"",j.gammaOutput?"#define GAMMA_OUTPUT":"","#define GAMMA_FACTOR "+x,i.mrtNormals?"#define MRT_NORMALS":"",i.mrtIdBuffer?"#define MRT_ID_BUFFER":"","#define TONEMAP_OUTPUT "+(i.tonemapOutput||0),i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+s:"",i.envMap?"#define "+t:"",i.envMap?"#define "+u:"",i.irradianceMap?"#define USE_IRRADIANCEMAP":"",i.envGammaEncoded?"#define ENV_GAMMA":"",i.irrGammaEncoded?"#define IRR_GAMMA":"",i.envRGBM?"#define ENV_RGBM":"",i.irrRGBM?"#define IRR_RGBM":"",i.lightMap?"#define USE_LIGHTMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.clearcoat?"#define CLEARCOAT":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.hatchPattern?"#define HATCH_PATTERN":"",i.mapInvert?"#define MAP_INVERT":"",e("map",i.mapClampS,i.mapClampT,!1,"vec4(vec3(0.0), 1.0)"),e("bumpMap",i.bumpMapClampS,i.bumpMapClampT),e("normalMap",i.normalMapClampS,i.normalMapClampT),e("specularMap",i.specularMapClampS,i.specularMapClampT),e("alphaMap",i.alphaMapClampS,i.alphaMapClampT,i.alphaMapInvert),"#ifdef USE_ENVMAP","#ifdef HAVE_TEXTURE_LOD","#extension GL_EXT_shader_texture_lod : enable","#endif","#endif","#extension GL_OES_standard_derivatives : enable","precision "+i.precisionFragment+" float;","precision "+i.precisionFragment+" int;","uniform highp mat4 viewMatrix;","uniform highp mat4 projectionMatrix;","uniform highp vec3 cameraPosition;","#ifdef USE_ENVMAP","uniform mat4 viewMatrixInverse;","#endif",""].join("\n"));var A=new THREE.WebGLShader(k,k.VERTEX_SHADER,v+o),B=new THREE.WebGLShader(k,k.FRAGMENT_SHADER,w+p);k.attachShader(z,A),k.attachShader(z,B),void 0!==q&&k.bindAttribLocation(z,0,q),k.linkProgram(z),k.getProgramParameter(z,k.LINK_STATUS)===!1&&(console.error("THREE.WebGLProgram: Could not initialise shader."),console.error("gl.VALIDATE_STATUS",k.getProgramParameter(z,k.VALIDATE_STATUS)),console.error("gl.getError()",k.getError())),""!==k.getProgramInfoLog(z)&&console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",k.getProgramInfoLog(z)),k.deleteShader(A),k.deleteShader(B);var C=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","viewMatrixInverse","mvpMatrix","dbId"];i.logarithmicDepthBuffer&&C.push("logDepthBufFC");for(var D in m)C.push(D);this.uniforms=c(k,z,C),C=["position","normal","uv","uv2","tangent","color","lineDistance","uvw"];for(var E in n)C.push(E);return this.attributes=d(k,z,C),this.attributesKeys=Object.keys(this.attributes),this.id=a++,this.code=g,this.usedTimes=1,this.program=z,this.vertexShader=A,this.fragmentShader=B,this}}(),FireflyWebGLRenderer=function(a){function b(a){a.__webglVertexBuffer=Ga.createBuffer(),a.__webglColorBuffer=Ga.createBuffer(),a.__webglLineDistanceBuffer=Ga.createBuffer(),Ka.info.memory.geometries++}function c(a){a.__webglVertexBuffer=Ga.createBuffer(),a.__webglNormalBuffer=Ga.createBuffer(),a.__webglTangentBuffer=Ga.createBuffer(),a.__webglColorBuffer=Ga.createBuffer(),a.__webglUVBuffer=Ga.createBuffer(),a.__webglUV2Buffer=Ga.createBuffer(),a.__webglSkinIndicesBuffer=Ga.createBuffer(),a.__webglSkinWeightsBuffer=Ga.createBuffer(),a.__webglFaceBuffer=Ga.createBuffer(),a.__webglLineBuffer=Ga.createBuffer();Ka.info.memory.geometries++}function d(a,b){var c=a.vertices.length,d=b.material;if(d.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var e in d.attributes){var f=d.attributes[e];if(!f.__webglInitialized||f.createUniqueBuffers){f.__webglInitialized=!0;var g=1;"v2"===f.type?g=2:"v3"===f.type?g=3:"v4"===f.type?g=4:"c"===f.type&&(g=3),f.size=g,f.array=new Float32Array(c*g),f.buffer=Ga.createBuffer(),f.buffer.belongsToAttribute=e,f.needsUpdate=!0}a.__webglCustomAttributesList.push(f)}}}function e(a,b){var c=a.vertices.length;a.__vertexArray=new Float32Array(3*c),a.__colorArray=new Float32Array(3*c),a.__lineDistanceArray=new Float32Array(1*c),a.__webglLineCount=c,d(a,b)}function f(a,b){var c=b.geometry,d=a.faces3,e=3*d.length,f=1*d.length,h=3*d.length,l=g(b,a),m=k(l),n=i(l),o=j(l);a.__vertexArray=new Float32Array(3*e),n&&(a.__normalArray=new Float32Array(3*e)),c.hasTangents&&(a.__tangentArray=new Float32Array(4*e)),o&&(a.__colorArray=new Float32Array(3*e)),m&&(c.faceVertexUvs.length>0&&(a.__uvArray=new Float32Array(2*e)),c.faceVertexUvs.length>1&&(a.__uv2Array=new Float32Array(2*e))),b.geometry.skinWeights.length&&b.geometry.skinIndices.length&&(a.__skinIndexArray=new Float32Array(4*e),a.__skinWeightArray=new Float32Array(4*e));var p=null!==hb.get("OES_element_index_uint")&&f>21845?Uint32Array:Uint16Array;a.__typeArray=p,a.__faceArray=new p(3*f),a.__lineArray=new p(2*h);if(a.__webglFaceCount=3*f,a.__webglLineCount=2*h,l.attributes){void 0===a.__webglCustomAttributesList&&(a.__webglCustomAttributesList=[]);for(var q in l.attributes){var r=l.attributes[q],s={};for(var t in r)s[t]=r[t];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var u=1;"v2"===s.type?u=2:"v3"===s.type?u=3:"v4"===s.type?u=4:"c"===s.type&&(u=3),s.size=u,s.array=new Float32Array(e*u),s.buffer=Ga.createBuffer(),s.buffer.belongsToAttribute=q,r.needsUpdate=!0,s.__original=r}a.__webglCustomAttributesList.push(s)}}a.__inittedArrays=!0}function g(a,b){return a.material instanceof THREE.MeshFaceMaterial?a.material.materials[b.materialIndex]:a.material}function h(a){return a&&void 0!==a.shading&&a.shading===THREE.SmoothShading}function i(a){return a instanceof THREE.MeshBasicMaterial&&!a.envMap||a instanceof THREE.MeshDepthMaterial?!1:h(a)?THREE.SmoothShading:THREE.FlatShading}function j(a){return a.vertexColors?a.vertexColors:!1}function k(a){return a.map||a.lightMap||a.bumpMap||a.normalMap||a.specularMap||a.alphaMap||a instanceof THREE.ShaderMaterial?!0:!1}function l(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o=a.vertices,p=a.colors,q=a.lineDistances,r=o.length,s=p.length,t=q.length,u=a.__vertexArray,v=a.__colorArray,w=a.__lineDistanceArray,x=a.verticesNeedUpdate,y=a.colorsNeedUpdate,z=a.lineDistancesNeedUpdate,A=a.__webglCustomAttributesList;if(x){for(c=0;r>c;c++)f=o[c],g=3*c,u[g]=f.x,u[g+1]=f.y,u[g+2]=f.z;Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglVertexBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,u,b)}if(y){for(d=0;s>d;d++)h=p[d],g=3*d,v[g]=h.r,v[g+1]=h.g,v[g+2]=h.b;Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglColorBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,v,b)}if(z){for(e=0;t>e;e++)w[e]=q[e];Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglLineDistanceBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,w,b)}if(A)for(i=0,j=A.length;j>i;i++)if(n=A[i],n.needsUpdate&&(void 0===n.boundTo||"vertices"===n.boundTo)){if(g=0,l=n.value.length,1===n.size)for(k=0;l>k;k++)n.array[k]=n.value[k];else if(2===n.size)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,g+=2;else if(3===n.size)if("c"===n.type)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.r,n.array[g+1]=m.g,n.array[g+2]=m.b,g+=3;else for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,g+=3;else if(4===n.size)for(k=0;l>k;k++)m=n.value[k],n.array[g]=m.x,n.array[g+1]=m.y,n.array[g+2]=m.z,n.array[g+3]=m.w,g+=4;Ga.bindBuffer(Ga.ARRAY_BUFFER,n.buffer),Ga.bufferData(Ga.ARRAY_BUFFER,n.array,b)}}function m(a,b,c,d,e){if(a.__inittedArrays){var f,g,h,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=i(e),K=j(e),L=k(e),M=J===THREE.SmoothShading,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=0,V=0,W=0,X=0,Y=a.__vertexArray,Z=a.__uvArray,$=a.__uv2Array,_=a.__normalArray,aa=a.__tangentArray,ba=a.__colorArray,ca=a.__webglCustomAttributesList,da=a.__faceArray,ea=a.__lineArray,fa=b.geometry,ga=fa.verticesNeedUpdate,ha=fa.elementsNeedUpdate,ia=fa.uvsNeedUpdate,ja=fa.normalsNeedUpdate,ka=fa.tangentsNeedUpdate,la=fa.colorsNeedUpdate,ma=fa.vertices,na=a.faces3,oa=fa.faces,pa=fa.faceVertexUvs[0],qa=fa.faceVertexUvs[1];fa.colors;if(ga){for(f=0,g=na.length;g>f;f++)l=oa[na[f]],t=ma[l.a],u=ma[l.b],v=ma[l.c],Y[O]=t.x,Y[O+1]=t.y,Y[O+2]=t.z,Y[O+3]=u.x,Y[O+4]=u.y,Y[O+5]=u.z,Y[O+6]=v.x,Y[O+7]=v.y,Y[O+8]=v.z,O+=9;Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglVertexBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,Y,c)}if(la&&K){for(f=0,g=na.length;g>f;f++)l=oa[na[f]],o=l.vertexColors,p=l.color,3===o.length&&K===THREE.VertexColors?(z=o[0],A=o[1],B=o[2]):(z=p,A=p,B=p),ba[V]=z.r,ba[V+1]=z.g,ba[V+2]=z.b,ba[V+3]=A.r,ba[V+4]=A.g,ba[V+5]=A.b,ba[V+6]=B.r,ba[V+7]=B.g,ba[V+8]=B.b,V+=9;V>0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglColorBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,ba,c))}if(ka&&fa.hasTangents){for(f=0,g=na.length;g>f;f++)l=oa[na[f]],q=l.vertexTangents,w=q[0],x=q[1],y=q[2],aa[T]=w.x,aa[T+1]=w.y,aa[T+2]=w.z,aa[T+3]=w.w,aa[T+4]=x.x,aa[T+5]=x.y,aa[T+6]=x.z,aa[T+7]=x.w,aa[T+8]=y.x,aa[T+9]=y.y,aa[T+10]=y.z,aa[T+11]=y.w,T+=12;Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglTangentBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,aa,c)}if(ja&&J){for(f=0,g=na.length;g>f;f++)if(l=oa[na[f]],m=l.vertexNormals,n=l.normal,3===m.length&&M)for(C=0;3>C;C++)E=m[C],_[S]=E.x,_[S+1]=E.y,_[S+2]=E.z,S+=3;else for(C=0;3>C;C++)_[S]=n.x,_[S+1]=n.y,_[S+2]=n.z,S+=3;Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglNormalBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,_,c)}if(ia&&pa&&L){for(f=0,g=na.length;g>f;f++)if(h=na[f],r=pa[h],void 0!==r)for(C=0;3>C;C++)F=r[C],Z[P]=F.x,Z[P+1]=F.y,P+=2;P>0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglUVBuffer),Ga.bufferData(Ga.ARRAY_BUFFER,Z,c))}if(ia&&qa&&L){for(f=0,g=na.length;g>f;f++)if(h=na[f],s=qa[h],void 0!==s)for(C=0;3>C;C++)G=s[C],$[Q]=G.x,$[Q+1]=G.y,Q+=2;Q>0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,a.__webglUV2Buffer),Ga.bufferData(Ga.ARRAY_BUFFER,$,c))}if(ha){for(f=0,g=na.length;g>f;f++)da[R]=N,da[R+1]=N+1,da[R+2]=N+2,R+=3,ea[U]=N,ea[U+1]=N+1,ea[U+2]=N,ea[U+3]=N+2,ea[U+4]=N+1,ea[U+5]=N+2,U+=6,N+=3;Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,a.__webglFaceBuffer),Ga.bufferData(Ga.ELEMENT_ARRAY_BUFFER,da,c),Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,a.__webglLineBuffer),Ga.bufferData(Ga.ELEMENT_ARRAY_BUFFER,ea,c)}if(ca)for(C=0,D=ca.length;D>C;C++)if(I=ca[C],I.__original.needsUpdate){if(W=0,X=0,1===I.size){if(void 0===I.boundTo||"vertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)l=oa[na[f]],I.array[W]=I.value[l.a],I.array[W+1]=I.value[l.b],I.array[W+2]=I.value[l.c],W+=3;else if("faces"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],I.array[W]=H,I.array[W+1]=H,I.array[W+2]=H,W+=3}else if(2===I.size){if(void 0===I.boundTo||"vertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)l=oa[na[f]],t=I.value[l.a],u=I.value[l.b],v=I.value[l.c],I.array[W]=t.x,I.array[W+1]=t.y,I.array[W+2]=u.x,I.array[W+3]=u.y,I.array[W+4]=v.x,I.array[W+5]=v.y,W+=6;else if("faces"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],t=H,u=H,v=H,I.array[W]=t.x,I.array[W+1]=t.y,I.array[W+2]=u.x,I.array[W+3]=u.y,I.array[W+4]=v.x,I.array[W+5]=v.y,W+=6}else if(3===I.size){var ra;if(ra="c"===I.type?["r","g","b"]:["x","y","z"],void 0===I.boundTo||"vertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)l=oa[na[f]],t=I.value[l.a],u=I.value[l.b],v=I.value[l.c],I.array[W]=t[ra[0]],I.array[W+1]=t[ra[1]],I.array[W+2]=t[ra[2]],I.array[W+3]=u[ra[0]],I.array[W+4]=u[ra[1]],I.array[W+5]=u[ra[2]],I.array[W+6]=v[ra[0]],I.array[W+7]=v[ra[1]],I.array[W+8]=v[ra[2]],W+=9;else if("faces"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],t=H,u=H,v=H,I.array[W]=t[ra[0]],I.array[W+1]=t[ra[1]],I.array[W+2]=t[ra[2]],I.array[W+3]=u[ra[0]],I.array[W+4]=u[ra[1]],I.array[W+5]=u[ra[2]],I.array[W+6]=v[ra[0]],I.array[W+7]=v[ra[1]],I.array[W+8]=v[ra[2]],W+=9;else if("faceVertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],t=H[0],u=H[1],v=H[2],I.array[W]=t[ra[0]],I.array[W+1]=t[ra[1]],I.array[W+2]=t[ra[2]],I.array[W+3]=u[ra[0]],I.array[W+4]=u[ra[1]],I.array[W+5]=u[ra[2]],I.array[W+6]=v[ra[0]],I.array[W+7]=v[ra[1]],I.array[W+8]=v[ra[2]],W+=9}else if(4===I.size)if(void 0===I.boundTo||"vertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)l=oa[na[f]],t=I.value[l.a],u=I.value[l.b],v=I.value[l.c],I.array[W]=t.x,I.array[W+1]=t.y,I.array[W+2]=t.z,I.array[W+3]=t.w,I.array[W+4]=u.x,I.array[W+5]=u.y,I.array[W+6]=u.z,I.array[W+7]=u.w,I.array[W+8]=v.x,I.array[W+9]=v.y,I.array[W+10]=v.z,I.array[W+11]=v.w,W+=12;else if("faces"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],t=H,u=H,v=H,I.array[W]=t.x,I.array[W+1]=t.y,I.array[W+2]=t.z,I.array[W+3]=t.w,I.array[W+4]=u.x,I.array[W+5]=u.y,I.array[W+6]=u.z,I.array[W+7]=u.w,I.array[W+8]=v.x,I.array[W+9]=v.y,I.array[W+10]=v.z,I.array[W+11]=v.w,W+=12;else if("faceVertices"===I.boundTo)for(f=0,g=na.length;g>f;f++)H=I.value[na[f]],t=H[0],u=H[1],v=H[2],I.array[W]=t.x,I.array[W+1]=t.y,I.array[W+2]=t.z,I.array[W+3]=t.w,I.array[W+4]=u.x,I.array[W+5]=u.y,I.array[W+6]=u.z,I.array[W+7]=u.w,I.array[W+8]=v.x,I.array[W+9]=v.y,I.array[W+10]=v.z,I.array[W+11]=v.w,W+=12;Ga.bindBuffer(Ga.ARRAY_BUFFER,I.buffer),Ga.bufferData(Ga.ARRAY_BUFFER,I.array,c)}d&&(delete a.__inittedArrays,delete a.__colorArray,delete a.__normalArray,delete a.__tangentArray,delete a.__uvArray,delete a.__uv2Array,delete a.__faceArray,delete a.__vertexArray,delete a.__lineArray,delete a.__skinIndexArray,delete a.__skinWeightArray)}}function n(a){if(a.streamingDraw){if(!a.streamingIndex){var b=a.attributes.index;b&&(b.buffer=Ga.createBuffer(),Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,b.buffer),Ga.bufferData(Ga.ELEMENT_ARRAY_BUFFER,b.array||a.ib,Ga.STATIC_DRAW))}}else{a.vb&&void 0===a.vbbuffer&&(a.vbbuffer=Ga.createBuffer(),a.vbNeedsUpdate=!0),a.ib&&void 0===a.ibbuffer&&(a.ibbuffer=Ga.createBuffer(),Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,a.ibbuffer),Ga.bufferData(Ga.ELEMENT_ARRAY_BUFFER,a.ib,Ga.STATIC_DRAW));for(var c=a.attributes,d=a.attributesKeys,e=0,f=d.length;f>e;e++){var g=d[e],h=c[g],i="index"===g;if(h.array&&void 0===h.buffer&&(h.buffer=Ga.createBuffer(),h.needsUpdate=!0),h.needsUpdate===!0){var j=i?Ga.ELEMENT_ARRAY_BUFFER:Ga.ARRAY_BUFFER;Ga.bindBuffer(j,h.buffer),Ga.bufferData(j,h.array,Ga.STATIC_DRAW),h.needsUpdate=!1}}a.vbNeedsUpdate&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,a.vbbuffer),Ga.bufferData(Ga.ARRAY_BUFFER,a.vb,Ga.STATIC_DRAW),a.vbNeedsUpdate=!1)}}function o(a,b,c,d){var e;if(c.streamingDraw)return c.vaos=null,!1;if(c.offsets&&c.offsets.length>1)return c.vaos=null,!1;if(!Ja)return c.vaos=null,!1;void 0===c.vaos&&(c.vaos=[]),e=Ja.createVertexArrayOES(),c.vaos.push({geomhash:b.id,uv:d,vao:e}),Ja.bindVertexArrayOES(e);var f=c.attributes.index;f&&Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,c.ibbuffer||f.buffer);for(var g=null,h=b.attributes,i=b.attributesKeys,j=c.vbstride,k=c.offsets&&c.offsets.length?c.offsets[0].index:0,l=0,m=i.length;m>l;l++){var n=i[l],o=h[n];if(o>=0){var p=c.attributes[n];if("uv"===n&&d&&(p=c.attributes["uv"+(d+1)]),!p){Ja.bindVertexArrayOES(null);for(var l=0;l<c.vaos.length;l++)Ja.deleteVertexArrayOES(c.vaos[l].vao);return c.vaos=null,!1}var q=Ga.FLOAT,r=p.bytesPerItem||4;1===r?q=Ga.UNSIGNED_BYTE:2===r&&(q=Ga.UNSIGNED_SHORT),Ga.enableVertexAttribArray(o),void 0!==p.itemOffset?(g!=c.vbbuffer&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,c.vbbuffer),g=c.vbbuffer),Ga.vertexAttribPointer(o,p.itemSize,q,p.normalize,4*j,4*(p.itemOffset+k*j))):(Ga.bindBuffer(Ga.ARRAY_BUFFER,p.buffer),g=p.buffer,Ga.vertexAttribPointer(o,p.itemSize,q,p.normalize,0,k*p.itemSize*r)),Ia&&c.numInstances&&Ia.vertexAttribDivisorANGLE(o,p.divisor||0)}}return!0}function p(a,b,c,d){var e=c.vaos;if(e)for(var f=0,g=e.length;g>f;f++){var h=e[f];
if(h.geomhash===b.id&&h.uv===d)return Ja.bindVertexArrayOES(h.vao),!0}else if(null===e)return!1;return o(a,b,c,d)}function q(a,b){var c=Ya[a];return c||(c=Ga.createBuffer(),Ya[a]=c),Ga.bindBuffer(Ga.ARRAY_BUFFER,c),Ga.bufferData(Ga.ARRAY_BUFFER,b,Ga.DYNAMIC_DRAW),c}function r(a,b,c,d,e){var f=b.attributes,g=b.attributesKeys,h=0,i=void 0;if(e)if(!e.buffer&&c.streamingDraw){var j=Ya.index;j||(j=Ga.createBuffer(),Ya.index=j),Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,j),Ga.bufferData(Ga.ELEMENT_ARRAY_BUFFER,e.array||c.ib,Ga.DYNAMIC_DRAW)}else Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,c.ibbuffer||e.buffer);for(var k=0,l=g.length;l>k;k++){var m=g[k],n=f[m];if(n>=0){var o=c.attributes[m];if(o){var p,r,s=void 0!==o.itemOffset;s?(p=c.vbstride,r=o.itemOffset,h!==i&&(c.streamingDraw?h=q("interleavedVB",c.vb):(h=c.vbbuffer,Ga.bindBuffer(Ga.ARRAY_BUFFER,h)),i=h)):(p=o.itemSize,r=0,c.streamingDraw?h=q(m,o.array):(h=o.buffer,Ga.bindBuffer(Ga.ARRAY_BUFFER,h)));var t=Ga.FLOAT,u=o.bytesPerItem||4;1===u?t=Ga.UNSIGNED_BYTE:2===u&&(t=Ga.UNSIGNED_SHORT),s&&(u=4),gb.enableAttribute(n),Ga.vertexAttribPointer(n,o.itemSize,t,o.normalize,p*u,(r+d*p)*u),Ia&&c.numInstances&&Ia.vertexAttribDivisorANGLE(n,o.divisor||0)}else if(a.defaultAttributeValues){var v=a.defaultAttributeValues[m];v&&2===v.length?Ga.vertexAttrib2fv(n,a.defaultAttributeValues[m]):v&&3===v.length&&Ga.vertexAttrib3fv(n,a.defaultAttributeValues[m])}}}gb.disableUnusedAttributes()}function s(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function t(a,b){return a.object.renderOrder!==b.object.renderOrder?a.object.renderOrder-b.object.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function v(a){x(a,!0)}function w(a){x(a,!1)}function x(a,b,c){if(c||a.visible!==!1){if(a instanceof THREE.Scene||a instanceof THREE.Group);else if(a instanceof Autodesk.Viewing.Private.RenderBatch)a.forEach(b?v:w);else if(C(a),a instanceof THREE.Light)za.push(a);else{var d=Aa[a.id];if(d&&(a.frustumCulled===!1||Za.intersectsObject(a)===!0))for(var e=0,f=d.length;f>e;e++){var g=d[e];B(g),g.render=!0,b===!0&&(ab.setFromMatrixPosition(a.matrixWorld),ab.applyProjection($a),g.z=ab.z)}}if(a.children)for(var e=0,f=a.children.length;f>e;e++)x(a.children[e],b,c)}}function y(a,b,c,d,e){for(var f,g=0,h=a.length;h>g;g++){var i=a[g],j=i.object,k=i.buffer;if(e){var l=i.material.cutplanes?i.material.cutplanes.length:0;f=0==l&&e._noCutplanesMaterial?e._noCutplanesMaterial:e}else{if(f=i.material,!f)continue;N(f)}if(Ka.setMaterialFaces(f),k instanceof THREE.BufferGeometry?Ka.renderBufferDirect(b,c,d,f,k,j):Ka.renderBuffer(b,c,d,f,k,j),f.decals&&!e)for(var m=f.decals,n=0,o=m.length;o>n;n++){var p=m[n];f=p.material,N(f),Ka.setMaterialFaces(f),k instanceof THREE.BufferGeometry&&Ka.renderBufferDirect(b,c,d,f,k,j,p.uv)}}}function z(a,b){if(a.visible&&!a.hide){var c;if(Lb){var d=a.material.cutplanes?a.material.cutplanes.length:0;c=0==d&&Lb._noCutplanesMaterial?Lb._noCutplanesMaterial:Lb}else{if(c=a.material,!c)return;N(c)}if(Ka.setMaterialFaces(c),Ka.renderBufferDirect(Ib,Jb,Kb,c,a.geometry,a),c.decals&&!Lb)for(var e=c.decals,f=0,g=e.length;g>f;f++){var h=e[f];c=h.material,N(c),Ka.setMaterialFaces(c),Ka.renderBufferDirect(Ib,Jb,Kb,c,a.geometry,a,h.uv)}}}function A(a,b,c,d,e,f){Hb=b,Ib=c,Jb=d,Lb=f||null,a.forEach(z,a.forceVisible?1:128,!1)}function B(a){var b=a.object,c=a.buffer,d=b.geometry,e=b.material;if(e instanceof THREE.MeshFaceMaterial){var f=d instanceof THREE.BufferGeometry?0:c.materialIndex;e=e.materials[f],a.material=e,e.transparent?Fa.push(a):Ea.push(a)}else e&&(a.material=e,e.transparent?Fa.push(a):Ea.push(a))}function C(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("removed",xb));var c=a.geometry;if(void 0===c||void 0===c.__webglInit&&(c.__webglInit=!0,c.addEventListener("dispose",yb),c instanceof THREE.BufferGeometry||(a instanceof THREE.Mesh?E(a,c):a instanceof THREE.Line&&void 0===c.__webglVertexBuffer&&(b(c),e(c,a),c.verticesNeedUpdate=!0,c.colorsNeedUpdate=!0,c.lineDistancesNeedUpdate=!0))),void 0===a.__webglActive)if(a.__webglActive=!0,a instanceof THREE.Mesh){if(c instanceof THREE.BufferGeometry)F(Aa,c,a);else if(c instanceof THREE.Geometry)for(var d=Mb[c.id],f=0,g=d.length;g>f;f++)F(Aa,d[f],a)}else a instanceof THREE.Line||a instanceof THREE.PointCloud?F(Aa,c,a):(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&G(Ba,a)}function D(a,b){for(var c,d,e=hb.get("OES_element_index_uint")?4294967296:65535,f={},g=a.morphTargets?a.morphTargets.length:0,h=a.morphNormals?a.morphNormals.length:0,i={},j=[],k=0,l=a.faces.length;l>k;k++){var m=a.faces[k],n=b?m.materialIndex:0;n in f||(f[n]={hash:n,counter:0}),c=f[n].hash+"_"+f[n].counter,c in i||(d={id:Nb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d)),i[c].vertices+3>e&&(f[n].counter+=1,c=f[n].hash+"_"+f[n].counter,c in i||(d={id:Nb++,faces3:[],materialIndex:n,vertices:0,numMorphTargets:g,numMorphNormals:h},i[c]=d,j.push(d))),i[c].faces3.push(k),i[c].vertices+=3}return j}function E(a,b){var d=a.material,e=!1;(void 0===Mb[b.id]||b.groupsNeedUpdate===!0)&&(delete Aa[a.id],Mb[b.id]=D(b,d instanceof THREE.MeshFaceMaterial),b.groupsNeedUpdate=!1);for(var g=Mb[b.id],h=0,i=g.length;i>h;h++){var j=g[h];void 0===j.__webglVertexBuffer?(c(j),f(j,a),b.verticesNeedUpdate=!0,b.morphTargetsNeedUpdate=!0,b.elementsNeedUpdate=!0,b.uvsNeedUpdate=!0,b.normalsNeedUpdate=!0,b.tangentsNeedUpdate=!0,b.colorsNeedUpdate=!0,e=!0):e=!1,(e||void 0===a.__webglActive)&&F(Aa,j,a)}a.__webglActive=!0}function F(a,b,c){var d=c.id;a[d]=a[d]||[],a[d].push({id:d,buffer:b,object:c,material:null,z:0})}function G(a,b){a.push({id:null,object:b,opaque:null,transparent:null,z:0})}function H(a){var b,c,d=a.geometry;if(d instanceof THREE.BufferGeometry)n(d);else if(a instanceof THREE.Mesh){d.groupsNeedUpdate===!0&&E(a,d);for(var e=Mb[d.id],f=0,h=e.length;h>f;f++){var i=e[f];c=g(a,i),b=c.attributes&&I(c),(d.verticesNeedUpdate||d.morphTargetsNeedUpdate||d.elementsNeedUpdate||d.uvsNeedUpdate||d.normalsNeedUpdate||d.colorsNeedUpdate||d.tangentsNeedUpdate||b)&&m(i,a,Ga.DYNAMIC_DRAW,!d.dynamic,c)}d.verticesNeedUpdate=!1,d.morphTargetsNeedUpdate=!1,d.elementsNeedUpdate=!1,d.uvsNeedUpdate=!1,d.normalsNeedUpdate=!1,d.colorsNeedUpdate=!1,d.tangentsNeedUpdate=!1,c.attributes&&J(c)}else a instanceof THREE.Line&&(c=g(a,d),b=c.attributes&&I(c),(d.verticesNeedUpdate||d.colorsNeedUpdate||d.lineDistancesNeedUpdate||b)&&l(d,Ga.DYNAMIC_DRAW),d.verticesNeedUpdate=!1,d.colorsNeedUpdate=!1,d.lineDistancesNeedUpdate=!1,c.attributes&&J(c))}function I(a){for(var b in a.attributes)if(a.attributes[b].needsUpdate)return!0;return!1}function J(a){for(var b in a.attributes)a.attributes[b].needsUpdate=!1}function K(a){a instanceof THREE.Mesh||a instanceof THREE.PointCloud||a instanceof THREE.Line?delete Aa[a.id]:(a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback)&&L(Ba,a),delete a.__webglInit,delete a.__webglActive}function L(a,b){for(var c=a.length-1;c>=0;c--)a[c].object===b&&a.splice(c,1)}function M(a,b,c,d){a.addEventListener("dispose",Bb);var e=Ob[a.type];if(e){var f=THREE.ShaderLib[e];a.__webglShader={uniforms:THREE.UniformsUtils.clone(f.uniforms),vertexShader:f.vertexShader,fragmentShader:f.fragmentShader}}else a.__webglShader={uniforms:a.uniforms,vertexShader:a.vertexShader,fragmentShader:a.fragmentShader};var g=la(b),h=ma(b),i={precision:pa,precisionFragment:qa,supportsVertexTextures:pb,haveTextureLod:!!hb.get("EXT_shader_texture_lod"),map:!!a.map,envMap:!!a.envMap,irradianceMap:!!a.irradianceMap,envIsSpherical:a.envMap&&a.envMap.mapping==THREE.SphericalReflectionMapping,envGammaEncoded:a.envMap&&a.envMap.GammaEncoded,irrGammaEncoded:a.irradianceMap&&a.irradianceMap.GammaEncoded,envRGBM:a.envMap&&a.envMap.RGBM,irrRGBM:a.irradianceMap&&a.irradianceMap.RGBM,lightMap:!!a.lightMap,bumpMap:hb.get("OES_standard_derivatives")&&!!a.bumpMap,normalMap:hb.get("OES_standard_derivatives")&&!!a.normalMap,specularMap:!!a.specularMap,alphaMap:!!a.alphaMap,vertexColors:a.vertexColors,fog:c,useFog:a.fog,fogExp:c instanceof THREE.FogExp2,sizeAttenuation:a.sizeAttenuation,logarithmicDepthBuffer:wa,maxDirLights:g.directional,maxPointLights:g.point,maxSpotLights:g.spot,maxHemiLights:g.hemi,maxShadows:h,shadowMapEnabled:Ka.shadowMapEnabled&&d.receiveShadow,shadowMapType:Ka.shadowMapType,shadowMapDebug:Ka.shadowMapDebug,shadowMapCascade:Ka.shadowMapCascade,alphaTest:a.alphaTest,metal:a.metal,clearcoat:a.clearcoat,wrapAround:a.wrapAround,doubleSided:a.side===THREE.DoubleSide,flipSided:a.side===THREE.BackSide,mrtNormals:a.mrtNormals,mrtIdBuffer:a.mrtIdBuffer,tonemapOutput:a.tonemapOutput,packedNormals:a.packedNormals,hatchPattern:!!a.hatchParams,numCutplanes:a.cutplanes?a.cutplanes.length:0,mapInvert:a.map&&a.map.invert,mapClampS:a.map&&a.map.clampS,mapClampT:a.map&&a.map.clampT,bumpMapClampS:a.bumpMap&&a.bumpMap.clampS,bumpMapClampT:a.bumpMap&&a.bumpMap.clampT,normalMapClampS:a.normalMap&&a.normalMap.clampS,normalMapClampT:a.normalMap&&a.normalMap.clampT,specularMapClampS:a.specularMap&&a.specularMap.clampS,specularMapClampT:a.specularMap&&a.specularMap.clampT,alphaMapInvert:a.alphaMap&&a.alphaMap.invert,alphaMapClampS:a.alphaMap&&a.alphaMap.clampS,alphaMapClampT:a.alphaMap&&a.alphaMap.clampT},j=[];e?j.push(e):(j.push(a.fragmentShader),j.push(a.vertexShader));for(var k in a.defines)j.push(k),j.push(a.defines[k]);for(var l in i)j.push(l),j.push(i[l]);for(var m,n=j.join(),l=0,o=La.length;o>l;l++){var p=La[l];if(p.code===n){m=p,m.usedTimes++;break}}void 0===m&&(m=new FireflyWebGLProgram(Ka,n,a,i),La.push(m),Ka.info.memory.programs=La.length),a.program=m,a.uniformsList=[];for(u in a.__webglShader.uniforms){var q=a.program.uniforms[u];q&&a.uniformsList.push([a.__webglShader.uniforms[u],q])}}function N(a){a.transparent===!0&&gb.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst,a.blendEquationAlpha,a.blendSrcAlpha,a.blendDstAlpha),gb.setDepthTest(a.depthTest),gb.setDepthWrite(a.depthWrite),gb.setPolygonOffset(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}function O(a,b,c,d,e){Ra=0,d.needsUpdate&&(d.program&&Gb(d),M(d,b,c,e),d.needsUpdate=!1);var f=!1,g=!1,h=!1,i=d.program,j=i.uniforms,k=d.__webglShader.uniforms;if(i.id!==Ma&&(Ga.useProgram(i.program),Ma=i.id,f=!0,g=!0,h=!0),d.id!==Oa&&(-1===Oa&&(h=!0),Oa=d.id,g=!0),(f||a!==Pa)&&(Ga.uniformMatrix4fv(j.projectionMatrix,!1,a.projectionMatrix.elements),wa&&Ga.uniform1f(j.logDepthBufFC,2/(Math.log(a.far+1)/Math.LN2)),a!==Pa&&(Pa=a),(d instanceof THREE.ShaderMaterial||d instanceof THREE.MeshPhongMaterial||d.isPrismMaterial||d.envMap)&&null!==j.cameraPosition&&(ab.setFromMatrixPosition(a.matrixWorld),Ga.uniform3f(j.cameraPosition,ab.x,ab.y,ab.z)),(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.ShaderMaterial||d.isPrismMaterial||d.skinning)&&(null!==j.viewMatrix&&Ga.uniformMatrix4fv(j.viewMatrix,!1,a.matrixWorldInverse.elements),null!==j.viewMatrixInverse&&Ga.uniformMatrix4fv(j.viewMatrixInverse,!1,_a.elements),j.mvpMatrix&&Ga.uniformMatrix4fv(j.mvpMatrix,!1,$a.elements),h?(T(k,d),U(k,!0)):U(k,!1))),g){c&&d.fog&&S(k,c),(d instanceof THREE.MeshPhongMaterial||d instanceof THREE.MeshLambertMaterial||d.isPrismMaterial||d.lights)&&(cb&&(h=!0,da(b),cb=!1),h?(Y(k,db),Z(k,!0)):Z(k,!1)),(d instanceof THREE.MeshBasicMaterial||d instanceof THREE.MeshLambertMaterial||d instanceof THREE.MeshPhongMaterial)&&(P(k,d),T(k,d)),d instanceof THREE.LineBasicMaterial?Q(k,d):d instanceof THREE.LineDashedMaterial?(Q(k,d),R(k,d)):d instanceof THREE.MeshPhongMaterial?V(k,d):d instanceof THREE.MeshLambertMaterial?X(k,d):d instanceof THREE.MeshDepthMaterial?(k.mNear.value=a.near,k.mFar.value=a.far,k.opacity.value=d.opacity):d instanceof THREE.MeshNormalMaterial?k.opacity.value=d.opacity:d.isPrismMaterial&&(W(k,d),T(k,d)),e.receiveShadow&&!d._shadowPass&&$(k,b);var l=k.cutplanes;d.cutplanes&&d.cutplanes.length>0&&l&&(l.value=d.cutplanes,l._array&&l._array.length!=4*d.cutplanes&&(l._array=void 0)),d.hatchParams&&k.hatchParams&&(k.hatchParams.value.copy(d.hatchParams),k.hatchTintColor.value.copy(d.hatchTintColor),k.hatchTintIntensity.value=d.hatchTintIntensity),ba(d.uniformsList)}if(_(j,e,a),null!==j.modelMatrix&&Ga.uniformMatrix4fv(j.modelMatrix,!1,e.matrixWorld.elements),null!==j.dbId){var m=e.dbId||e.fragId||0;Ga.uniform4f(j.dbId,(255&m)/255,(m>>8&255)/255,(m>>16&255)/255,(m>>24&255)/255)}return i}function P(a,b){function c(a,b,c){var d=c.offset,e=c.repeat;if(b){var f=b.value;c.matrix?f.copy(c.matrix):f.identity(),f.elements[6]+=d.x,f.elements[7]+=d.y,f.elements[0]*=e.x,f.elements[3]*=e.x,f.elements[1]*=e.y,f.elements[4]*=e.y}else a.offsetRepeat.value.set(d.x,d.y,e.x,e.y)}a.opacity.value=b.opacity,a.diffuse.value.copy(b.color),a.map.value=b.map,a.lightMap.value=b.lightMap,a.specularMap.value=b.specularMap,a.alphaMap.value=b.alphaMap,b.bumpMap&&(a.bumpMap.value=b.bumpMap,a.bumpScale.value=b.bumpScale),b.normalMap&&(a.normalMap.value=b.normalMap,a.normalScale.value.copy(b.normalScale)),b.alphaMap&&c(a,a.texMatrixAlpha,b.alphaMap);var d;b.normalMap?d=b.normalMap:b.bumpMap&&(d=b.bumpMap),void 0!==d&&c(a,a.texMatrixBump,d);var e;b.map?e=b.map:b.specularMap&&(e=b.specularMap),void 0!==e&&c(a,a.texMatrix,e),a.envMap.value=b.envMap,a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.reflectivity.value=b.reflectivity,a.refractionRatio.value=b.refractionRatio}function Q(a,b){a.diffuse.value=b.color,a.opacity.value=b.opacity}function R(a,b){a.dashSize.value=b.dashSize,a.totalSize.value=b.dashSize+b.gapSize,a.scale.value=b.scale}function S(a,b){a.fogColor.value=b.color,b instanceof THREE.Fog?(a.fogNear.value=b.near,a.fogFar.value=b.far):b instanceof THREE.FogExp2&&(a.fogDensity.value=b.density)}function T(a,b){a.envMap&&(a.envMap.value=b.envMap),a.irradianceMap&&(a.irradianceMap.value=b.irradianceMap),a.envMapExposure&&(a.envMapExposure.value=b.envMapExposure),a.envRotationSin&&a.envRotationCos&&(a.envRotationSin.value=b.envRotationSin,a.envRotationCos.value=b.envRotationCos)}function U(a,b){a.envMap&&(a.envMap.needsUpdate=b),a.irradianceMap&&(a.irradianceMap.needsUpdate=b),a.envMapExposure&&(a.envMapExposure.needsUpdate=b)}function V(a,b){a.shininess.value=b.shininess;var c=Math.log(Math.max(1+1e-10,b.shininess));a.reflMipIndex.value=Math.max(0,-.72134752*c+5.5),a.emissive.value.copy(b.emissive),a.specular.value.copy(b.specular),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB),a.exposureBias.value=b.exposureBias}function W(a,b){function c(a,b,c){a[c].value=b[c],null!=b[c]&&(a[c+"_texMatrix"].value=(new THREE.Matrix3).copy(b[c].matrix),a[c+"_invert"].value=b[c].invert)}function d(a,b,c){a[c].value=b[c],null!=b[c]&&(a[c+"_texMatrix"].value=(new THREE.Matrix3).copy(b[c].matrix),a[c+"_bumpScale"].value=(new THREE.Vector2).copy(b[c].bumpScale),a[c+"_bumpmapType"].value=b[c].bumpmapType)}switch(a.exposureBias.value=b.exposureBias,a.surface_albedo.value=(new THREE.Color).copy(b.surface_albedo),a.surface_roughness.value=b.surface_roughness,a.surface_anisotropy.value=b.surface_anisotropy,a.surface_rotation.value=b.surface_rotation,c(a,b,"surface_albedo_map"),c(a,b,"surface_roughness_map"),c(a,b,"surface_cutout_map"),c(a,b,"surface_anisotropy_map"),c(a,b,"surface_rotation_map"),d(a,b,"surface_normal_map"),b.prismType){case"PrismOpaque":a.opaque_albedo.value=(new THREE.Color).copy(b.opaque_albedo),a.opaque_luminance_modifier.value=(new THREE.Color).copy(b.opaque_luminance_modifier),a.opaque_f0.value=b.opaque_f0,a.opaque_luminance.value=b.opaque_luminance,c(a,b,"opaque_albedo_map"),c(a,b,"opaque_luminance_modifier_map"),c(a,b,"opaque_f0_map");break;case"PrismMetal":a.metal_f0.value=(new THREE.Color).copy(b.metal_f0),c(a,b,"metal_f0_map");break;case"PrismLayered":a.layered_f0.value=b.layered_f0,a.layered_diffuse.value=(new THREE.Color).copy(b.layered_diffuse),a.layered_fraction.value=b.layered_fraction,a.layered_bottom_f0.value=(new THREE.Color).copy(b.layered_bottom_f0),a.layered_roughness.value=b.layered_roughness,a.layered_anisotropy.value=b.layered_anisotropy,a.layered_rotation.value=b.layered_rotation,c(a,b,"layered_bottom_f0_map"),c(a,b,"layered_f0_map"),c(a,b,"layered_diffuse_map"),c(a,b,"layered_fraction_map"),c(a,b,"layered_roughness_map"),c(a,b,"layered_anisotropy_map"),c(a,b,"layered_rotation_map"),d(a,b,"layered_normal_map");break;case"PrismTransparent":a.transparent_color.value=(new THREE.Color).copy(b.transparent_color),a.transparent_distance.value=b.transparent_distance,a.transparent_ior.value=b.transparent_ior;break;case"PrismWood":a.wood_fiber_cosine_enable.value=b.wood_fiber_cosine_enable,a.wood_fiber_cosine_bands.value=b.wood_fiber_cosine_bands,a.wood_fiber_cosine_weights.value=(new THREE.Vector4).copy(b.wood_fiber_cosine_weights),a.wood_fiber_cosine_frequencies.value=(new THREE.Vector4).copy(b.wood_fiber_cosine_frequencies),a.wood_fiber_perlin_enable.value=b.wood_fiber_perlin_enable,a.wood_fiber_perlin_bands.value=b.wood_fiber_perlin_bands,a.wood_fiber_perlin_weights.value=(new THREE.Vector4).copy(b.wood_fiber_perlin_weights),a.wood_fiber_perlin_frequencies.value=(new THREE.Vector4).copy(b.wood_fiber_perlin_frequencies),a.wood_fiber_perlin_scale_z.value=b.wood_fiber_perlin_scale_z,a.wood_growth_perlin_enable.value=b.wood_growth_perlin_enable,a.wood_growth_perlin_bands.value=b.wood_growth_perlin_bands,a.wood_growth_perlin_weights.value=(new THREE.Vector4).copy(b.wood_growth_perlin_weights),a.wood_growth_perlin_frequencies.value=(new THREE.Vector4).copy(b.wood_growth_perlin_frequencies),a.wood_latewood_ratio.value=b.wood_latewood_ratio,a.wood_earlywood_sharpness.value=b.wood_earlywood_sharpness,a.wood_latewood_sharpness.value=b.wood_latewood_sharpness,a.wood_ring_thickness.value=b.wood_ring_thickness,a.wood_earlycolor_perlin_enable.value=b.wood_earlycolor_perlin_enable,a.wood_earlycolor_perlin_bands.value=b.wood_earlycolor_perlin_bands,a.wood_earlycolor_perlin_weights.value=(new THREE.Vector4).copy(b.wood_earlycolor_perlin_weights),a.wood_earlycolor_perlin_frequencies.value=(new THREE.Vector4).copy(b.wood_earlycolor_perlin_frequencies),a.wood_early_color.value=(new THREE.Color).copy(b.wood_early_color),a.wood_use_manual_late_color.value=b.wood_use_manual_late_color,a.wood_manual_late_color.value=(new THREE.Color).copy(b.wood_manual_late_color),a.wood_latecolor_perlin_enable.value=b.wood_latecolor_perlin_enable,a.wood_latecolor_perlin_bands.value=b.wood_latecolor_perlin_bands,a.wood_latecolor_perlin_weights.value=(new THREE.Vector4).copy(b.wood_latecolor_perlin_weights),a.wood_latecolor_perlin_frequencies.value=(new THREE.Vector4).copy(b.wood_latecolor_perlin_frequencies),a.wood_late_color_power.value=b.wood_late_color_power,a.wood_diffuse_perlin_enable.value=b.wood_diffuse_perlin_enable,a.wood_diffuse_perlin_bands.value=b.wood_diffuse_perlin_bands,a.wood_diffuse_perlin_weights.value=(new THREE.Vector4).copy(b.wood_diffuse_perlin_weights),a.wood_diffuse_perlin_frequencies.value=(new THREE.Vector4).copy(b.wood_diffuse_perlin_frequencies),a.wood_diffuse_perlin_scale_z.value=b.wood_diffuse_perlin_scale_z,a.wood_use_pores.value=b.wood_use_pores,a.wood_pore_type.value=b.wood_pore_type,a.wood_pore_radius.value=b.wood_pore_radius,a.wood_pore_cell_dim.value=b.wood_pore_cell_dim,a.wood_pore_color_power.value=b.wood_pore_color_power,a.wood_pore_depth.value=b.wood_pore_depth,a.wood_use_rays.value=b.wood_use_rays,a.wood_ray_color_power.value=b.wood_ray_color_power,a.wood_ray_seg_length_z.value=b.wood_ray_seg_length_z,a.wood_ray_num_slices.value=b.wood_ray_num_slices,a.wood_ray_ellipse_z2x.value=b.wood_ray_ellipse_z2x,a.wood_ray_ellipse_radius_x.value=b.wood_ray_ellipse_radius_x,a.wood_use_latewood_bump.value=b.wood_use_latewood_bump,a.wood_latewood_bump_depth.value=b.wood_latewood_bump_depth,a.wood_use_groove_roughness.value=b.wood_use_groove_roughness,a.wood_groove_roughness.value=b.wood_groove_roughness,a.wood_diffuse_lobe_weight.value=b.wood_diffuse_lobe_weight;break;default:console.warn("Unknown prism type: "+b.prismType)}a.envExponentMin.value=b.envExponentMin,a.envExponentMax.value=b.envExponentMax,a.envExponentCount.value=b.envExponentCount}function X(a,b){a.emissive.value.copy(b.emissive),b.wrapAround&&a.wrapRGB.value.copy(b.wrapRGB)}function Y(a,b){a.ambientLightColor.value=b.ambient,a.directionalLightColor.value=b.directional.colors,a.directionalLightDirection.value=b.directional.positions,a.pointLightColor.value=b.point.colors,a.pointLightPosition.value=b.point.positions,a.pointLightDistance.value=b.point.distances,a.spotLightColor.value=b.spot.colors,a.spotLightPosition.value=b.spot.positions,a.spotLightDistance.value=b.spot.distances,a.spotLightDirection.value=b.spot.directions,a.spotLightAngleCos.value=b.spot.anglesCos,a.spotLightExponent.value=b.spot.exponents,a.hemisphereLightSkyColor.value=b.hemi.skyColors,a.hemisphereLightGroundColor.value=b.hemi.groundColors,a.hemisphereLightDirection.value=b.hemi.positions}function Z(a,b){a.ambientLightColor.needsUpdate=b,a.directionalLightColor.needsUpdate=b,a.directionalLightDirection.needsUpdate=b,a.pointLightColor.needsUpdate=b,a.pointLightPosition.needsUpdate=b,a.pointLightDistance.needsUpdate=b,a.spotLightColor.needsUpdate=b,a.spotLightPosition.needsUpdate=b,a.spotLightDistance.needsUpdate=b,a.spotLightDirection.needsUpdate=b,a.spotLightAngleCos.needsUpdate=b,a.spotLightExponent.needsUpdate=b,a.hemisphereLightSkyColor.needsUpdate=b,a.hemisphereLightGroundColor.needsUpdate=b,a.hemisphereLightDirection.needsUpdate=b}function $(a,b){if(a.shadowMatrix)for(var c=0,d=0,e=b.length;e>d;d++){var f=b[d];f.castShadow&&(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade)&&(a.shadowMap.value[c]=f.shadowMap,a.shadowMapSize.value[c]=f.shadowMapSize,a.shadowMatrix.value[c]=f.shadowMatrix,a.shadowDarkness.value[c]=f.shadowDarkness,a.shadowBias.value[c]=f.shadowBias,c++)}}function _(a,b,c){Ca.multiplyMatrices(c.matrixWorldInverse,b.matrixWorld),Ga.uniformMatrix4fv(a.modelViewMatrix,!1,Ca.elements),a.normalMatrix&&(Da.getNormalMatrix(Ca),Ga.uniformMatrix3fv(a.normalMatrix,!1,Da.elements))}function aa(){var a=Ra;return a>=lb&&console.warn("WebGLRenderer: trying to use "+a+" texture units while this GPU supports only "+lb),Ra+=1,a}function ba(a){for(var b,c,d,e=0,f=a.length;f>e;e++){var g=a[e][0];if(g.needsUpdate!==!1){var h=g.type,i=g.value,j=a[e][1];switch(h){case"1i":Ga.uniform1i(j,i);break;case"1f":Ga.uniform1f(j,i);break;case"2f":Ga.uniform2f(j,i[0],i[1]);break;case"3f":Ga.uniform3f(j,i[0],i[1],i[2]);break;case"4f":Ga.uniform4f(j,i[0],i[1],i[2],i[3]);break;case"1iv":Ga.uniform1iv(j,i);break;case"3iv":Ga.uniform3iv(j,i);break;case"1fv":Ga.uniform1fv(j,i);break;case"2fv":Ga.uniform2fv(j,i);break;case"3fv":Ga.uniform3fv(j,i);break;case"4fv":Ga.uniform4fv(j,i);break;case"Matrix3fv":Ga.uniformMatrix3fv(j,!1,i);break;case"Matrix4fv":Ga.uniformMatrix4fv(j,!1,i);break;case"i":Ga.uniform1i(j,i);break;case"f":Ga.uniform1f(j,i);break;case"v2":Ga.uniform2f(j,i.x,i.y);break;case"v3":Ga.uniform3f(j,i.x,i.y,i.z);break;case"v4":Ga.uniform4f(j,i.x,i.y,i.z,i.w);break;case"c":Ga.uniform3f(j,i.r,i.g,i.b);break;case"iv1":Ga.uniform1iv(j,i);break;case"iv":Ga.uniform3iv(j,i);break;case"fv1":Ga.uniform1fv(j,i);break;case"fv":Ga.uniform3fv(j,i);break;case"v2v":void 0===g._array&&(g._array=new Float32Array(2*i.length));for(var k=0,l=i.length;l>k;k++)d=2*k,g._array[d]=i[k].x,g._array[d+1]=i[k].y;Ga.uniform2fv(j,g._array);break;case"v3v":void 0===g._array&&(g._array=new Float32Array(3*i.length));for(var k=0,l=i.length;l>k;k++)d=3*k,g._array[d]=i[k].x,g._array[d+1]=i[k].y,g._array[d+2]=i[k].z;Ga.uniform3fv(j,g._array);break;case"v4v":void 0===g._array&&(g._array=new Float32Array(4*i.length));for(var k=0,l=i.length;l>k;k++)d=4*k,g._array[d]=i[k].x,g._array[d+1]=i[k].y,g._array[d+2]=i[k].z,g._array[d+3]=i[k].w;Ga.uniform4fv(j,g._array);break;case"m3":Ga.uniformMatrix3fv(j,!1,i.elements);break;case"m3v":void 0===g._array&&(g._array=new Float32Array(9*i.length));for(var k=0,l=i.length;l>k;k++)i[k].flattenToArrayOffset(g._array,9*k);Ga.uniformMatrix3fv(j,!1,g._array);break;case"m4":Ga.uniformMatrix4fv(j,!1,i.elements);break;case"m4v":void 0===g._array&&(g._array=new Float32Array(16*i.length));for(var k=0,l=i.length;l>k;k++)i[k].flattenToArrayOffset(g._array,16*k);Ga.uniformMatrix4fv(j,!1,g._array);break;case"t":if(b=i,c=aa(),Ga.uniform1i(j,c),!b)continue;b instanceof THREE.CubeTexture||b.image instanceof Array&&6===b.image.length?ga(b,c):b instanceof THREE.WebGLRenderTargetCube?ha(b,c):Ka.setTexture(b,c);break;case"tv":void 0===g._array&&(g._array=[]);for(var k=0,l=g.value.length;l>k;k++)g._array[k]=aa();Ga.uniform1iv(j,g._array);for(var k=0,l=g.value.length;l>k;k++)b=g.value[k],c=g._array[k],b&&Ka.setTexture(b,c);break;default:console.warn("THREE.WebGLRenderer: Unknown uniform type: "+h)}}}}function ca(a,b,c,d){a[b]=c.r*d,a[b+1]=c.g*d,a[b+2]=c.b*d}function da(a){var b,c,d,e,f,g,h,i,j=0,k=0,l=0,m=db,n=m.directional.colors,o=m.directional.positions,p=m.point.colors,q=m.point.positions,r=m.point.distances,s=m.spot.colors,t=m.spot.positions,u=m.spot.distances,v=m.spot.directions,w=m.spot.anglesCos,x=m.spot.exponents,y=m.hemi.skyColors,z=m.hemi.groundColors,A=m.hemi.positions,B=0,C=0,D=0,E=0,F=0,G=0,H=0,I=0,J=0,K=0,L=0,M=0;for(b=0,c=a.length;c>b;b++)if(d=a[b],!d.onlyShadow)if(e=d.color,h=d.intensity,i=d.distance,d instanceof THREE.AmbientLight){if(!d.visible)continue;j+=e.r,k+=e.g,l+=e.b}else if(d instanceof THREE.DirectionalLight){if(F+=1,!d.visible)continue;bb.setFromMatrixPosition(d.matrixWorld),ab.setFromMatrixPosition(d.target.matrixWorld),bb.sub(ab),bb.normalize(),J=3*B,o[J]=bb.x,o[J+1]=bb.y,o[J+2]=bb.z,ca(n,J,e,h),B+=1}else if(d instanceof THREE.PointLight){if(G+=1,!d.visible)continue;K=3*C,ca(p,K,e,h),ab.setFromMatrixPosition(d.matrixWorld),q[K]=ab.x,q[K+1]=ab.y,q[K+2]=ab.z,r[C]=i,C+=1}else if(d instanceof THREE.SpotLight){if(H+=1,!d.visible)continue;L=3*D,ca(s,L,e,h),ab.setFromMatrixPosition(d.matrixWorld),t[L]=ab.x,t[L+1]=ab.y,t[L+2]=ab.z,u[D]=i,bb.copy(ab),ab.setFromMatrixPosition(d.target.matrixWorld),bb.sub(ab),bb.normalize(),v[L]=bb.x,v[L+1]=bb.y,v[L+2]=bb.z,w[D]=Math.cos(d.angle),x[D]=d.exponent,D+=1}else if(d instanceof THREE.HemisphereLight){if(I+=1,!d.visible)continue;bb.setFromMatrixPosition(d.matrixWorld),bb.normalize(),M=3*E,A[M]=bb.x,A[M+1]=bb.y,A[M+2]=bb.z,f=d.color,g=d.groundColor,ca(y,M,f,h),ca(z,M,g,h),E+=1}for(b=3*B,c=Math.max(n.length,3*F);c>b;b++)n[b]=0;for(b=3*C,c=Math.max(p.length,3*G);c>b;b++)p[b]=0;for(b=3*D,c=Math.max(s.length,3*H);c>b;b++)s[b]=0;for(b=3*E,c=Math.max(y.length,3*I);c>b;b++)y[b]=0;for(b=3*E,c=Math.max(z.length,3*I);c>b;b++)z[b]=0;m.directional.length=B,m.point.length=C,m.spot.length=D,m.hemi.length=E,m.ambient[0]=j,m.ambient[1]=k,m.ambient[2]=l}function ea(a,b,c){var d;c?(Ga.texParameteri(a,Ga.TEXTURE_WRAP_S,ka(b.wrapS)),Ga.texParameteri(a,Ga.TEXTURE_WRAP_T,ka(b.wrapT)),Ga.texParameteri(a,Ga.TEXTURE_MAG_FILTER,ka(b.magFilter)),Ga.texParameteri(a,Ga.TEXTURE_MIN_FILTER,ka(b.minFilter))):(Ga.texParameteri(a,Ga.TEXTURE_WRAP_S,Ga.CLAMP_TO_EDGE),Ga.texParameteri(a,Ga.TEXTURE_WRAP_T,Ga.CLAMP_TO_EDGE),(b.wrapS!==THREE.ClampToEdgeWrapping||b.wrapT!==THREE.ClampToEdgeWrapping)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping. ( "+b.sourceFile+" )"),Ga.texParameteri(a,Ga.TEXTURE_MAG_FILTER,ja(b.magFilter)),Ga.texParameteri(a,Ga.TEXTURE_MIN_FILTER,ja(b.minFilter)),b.minFilter!==THREE.NearestFilter&&b.minFilter!==THREE.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter. ( "+b.sourceFile+" )")),d=hb.get("EXT_texture_filter_anisotropic"),d&&b.type!==THREE.FloatType&&b.type!==THREE.HalfFloatType&&(b.anisotropy>1||b.__oldAnisotropy)&&(Ga.texParameterf(a,d.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(b.anisotropy,Ka.getMaxAnisotropy())),b.__oldAnisotropy=b.anisotropy)}function fa(a,b){if(a.width<=b&&a.height<=b)return a;var c=Math.max(a.width,a.height),d=Math.floor(a.width*b/c),e=Math.floor(a.height*b/c),f=document.createElement("canvas");f.width=d,f.height=e;var g=f.getContext("2d");return g.drawImage(a,0,0,a.width,a.height,0,0,d,e),f}function ga(a,b){if(6===a.image.length)if(a.needsUpdate){a.image.__webglTextureCube||(a.addEventListener("dispose",zb),a.image.__webglTextureCube=Ga.createTexture(),Ka.info.memory.textures++),Ga.activeTexture(Ga.TEXTURE0+b),Ga.bindTexture(Ga.TEXTURE_CUBE_MAP,a.image.__webglTextureCube),Ga.pixelStorei(Ga.UNPACK_FLIP_Y_WEBGL,a.flipY);for(var c=a instanceof THREE.CompressedTexture,d=a.image[0]instanceof THREE.DataTexture,e=[],f=0;6>f;f++)!Ka.autoScaleCubemaps||c||d?e[f]=d?a.image[f].image:a.image[f]:e[f]=fa(a.image[f],ob);var g=e[0],h=THREE.Math.isPowerOfTwo(g.width)&&THREE.Math.isPowerOfTwo(g.height),i=ka(a.format),j=ka(a.type);ea(Ga.TEXTURE_CUBE_MAP,a,h);for(var f=0;6>f;f++)if(c)for(var k,l=e[f].mipmaps,m=0,n=l.length;n>m;m++)k=l[m],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?ub().indexOf(i)>-1?Ga.compressedTexImage2D(Ga.TEXTURE_CUBE_MAP_POSITIVE_X+f,m,i,k.width,k.height,0,k.data):console.warn("Attempt to load unsupported compressed texture format"):Ga.texImage2D(Ga.TEXTURE_CUBE_MAP_POSITIVE_X+f,m,i,k.width,k.height,0,i,j,k.data);else d?Ga.texImage2D(Ga.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,i,e[f].width,e[f].height,0,i,j,e[f].data):Ga.texImage2D(Ga.TEXTURE_CUBE_MAP_POSITIVE_X+f,0,i,i,j,e[f]);a.generateMipmaps&&h&&Ga.generateMipmap(Ga.TEXTURE_CUBE_MAP),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()}else Ga.activeTexture(Ga.TEXTURE0+b),Ga.bindTexture(Ga.TEXTURE_CUBE_MAP,a.image.__webglTextureCube)}function ha(a,b){Ga.activeTexture(Ga.TEXTURE0+b),Ga.bindTexture(Ga.TEXTURE_CUBE_MAP,a.__webglTexture)}function ia(a){Ga.bindTexture(Ga.TEXTURE_2D,a.__webglTexture),Ga.generateMipmap(Ga.TEXTURE_2D),Ga.bindTexture(Ga.TEXTURE_2D,null)}function ja(a){return a===THREE.NearestFilter||a===THREE.NearestMipMapNearestFilter||a===THREE.NearestMipMapLinearFilter?Ga.NEAREST:Ga.LINEAR}function ka(a){var b;if(a===THREE.RepeatWrapping)return Ga.REPEAT;if(a===THREE.ClampToEdgeWrapping)return Ga.CLAMP_TO_EDGE;if(a===THREE.MirroredRepeatWrapping)return Ga.MIRRORED_REPEAT;if(a===THREE.NearestFilter)return Ga.NEAREST;if(a===THREE.NearestMipMapNearestFilter)return Ga.NEAREST_MIPMAP_NEAREST;if(a===THREE.NearestMipMapLinearFilter)return Ga.NEAREST_MIPMAP_LINEAR;if(a===THREE.LinearFilter)return Ga.LINEAR;if(a===THREE.LinearMipMapNearestFilter)return Ga.LINEAR_MIPMAP_NEAREST;if(a===THREE.LinearMipMapLinearFilter)return Ga.LINEAR_MIPMAP_LINEAR;if(a===THREE.UnsignedByteType)return Ga.UNSIGNED_BYTE;if(a===THREE.UnsignedShort4444Type)return Ga.UNSIGNED_SHORT_4_4_4_4;if(a===THREE.UnsignedShort5551Type)return Ga.UNSIGNED_SHORT_5_5_5_1;if(a===THREE.UnsignedShort565Type)return Ga.UNSIGNED_SHORT_5_6_5;if(a===THREE.ByteType)return Ga.BYTE;if(a===THREE.ShortType)return Ga.SHORT;if(a===THREE.UnsignedShortType)return Ga.UNSIGNED_SHORT;if(a===THREE.IntType)return Ga.INT;if(a===THREE.UnsignedIntType)return Ga.UNSIGNED_INT;if(a===THREE.FloatType)return Ga.FLOAT;if(a===THREE.HalfFloatType)return 36193;if(a===THREE.AlphaFormat)return Ga.ALPHA;if(a===THREE.RGBFormat)return Ga.RGB;if(a===THREE.RGBAFormat)return Ga.RGBA;if(a===THREE.LuminanceFormat)return Ga.LUMINANCE;if(a===THREE.LuminanceAlphaFormat)return Ga.LUMINANCE_ALPHA;if(a===THREE.AddEquation)return Ga.FUNC_ADD;if(a===THREE.SubtractEquation)return Ga.FUNC_SUBTRACT;if(a===THREE.ReverseSubtractEquation)return Ga.FUNC_REVERSE_SUBTRACT;if(a===THREE.ZeroFactor)return Ga.ZERO;if(a===THREE.OneFactor)return Ga.ONE;if(a===THREE.SrcColorFactor)return Ga.SRC_COLOR;if(a===THREE.OneMinusSrcColorFactor)return Ga.ONE_MINUS_SRC_COLOR;if(a===THREE.SrcAlphaFactor)return Ga.SRC_ALPHA;if(a===THREE.OneMinusSrcAlphaFactor)return Ga.ONE_MINUS_SRC_ALPHA;if(a===THREE.DstAlphaFactor)return Ga.DST_ALPHA;if(a===THREE.OneMinusDstAlphaFactor)return Ga.ONE_MINUS_DST_ALPHA;if(a===THREE.DstColorFactor)return Ga.DST_COLOR;
if(a===THREE.OneMinusDstColorFactor)return Ga.ONE_MINUS_DST_COLOR;if(a===THREE.SrcAlphaSaturateFactor)return Ga.SRC_ALPHA_SATURATE;if(b=hb.get("WEBGL_compressed_texture_s3tc"),null!==b){if(a===THREE.RGB_S3TC_DXT1_Format)return b.COMPRESSED_RGB_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT1_Format)return b.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(a===THREE.RGBA_S3TC_DXT3_Format)return b.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(a===THREE.RGBA_S3TC_DXT5_Format)return b.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(b=hb.get("WEBGL_compressed_texture_pvrtc"),null!==b){if(a===THREE.RGB_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(a===THREE.RGB_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(a===THREE.RGBA_PVRTC_4BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(a===THREE.RGBA_PVRTC_2BPPV1_Format)return b.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(b=hb.get("EXT_blend_minmax"),null!==b){if(a===THREE.MinEquation)return b.MIN_EXT;if(a===THREE.MaxEquation)return b.MAX_EXT}return 0}function la(a){for(var b=0,c=0,d=0,e=0,f=0,g=a.length;g>f;f++){var h=a[f];h.onlyShadow||(h instanceof THREE.DirectionalLight&&b++,h instanceof THREE.PointLight&&c++,h instanceof THREE.SpotLight&&d++,h instanceof THREE.HemisphereLight&&e++)}return{directional:b,point:c,spot:d,hemi:e}}function ma(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a[c];e.castShadow&&(e instanceof THREE.SpotLight&&b++,e instanceof THREE.DirectionalLight&&!e.shadowCascade&&b++)}return b}console.log("THREE.WebGLRenderer",THREE.REVISION),a=a||{};var na=void 0!==a.canvas?a.canvas:document.createElement("canvas"),oa=window.devicePixelRatio||1,pa=void 0!==a.precision?a.precision:"highp",qa=void 0!==a.precision?a.precision:isMobileDevice()?"mediump":"highp",ra=void 0!==a.alpha?a.alpha:!1,sa=void 0!==a.premultipliedAlpha?a.premultipliedAlpha:!0,ta=void 0!==a.antialias?a.antialias:!1,ua=void 0!==a.stencil?a.stencil:!0,va=void 0!==a.preserveDrawingBuffer?a.preserveDrawingBuffer:!0,wa=void 0!==a.logarithmicDepthBuffer?a.logarithmicDepthBuffer:!1,xa=new THREE.Color(0),ya=0,za=[],Aa={},Ba=[],Ca=new THREE.Matrix4,Da=new THREE.Matrix3,Ea=[],Fa=[];this.domElement=na,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Ga,Ha,Ia,Ja,Ka=this,La=[],Ma=null,Na=null,Oa=-1,Pa=null,Qa="",Ra=(new THREE.Frustum,new THREE.Matrix4,new THREE.Matrix4,0),Sa=0,Ta=0,Ua=na.width,Va=na.height,Wa=0,Xa=0,Ya={},Za=new THREE.Frustum,$a=new THREE.Matrix4,_a=new THREE.Matrix4,ab=new THREE.Vector3,bb=new THREE.Vector3,cb=!0,db={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}};try{var eb={alpha:ra,premultipliedAlpha:sa,antialias:ta,stencil:ua,preserveDrawingBuffer:va};if(Ga=na.getContext("webgl",eb)||na.getContext("experimental-webgl",eb),null===Ga)throw null!==na.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";Ga=rescueFromPolymer(Ga),na.addEventListener("webglcontextlost",function(a){a.preventDefault(),kb(),jb(),Aa={}},!1)}catch(fb){console.error(fb)}var gb=new THREE.WebGLState(Ga,ka);void 0===Ga.getShaderPrecisionFormat&&(Ga.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}});var hb=new THREE.WebGLExtensions(Ga);hb.get("OES_texture_float"),hb.get("OES_texture_float_linear"),hb.get("OES_texture_half_float"),hb.get("OES_texture_half_float_linear"),hb.get("OES_standard_derivatives"),hb.get("EXT_shader_texture_lod"),hb.get("EXT_texture_filter_anisotropic"),hb.get("WEBGL_compressed_texture_s3tc"),Ha=hb.get("WEBGL_draw_buffers"),Ia=null,Ja=hb.get("OES_vertex_array_object"),wa&&hb.get("EXT_frag_depth");var ib=function(a,b,c,d){sa===!0&&(a*=d,b*=d,c*=d),Ga.clearColor(a,b,c,d)},jb=function(){Ga.clearColor(0,0,0,1),Ga.clearDepth(1),Ga.clearStencil(0),Ga.enable(Ga.DEPTH_TEST),Ga.depthFunc(Ga.LEQUAL),Ga.frontFace(Ga.CCW),Ga.cullFace(Ga.BACK),Ga.enable(Ga.CULL_FACE),Ga.enable(Ga.BLEND),Ga.blendEquation(Ga.FUNC_ADD),Ga.blendFunc(Ga.SRC_ALPHA,Ga.ONE_MINUS_SRC_ALPHA),Ga.viewport(Sa,Ta,Ua,Va),ib(xa.r,xa.g,xa.b,ya)},kb=function(){Ma=null,Pa=null,Qa="",Oa=-1,cb=!0,gb.reset()};jb(),this.context=Ga,this.state=gb;var lb=Ga.getParameter(Ga.MAX_TEXTURE_IMAGE_UNITS),mb=Ga.getParameter(Ga.MAX_VERTEX_TEXTURE_IMAGE_UNITS),nb=Ga.getParameter(Ga.MAX_TEXTURE_SIZE),ob=Ga.getParameter(Ga.MAX_CUBE_MAP_TEXTURE_SIZE),pb=mb>0,qb=(pb&&hb.get("OES_texture_float"),Ga.getShaderPrecisionFormat(Ga.VERTEX_SHADER,Ga.HIGH_FLOAT)),rb=Ga.getShaderPrecisionFormat(Ga.VERTEX_SHADER,Ga.MEDIUM_FLOAT),sb=Ga.getShaderPrecisionFormat(Ga.FRAGMENT_SHADER,Ga.HIGH_FLOAT),tb=Ga.getShaderPrecisionFormat(Ga.FRAGMENT_SHADER,Ga.MEDIUM_FLOAT),ub=function(){var a;return function(){if(void 0!==a)return a;if(a=[],hb.get("WEBGL_compressed_texture_pvrtc")||hb.get("WEBGL_compressed_texture_s3tc"))for(var b=Ga.getParameter(Ga.COMPRESSED_TEXTURE_FORMATS),c=0;c<b.length;c++)a.push(b[c]);return a}}(),vb=qb.precision>0,wb=rb.precision>0;"highp"!==pa||vb||(wb?(pa="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(pa="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==pa||wb||(pa="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),vb=sb.precision>0,wb=tb.precision>0,"highp"!==qa||vb||(wb?(qa="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(qa="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==qa||wb||(qa="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Ga},this.forceContextLoss=function(){hb.get("WEBGL_lose_context").loseContext()},this.supportsVertexTextures=function(){return pb},this.supportsFloatTextures=function(){return hb.get("OES_texture_float")},this.supportsHalfFloatTextures=function(){return hb.get("OES_texture_half_float_linear")},this.supportsStandardDerivatives=function(){return hb.get("OES_standard_derivatives")},this.supportsCompressedTextureS3TC=function(){return hb.get("WEBGL_compressed_texture_s3tc")},this.supportsMRT=function(){return Ha},this.supportsBlendMinMax=function(){return hb.get("EXT_blend_minmax")},this.getMaxAnisotropy=function(){var a;return function(){if(void 0!==a)return a;var b=hb.get("EXT_texture_filter_anisotropic");return a=null!==b?Ga.getParameter(b.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}}(),this.getPrecision=function(){return _precision},this.getPixelRatio=function(){return oa},this.setPixelRatio=function(a){oa=a},this.setSize=function(a,b,c){na.width=a*oa,na.height=b*oa,c!==!1&&(na.style.width=a+"px",na.style.height=b+"px"),this.setViewport(0,0,a,b)},this.setViewport=function(a,b,c,d){Sa=a*oa,Ta=b*oa,Ua=c*oa,Va=d*oa,Ga.viewport(Sa,Ta,Ua,Va)},this.setScissor=function(a,b,c,d){Ga.scissor(a*oa,b*oa,c*oa,d*oa)},this.enableScissorTest=function(a){a?Ga.enable(Ga.SCISSOR_TEST):Ga.disable(Ga.SCISSOR_TEST)},this.getClearColor=function(){return xa},this.setClearColor=function(a,b){xa.set(a),ya=void 0!==b?b:1,ib(xa.r,xa.g,xa.b,ya)},this.getClearAlpha=function(){return ya},this.setClearAlpha=function(a){ya=a,ib(xa.r,xa.g,xa.b,ya)},this.clear=function(a,b,c){var d=0;(void 0===a||a)&&(d|=Ga.COLOR_BUFFER_BIT),(void 0===b||b)&&(d|=Ga.DEPTH_BUFFER_BIT),(void 0===c||c)&&(d|=Ga.STENCIL_BUFFER_BIT),Ga.clear(d)},this.clearColor=function(){Ga.clear(Ga.COLOR_BUFFER_BIT)},this.clearDepth=function(){Ga.clear(Ga.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Ga.clear(Ga.STENCIL_BUFFER_BIT)},this.clearTarget=function(a,b,c,d){this.setRenderTarget(a),this.clear(b,c,d)},this.resetGLState=kb,this.updateShadowMap=function(a,b){Ma=null,_oldBlending=-1,_oldDepthTest=-1,_oldDepthWrite=-1,Qa="",Oa=-1,cb=!0,_oldDoubleSided=-1,_oldFlipSided=-1,initObjects(a)};var xb=function(a){var b=a.target;b.traverse(function(a){a.removeEventListener("remove",xb),K(a)})},yb=function(a){var b=a.target;b.removeEventListener("dispose",yb),Db(b)},zb=function(a){var b=a.target;b.removeEventListener("dispose",zb),Eb(b),Ka.info.memory.textures--},Ab=function(a){var b=a.target;b.removeEventListener("dispose",Ab),Fb(b),Ka.info.memory.textures--},Bb=function(a){var b=a.target;b.removeEventListener("dispose",Bb),Gb(b)},Cb=function(a){if(void 0!==a.__webglVertexBuffer&&Ga.deleteBuffer(a.__webglVertexBuffer),void 0!==a.__webglNormalBuffer&&Ga.deleteBuffer(a.__webglNormalBuffer),void 0!==a.__webglTangentBuffer&&Ga.deleteBuffer(a.__webglTangentBuffer),void 0!==a.__webglColorBuffer&&Ga.deleteBuffer(a.__webglColorBuffer),void 0!==a.__webglUVBuffer&&Ga.deleteBuffer(a.__webglUVBuffer),void 0!==a.__webglUV2Buffer&&Ga.deleteBuffer(a.__webglUV2Buffer),void 0!==a.__webglSkinIndicesBuffer&&Ga.deleteBuffer(a.__webglSkinIndicesBuffer),void 0!==a.__webglSkinWeightsBuffer&&Ga.deleteBuffer(a.__webglSkinWeightsBuffer),void 0!==a.__webglFaceBuffer&&Ga.deleteBuffer(a.__webglFaceBuffer),void 0!==a.__webglLineBuffer&&Ga.deleteBuffer(a.__webglLineBuffer),void 0!==a.__webglLineDistanceBuffer&&Ga.deleteBuffer(a.__webglLineDistanceBuffer),void 0!==a.__webglCustomAttributesList)for(var b in a.__webglCustomAttributesList)Ga.deleteBuffer(a.__webglCustomAttributesList[b].buffer);Ka.info.memory.geometries--},Db=function(a){if(a.__webglInit=void 0,a instanceof THREE.BufferGeometry){if(void 0!==a.vbbuffer&&Ga.deleteBuffer(a.vbbuffer),void 0!==a.ibbuffer&&Ga.deleteBuffer(a.ibbuffer),a.vaos)for(var b=0;b<a.vaos.length;b++)Ja.deleteVertexArrayOES(a.vaos[b].vao);var c=a.attributes;for(var d in c)void 0!==c[d].buffer&&Ga.deleteBuffer(c[d].buffer);Ka.info.memory.geometries--}else{var e=Mb[a.id];if(void 0!==e){for(var b=0,f=e.length;f>b;b++){var g=e[b];if(void 0!==g.numMorphTargets){for(var h=0,i=g.numMorphTargets;i>h;h++)Ga.deleteBuffer(g.__webglMorphTargetsBuffers[h]);delete g.__webglMorphTargetsBuffers}if(void 0!==g.numMorphNormals){for(var h=0,i=g.numMorphNormals;i>h;h++)Ga.deleteBuffer(g.__webglMorphNormalsBuffers[h]);delete g.__webglMorphNormalsBuffers}Cb(g)}delete Mb[a.id]}else Cb(a)}};this.deallocateGeometry=Db;var Eb=function(a){if(a.image&&a.image.__webglTextureCube)Ga.deleteTexture(a.image.__webglTextureCube);else{if(!a.__webglInit)return;a.__webglInit=!1,Ga.deleteTexture(a.__webglTexture)}},Fb=function(a){a&&a.__webglTexture&&(Ga.deleteTexture(a.__webglTexture),Ga.deleteFramebuffer(a.__webglFramebuffer),Ga.deleteRenderbuffer(a.__webglRenderbuffer))},Gb=function(a){var b=a.program.program;if(void 0!==b){a.program=void 0;var c,d,e,f=!1;for(c=0,d=La.length;d>c;c++)if(e=La[c],e.program===b){e.usedTimes--,0===e.usedTimes&&(f=!0);break}if(f===!0){var g=[];for(c=0,d=La.length;d>c;c++)e=La[c],e.program!==b&&g.push(e);La=g,Ga.deleteProgram(b),Ka.info.memory.programs--}}};this.renderBufferDirect=function(a,b,c,d,e,f,g){if(d.visible!==!1){n(f.geometry);var h=O(a,b,c,d,f),i=e.attributes,j=!1,k=d.wireframe?1:0,l="direct_"+e.id+(g?"/"+g:"")+"_"+h.id+"_"+k;l!==Qa&&(Qa=l,j=!0);var m=p(d,h,e,g||0);if(j=j&&!m,j&&gb.initAttributes(),f instanceof THREE.Mesh){var o=i.index;if(o){var q,s,t=o.array?o.array:e.ib;t instanceof Uint32Array&&hb.get("OES_element_index_uint")?(q=Ga.UNSIGNED_INT,s=4):(q=Ga.UNSIGNED_SHORT,s=2);var u=e.offsets;u&&u.length>1&&(j=!0);var v=0;do{var w,x,y;u&&u.length?(w=u[v].index,x=u[v].start,y=u[v].count):(w=0,x=0,y=t.length),j&&r(d,h,e,w,o),e.numInstances?Ia.drawElementsInstancedANGLE(e.isLines?Ga.LINES:Ga.TRIANGLES,y,q,x*s,e.numInstances):Ga.drawElements(e.isLines?Ga.LINES:Ga.TRIANGLES,y,q,x*s)}while(u&&++v<u.length)}else{j&&r(d,h,e,w);var z=e.attributes.position;e.numInstances?Ia.drawArraysInstancedANGLE(e.isLines?Ga.LINE_STRIP:Ga.TRIANGLES,0,z.array.length/3,e.numInstances):Ga.drawArrays(e.isLines?Ga.LINE_STRIP:Ga.TRIANGLES,0,z.array.length/z.itemSize)}}else console.log("Only THREE.Mesh can be rendered by the Firefly renderer. Use THREE.Mesh to draw lines.");m&&Ja.bindVertexArrayOES(null)}},this.renderBuffer=function(a,b,c,d,e,f){if(d.visible!==!1){H(f);var g=O(a,b,c,d,f),h=g.attributes,i=!1,j=d.wireframe?1:0,k=e.id+"_"+g.id+"_"+j;if(k!==Qa&&(Qa=k,i=!0),i&&gb.initAttributes(),!d.morphTargets&&h.position>=0&&i&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglVertexBuffer),gb.enableAttribute(h.position),Ga.vertexAttribPointer(h.position,3,Ga.FLOAT,!1,0,0)),i){if(e.__webglCustomAttributesList)for(var l=0,m=e.__webglCustomAttributesList.length;m>l;l++){var n=e.__webglCustomAttributesList[l];h[n.buffer.belongsToAttribute]>=0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,n.buffer),gb.enableAttribute(h[n.buffer.belongsToAttribute]),Ga.vertexAttribPointer(h[n.buffer.belongsToAttribute],n.size,Ga.FLOAT,!1,0,0))}h.color>=0&&(f.geometry.colors.length>0||f.geometry.faces.length>0?(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglColorBuffer),gb.enableAttribute(h.color),Ga.vertexAttribPointer(h.color,3,Ga.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ga.vertexAttrib3fv(h.color,d.defaultAttributeValues.color)),h.normal>=0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglNormalBuffer),gb.enableAttribute(h.normal),Ga.vertexAttribPointer(h.normal,3,Ga.FLOAT,!1,0,0)),h.tangent>=0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglTangentBuffer),gb.enableAttribute(h.tangent),Ga.vertexAttribPointer(h.tangent,4,Ga.FLOAT,!1,0,0)),h.uv>=0&&(f.geometry.faceVertexUvs[0]?(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglUVBuffer),gb.enableAttribute(h.uv),Ga.vertexAttribPointer(h.uv,2,Ga.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ga.vertexAttrib2fv(h.uv,d.defaultAttributeValues.uv)),h.uv2>=0&&(f.geometry.faceVertexUvs[1]?(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglUV2Buffer),gb.enableAttribute(h.uv2),Ga.vertexAttribPointer(h.uv2,2,Ga.FLOAT,!1,0,0)):d.defaultAttributeValues&&Ga.vertexAttrib2fv(h.uv2,d.defaultAttributeValues.uv2)),h.lineDistance>=0&&(Ga.bindBuffer(Ga.ARRAY_BUFFER,e.__webglLineDistanceBuffer),gb.enableAttribute(h.lineDistance),Ga.vertexAttribPointer(h.lineDistance,1,Ga.FLOAT,!1,0,0))}if(gb.disableUnusedAttributes(),f instanceof THREE.Mesh){var o=e.__typeArray===Uint32Array?Ga.UNSIGNED_INT:Ga.UNSIGNED_SHORT;d.wireframe?(gb.setLineWidth(d.wireframeLinewidth*oa),i&&Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Ga.drawElements(Ga.LINES,e.__webglLineCount,o,0)):(i&&Ga.bindBuffer(Ga.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Ga.drawElements(Ga.TRIANGLES,e.__webglFaceCount,o,0))}else if(f instanceof THREE.Line){var p=f.mode===THREE.LineStrip?Ga.LINE_STRIP:Ga.LINES;gb.setLineWidth(d.linewidth*oa),Ga.drawArrays(p,0,e.__webglLineCount)}}},this.render=function(a,b,c,d,e){if(b instanceof THREE.Camera==!1)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");Qa="",Oa=-1,Pa=null,void 0!==e&&(za.length=0,cb=!0);var f=a.fog;a.autoUpdate===!0&&a.updateMatrixWorld(),void 0===b.parent&&b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),b.worldUpTransform?_a.multiplyMatrices(b.worldUpTransform,b.matrixWorld):_a.copy(b.matrixWorld),$a.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),Za.setFromMatrix($a);var g=a instanceof Autodesk.Viewing.Private.RenderBatch&&a.renderImmediate;if(g||(Ea.length=0,Fa.length=0,x(a,Ka.sortObjects===!0,a.forceVisible===!0),Ka.sortObjects===!0&&(Ea.sort(t),Fa.sort(s))),cb&&(e&&e.length&&(za=e.slice()),da(za)),this.resetGLState(),this.setRenderTarget(c),(this.autoClear||d)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),a.overrideMaterial){var h=a.overrideMaterial;N(h),g?A(a,"",b,za,f,h):(y(Ea,b,za,f,h),y(Fa,b,za,f,h))}else g?A(a,"",b,za,f,h):(gb.setBlending(THREE.NoBlending),y(Ea,b,za,f,null),y(Fa,b,za,f,null));this.resetGLState(),c&&c.generateMipmaps&&c.minFilter!==THREE.NearestFilter&&c.minFilter!==THREE.LinearFilter&&ia(c),gb.setDepthTest(!0),gb.setDepthWrite(!0)};var Hb,Ib,Jb,Kb,Lb,Mb={},Nb=0,Ob={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"firefly_basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"firefly_phong",LineBasicMaterial:"firefly_basic",LineDashedMaterial:"dashed",PointCloudMaterial:"particle_basic"};this.setFaceCulling=function(a,b){a===THREE.CullFaceNone?Ga.disable(Ga.CULL_FACE):(b===THREE.FrontFaceDirectionCW?Ga.frontFace(Ga.CW):Ga.frontFace(Ga.CCW),a===THREE.CullFaceBack?Ga.cullFace(Ga.BACK):a===THREE.CullFaceFront?Ga.cullFace(Ga.FRONT):Ga.cullFace(Ga.FRONT_AND_BACK),Ga.enable(Ga.CULL_FACE))},this.setMaterialFaces=function(a){gb.setDoubleSided(a.side===THREE.DoubleSide),gb.setFlipSided(a.side===THREE.BackSide)},this.uploadTexture=function(a){void 0===a.__webglInit&&(a.__webglInit=!0,a.addEventListener("dispose",zb),a.__webglTexture=Ga.createTexture(),Ka.info.memory.textures++),Ga.bindTexture(Ga.TEXTURE_2D,a.__webglTexture),Ga.pixelStorei(Ga.UNPACK_FLIP_Y_WEBGL,a.flipY),Ga.pixelStorei(Ga.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a.premultiplyAlpha),Ga.pixelStorei(Ga.UNPACK_ALIGNMENT,a.unpackAlignment),a.image=fa(a.image,nb);var b=a.image,c=THREE.Math.isPowerOfTwo(b.width)&&THREE.Math.isPowerOfTwo(b.height),d=ka(a.format),e=ka(a.type);ea(Ga.TEXTURE_2D,a,c);var f,g=a.mipmaps;if(a instanceof THREE.DataTexture)if(g.length>0&&c){for(var h=0,i=g.length;i>h;h++)f=g[h],Ga.texImage2D(Ga.TEXTURE_2D,h,d,f.width,f.height,0,d,e,f.data);a.generateMipmaps=!1}else Ga.texImage2D(Ga.TEXTURE_2D,0,d,b.width,b.height,0,d,e,b.data);else if(a instanceof THREE.CompressedTexture){for(var h=0,i=g.length;i>h;h++)f=g[h],a.format!==THREE.RGBAFormat&&a.format!==THREE.RGBFormat?ub().indexOf(d)>-1?Ga.compressedTexImage2D(Ga.TEXTURE_2D,h,d,f.width,f.height,0,f.data):console.warn("Attempt to load unsupported compressed texture format"):Ga.texImage2D(Ga.TEXTURE_2D,h,d,f.width,f.height,0,d,e,f.data);if(g.length>1&&ub().indexOf(d)>-1)for(var j,k=f.width>>1,l=f.height>>1,m=g.length;k>=1||l>=1;)j=4==f.width&&4==f.height?f.data:new DataView(f.data.buffer,f.data.byteOffset,f.data.byteLength*(Math.max(k,4)*Math.max(l,4))/(f.width*f.height)),Ga.compressedTexImage2D(Ga.TEXTURE_2D,m,d,Math.max(k,1),Math.max(l,1),0,j),k>>=1,l>>=1,++m}else if(g.length>0&&c){for(var h=0,i=g.length;i>h;h++)f=rescueFromPolymer(g[h]),Ga.texImage2D(Ga.TEXTURE_2D,h,d,d,e,f);a.generateMipmaps=!1}else Ga.texImage2D(Ga.TEXTURE_2D,0,d,d,e,rescueFromPolymer(a.image));a.generateMipmaps&&c&&Ga.generateMipmap(Ga.TEXTURE_2D),a.needsUpdate=!1,a.onUpdate&&a.onUpdate()},this.setTexture=function(a,b){Ga.activeTexture(Ga.TEXTURE0+b),a.needsUpdate?Ka.uploadTexture(a):Ga.bindTexture(Ga.TEXTURE_2D,a.__webglTexture)},this.initFrameBufferMRT=function(a,b){var c=a[0],d=!1;if(c&&!c.__webglFramebuffer){void 0===c.depthBuffer&&(c.depthBuffer=!0),void 0===c.stencilBuffer&&(c.stencilBuffer=!0),c.__webglFramebuffer=Ga.createFramebuffer(),Ga.bindFramebuffer(Ga.FRAMEBUFFER,c.__webglFramebuffer);var e;c.shareDepthFrom?e=c.__webglRenderbuffer=c.shareDepthFrom.__webglRenderbuffer:c.depthBuffer&&!c.stencilBuffer?(e=c.__webglRenderbuffer=Ga.createRenderbuffer(),Ga.bindRenderbuffer(Ga.RENDERBUFFER,e),Ga.renderbufferStorage(Ga.RENDERBUFFER,Ga.DEPTH_COMPONENT16,c.width,c.height)):c.depthBuffer&&c.stencilBuffer&&(e=c.__webglRenderbuffer=Ga.createRenderbuffer(),Ga.bindRenderbuffer(Ga.RENDERBUFFER,e),Ga.renderbufferStorage(Ga.RENDERBUFFER,Ga.DEPTH_STENCIL,c.width,c.height)),c.depthBuffer&&!c.stencilBuffer?Ga.framebufferRenderbuffer(Ga.FRAMEBUFFER,Ga.DEPTH_ATTACHMENT,Ga.RENDERBUFFER,e):c.depthBuffer&&c.stencilBuffer&&Ga.framebufferRenderbuffer(Ga.FRAMEBUFFER,Ga.DEPTH_STENCIL_ATTACHMENT,Ga.RENDERBUFFER,e),d=!0}var f=Na;Ga.bindFramebuffer(Ga.FRAMEBUFFER,c.__webglFramebuffer);for(var g=0;g<a.length;g++){var h=a[g];if(!h.__webglTexture){var i=THREE.Math.isPowerOfTwo(h.width)&&THREE.Math.isPowerOfTwo(h.height),j=ka(h.format),k=ka(h.type);h.addEventListener("dispose",Ab),h.__webglTexture=Ga.createTexture(),Ka.info.memory.textures++,Ga.bindTexture(Ga.TEXTURE_2D,h.__webglTexture),ea(Ga.TEXTURE_2D,h,i),Ga.texImage2D(Ga.TEXTURE_2D,0,j,h.width,h.height,0,j,k,null),i&&h.generateMipmaps&&Ga.generateMipmap(Ga.TEXTURE_2D)}Ga.framebufferTexture2D(Ga.FRAMEBUFFER,Ga.COLOR_ATTACHMENT0+g,Ga.TEXTURE_2D,h.__webglTexture,0)}if(Ha){for(var l=[Ha.COLOR_ATTACHMENT0_WEBGL],g=1;g<a.length;g++)l.push(Ha.COLOR_ATTACHMENT0_WEBGL+g);Ha.drawBuffersWEBGL(l)}if(b){var m=Ga.checkFramebufferStatus(Ga.FRAMEBUFFER);m!==Ga.FRAMEBUFFER_COMPLETE&&(console.log("Can't use multiple render targets. Falling back to two passes. "+m),delete c.__webglFramebuffer,b=!1)}return Ga.bindFramebuffer(Ga.FRAMEBUFFER,f),d&&(Ga.bindTexture(Ga.TEXTURE_2D,null),Ga.bindRenderbuffer(Ga.RENDERBUFFER,null),Ga.bindFramebuffer(Ga.FRAMEBUFFER,null)),b},this.setRenderTarget=function(a){var b;if(Array.isArray(a))this.initFrameBufferMRT(a),b=a[0];else if(a){var c=a.__webglFramebuffer;c&&Na===c||this.initFrameBufferMRT([a]),b=a}var d,e,f,g,h;b?(d=b.__webglFramebuffer,e=b.width,f=b.height,g=0,h=0):(d=null,e=Ua,f=Va,g=Sa,h=Ta),d!==Na&&(Ga.bindFramebuffer(Ga.FRAMEBUFFER,d),Ga.viewport(g,h,e,f),Na=d),Wa=e,Xa=f},this.verifyMRTWorks=function(a){return Ha?this.initFrameBufferMRT(a,!0):!1},this.readRenderTargetPixels=function(a,b,c,d,e,f){if(!(a instanceof THREE.WebGLRenderTarget))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");if(a.__webglFramebuffer){var g=!1;a.__webglFramebuffer!==Na&&(Ga.bindFramebuffer(Ga.FRAMEBUFFER,a.__webglFramebuffer),g=!0),Ga.checkFramebufferStatus(Ga.FRAMEBUFFER)===Ga.FRAMEBUFFER_COMPLETE?Ga.readPixels(b,c,d,e,Ga.RGBA,Ga.UNSIGNED_BYTE,f):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete."),g&&Ga.bindFramebuffer(Ga.FRAMEBUFFER,Na)}}},AutodeskNamespace("Autodesk.Viewing.Private"),function(){function a(a,b){var c=255*b[2]+b[3],d=Math.pow(2,(c-127)/2),e=d/b[1],f=b[0]*e,h=g[0]*f+g[3]*d+g[6]*e,i=g[1]*f+g[4]*d+g[7]*e,j=g[2]*f+g[5]*d+g[8]*e;0>h&&(h=0),0>i&&(i=0),0>j&&(j=0),a[0]=h,a[1]=i,a[2]=j}function b(a,b,c){var d=.0625*Math.sqrt(b[0]*c),e=.0625*Math.sqrt(b[1]*c),f=.0625*Math.sqrt(b[2]*c),g=Math.max(Math.max(d,e),Math.max(f,1e-6));g>1&&(g=1);var h=Math.ceil(255*g)/255;d>1&&(d=1),e>1&&(e=1),f>1&&(f=1),a[3]=h;var i=1/h;a[0]=d*i,a[1]=e*i,a[2]=f*i}function c(a,b,c){var d=Math.sqrt(b[0]*c),e=Math.sqrt(b[1]*c),f=Math.sqrt(b[2]*c),g=65504;d>g&&(d=g),e>g&&(e=g),f>g&&(f=g),a[0]=d,a[1]=e,a[2]=f}function d(a){h[0]=a;var b=i[0],c=0;if(0==(2147483647&b))k[c++]=b>>16;else{var d=2147483648&b,e=2139095040&b,f=8388607&b;if(0==e)k[c++]=d>>16;else if(2139095040==e)0==f?k[c++]=d>>16|31744:k[c++]=65024;else{var g,l,m=d>>16,n=(0|e>>23)-127+15;n>=31?k[c++]=d>>16|31744:0>=n?(14-n>24?g=0:(f|=8388608,g=f>>14-n,j[0]=g,g=j[0],f>>13-n&1&&(g+=1)),k[c++]=m|g):(l=n<<10,j[0]=l,l=j[0],g=f>>13,j[0]=g,g=j[0],4096&f?k[c++]=(m|l|g)+1:k[c++]=m|l|g)}}return k[0]}var e=Autodesk.Viewing.Private;e.BackgroundPresets={"Fusion Grey":[230,230,230,150,150,150],"Sky Blue":[226,244,255,156,172,180],Snow:[181,186,199,181,186,199],Midnight:[41,76,120,1,2,3],White:[255,255,255,255,255,255],AutoCADModel:[30,40,48,30,40,48],"Dark Grey":[51,51,51,51,51,51],"Dark Sky":[51,51,51,51,51,51],"Infinity Pool":[255,255,255,255,255,255],Tranquility:[0,84,166,0,84,166],"Grey Room":[129,129,129,129,129,129],"Photo Booth":[237,237,237,237,237,237],"RaaS SBS":[1,1,1,90,90,90],Plaza:[79,102,130,79,102,130],Custom:[230,230,230,150,150,150]};var f=e.BackgroundPresets;e.LightPresets=[{name:"Simple Grey",path:null,tonemap:0,E_bias:0,directLightColor:[1,.84,.67],ambientColor:[.8,.9,1],lightMultiplier:1,bgColorGradient:f["Fusion Grey"],darkerFade:!1,rotation:0},{name:"Sharp Highlights",path:"SharpHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Photo Booth"],darkerFade:!0,rotation:0},{name:"Dark Sky",path:"DarkSky",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:1,lightDirection:[.1,-.55,-1],bgColorGradient:f["Dark Sky"],darkerFade:!1,rotation:0},{name:"Grey Room",path:"GreyRoom",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:f["Grey Room"],darkerFade:!0,rotation:0},{name:"Photo Booth",path:"PhotoBooth",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:f["Photo Booth"],darkerFade:!0,rotation:0},{name:"Tranquility",path:"TranquilityBlue",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:f.Tranquility,darkerFade:!1,rotation:0},{name:"Infinity Pool",path:"InfinityPool",type:"logluv",tonemap:1,E_bias:-1,directLightColor:[1,.84,.67],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:.5,lightDirection:[.1,-.55,-1],bgColorGradient:f["Infinity Pool"],darkerFade:!1,rotation:0},{name:"Simple White",path:null,tonemap:0,E_bias:0,directLightColor:[1,1,1],ambientColor:[.9,.9,.9],lightMultiplier:1,bgColorGradient:f.White,saoRadius:.06,saoIntensity:.15,darkerFade:!0,rotation:0},{name:"Riverbank",path:"riverbank",type:"logluv",tonemap:1,E_bias:-5.7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["Sky Blue"],darkerFade:!1,rotation:0},{name:"Contrast",path:"IDViz",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f.Midnight,darkerFade:!1,rotation:0},{name:"Rim Highlights",path:"RimHighlights",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[.5,.5,.5],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Photo Booth"],darkerFade:!0,rotation:0},{name:"Cool Light",path:"CoolLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Warm Light",path:"WarmLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Soft Light",path:"SoftLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Grid Light",path:"GridLight",type:"logluv",tonemap:1,E_bias:-9,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f["Fusion Grey"],darkerFade:!0,rotation:0},{name:"Plaza",path:"Plaza",type:"logluv",tonemap:1,E_bias:-14,directLightColor:[.9,.9,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f.Plaza,darkerFade:!1,rotation:0},{name:"Snow Field",path:"SnowField",type:"logluv",tonemap:1,E_bias:-10.461343,directLightColor:[1,1,1],ambientColor:[.25/8,.25/8,.25/8],lightMultiplier:0,bgColorGradient:f.Snow,darkerFade:!1,rotation:0}],e.DebugEnvironments=[{name:"Field",path:"field",type:"logluv",tonemap:1,E_bias:-2.9,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["Sky Blue"],darkerFade:!1,rotation:0},{name:"Crossroads",path:"crossroads",type:"logluv",tonemap:1,E_bias:-5.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["Sky Blue"],darkerFade:!1,rotation:0},{name:"Seaport",path:"seaport",type:"logluv",tonemap:1,E_bias:-6.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["Sky Blue"],darkerFade:!1,rotation:0},{name:"Glacier",path:"glacier",type:"logluv",tonemap:1,E_bias:0,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f.Midnight,darkerFade:!1,rotation:0},{name:"Boardwalk",path:"boardwalk",type:"logluv",tonemap:1,E_bias:-7,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["Sky Blue"],darkerFade:!1,rotation:0},{name:"RaaS Test Env",path:"Reflection",type:"logluv",tonemap:2,E_bias:-1.5,directLightColor:[1,1,1],lightMultiplier:0,bgColorGradient:f["RaaS SBS"],darkerFade:!1,rotation:0}],ENABLE_DEBUG&&(e.LightPresets=e.LightPresets.concat(e.DebugEnvironments)),e.CreateCubeMapFromColors=function(a,b){for(var c=255*a.x,d=255*a.y,e=255*a.z,f=255*b.x,g=255*b.y,h=255*b.z,i=new Uint8Array(16),j=new Uint8Array(16),k=new Uint8Array(16),l=0;4>l;l++)i[4*l]=c,i[4*l+1]=d,i[4*l+2]=e,i[4*l+3]=255,j[4*l]=f,j[4*l+1]=g,j[4*l+2]=h,j[4*l+3]=255,0|l/2?(k[4*l]=c,k[4*l+1]=d,k[4*l+2]=e,k[4*l+3]=255):(k[4*l]=f,k[4*l+1]=g,k[4*l+2]=h,k[4*l+3]=255);var m=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),n=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),o=new THREE.DataTexture(j,2,2,THREE.RGBAFormat),p=new THREE.DataTexture(i,2,2,THREE.RGBAFormat),q=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),r=new THREE.DataTexture(k,2,2,THREE.RGBAFormat),s=new THREE.Texture(null,THREE.CubeReflectionMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.LinearFilter,THREE.LinearFilter,THREE.RGBAFormat);return s.image=[n,m,p,o,r,q],s.needsUpdate=!0,s};var g=[6.0014,-2.7008,-1.7996,-1.332,3.1029,-5.7721,.3008,-1.0882,5.6268],h=new Float32Array(1),i=new Uint32Array(h.buffer),j=new Uint16Array(1),k=new Uint16Array(1),l=new Float32Array(4),m=new Float32Array(4);e.DecodeEnvMap=function(e,f,g){if(!e.LogLuv)return void stderr("Environment map expected to be in LogLuv format.");for(var h=Math.pow(2,f),i=Array.isArray(e.image)?e.image:[k],j=0;j<i.length;j++)for(var k=i[j],n=0;n<k.mipmaps.length;n++){var o,p=k.mipmaps[n],q=p.data;g?(o=new Uint16Array(q.length/4*3),p.data=o):o=q.buffer;for(var r=0,s=0;s<q.length;s+=4)l[0]=q[s]/255,l[1]=q[s+1]/255,l[2]=q[s+2]/255,l[3]=q[s+3]/255,a(m,l),g?(c(l,m,h),o[r++]=d(l[0]),o[r++]=d(l[1]),o[r++]=d(l[2])):(b(l,m,h),q[s]=Math.round(255*l[0]),q[s+1]=Math.round(255*l[1]),q[s+2]=Math.round(255*l[2]),q[s+3]=Math.round(255*l[3]))}e.LogLuv=!1,g?(e.type=THREE.HalfFloatType,e.format=THREE.RGBFormat,e.RGBM=!1,e.GammaEncoded=!0):e.RGBM=!0},e.DefaultLightPreset=8,e.DefaultLightPreset2d=0}(),function(a){"use strict";var b=[{id:"SOLID",name:"Solid",ascii_art:"_______________________________________",def:[1]},{id:"BORDER",name:"Border",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.5,-.25,.5,-.25,0,-.25]},{id:"BORDER2",name:"Border (.5x)",ascii_art:"__ __ . __ __ . __ __ . __ __ . __ __ .",def:[.25,-.125,.25,-.125,0,-.125]},{id:"BORDERX2",name:"Border (2x)",ascii_art:"____  ____  .  ____  ____  .  ___",def:[1,-.5,1,-.5,0,-.5]},{id:"CENTER",name:"Center",ascii_art:"____ _ ____ _ ____ _ ____ _ ____ _ ____",def:[1.25,-.25,.25,-.25]},{id:"CENTER2",name:"Center (.5x)",ascii_art:"___ _ ___ _ ___ _ ___ _ ___ _ ___",def:[.75,-.125,.125,-.125]},{id:"CENTERX2",name:"Center (2x)",ascii_art:"________  __  ________  __  _____",def:[2.5,-.5,.5,-.5]},{id:"DASHDOT",name:"Dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . __",def:[.5,-.25,0,-.25]},{id:"DASHDOT2",name:"Dash dot (.5x)",ascii_art:"_._._._._._._._._._._._._._._.",def:[.25,-.125,0,-.125]},{id:"DASHDOTX2",name:"Dash dot (2x)",ascii_art:"____  .  ____  .  ____  .  ___",def:[1,-.5,0,-.5]},{id:"DASHED",name:"Dashed",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ _",def:[.5,-.25]},{id:"DASHED2",name:"Dashed (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.25,-.125]},{id:"DASHEDX2",name:"Dashed (2x)",ascii_art:"____  ____  ____  ____  ____  ___",def:[1,-.5]},{id:"DIVIDE",name:"Divide",ascii_art:"____ . . ____ . . ____ . . ____ . . ____",def:[.5,-.25,0,-.25,0,-.25]},{id:"DIVIDE2",name:"Divide (.5x)",ascii_art:"__..__..__..__..__..__..__..__.._",def:[.25,-.125,0,-.125,0,-.125]},{id:"DIVIDEX2",name:"Divide (2x)",ascii_art:"________  .  .  ________  .  .  _",def:[1,-.5,0,-.5,0,-.5]},{id:"DOT",name:"Dot",ascii_art:". . . . . . . . . . . . . . . . . . . . . . . .",def:[0,-.25]},{id:"DOT2",name:"Dot (.5x)",ascii_art:"........................................",
def:[0,-.125]},{id:"DOTX2",name:"Dot (2x)",ascii_art:".  .  .  .  .  .  .  .  .  .  .  .  .  .",def:[0,-.5]},{id:"HIDDEN",name:"Hidden",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __ __",def:[.25,-.125]},{id:"HIDDEN2",name:"Hidden (.5x)",ascii_art:"_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _",def:[.125,-.0625]},{id:"HIDDENX2",name:"Hidden (2x)",ascii_art:"____ ____ ____ ____ ____ ____ ____",def:[.5,-.25]},{id:"PHANTOM",name:"Phantom",ascii_art:"______  __  __  ______  __  __  ______",def:[1.25,-.25,.25,-.25,.25,-.25]},{id:"PHANTOM2",name:"Phantom (.5x)",ascii_art:"___ _ _ ___ _ _ ___ _ _ ___ _ _",def:[.625,-.125,.125,-.125,.125,-.125]},{id:"PHANTOMX2",name:"Phantom (2x)",ascii_art:"____________    ____    ____   _",def:[2.5,-.5,.5,-.5,.5,-.5]},{id:"ACAD_ISO02W100",name:"ISO dash",ascii_art:"__ __ __ __ __ __ __ __ __ __ __ __ __",def:[12,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO03W100",name:"ISO dash space",ascii_art:"__    __    __    __    __    __",def:[12,-18],pen_width:1,unit:"mm"},{id:"ACAD_ISO04W100",name:"ISO long-dash dot",ascii_art:"____ . ____ . ____ . ____ . _",def:[24,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO05W100",name:"ISO long-dash double-dot",ascii_art:"____ .. ____ .. ____ .",def:[24,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO06W100",name:"ISO long-dash triple-dot",ascii_art:"____ ... ____ ... ____",def:[24,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO07W100",name:"ISO dot",ascii_art:". . . . . . . . . . . . . . . . . . . .",def:[.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO08W100",name:"ISO long-dash short-dash",ascii_art:"____ __ ____ __ ____ _",def:[24,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO09W100",name:"ISO long-dash double-short-dash",ascii_art:"____ __ __ ____",def:[24,-3,6,-3,6,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO10W100",name:"ISO dash dot",ascii_art:"__ . __ . __ . __ . __ . __ . __ . ",def:[12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO11W100",name:"ISO double-dash dot",ascii_art:"__ __ . __ __ . __ __ . __ _",def:[12,-3,12,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO12W100",name:"ISO dash double-dot",ascii_art:"__ . . __ . . __ . . __ . .",def:[12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO13W100",name:"ISO double-dash double-dot",ascii_art:"__ __ . . __ __ . . _",def:[12,-3,12,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO14W100",name:"ISO dash triple-dot",ascii_art:"__ . . . __ . . . __ . . . _",def:[12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"ACAD_ISO15W100",name:"ISO double-dash triple-dot",ascii_art:"__ __ . . . __ __ . .",def:[12,-3,12,-3,.5,-3,.5,-3,.5,-3],pen_width:1,unit:"mm"},{id:"FENCELINE1",name:"Fenceline circle",ascii_art:"----0-----0----0-----0----0-----0--",def:[.25,-.1,["CIRC1","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"FENCELINE2",name:"Fenceline square",ascii_art:"----[]-----[]----[]-----[]----[]---",def:[.25,-.1,["BOX","ltypeshp.shx","x=-.1","s=.1"],-.1,1]},{id:"TRACKS",name:"Tracks",ascii_art:"-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-|-",def:[.15,["TRACK1","ltypeshp.shx","s=.25"],.15]},{id:"BATTING",name:"Batting",ascii_art:"SSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSSS",def:[1e-4,-.1,["BAT","ltypeshp.shx","x=-.1","s=.1"],-.2,["BAT","ltypeshp.shx","r=180","x=.1","s=.1"],-.1]},{id:"HOT_WATER_SUPPLY",name:"Hot water supply",ascii_art:"---- HW ---- HW ---- HW ----",def:[.5,-.2,["HW","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.2]},{id:"GAS_LINE",name:"Gas line",ascii_art:"----GAS----GAS----GAS----GAS----GAS----GAS--",def:[.5,-.2,["GAS","STANDARD","S=.1","R=0.0","X=-0.1","Y=-.05"],-.25]},{id:"ZIGZAG",name:"Zig zag",ascii_art:"/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/\\/",def:[1e-4,-.2,["ZIG","ltypeshp.shx","x=-.2","s=.2"],-.4,["ZIG","ltypeshp.shx","r=180","x=.2","s=.2"],-.2]}],c=function(){for(var a=b.length,c=0,d=0;a>d;d++){var e=b[d];e.def.length>c&&(c=e.def.length)}for(var f=c+3,g=a,h=1;f>h;)h*=2;for(f=h,h=1;g>h;)h*=2;g=h;for(var i=new Uint8Array(f*g),j=0;a>j;j++){for(var k=j*f,e=b[j],l=96,m=e.unit&&"mm"==e.unit?1/25.4:1,n=e.pen_width||0,o=e.def,p=0,d=0;d<o.length;d++){var q=Math.abs(o[d]),r=.5*n>=q;r&&(q=0);var s=0|q*l*m;p+=s,i[k+d+2]=s?s:1}i[k]=p%256,i[k+1]=p/256,i[k+o.length+2]=0}var t=new THREE.DataTexture(i,f,g,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);return t.generateMipmaps=!1,t.flipY=!1,t.needsUpdate=!0,t};a.LineStyleDefs=b,a.CreateLinePatternTexture=c}(Autodesk.Viewing.Private),function(){function a(a,b){if(!a||!a.colors)return new THREE.Color(1,0,0);var c=a.colors[b];if(!c)return new THREE.Color(0,0,0);var d=c.values;if(!d||!d.length)return new THREE.Color(1,0,0);var e=d[0];return new THREE.Color(e.r,e.g,e.b)}function b(a,b,c){if(!a||!a.scalars)return c;var d=a.scalars[b];return d?d.values[0]:c}function c(a,b,c){if(!a||!a.booleans)return c;var d=a.booleans;return d?d[b]:c}function d(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];return e?e.values[0]:d}function e(a,b,c){var d={bands:0,weights:new THREE.Vector4(1,1,1,1),frequencies:new THREE.Vector4(1,1,1,1)};if(!a||!a[b])return d;var e=a[b][c];if(!(e&&e.values&&e.values instanceof Array))return d;var f=e.values;d.bands=f.length/2;for(var g=0;g<d.bands;++g)d.frequencies.setComponent(g,1/f[2*g]),d.weights.setComponent(g,f[2*g+1]);return d}function f(a,b,c,d){if(!a||!a.scalars)return d;var e=a.scalars[b];return e?j(e.values[0],e.units,c):d}function g(a,b,c,d){if(!a||!a[b])return d;var e=a[b][c];if(!e)return d;var f=e.connections;return f?e.connections[0]:d}function h(a){var b=a;return.04045>=b?b/=12.92:b=Math.pow((b+.055)/1.055,2.4),b}function i(a){var b,c,d;return b=h(a.r),c=h(a.g),d=h(a.b),new THREE.Color(b,c,d)}function j(a,b,c){var d=w[c];d||(d=1,console.warn("Unsupported unit: "+c));var e=w[b];return e||(e=1,console.warn("Unsupported unit: "+b)),a*d/e}function k(a,b,c){if(0==b){var e=f(a,"bumpmap_Depth",c,0),g=1,h=1;return null!=d(a,"scalars","texture_RealWorldScale")?g=h=f(a,"texture_RealWorldScale",c,1):(g=f(a,"texture_RealWorldScaleX",c,1),h=f(a,"texture_RealWorldScaleY",c,1)),g=0==g?1:1/g,h=0==h?1:1/h,new THREE.Vector2(g*e,h*e)}var i=d(a,"scalars","bumpmap_NormalScale",1);return new THREE.Vector2(i,i)}function l(a,b){var c=f(a,"texture_RealWorldOffsetX",b,0),e=f(a,"texture_RealWorldOffsetY",b,0),g=d(a,"scalars","texture_UOffset",0),h=d(a,"scalars","texture_VOffset",0);c+=g,e+=h;var i=1,j=1;null!=d(a,"scalars","texture_RealWorldScale")?i=j=f(a,"texture_RealWorldScale",b,1):(i=f(a,"texture_RealWorldScaleX",b,1),j=f(a,"texture_RealWorldScaleY",b,1)),i=0==i?1:1/i,j=0==j?1:1/j;var k=d(a,"scalars","texture_UScale",1),l=d(a,"scalars","texture_VScale",1);i*=k,j*=l;var m=d(a,"scalars","texture_WAngle",1);m*=Math.PI/180;var n={elements:[Math.cos(m)*i,Math.sin(m)*j,0,-Math.sin(m)*i,Math.cos(m)*j,0,c,e,1]};return n}function m(){var a=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],b=new Uint8Array(a),c=new THREE.DataTexture(b,256,1,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);c.generateMipmaps=!1,c.flipY=!1,c.needsUpdate=!0;var d=[225,39,122,231,29,173,15,159,75,88,233,19,179,79,72,94,54,73,151,161,171,113,221,144,127,83,168,19,88,122,62,225,109,128,246,247,172,101,61,139,211,168,64,210,224,82,87,97,119,250,201,44,242,239,154,99,126,13,44,70,246,170,100,52,135,28,187,22,207,119,199,1,235,187,55,131,190,124,222,249,236,53,225,231,71,30,173,185,153,47,79,133,225,10,140,62,17,99,100,29,137,95,142,244,76,5,83,124,38,216,253,195,44,210,148,185,188,39,78,195,132,30,60,73,92,223,133,80,230,56,118,207,79,15,251,211,111,21,79,23,240,146,150,207,3,61,103,27,148,6,31,127,235,58,173,244,116,81,34,120,192,213,188,226,97,23,16,161,106,80,242,148,35,37,91,117,51,216,97,193,126,222,39,38,133,217,215,23,237,57,205,42,222,165,126,133,33,8,227,154,27,18,56,11,192,120,80,92,236,38,210,207,128,31,135,39,123,5,49,127,107,200,34,14,153,239,134,19,248,162,58,201,159,198,243,158,72,5,138,184,222,200,34,141,233,40,195,238,191,122,171,32,66,254,229,197],e=new Uint8Array(d),f=new THREE.DataTexture(e,256,1,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);f.generateMipmaps=!1,f.flipY=!1,f.needsUpdate=!0;for(var g,h,i,j,k,l,m,n=function(b){return a[b%256]},o=new Array(262144),p=0;256>p;++p)for(var q=0;256>q;++q)g=n(q)+p,h=n(g),i=n(g+1),j=n(q+1)+p,k=n(j),l=n(j+1),m=4*(256*p+q),o[m]=h,o[m+1]=i,o[m+2]=k,o[m+3]=l;var r=new Uint8Array(o),s=new THREE.DataTexture(r,256,256,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);s.generateMipmaps=!1,s.flipY=!1,s.needsUpdate=!0;for(var t=[1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1,1,1,0,0,-1,1,-1,1,0,0,-1,-1],v=new Array(1024),q=0;256>q;++q){var w=a[q]%16;v[4*q]=127*t[3*w]+128,v[4*q+1]=127*t[3*w+1]+128,v[4*q+2]=127*t[3*w+2]+128,v[4*q+3]=0}var x=new Uint8Array(v),y=new THREE.DataTexture(x,256,1,THREE.RGBAFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.RepeatWrapping,THREE.RepeatWrapping,THREE.NearestFilter,THREE.NearestFilter,0);y.generateMipmaps=!1,y.flipY=!1,y.needsUpdate=!0,u={permutation:c,gradient:f,perm2D:s,permGrad:y}}function n(a,b,c){a[c+"_enable"]=d(b,"booleans",c+"_enable",0);var f=e(b,"scalars",c+"_prof");a[c+"_bands"]=f.bands,a[c+"_weights"]=f.weights,a[c+"_frequencies"]=f.frequencies}function o(e,f){var h=e.materials,j=h[e.userassets[0]],k=j.properties,l=f?v.createPrismMaterial():new THREE.MeshPhongMaterial;if(l.proteinMat=e,l.packedNormals=!0,j&&f){l.tag=j.tag,l.prismType=j.definition,void 0===l.prismType&&(l.prismType="");var o=l.mapList;switch(l.transparent=!1,l.envExponentMin=1,l.envExponentMax=512,l.envExponentCount=10,l.surface_albedo=i(a(k,"surface_albedo",new THREE.Color(1,0,0))),o.surface_albedo_map=g(k,"colors","surface_albedo",null),l.surface_anisotropy=d(k,"scalars","surface_anisotropy",0),o.surface_anisotropy_map=g(k,"scalars","surface_anisotropy",null),l.surface_rotation=d(k,"scalars","surface_rotation",0),o.surface_rotation_map=g(k,"scalars","surface_rotation",null),l.surface_roughness=d(k,"scalars","surface_roughness",0),o.surface_roughness_map=g(k,"scalars","surface_roughness",null),o.surface_cutout_map=g(k,"textures","surface_cutout",null),o.surface_normal_map=g(k,"textures","surface_normal",null),l.prismType){case"PrismOpaque":l.opaque_albedo=i(a(k,"opaque_albedo",new THREE.Color(1,0,0))),o.opaque_albedo_map=g(k,"colors","opaque_albedo",null),l.opaque_luminance_modifier=i(a(k,"opaque_luminance_modifier",new THREE.Color(0,0,0))),o.opaque_luminance_modifier_map=g(k,"colors","opaque_luminance_modifier",null),l.opaque_f0=d(k,"scalars","opaque_f0",0),o.opaque_f0_map=g(k,"scalars","opaque_f0",null),l.opaque_luminance=d(k,"scalars","opaque_luminance",0);break;case"PrismMetal":l.metal_f0=i(a(k,"metal_f0",new THREE.Color(1,0,0))),o.metal_f0_map=g(k,"colors","metal_f0",null);break;case"PrismLayered":l.layered_bottom_f0=i(a(k,"layered_bottom_f0",new THREE.Color(1,1,1))),o.layered_bottom_f0_map=g(k,"colors","layered_bottom_f0",null),l.layered_diffuse=i(a(k,"layered_diffuse",new THREE.Color(1,0,0))),o.layered_diffuse_map=g(k,"colors","layered_diffuse",null),l.layered_anisotropy=d(k,"scalars","layered_anisotropy",0),o.layered_anisotropy_map=g(k,"scalars","layered_anisotropy",null),l.layered_f0=d(k,"scalars","layered_f0",0),o.layered_f0_map=g(k,"scalars","layered_f0",null),l.layered_fraction=d(k,"scalars","layered_fraction",0),o.layered_fraction_map=g(k,"scalars","layered_fraction",null),l.layered_rotation=d(k,"scalars","layered_rotation",0),o.layered_rotation_map=g(k,"scalars","layered_rotation",null),l.layered_roughness=d(k,"scalars","layered_roughness",0),o.layered_roughness_map=g(k,"scalars","layered_roughness",null),o.layered_normal_map=g(k,"textures","layered_normal",null);break;case"PrismTransparent":l.transparent_color=i(a(k,"transparent_color",new THREE.Color(1,0,0))),l.transparent_distance=d(k,"scalars","transparent_distance",0),l.transparent_ior=d(k,"scalars","transparent_ior",0),l.transparent=!0;break;case"PrismWood":n(l,k,"wood_fiber_cosine"),n(l,k,"wood_fiber_perlin"),l.wood_fiber_perlin_scale_z=d(k,"scalars","wood_fiber_perlin_scale_z",0),n(l,k,"wood_growth_perlin"),l.wood_latewood_ratio=d(k,"scalars","wood_latewood_ratio",0),l.wood_earlywood_sharpness=d(k,"scalars","wood_earlywood_sharpness",0),l.wood_latewood_sharpness=d(k,"scalars","wood_latewood_sharpness",0),l.wood_ring_thickness=d(k,"scalars","wood_ring_thickness",0),n(l,k,"wood_earlycolor_perlin"),l.wood_early_color=i(a(k,"wood_early_color",new THREE.Color(1,0,0))),l.wood_use_manual_late_color=d(k,"booleans","wood_use_manual_late_color",0),l.wood_manual_late_color=i(a(k,"wood_manual_late_color",new THREE.Color(1,0,0))),n(l,k,"wood_latecolor_perlin"),l.wood_late_color_power=d(k,"scalars","wood_late_color_power",0),n(l,k,"wood_diffuse_perlin"),l.wood_diffuse_perlin_scale_z=d(k,"scalars","wood_diffuse_perlin_scale_z",0),l.wood_use_pores=d(k,"booleans","wood_use_pores",0),l.wood_pore_type=d(k,"choicelists","wood_pore_type",0),l.wood_pore_radius=d(k,"scalars","wood_pore_radius",0),l.wood_pore_cell_dim=d(k,"scalars","wood_pore_cell_dim",0),l.wood_pore_color_power=d(k,"scalars","wood_pore_color_power",0),l.wood_pore_depth=d(k,"scalars","wood_pore_depth",0),l.wood_use_rays=d(k,"booleans","wood_use_rays",0),l.wood_ray_color_power=d(k,"scalars","wood_ray_color_power",0),l.wood_ray_seg_length_z=d(k,"scalars","wood_ray_seg_length_z",0),l.wood_ray_num_slices=d(k,"integers","wood_ray_num_slices",0),l.wood_ray_ellipse_z2x=d(k,"scalars","wood_ray_ellipse_z2x",0),l.wood_ray_ellipse_radius_x=d(k,"scalars","wood_ray_ellipse_radius_x",0),l.wood_use_latewood_bump=d(k,"booleans","wood_use_latewood_bump",0),l.wood_latewood_bump_depth=d(k,"scalars","wood_latewood_bump_depth",0),l.wood_use_groove_roughness=d(k,"booleans","wood_use_groove_roughness",0),l.wood_groove_roughness=d(k,"scalars","wood_groove_roughness",0),l.wood_diffuse_lobe_weight=d(k,"scalars","wood_diffuse_lobe_weight",0),l.transparent=!1,u||m(),l.uniforms.permutationMap.value=u.permutation,l.uniforms.gradientMap.value=u.gradient,l.uniforms.perm2DMap.value=u.perm2D,l.uniforms.permGradMap.value=u.permGrad;break;default:console.warn("Unknown prism type: "+l.prismType)}l.defines={},l.textureMaps={};for(var p in o)if(o[p]){var q=h[o[p]],r=q.properties,s="BumpMap"==q.definition?"bumpmap_Bitmap":"unifiedbitmap_Bitmap",t=r.uris[s].values[0];if(t){var w={mapName:p,uri:t,textureObj:q,isPrism:!0};l.textureMaps[w.mapName]=w,l.defines["USE_"+p.toUpperCase()]=""}}return l.defines[l.prismType.toUpperCase()]="",l}if(j&&!f&&"SimplePhong"==j.definition){l.tag=j.tag,l.proteinType=j.proteinType,void 0===l.proteinType&&(l.proteinType=null);var x=l.ambient=a(k,"generic_ambient"),y=l.color=a(k,"generic_diffuse"),z=l.specular=a(k,"generic_specular"),A=l.emissive=a(k,"generic_emissive");0==y.r&&0==y.g&&0==y.b&&0==z.r&&0==z.g&&0==z.b&&0==x.r&&0==x.g&&0==x.b&&0==A.r&&0==A.g&&0==A.b&&(y.r=y.g=y.b=.4),l.shininess=b(k,"generic_glossiness",30),l.opacity=1-b(k,"generic_transparency",0),l.reflectivity=b(k,"generic_reflectivity_at_0deg",0);var B=c(k,"generic_bump_is_normal"),C=b(k,"generic_bump_amount",0);null==C&&(C=1),B?(C>1&&(C=1),l.normalScale=new THREE.Vector2(C,C)):(C>=1&&(C=.03),l.bumpScale=C);var D=c(k,"generic_is_metal");void 0!==D&&(l.metal=D);var E=c(k,"generic_backface_cull");void 0===E||E||(l.side=THREE.DoubleSide),l.transparent=j.transparent,l.textureMaps={};var F=j.textures;for(var G in F){var w={};w.textureObj=h[F[G].connections[0]];var r=w.textureObj.properties;if(w.uri=r.uris.unifiedbitmap_Bitmap.values[0],w.uri){if("generic_diffuse"==G)w.mapName="map",(!l.color||0==l.color.r&&0==l.color.g&&0==l.color.b)&&l.color.setRGB(1,1,1);else if("generic_bump"==G)B?w.mapName="normalMap":w.mapName="bumpMap";else if("generic_specular"==G)w.mapName="specularMap";else{if("generic_alpha"!=G)continue;w.mapName="alphaMap",l.transparent=!0}l.textureMaps[w.mapName]=w}}}else l.ambient=197379,l.color=7829367,l.specular=3355443,l.shininess=30,l.shading=THREE.SmoothShading;return l}function p(a,b,c){var e=a.properties;b.wrapS=d(e,"booleans","texture_URepeat",!1)?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,b.wrapT=d(e,"booleans","texture_VRepeat",!1)?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,b.matrix=l(e,c),"UnifiedBitmap"==a.definition&&(b.invert=d(e,"booleans","unifiedbitmap_Invert",!1)),"BumpMap"==a.definition&&(b.bumpmapType=d(e,"choicelists","bumpmap_Type",0),b.bumpScale=k(e,b.bumpmapType,c))}function q(a,d){if(a){var e=a.properties;d.invert=c(e,"unifiedbitmap_Invert"),d.clampS=!c(e,"texture_URepeat",!0),d.clampT=!c(e,"texture_VRepeat",!0);var f=b(e,"texture_UScale",1),g=b(e,"texture_VScale",1),h=b(e,"texture_UOffset",0),i=b(e,"texture_VOffset",0),j=b(e,"texture_WAngle",0);d.matrix={elements:[Math.cos(j)*f,Math.sin(j)*g,0,-Math.sin(j)*f,Math.cos(j)*g,0,h,i,1]}}}function r(a,b,c,d){d?p(a,b,c):q(a,b)}function s(a,b){var c=new THREE.MeshPhongMaterial;c.packedNormals=!0,c.textureMaps={};var d=a.values,e=d.diffuse;if(e)if(Array.isArray(e))c.color=new THREE.Color(e[0],e[1],e[2]);else if("string"==typeof e){c.color=new THREE.Color(1,1,1);var f={};f.mapName="map";var g=b.gltf.textures[e];f.uri=g.source,f.flipY=!1,c.textureMaps[f.mapName]=f}var h=d.specular;return h&&(c.specular=new THREE.Color(h[0],h[1],h[2])),d.shininess&&(c.shininess=d.shininess),c.reflectivity=0,c}function t(a){var b=a.materials,c=b[a.userassets[0]];if(c){var d=c.definition;return"PrismLayered"==d||"PrismMetal"==d||"PrismOpaque"==d||"PrismTransparent"==d||"PrismWood"==d}return!1}var u,v=Autodesk.Viewing.Private,w={MilliMeter:1e3,mm:1e3,8206:1e3,DeciMeter:10,dm:10,8204:10,CentiMeter:100,cm:100,8205:100,Meter:1,m:1,8193:1,KiloMeter:.001,km:.001,8201:.001,Inch:39.37008,"in":39.37008,8214:39.37008,Foot:3.28084,ft:3.28084,8215:3.28084,Mile:62137e-8,mi:62137e-8,8225:62137e-8,Yard:1.09361,yard:1.09361,8221:1.09361};Autodesk.Viewing.Private.MaterialConverter={convertMaterial:o,convertTexture:r,convertMaterialGltf:s,isPrismMaterial:t}}(),function(){function a(a,b,c){if(auth){var e=-1===a.indexOf("://")||-1!==a.indexOf(window.location.host)||d.urlIsApiViewingOrDev(a);e?THREE.ImageUtils.crossOrigin="use-credentials":THREE.ImageUtils.crossOrigin="anonymous"}var f=a.indexOf("urn:");return-1!=f&&(a=a.substr(0,f)+encodeURIComponent(a.substr(f)),a+="?domain="+encodeURIComponent(window.location.origin),Autodesk.Viewing.ACM_SESSION_ID&&(a+="&acmsession="+Autodesk.Viewing.ACM_SESSION_ID)),".dds"===a.slice(a.length-4).toLocaleLowerCase()?(new THREE.DDSLoader).load(a,c):THREE.ImageUtils.loadTexture(a,b,c)}function b(a){var b=a.width,c=a.height;if(0===(b&b-1)&&0===(c&c-1))return a;for(var d=1;b>2*d;)d*=2;for(var e=1;c>2*e;)e*=2;var f=document.createElement("canvas"),g=f.getContext("2d");return f.width=d,f.height=e,g.drawImage(a,0,0,d,e),f}function c(c){function e(a){return-1!=a.indexOf("__lineMaterial__")}function f(a,b){return e(b)?b:a.basePath+"|mat|"+b}this.viewer=c;var g=this,h=this.materials={},i=this.materialsNonHDR={};this.textures={},this.layerMaskTex=null,this.reflectionCube=null,this.irradianceMap=null;var j=1,k=0,l=1,m=[];this.hasPrism=!1,this.renderPrism=!0;var n=[];this.defaultMaterial=new THREE.MeshPhongMaterial({ambient:197379,color:7829367,specular:3355443,shininess:30,shading:THREE.SmoothShading,reflectivity:0}),this.dtor=function(){this.cleanup(),THREE.Cache.clear(),this.viewer=null,g=null},this.findMaterial=function(a,b){var c=h[f(a,b)];return c||(stderr("Unknown material "+b+". Using default."),c=this.defaultMaterial),c},this.setRenderPrism=function(a){this.renderPrism=a},this.convertMaterials=function(a){if(!a.materials)return 0;{if(!a.gltfMaterials){var b=a.materials.materials,c=a.proteinMaterials?a.proteinMaterials.materials:null,e=this.renderPrism,g=0;for(var h in b){var i=!1;c&&(i=e&&d.MaterialConverter.isPrismMaterial(c[h]));var j=i?c[h]:b[h],k=d.MaterialConverter.convertMaterial(j,i);!_isIE11&&a.doubleSided&&(k.side=THREE.DoubleSide);var l=f(a,h);if(this.addMaterial(l,k,i),g++,j.decals){k.decals=[];for(var m=0,n=j.decals.length;n>m;m++){var o=j.decals[m];i=e&&d.MaterialConverter.isPrismMaterial(o.material);var p=d.MaterialConverter.convertMaterial(o.material,i);k.decals.push({uv:o.uv||0,material:p}),this.addMaterial(l+"|decal|"+m,p,i)}}}return g}var q=a.materials.materials;for(var h in q){var r=q[h],k=d.MaterialConverter.convertMaterialGltf(r,a),l=f(a,h);this.addMaterial(l,k,!1)}}},this.updateMaterials=function(){for(;m.length;)for(var a=m.pop(),b=0;b<a.mats.length;b++)a.mats[b][a.slot]=a.tex,a.mats[b].needsUpdate=!0,this.viewer.invalidate(!0,!1,!1)},this.loadTexture=function(c,e){if(c.textureMaps){var f=c.textureMaps;for(var h in f){var i=f[h],j=e.basePath+i.uri+i.mapName,k=g.textures[j];if(k)k.tex?(c[i.mapName]=k.tex,c.needsUpdate=!0):(g.textures[j].mats.push(c),g.textures[j].slots.push(i.mapName));else{var l=null,n=c.proteinType&&c.proteinType.length,o=n&&0===c.proteinType.indexOf("Prism"),p=(o&&PRISM_ROOT||n&&PROTEIN_ROOT)&&(0===i.uri.indexOf("1/Mats")||0===i.uri.indexOf("2/Mats")||0===i.uri.indexOf("3/Mats"));if(p)l=o?PRISM_ROOT+i.uri:PROTEIN_ROOT+i.uri;else{for(var q=0;q<e.manifest.assets.length;++q){var r=e.manifest.assets[q];if(r.id==i.uri){l=d.pathToURL(e.basePath+r.URI);break}}l||(l=d.pathToURL(e.basePath+i.uri))}g.textures[j]={mats:[c],slots:[i.mapName],tex:null};var s=function(c,d){return a(d,THREE.UVMapping,function(a){if(g){a.image=b(a.image);var d=g.textures[c];if(d){d.tex||(d.tex=a);for(var e=0;e<d.mats.length;e++)d.mats[e][d.slots[e]]=a;m.push(d)}}})}(j,l);"bumpMap"==i.mapName||"normalMap"==i.mapName?s.anisotropy=0:s.anisotropy=this.viewer.renderer().getMaxAnisotropy(),s.flipY=void 0!==i.flipY?i.flipY:!0,s.invert=!1,s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping,d.MaterialConverter.convertTexture(i.textureObj,s,e.materials.scene.SceneUnit,i.isPrism)}}}},this.loadTextures=function(a){for(var b in h)if(-1!=b.indexOf(a.basePath)){var c=h[b];this.loadTexture(c,a)}},this.create2DMaterial=function(c,d,e,i){var j="__lineMaterial__";if(d.image&&(j+="|image:"+d.image.name),d.clip&&(j+="|clip:"+JSON.stringify(d.clip)),e&&(j+="|id"),i&&(j+="|selection"),d.skipEllipticals&&(j+="|skipEllipticals"),d.skipCircles&&(j+="|skipCircles"),d.skipTriangleGeoms&&(j+="|skipTriangleGeoms"),d.useInstancing&&(j+="|useInstancing"),c&&(j+=c.basePath),j=f(null,j),!h.hasOwnProperty(j)){var k=Autodesk.Viewing.Shaders,l=new THREE.ShaderMaterial({fragmentShader:k.LineShader.fragmentShader,vertexShader:k.LineShader.vertexShader,uniforms:THREE.UniformsUtils.clone(k.LineShader.uniforms),attributes:k.LineShader.attributes,defines:THREE.UniformsUtils.clone(k.LineShader.defines),transparent:!0});if(l.depthWrite=!1,l.depthTest=!1,l.side=THREE.DoubleSide,l.blending=THREE.NormalBlending,e?(l.defines.ID_COLOR=1,l.blending=THREE.NoBlending):i?(l.defines.SELECTION_RENDERER=1,l.uniforms.selectionColor.value=new THREE.Vector4(0,0,1,1)):this.viewer.renderer().hasMRT()&&(l.mrtIdBuffer=1),d.skipEllipticals||(l.defines.HAS_ELLIPTICALS=1),d.skipCircles||(l.defines.HAS_CIRCLES=1),d.skipTriangleGeoms||(l.defines.HAS_TRIANGLE_GEOMS=1),d.useInstancing&&(l.defines.USE_INSTANCING=1),this.layerMaskTex&&(l.defines.HAS_LAYERS=1,l.uniforms.tLayerMask.value=g.layerMaskTex),this.lineStyleTex&&(l.defines.HAS_LINESTYLES=1,l.defines.MAX_LINESTYLE_LENGTH=g.lineStyleTex.image.width,l.uniforms.tLineStyle.value=g.lineStyleTex,l.uniforms.vLineStyleTexSize.value.set(g.lineStyleTex.image.width,g.lineStyleTex.image.height)),d.image){var m=this,n=function(a){m.viewer&&(a.image=b(a.image),a.wrapS=THREE.ClampToEdgeWrapping,a.wrapT=THREE.ClampToEdgeWrapping,a.minFilter=THREE.LinearMipMapLinearFilter,a.magFilter=THREE.LinearFilter,a.anisotropy=1,a.flipY=!0,a.generateMipmaps=!0,a.needsUpdate=!0,l.defines.HAS_RASTER_QUADS=1,l.uniforms.tRaster.value=a,-1!=d.image.dataURI.indexOf("png")&&(l.transparent=!0),l.needsUpdate=!0,m.viewer.invalidate(!1,!0,!1))};a(d.image.dataURI,THREE.UVMapping,n)}l.modelScale=d.modelScale||1,h[j]=l}return j},this.addMaterial=function(a,b,c){function d(a){return.299*a.r+.587*a.g+.114*a.b}var e=b.proteinMat?b.proteinMat:null,f=b.proteinType&&-1!=b.proteinType.indexOf("Prism");if(this.hasPrism=f||this.hasPrism,!c){if(b.metal)b.reflectivity||(b.reflectivity=d(b.specular)),e&&(1===b.reflectivity&&(b.reflectivity=d(b.specular)),0===b.color.r&&0===b.color.g&&0===b.color.b||(b.color.r*=.1,b.color.g*=.1,b.color.b*=.1));else if(f){var i=!1;if("PrismLayered"==b.proteinType&&(b.clearcoat=!0,b.reflectivity=.06,e)){var m=e.materials[e.userassets[0]],o=m.categories;o&&o.length&&-1!=o[0].indexOf("Metal")&&(i=!0)}b.reflectivity=Math.sqrt(b.reflectivity),i?b.specular.copy(b.color):(b.specular.r=b.reflectivity,b.specular.g=b.reflectivity,b.specular.b=b.reflectivity)}else b.reflectivity?b.reflectivity>.3?(b.metal=!0,b.specular.r=b.color.r,b.specular.g=b.color.g,b.specular.b=b.color.b,b.color.r*=.1,b.color.g*=.1,b.color.b*=.1):(b.specular.r*=b.reflectivity,b.specular.g*=b.reflectivity,b.specular.b*=b.reflectivity):1!==b.color.r||1!==b.color.g||1!==b.color.b||1!==b.specular.r||1!==b.specular.g||1!==b.specular.b||b.textureMaps&&(b.textureMaps.map||b.textureMaps.specularMap)?(b.reflectivity=.01+.06*d(b.specular),b.specular.r*=b.reflectivity,b.specular.g*=b.reflectivity,b.specular.b*=b.reflectivity):(b.metal=!0,b.reflectivity=.7,b.color.r*=.1,b.color.g*=.1,b.color.b*=.1),b.opacity<1&&(b.reflectivity=1);(b.transparent||b.textureMaps&&(b.textureMaps.map&&-1!=b.textureMaps.map.uri.toLowerCase().indexOf(".png")||b.textureMaps.opacityMap))&&(b.alphaTest=.01)}if(b.textureMaps&&b.textureMaps.normalMap){var p=b.bumpScale;(void 0===p||p>=1)&&(p=1),b.normalScale=new THREE.Vector2(p,p)}else void 0===b.bumpScale&&b.textureMaps&&(b.textureMaps.map||b.textureMaps.bumpMap)?b.bumpScale=.03:b.bumpScale>=1&&(b.bumpScale=.03);b.shininess*=.25,g.reflectionCube&&(b.envMap=g.reflectionCube),g.irradianceMap&&(b.irradianceMap=g.irradianceMap),b.exposureBias=Math.pow(2,this.viewer.renderer().getExposureBias()),b.tonemapOutput=this.viewer.renderer().getToneMapMethod(),b.envMapExposure=j,b.envRotationSin=k,b.envRotationCos=l,this.viewer.renderer().applyMRTFlags(b),b.side==THREE.DoubleSide&&this.viewer.renderer().toggleTwoSided(!0),b.cutplanes=n,h[a]=b},this.addMaterialNonHDR=function(a,b){b.cutplanes=n,i[a]=b},this.togglePolygonOffset=function(a){for(var b in h){var c=h[b];c instanceof THREE.MeshPhongMaterial&&(c.polygonOffset=!0,c.polygonOffsetFactor=a?1:0,c.polygonOffsetUnits=a?1:0,c.needsUpdate=!0)}},this.applyGeometryFlagsToMaterial=function(a,b){b.attributes.color&&(a.vertexColors=THREE.VertexColors,a.needsUpdate=!0),!a.proteinType&&b.attributes.uv&&b.attributes.uv.isPattern&&(a.map&&!a.bumpMap&&(a.bumpMap=a.map,a.needsUpdate=!0),a.textureMaps&&a.textureMaps.map&&!a.textureMaps.bumpMap&&(a.textureMaps.bumpMap=a.textureMaps.map,a.needsUpdate=!0))},this.toggleMRTSetting=function(){for(var a in h){var b=h[a];e(a)||this.viewer.renderer().applyMRTFlags(b)}},this.updatePixelScale=function(a){var b=h;for(var c in b)if(e(c)){var d=b[c];d.uniforms.aaRange.value=.5/(a*d.modelScale),d.uniforms.pixelsPerUnit.value=a*d.modelScale}},this.setCubeMapFromColors=function(a,b){var c=d.CreateCubeMapFromColors(a,b);g.reflectionCube=c,g.reflectionCube.isBgColor=!0;for(var e in h){var f=h[e];f.envMap=c,f.needsUpdate=!0}return this.viewer.invalidate(!0),g.reflectionCube},this.setCubeMap=function(a,b){var c=this,e=function(e){if(e&&(e.mapping=THREE.CubeReflectionMapping,e.LogLuv=-1!=a.indexOf("logluv"),e.RGBM=-1!=a.indexOf("rgbm"),d.DecodeEnvMap(e,b,!1)),c.reflectionCube=e,c.reflectionCube)for(var f in h){var i=h[f];i.envMap=g.reflectionCube,i.needsUpdate=!0}else c.setCubeMapFromColors(c.viewer.clearColorTop,c.viewer.clearColorBottom);c.viewer.invalidate(!0)};return Array.isArray(a)?(this.reflectionCube=THREE.ImageUtils.loadTextureCube(a,THREE.CubeReflectionMapping,e),this.reflectionCube.format=THREE.RGBFormat):"string"==typeof a?-1!=a.toLowerCase().indexOf(".dds")?this.reflectionCube=(new THREE.DDSLoader).load(a,e):(this.reflectionCube=THREE.ImageUtils.loadTexture(a,THREE.SphericalReflectionMapping,e),this.reflectionCube.format=THREE.RGBFormat):e(a?a:null),c.reflectionCube},this.setIrradianceMap=function(a,b){var c=this,e=function(e){if(e){e.mapping=THREE.CubeReflectionMapping,e.LogLuv=-1!=a.indexOf("logluv"),e.RGBM=-1!=a.indexOf("rgbm"),d.DecodeEnvMap(e,b,!1);for(var f in h){var g=h[f];g.irradianceMap=e,g.needsUpdate=!0}c.irradianceMap=e}else if(c.irradianceMap){for(var f in h){var g=h[f];g.irradianceMap=null,g.needsUpdate=!0}c.irradianceMap=null}c.viewer.invalidate(!0)};return THREE.ImageUtils.crossOrigin="",Array.isArray(a)?(g.irradianceMap=THREE.ImageUtils.loadTextureCube(a,THREE.CubeReflectionMapping,e),g.irradianceMap.format=THREE.RGBFormat):"string"==typeof a?-1!=a.toLowerCase().indexOf(".dds")&&(g.irradianceMap=(new THREE.DDSLoader).load(a,e)):e(a?a:null),c.irradianceMap},this.setTonemapMethod=function(a){for(var b in h){var c=h[b];c.tonemapOutput=a,c.needsUpdate=!0}},this.setEnvExposure=function(a){var b=Math.pow(2,a);j=b;for(var c in h){var d=h[c];d.envMapExposure=b,d.needsUpdate=!0}},this.setEnvRotation=function(a){k=Math.sin(a),l=Math.cos(a);for(var b in h){var c=h[b];c.envRotationSin=k,c.envRotationCos=l,c.needsUpdate=!0}},this.setTonemapExposureBias=function(a){var b=Math.pow(2,a);for(var c in h){var d=h[c];d.exposureBias=b,d.needsUpdate=!0}},this.initLayersTexture=function(a){for(var b=a.getData().layerCount,c=256,d=256,e=new Uint8Array(c*d),f=0,g=b;g>f;f++)e[f]=255;var h=new THREE.DataTexture(e,c,d,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);h.generateMipmaps=!1,h.flipY=!1,h.needsUpdate=!0,this.layerMaskTex=h,this.layersMap=a.getData().layersMap},this.initLineStyleTexture=function(){this.lineStyleTex=d.CreateLinePatternTexture()},this.init2DSelectionMaterial=function(a){for(var b=a.myData.maxObjectNumber||1,c=4096,d=0|Math.ceil(b/c),e=1;d>e;)e*=2;d=e;for(var f=new Uint8Array(c*d),g=0;b>g;g++)f[g]=0;var i=new THREE.DataTexture(f,c,d,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.NearestFilter,THREE.NearestFilter,0);i.generateMipmaps=!1,i.flipY=!1,i.needsUpdate=!0,this.selectionTex=i;var j=this.create2DMaterial(a.getData(),{},!1,!0),k=h[j];return k.uniforms.tSelectionTexture.value=this.selectionTex,k.uniforms.vSelTexSize.value.set(c,d),k.needsUpdate=!0,k},this.setLayerVisible=function(a,b){for(var c=this.layerMaskTex,d=c.image.data,f=this.layersMap,g=b?255:0,i=0;i<a.length;++i){var j=a[i];d[f[j]]=g}c.needsUpdate=!0;for(var k in h)e(k)&&(h[k].needsUpdate=!0);this.viewer.invalidate(!0)},this.isLayerVisible=function(a){return!!this.layerMaskTex.image.data[this.layersMap[a]]},this.highlightObject2D=function(a,b){var c=this.selectionTex.image.data;c[a]=b?255:0,this.selectionTex.needsUpdate=!0,this.viewer.invalidate(!1,!1,!0)},this.cloneMaterial=function(a){
var b=a.isPrismMaterial?d.clonePrismMaterial(a):a.clone();return(b instanceof THREE.MeshPhongMaterial||b.isPrismMaterial)&&(b.packedNormals=a.packedNormals,b.exposureBias=a.exposureBias,b.irradianceMap=a.irradianceMap,b.envMapExposure=a.envMapExposure,b.envRotationSin=a.envRotationSin,b.envRotationCos=a.envRotationCos,b.proteinType=a.proteinType,b.proteinMat=a.proteinMat,b.tonemapOutput=a.tonemapOutput,b.cutplanes=a.cutplanes),this.viewer.renderer().applyMRTFlags(b),b},this.getCutPlanes=function(){return n.slice()},this.getCutPlanesRaw=function(){return n},this.setCutPlanes=function(a){if(n.length!==(a?a.length||0:0)){for(var b in h)h[b].needsUpdate=!0,a&&a.length>0&&(h[b].side=THREE.DoubleSide);for(var b in i)i[b].needsUpdate=!0}for(;n.length>0;)n.pop();if(a)for(var c=0;c<a.length;c++)n.push(a[c].clone())},this.cleanup=function(a){var b={};for(var c in this.textures){var d=this.textures[c];-1===c.indexOf(a.basePath)?b[c]=d:d.tex&&d.tex.dispose()}this.textures=b;var e={},f={type:"dispose"};for(var g in h)if(a&&-1===g.indexOf(a.basePath))e[g]=h[g];else{var i=h[g];i.dispatchEvent(f),i.needsUpdate=!0}h=this.materials=e},this.addSimpleMaterial=function(a,b,c){var e=d.MaterialConverter.convertMaterial(b),g=f(c,a);this.addMaterial(g,e),this.loadTexture(e,c)},this.addMaterial("__defaultMaterial__",this.defaultMaterial)}var d=Autodesk.Viewing.Private;Autodesk.Viewing.Private.MaterialManager=c}(),function(){"use strict";var a=Autodesk.Viewing.Shaders,b=function(b,c){function d(a){return new THREE.ShaderMaterial({uniforms:THREE.UniformsUtils.clone(a.uniforms),vertexShader:a.vertexShader,fragmentShader:a.fragmentShader,defines:THREE.UniformsUtils.clone(a.defines)})}init_GroundShader();var e,f,g,h,i,j,k,l,m,n,o,p,q=b,r=!1,s=!1,t={texSize:s?128:64,pixScale:1,blurRadius:s?5:7,debug:!1};if(this.setTransform=function(a,b,c,d){e.left=-b.z/2,e.right=b.z/2,e.top=b.x/2,e.bottom=-b.x/2,e.near=1,e.far=b.y+e.near,e.updateProjectionMatrix(),e.position.addVectors(a,c.clone().multiplyScalar(-b.y/2-e.near)),d&&e.up.set(d.x,d.y,d.z),e.lookAt(a),g.position.set(a.x,a.y,a.z),g.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),g.scale.set(b.z,b.x,b.y),t.debug&&(p.position.set(a.x,a.y,a.z),p.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z),p.scale.set(b.z,b.x,b.y)),o.uniforms.worldSize.value.copy(b)},this.renderIntoShadow=function(a){if(!a.overrideMaterial||!a.overrideMaterial.transparent){var b=a.overrideMaterial;a.overrideMaterial=k,q.render(a,e,i,!1),a.overrideMaterial=b}},this.renderShadow=function(a,b){r&&(b?q.render(f,a,b,!1):q.render(f,a))},this.postprocess=function(){s?(o.render(q,j,i),n.render(q,i,j),m.render(q,j,i)):(n.render(q,j,i),m.render(q,i,j)),r=!0},this.clear=function(){var a=q.getClearColor().getHex(),b=q.getClearAlpha();q.setClearColor(0,0),q.clearTarget(i,!0,!0,!1),q.setClearColor(a,b),r=!1},this.setColor=function(a){l.uniforms.uShadowColor.value.x=a.r,l.uniforms.uShadowColor.value.y=a.g,l.uniforms.uShadowColor.value.z=a.b},this.getColor=function(){return new THREE.Color(l.uniforms.uShadowColor.value.x,l.uniforms.uShadowColor.value.y,l.uniforms.uShadowColor.value.z)},this.setAlpha=function(a){l.uniforms.uShadowColor.value.w=a},this.getAlpha=function(){return l.uniforms.uShadowColor.value.w},this.isValid=function(){return r},this.getDepthMaterial=function(){return k},c)for(var u in t)t[u]=c[u]||t[u];f=new THREE.Scene,e=new THREE.OrthographicCamera,i=new THREE.WebGLRenderTarget(t.texSize,t.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),i.generateMipmaps=!1,j=new THREE.WebGLRenderTarget(t.texSize,t.texSize,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),j.generateMipmaps=!1,k=d(a.GroundDepthShader),k.side=THREE.DoubleSide,k.blending=THREE.NoBlending,m=new a.LmvShaderPass(a.GroundShadowBlurShader,"tDepth"),n=new a.LmvShaderPass(a.GroundShadowBlurShader,"tDepth"),o=new a.LmvShaderPass(a.GroundShadowAOShader,"tDepth"),m.material.defines.KERNEL_SCALE=n.material.defines.KERNEL_SCALE=(t.pixScale/t.texSize).toFixed(4),m.material.defines.KERNEL_RADIUS=n.material.defines.KERNEL_RADIUS=t.blurRadius.toFixed(2),o.material.blending=m.material.blending=n.material.blending=THREE.NoBlending,o.material.depthWrite=m.material.depthWrite=n.material.depthWrite=!1,o.material.depthTest=m.material.depthTest=n.material.depthTest=!1,m.material.defines.HORIZONTAL=1,l=d(a.GroundShadowColorShader),l.uniforms.tDepth.value=s?j:i,l.depthWrite=!1,l.transparent=!0,h=new THREE.BufferGeometry,h.addAttribute("position",new THREE.BufferAttribute(new Float32Array([-.5,-.5,.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5]),3)),h.addAttribute("uv",new THREE.BufferAttribute(new Float32Array([0,0,0,1,1,1,1,0]),2)),h.addAttribute("index",new THREE.BufferAttribute(new Uint16Array([0,1,2,2,3,0]),1)),g=new THREE.Mesh(h,l),f.add(g),t.debug&&(p=new THREE.Mesh(new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:65280,wireframe:!0})),f.add(p)),this.setTransform(new THREE.Vector3(0,0,0),new THREE.Vector3(1,1,1),new THREE.Vector3(0,1,0))};b.prototype.constructor=b,a.GroundShadow=b}(),function(){"use strict";var a=Autodesk.Viewing.Shaders,b=function(b,c,d,e){init_GroundReflectionShader();var f,g,h,i,j,k,l=b,m=l.getContext(),n=c||512,o=d||512,p=!1,q=new THREE.Color(0,0,0),r=!1,s=!1;this.inTarget=void 0,this.outTarget=void 0;var t={color:new THREE.Color(1,1,1),alpha:.3,texScale:.5,blurRadius:2,blurTexScale:.5,fadeAngle:Math.PI/18},u=function(a){var b=a.normal,c=a.constant;return(new THREE.Matrix4).set(1-2*b.x*b.x,-2*b.y*b.x,-2*b.x*b.z,-2*c*b.x,-2*b.x*b.y,1-2*b.y*b.y,-2*b.y*b.z,-2*c*b.y,-2*b.x*b.z,-2*b.y*b.z,1-2*b.z*b.z,-2*c*b.z,0,0,0,1)};if(this.setTransform=function(a,b,c){i=a,h.normal=b,h.constant=-a.dot(b)},this.cleanup=function(){f&&f.cleanup(),this.inTarget&&this.inTarget.dispose(),this.outTarget&&this.outTarget.dispose()},this.setSize=function(b,c){n=b,o=c,this.cleanup(),this.inTarget=new THREE.WebGLRenderTarget(n*t.texScale,o*t.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),this.inTarget.generateMipmaps=!1,this.outTarget=new THREE.WebGLRenderTarget(n*t.texScale,o*t.texScale,{magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),this.outTarget.generateMipmaps=!1,f?f.setSize(n*t.texScale*t.blurTexScale,o*t.texScale*t.blurTexScale):f=new a.GaussianPass(n*t.texScale*t.blurTexScale,o*t.texScale*t.blurTexScale,t.blurRadius,1,{hasAlpha:!0,blending:!0,flipUV:!0})},this.updateCamera=function(a){var b=a.position.clone().sub(i).normalize(),c=Math.PI/2-b.angleTo(h.normal);if(p=0>c,!p){if(t.fadeAngle>0){var d=Math.min(t.fadeAngle,c)/t.fadeAngle;f.setAlpha(d*t.alpha)}var e=u(h);j=a.clone(),j.applyMatrix(e),j.projectionMatrix.elements[5]*=-1,j.matrixWorldNeedsUpdate=!0,a.worldUpTransform?j.worldUpTransform=a.worldUpTransform.clone():j.worldUpTransform=new THREE.Matrix4}},this.renderIntoReflection=function(a){p||l.render(a,j,this.inTarget)},this.renderReflection=function(a,b){p||(m.depthRange(.999999,1),g.render(l,b,this.outTarget),m.depthRange(0,1))},this.toggleEnvMapBackground=function(a){s=a,k.uniforms.envMapBackground.value=a},this.postprocess=function(a){p||(r||s?(k.uniforms.uCamDir.value=a.getWorldDirection(),k.uniforms.uCamUp.value=a.up,k.uniforms.uResolution.value.set(n,o),k.uniforms.uHalfFovTan.value=Math.tan(THREE.Math.degToRad(.5*a.fov)),k.render(l,this.outTarget),l.clearTarget(this.outTarget,!1,!0,!1)):(l.setClearColor(q,1),l.clearTarget(this.outTarget,!0,!0,!1)),f.render(l,this.outTarget,this.inTarget))},this.clear=function(){l.setClearColor(q,0),l.clearTarget(this.inTarget,!0,!0,!1)},this.setClearColors=function(a,b){b?(q.setRGB(.5*(a.x+b.x),.5*(a.y+b.y),.5*(a.z+b.z)),r=!a.equals(b)&&!isAndroidDevice()&&!isIOSDevice()):(q.copy(a),r=!1),r&&(k.uniforms.color1.value.copy(a),k.uniforms.color2.value.copy(b))},this.setEnvRotation=function(a){k.material.envRotationSin=Math.sin(a),k.material.envRotationCos=Math.cos(a)},this.isGroundCulled=function(){return p},this.setColor=function(a){f.setColor(t.color),t.color.set(a)},this.setAlpha=function(a){f.setAlpha(t.alpha),t.alpha=a},e)for(var v in t)t[v]=void 0!==e[v]?e[v]:t[v];g=new a.LmvShaderPass(a.GroundReflectionDrawShader),g.material.blending=THREE.NoBlending,g.material.depthTest=!0,g.material.depthWrite=!1,k=new a.LmvShaderPass(a.BackgroundShader),k.material.blending=THREE.NoBlending,k.material.depthWrite=!1,k.material.depthTest=!1,this.setSize(n,o),f.setAlpha(t.color),f.setAlpha(t.alpha),h=new THREE.Plane(new THREE.Vector3(0,1,0),0),i=new THREE.Vector3(0,0,0)};b.prototype.constructor=b,a.GroundReflection=b}(),function(){var a=Autodesk.Viewing.Shaders,b=function(b,c,d,e,f){init_GaussianShader();var g,h,i,j=b,k=c,l=d||3,m=e||1,n={hasAlpha:f.hasAlpha||!1,blending:f.blending||!1,flipUV:f.flipUV||!1};this.render=function(a,b,c){g.render(a,i,c),h.render(a,b,i)},this.setSize=function(a,b){this.cleanup(),j=a,k=b,i=new THREE.WebGLRenderTarget(a,b,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat,stencilBuffer:!1}),i.generateMipmaps=!1,g.material.defines.KERNEL_SCALE_H=h.material.defines.KERNEL_SCALE_H=(m/j).toFixed(4),g.material.defines.KERNEL_SCALE_V=h.material.defines.KERNEL_SCALE_V=(m/k).toFixed(4),g.material.needsUpdate=h.material.needsUpdate=!0},this.cleanup=function(){i&&i.dispose()},this.setColor=function(a){h.material.uniforms.uColor.value.x=a.r,h.material.uniforms.uColor.value.y=a.g,h.material.uniforms.uColor.value.z=a.b},this.setAlpha=function(a){h.material.uniforms.uColor.value.w=a},g=new a.LmvShaderPass(a.GaussianShader),h=new a.LmvShaderPass(a.GaussianShader),this.setSize(b,c),g.material.blending=h.material.blending=THREE.NoBlending,g.material.depthWrite=h.material.depthWrite=!1,g.material.depthTest=h.material.depthTest=!1,g.material.defines.HORIZONTAL=1,g.material.defines.KERNEL_RADIUS=h.material.defines.KERNEL_RADIUS=l.toFixed(1),n.blending&&(h.material.transparent=!0,h.material.blending=THREE.NormalBlending),n.hasAlpha&&(g.material.defines.HAS_ALPHA=h.material.defines.HAS_ALPHA=""),n.flipUV&&(g.material.defines.FLIP_UV="")};a.GaussianPass=b}(),function(){"use strict";function a(a,b){function c(a,b,c,d,e,f,g){var h=.5*(c-a),i=.5*(d-b);return(2*(b-c)+h+i)*g+(-3*(b-c)-2*h-i)*f+h*e+b}var d,e,f,g,h,i,j,k,l,m=[],n=[];return d=(a.length-1)*b,e=Math.floor(d),f=d-e,m[0]=0===e?e:e-1,m[1]=e,m[2]=e>a.length-2?e:e+1,m[3]=e>a.length-3?e:e+2,i=a[m[0]],j=a[m[1]],k=a[m[2]],l=a[m[3]],g=f*f,h=f*g,n[0]=c(i[0],j[0],k[0],l[0],f,g,h),n[1]=c(i[1],j[1],k[1],l[1],f,g,h),n[2]=c(i[2],j[2],k[2],l[2],f,g,h),n}var b=Autodesk.Viewing.Private,c={LINEAR:0,CATMULLROM:1,CATMULLROM_FORWARD:2},d=function(){this.animations=[]};d.prototype.init=function(a){if(a.initialized===!0)return a;for(var b=0;b<a.hierarchy.length;b++){for(var c=0;c<a.hierarchy[b].keys.length;c++)if(a.hierarchy[b].keys[c].time<0&&(a.hierarchy[b].keys[c].time=0),void 0!==a.hierarchy[b].keys[c].rot&&!(a.hierarchy[b].keys[c].rot instanceof THREE.Quaternion)){var d=a.hierarchy[b].keys[c].rot;Array.isArray(d)||(d=[d._x,d._y,d._z,d._w]),a.hierarchy[b].keys[c].rot=(new THREE.Quaternion).fromArray(d)}for(var c=1;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].time===a.hierarchy[b].keys[c-1].time&&(a.hierarchy[b].keys.splice(c,1),c--);for(var c=0;c<a.hierarchy[b].keys.length;c++)a.hierarchy[b].keys[c].index=c}return a.initialized=!0,a},d.prototype.parse=function(a){function b(a,c){if(c.push(a),a.children&&!(a instanceof THREE.Camera))for(var d=0;d<a.children.length;d++)b(a.children[d],c)}var c=[];return b(a,c),c},d.prototype.play=function(a){-1===this.animations.indexOf(a)&&this.animations.push(a)},d.prototype.stop=function(a){var b=this.animations.indexOf(a);-1!==b&&this.animations.splice(b,1)},d.prototype.update=function(a){for(var b=0;b<this.animations.length;b++)this.animations[b].update(a)};var e=function(a,b,d){this.root=a,this.handler=d.animationHandler,this.data=this.handler.init(b),this.hierarchy=this.handler.parse(a),this.viewer=d.viewer,this.animator=d,this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!1,this.delta=.5,this.interpolationType=c.LINEAR,this.setStartAndEndKeyTime()};e.prototype.setStartAndEndKeyTime=function(){if(this.data.hierarchy.length>0){var a=this.data.hierarchy[0].keys;this.startKeyTime=a[0].time,this.endKeyTime=a[a.length-1].time}else this.startKeyTime=this.endKeyTime=0},e.prototype.keyTypes=[],e.prototype.defaultKey={},e.prototype.play=function(a){this.currentTime=void 0!==a?a:0,this.isPlaying=!0,this.isPaused=!1,this.reset(),this.handler.play(this)},e.prototype.pause=function(){this.isPaused===!0?this.handler.play(this):this.handler.stop(this),this.isPaused=!this.isPaused},e.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,this.handler.stop(this)},e.prototype["goto"]=function(a){this.isPlaying||this.play(),this.isPaused||this.pause();var b=a-this.currentTime;this.update(b)},e.prototype.reset=function(){for(var a=0,b=this.hierarchy.length;b>a;a++){var c=this.hierarchy[a];void 0===c.animationCache&&(c.animationCache={}),void 0===c.animationCache[this.data.name]&&(c.animationCache[this.data.name]={prevKey:this.defaultKey,nextKey:this.defaultKey,originalMatrix:c.matrix});for(var d=c.animationCache[this.data.name],e=0;e<this.keyTypes.length;e++){for(var f=this.keyTypes[e],g=this.data.hierarchy[a].keys[0],h=this.getNextKeyWith(f,a,1);h.time<this.currentTime&&h.index>g.index;)g=h,h=this.getNextKeyWith(f,a,h.index+1);d.prevKey[f]=g,d.nextKey[f]=h}}this.setStartAndEndKeyTime()},e.prototype.getNextKeyWith=function(a,b,d){var e=this.data.hierarchy[b].keys;for(this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD?d=d<e.length-1?d:e.length-1:d%=e.length;d<e.length;d++)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[0]},e.prototype.getPrevKeyWith=function(a,b,d){var e=this.data.hierarchy[b].keys;for(d=this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD?d>0?d:0:d>=0?d:d+e.length;d>=0;d--)if(void 0!==e[d][a])return e[d];return this.data.hierarchy[b].keys[e.length-1]},e.prototype.isPlayingOutOfRange=function(){return this.isPaused===!1&&(this.currentTime<this.startKeyTime-this.delta||this.currentTime>this.endKeyTime+this.delta)},e.prototype.resetIfLooped=function(){this.loop===!0&&this.currentTime>this.endKeyTime&&(this.currentTime%=this.endKeyTime,this.reset())};var f=function(a,b,c){e.call(this,a,b,c),this.localMatrix=new THREE.Matrix4,this.root.getAnimTransform(),this.relativeTransform=b.custom&&b.custom.transform&&"abs"===b.custom.transform?!1:!0};f.prototype=Object.create(e.prototype),f.prototype.constructor=f,f.prototype.keyTypes=["pos","rot","scl"],f.prototype.defaultKey={pos:0,rot:0,scl:0},f.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Quaternion)}var d,e,f,g=[];return function(h){if(this.isPlaying!==!1&&(this.currentTime+=h*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var i=0,j=this.hierarchy.length;j>i;i++){for(var k=this.hierarchy[i],l=k.animationCache[this.data.name],m=0;m<this.keyTypes.length;m++){var n=this.keyTypes[m],o=l.prevKey[n],p=l.nextKey[n];if(p.time<=this.currentTime||o.time>=this.currentTime){for(o=this.data.hierarchy[i].keys[0],p=this.getNextKeyWith(n,i,1);p.time<this.currentTime&&p.index>o.index;)o=p,p=this.getNextKeyWith(n,i,p.index+1);l.prevKey[n]=o,l.nextKey[n]=p}var q=o[n],r=p[n];if(p.time!==o.time&&void 0!==q&&void 0!==r){var s=(this.currentTime-o.time)/(p.time-o.time);if(0>s&&(s=0),s>1&&(s=1),"pos"===n)if(this.interpolationType===c.LINEAR)e.x=q[0]+(r[0]-q[0])*s,e.y=q[1]+(r[1]-q[1])*s,e.z=q[2]+(r[2]-q[2])*s,k.position.copy(e);else{g[0]=this.getPrevKeyWith("pos",i,o.index-1).pos,g[1]=q,g[2]=r,g[3]=this.getNextKeyWith("pos",i,p.index+1).pos,s=.33*s+.33;var t=a(g,s);if(e.x=t[0],e.y=t[1],e.z=t[2],k.position.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var u=a(g,1.01*s);d.set(u[0],u[1],u[2]),d.sub(vector),d.y=0,d.normalize();var v=Math.atan2(d.x,d.z);k.rotation.set(0,v,0)}}else"rot"===n?(THREE.Quaternion.slerp(q,r,f,s),k.quaternion.copy(f)):"scl"===n&&(e.x=q[0]+(r[0]-q[0])*s,e.y=q[1]+(r[1]-q[1])*s,e.z=q[2]+(r[2]-q[2])*s,k.scale.copy(e))}}this.relativeTransform&&k.updateAnimTransform()}}}();var g=function(a,b,c){e.call(this,a,b,c)};g.prototype=Object.create(e.prototype),g.prototype.constructor=g,g.prototype.keyTypes=["pos","up","target","fov","perspective"],g.prototype.defaultKey={pos:0,up:0,target:0,fov:0,perspective:0},g.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3)}var d,e,f=[];return function(g){if(this.isPlaying!==!1&&(this.currentTime+=g*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange())){for(var h=0,i=this.hierarchy.length;i>h;h++){for(var j=this.hierarchy[h],k=j.animationCache[this.data.name],l=0;l<this.keyTypes.length;l++){var m=this.keyTypes[l],n=k.prevKey[m],o=k.nextKey[m];if(o.time<=this.currentTime||n.time>=this.currentTime){for(n=this.data.hierarchy[h].keys[0],o=this.getNextKeyWith(m,h,1);o.time<this.currentTime&&o.index>n.index;)n=o,o=this.getNextKeyWith(m,h,o.index+1);k.prevKey[m]=n,k.nextKey[m]=o}var p=n[m],q=o[m];if(o.time!==n.time&&void 0!==p&&void 0!==q){var r=(this.currentTime-n.time)/(o.time-n.time);0>r&&(r=0),r>1&&(r=1);var s;if("pos"===m)s=j.position;else if("up"===m)s=j.up;else if("target"===m)s=j.target;else{if("fov"===m){j.setFov(p+(q-p)*r);continue}if("perspective"===m){var t=r>.5?q:p;t?j.toPerspective():j.toOrthographic();continue}}if(this.interpolationType===c.LINEAR)e.x=p[0]+(q[0]-p[0])*r,e.y=p[1]+(q[1]-p[1])*r,e.z=p[2]+(q[2]-p[2])*r,s.copy(e);else{f[0]=this.getPrevKeyWith(m,h,n.index-1)[m],f[1]=p,f[2]=q,f[3]=this.getNextKeyWith(m,h,o.index+1)[m],r=.33*r+.33;var u=a(f,r);if(e.x=u[0],e.y=u[1],e.z=u[2],s.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var v=a(f,1.01*r);d.set(v[0],v[1],v[2]),d.sub(s),d.y=0,d.normalize();var w=Math.atan2(d.x,d.z);j.rotation.set(0,w,0)}}}}j.matrixAutoUpdate=!0,j.matrixWorldNeedsUpdate=!0}j.lookAt(j.target),this.animator.updateFlag|=this.animator.UPDATE_CAMERA}}}();var h=function(a,b,c,d){e.call(this,a,b,d),this.nodeId=c,this.epsilon=.1,this.root.setMaterial(this.viewer.matman().cloneMaterial(a.getMaterial()))};h.prototype=Object.create(e.prototype),h.prototype.constructor=h,h.prototype.keyTypes=["vis","opa"],h.prototype.defaultKey={viz:1,opa:1},h.prototype.update=function(){return function(a){if(this.isPlaying!==!1&&(this.currentTime+=a*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange()))for(var b=0,c=this.hierarchy.length;c>b;b++)for(var d=this.hierarchy[b],e=d.animationCache[this.data.name],f=0;f<this.keyTypes.length;f++){var g=this.keyTypes[f],h=e.prevKey[g],i=e.nextKey[g];if(i.time<=this.currentTime||h.time>=this.currentTime){for(h=this.data.hierarchy[b].keys[0],i=this.getNextKeyWith(g,b,1);i.time<this.currentTime&&i.index>h.index;)h=i,i=this.getNextKeyWith(g,b,i.index+1);e.prevKey[g]=h,e.nextKey[g]=i}var j=h[g],k=i[g];if(i.time!==h.time&&void 0!==j&&void 0!==k){var l=d.getMaterial();if("vis"===g){var m=Math.abs(this.currentTime-i.time)<this.epsilon,n=m?i:h,o=m?k:j;1===o&&void 0===n.opa&&(l.transparent=!1,l.opacity=1),this.viewer.visibilityManager.setNodeOff(this.nodeId,!o)}else if("opa"===g){var p=(this.currentTime-h.time)/(i.time-h.time);0>p&&(p=0),p>1&&(p=1);var q=j+(k-j)*p;l.transparent=1!==q,l.opacity=q,q>0&&this.viewer.visibilityManager.setNodeOff(this.nodeId,!1)}}}}}();var i=function(a,b,c){function d(a,b,c){var d=f.container=document.createElement("div"),e=a.name;d.id=e,d.style.cursor="pointer",d.style.visibility=c;var g=document.createElement("div");g.id=e+"-txt",g.style.cssText="display: none;position: absolute;z-index: 1;",d.appendChild(g);var h=document.createElement("img"),i=a.custom&&a.custom.att&&1===a.custom.att;h.src=i?"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABv1BMVEUAAAAAAAAAAAAAAAABAwEAAAAAAAAjSRkAAAAFDASJqnZhg1IqTyAjSRkpTx8hRxggRRcAAAAhRRcKFwgAAACau4R9mnFmiFUhSBgbOhMZNhIAAAAECQMgQxcAAAAAAAAAAAAHDwXB2q2jw4yfvoivyJ6fuI6mv5eSr4KAoWu2trZpiV3Nzc0wVSUhRxhNT01vb28AAAAgRBcAAAAAAAAAAAAhRxgeQBYAAAAAAAAAAAAfQRbP5MC0zqCqyJKpyJJBYje3z6WxyKOFpXF9nmkrTiG+wb5xkGVcf0xYfEg1WSpNTU0hRhgfQhYfQhZVVVVAQEAXMREcOhQcHBwSJw0AAAAAAAAWLxAVLQ8AAAAAAAAfQhYIEgYAAACbvn+DsGCGsmSUunaItGXc6dStypelxY2ZvX2Ntm2JtGnS48fB17G40aWNuWucxH6ny4mUvnPF27aPuHCEsGHV5czI3Lq52KGvzJqz1JmqyJOqzY6ew4OYwHiGs2OEsWHb29vL4LvM5bnD3q2+3KWkyoaLtWuKtmfOzs7IyMi21pyawXqPuG/g4ODX68fI4rTG4LCu0ZKszJKlx4qZwHuBnXR2iXENcZskAAAAXnRSTlMAEAIBCAsF6BUn+vPu7erjsZyBEwP99/TRk3JgRUQ1IxwO/v79/Pv6+fn09PPq08q7sqWDe2xrY01AMBj+/v7+/v37+fn59fXz8u/c1cbFxLWonZiIcm1lYVdSQT8de/EoFwAAAgVJREFUOMutklVz21AQRiNFlswYs+M6DTdN0kCDZWZmuAKDZFtgiO2YYm6TlOEHV53ptGs5j93Xc+a7e3d36P/W9prdZ/PZ17aPxphz3mR0x91G07wTG8TDo5R3HLGH3S6fGPdSo8Na/to6W2HZBEqwPCNULlu1BkFdQSyKx4qxOMoyDDJSRB/HnTcqWbSbTmVS6V3E57hvXicOBZd1gmfj6Z1kPrmTjrMMfRizumDA+k3UTcRSyWg0mkzFEgLNlU3rIIJcns0KqJjJq0I+U0SqUJlZJv8JugU3J/QnHEwu6MCMqPN1pq+H3sFxCgOC7RyT48Ev6qLUL/gmeJrJ/p0DzSnyxTtAGLMbv9dohv8zSbomSqUpOxB0AdNXsUbnGEEQmJzKq3JrLgCaJAzms5LI1enfVefEamc/YzYQYFB6/1xBUsQex3E9UZHkUvO6X48PwQjLTKEjVRVFqUqd8v6naQsMUCNcL8xTrVJZluXyl1K7OW1+7sL71x15cvVH43O7UGi3mmc8lkCE0ByMbvXazwueycbHxiXPrUdv3hLDGiF8au/d4sO7Novtnj9k0BO45uRGTp98f2JlK/RqYzN8TK8bGTjZLTXgfvDp6rMNA0ZADAOWHI6VTYwE4WAZjz/s3V5yvIxADosIPlh0BNXHSdA8LFIfDgE8WDg5hmmx9h/40fgXth2SDk3yjP4AAAAASUVORK5CYII=":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABvFBMVEUAAAAAAAADAAAAAAAAAAACAAAAAAAAAAC5PznHVE8BAAAAAADbc27NXVeUDQaZDQaRBwAAAAAAAACHBgDuhoHVa2W9RD2QCAKYCAGPBgB0BQAAAAAAAACMBgAAAAADAAD2jonWb2n2jYjYbWfmeXPNzc3RYFqzODKfFA1RUVGKBgCVBwBvb2+WBwCBBgCFBgCWBwCLBgAAAAAAAACMBgCTBwByBQCTBwBbBACEBgAAAAAAAAAoAgBSBADgeHOoOzXmfnnofnjieHPGvr63t7e0tLTidW/ebmnba2XWZWDAT0qRHBfBSkRNTU2aFxGOBgBYTEsAAACNBgBAQEAAAABbBQAcHBxyBQBKBAAAAABfBAAAAAAAAAAsAgAkAgCJBgDZRT3MOTHQPDTVQjrlUkrjUEjRPjbOOjP/bGTvXFTqV0/fTETNOjL5Zl7eS0PzYFjxXlbiT0fUQTn0e3T7aGDWXFXbSEDTRj/PQTrOPjbb29vgamTxY1zoVE3STETTQjvSPzfOzs7IyMj5g3zzaWLXY13XYVrsXlbbU0zg4OD8lZD4gXq0eHXqd3HscWv2b2jrZmDQZWDdWVLkV1C5y9+5AAAAYHRSTlMAAgUBDggMEeDsIBj+8NHJxpxAEP754tDDtIFsYDkvI/78+/j08/DfycfHxbuvr5mTjYN0bWxkWVZTTDUjEfz8+/n59fT08vHw8PDw5NzV0Mq5uLWrm5iLfX1hV0g/ODZEwKduAAACAklEQVQ4y62SVXPbQBzEa1mWZYaY49ihBhtmKjMzw92JLLBsyxxT2mCZvnCVmU59VpO37Ms97G929nb+p05WXUvTE5GJ6aWuY+yFEdoVdAZd9MjCEYi5J0L3FZutSqVZdIYiPWaj/85j2yszAACGVyq7Lo+RIMZtxRaQOZaTwZZSLbrGLR2+aX54twVykpgVpRzgYbVGz5twYMPTV2ZkKZMupDOSzAiwfNazgQesDO9VASemU6lUWuQAgnyNXsEiiBlbEwE2W9CBQpbVAfRraIZoA5ZosII6EpB6MYrVpLxOQejowKsBL9UGSK+zCnnsF4omB7wkBkQHylDZ+rcDROD3hYcYQE0NHQhQ4f8uCQVG/XF9isJKLtI1TYBQQAgdPlqJzYcWMYBYd58/YJACD6UgpsTVA+51AhvKGgt9zQGN1xN4Dajs/vbtmBXf2mIP3/jGqiW9Q0nlGtn8tXBSnwGPWHYP5PcbLMs2JHFn+6p7WQ/ARTie3/rZm9+pZ+rfP/fawi8dhOFgqLlLX87dHOz/1D9ou/vsrcNiNgBrZzbf338yOXZvbDL2xm4ljCdn6j794cpswr/62p+wWy2m/042oQeMxudedK8mSdzGAy4/9vlm/STRtjGRTz9u3nnge2U3+O2h4o9GfXG7lcLKGWZY8ycduG3sQJCk0Tb+w3S0/Qemc4+eJchuZgAAAABJRU5ErkJggg==",h.id=e+"-img",h.style.cssText="display: block;position: absolute;z-index: 1;",d.appendChild(h),b.api.container.appendChild(d),d.addEventListener("click",function(){g.style.display="none"===g.style.display?"block":"none"});var j=32512,k=.6,l=new THREE.SphereGeometry(.01),m=new THREE.MeshPhongMaterial({color:j,ambient:j,opacity:k,transparent:!0}),n=new THREE.Mesh(l,m);return n.visible=!1,void 0===b.overlayScenes.annotation&&b.createOverlayScene("annotation"),b.addOverlay("annotation",n),n}var f=this;null===a&&(a=d(b,c.viewer,"hidden")),e.call(this,a,b,c),this.id=b.name,this.text="",this.state="hidden",this.epsilon=.1,this.viewer.api.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(b){f.updateText(a.position,f.text)})};i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype.keyTypes=["pos","text","vis"],i.prototype.defaultKey={pos:0,text:"",vis:1},i.prototype.stop=function(){e.prototype.stop.call(this),this.container.parentNode.removeChild(this.container),this.viewer.removeOverlay("annotation",this.root),this.root=null},i.prototype.updateText=function(a,b){function c(a,b,c){var d=a.clone(),e=new THREE.Matrix4;return b.updateMatrixWorld(),b.matrixWorldInverse.getInverse(b.matrixWorld),e.multiplyMatrices(b.projectionMatrix,b.matrixWorldInverse),d.applyProjection(e),{x:(d.x+1)*c.width/2+c.offsetLeft,y:(-d.y+1)*c.height/2+c.offsetTop}}var d=c(a,this.viewer.camera,this.viewer.canvas),e=document.getElementById(this.id+"-txt");e&&(e.innerHTML=b,e.style.left=d.x+"px",e.style.top=d.y+"px",this.text=b),e=document.getElementById(this.id+"-img"),e&&(e.style.left=d.x+"px",e.style.top=d.y-24+"px")},i.prototype.update=function(){function b(){d||(d=new THREE.Vector3,e=new THREE.Vector3)}var d,e,f=[];return function(g){if(this.isPlaying!==!1&&(this.currentTime+=g*this.timeScale,b(),this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime){var h=document.getElementById(this.id);return void(h&&(h.style.visibility=this.state))}for(var i=0,j=this.hierarchy.length;j>i;i++){for(var k=this.hierarchy[i],l=k.animationCache[this.data.name],m=0;m<this.keyTypes.length;m++){var n=this.keyTypes[m],o=l.prevKey[n],p=l.nextKey[n];if(p.time<=this.currentTime||o.time>=this.currentTime){for(o=this.data.hierarchy[i].keys[0],p=this.getNextKeyWith(n,i,1);p.time<this.currentTime&&p.index>o.index;)o=p,p=this.getNextKeyWith(n,i,p.index+1);l.prevKey[n]=o,l.nextKey[n]=p}var q=o[n],r=p[n];if(p.time!==o.time&&void 0!==q&&void 0!==r){var s=(this.currentTime-o.time)/(p.time-o.time);if(0>s&&(s=0),s>1&&(s=1),"pos"===n){if(this.interpolationType===c.LINEAR)e.x=q[0]+(r[0]-q[0])*s,e.y=q[1]+(r[1]-q[1])*s,e.z=q[2]+(r[2]-q[2])*s,k.position.copy(e);else if(this.interpolationType===c.CATMULLROM||this.interpolationType===c.CATMULLROM_FORWARD){f[0]=this.getPrevKeyWith("pos",i,o.index-1).pos,f[1]=q,f[2]=r,f[3]=this.getNextKeyWith("pos",i,p.index+1).pos,s=.33*s+.33;var t=a(f,s);if(e.x=t[0],e.y=t[1],e.z=t[2],k.position.copy(e),this.interpolationType===c.CATMULLROM_FORWARD){var u=a(f,1.01*s);d.set(u[0],u[1],u[2]),d.sub(vector),d.y=0,d.normalize();var v=Math.atan2(d.x,d.z);k.rotation.set(0,v,0)}}}else if("text"===n){var w=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;this.updateText(k.position,w)}else if("vis"===n){var h=document.getElementById(this.id);if(h){var x=Math.abs(this.currentTime-p.time)<this.epsilon?r:q;h.style.visibility=x?"visible":"hidden"}}}}k.matrixAutoUpdate=!0,k.matrixWorldNeedsUpdate=!0}}}}();var j=function(a,b,c){this.viewer=c.viewer,null===a&&(a=this.createPolyline([])),e.call(this,a,b,c),this.epsilon=.1};j.prototype=Object.create(e.prototype),j.prototype.constructor=j,j.prototype.keyTypes=["points","vis"],j.prototype.defaultKey={points:[],vis:1},j.prototype.stop=function(){e.prototype.stop.call(this),this.viewer.removeOverlay("polyline",this.root),this.root=null},j.prototype.update=function(){function a(a){a.root&&(a.viewer.removeOverlay("polyline",a.root),a.root=null)}return function(b){if(this.isPlaying!==!1&&(this.currentTime+=b*this.timeScale,this.resetIfLooped(),!this.isPlayingOutOfRange())){if(this.isPaused&&this.currentTime<this.startKeyTime)return void a(this);for(var c=0,d=this.hierarchy.length;d>c;c++)for(var e=this.hierarchy[c],f=e.animationCache[this.data.name],g=0;g<this.keyTypes.length;g++){var h=this.keyTypes[g],i=f.prevKey[h],j=f.nextKey[h];if(j.time<=this.currentTime||i.time>=this.currentTime){for(i=this.data.hierarchy[c].keys[0],j=this.getNextKeyWith(h,c,1);j.time<this.currentTime&&j.index>i.index;)i=j,j=this.getNextKeyWith(h,c,j.index+1);f.prevKey[h]=i,f.nextKey[h]=j}var k=i[h],l=j[h];if(j.time!==i.time&&void 0!==k&&void 0!==l){var m=(this.currentTime-i.time)/(j.time-i.time);if(0>m&&(m=0),m>1&&(m=1),"points"===h){var n=.5>m?k:l;this.viewer.removeOverlay("polyline",this.root),this.root=null;for(var o=[],p=0;p<n.length;p++){var q=n[p].slice();if(0===p)q[0]=k[p][0]+(l[p][0]-k[p][0])*m,q[1]=k[p][1]+(l[p][1]-k[p][1])*m,q[2]=k[p][2]+(l[p][2]-k[p][2])*m;else if(p===n.length-1){var r=k.length-1,s=l.length-1;q[0]=k[r][0]+(l[s][0]-k[r][0])*m,q[1]=k[r][1]+(l[s][1]-k[r][1])*m,q[2]=k[r][2]+(l[s][2]-k[r][2])*m}var t=new THREE.Vector3(q[0],q[1],q[2]);o.push(t)}this.root=this.createPolyline(o)}else if("vis"===h){var u=Math.abs(this.currentTime-j.time)<this.epsilon?l:k;this.root.visible=u,u||a(this)}}}}}}(),j.prototype.createPolyline=function(a){for(var b=new THREE.Geometry,c=0;c<a.length;c++)b.vertices.push(a[c]);b.computeLineDistances();var d=new THREE.LineDashedMaterial({color:0,dashSize:1,gapSize:.5,linewidth:1}),e=new THREE.Line(b,d,THREE.LineStrip);return void 0===this.viewer.overlayScenes.polyline&&this.viewer.createOverlayScene("polyline"),this.viewer.addOverlay("polyline",e),e},b.Animation=e,b.AnimationHandler=d,b.MeshAnimation=f,b.CameraAnimation=g,b.PolylineAnimation=j,b.VisibilityAnimation=h,b.AnnotationAnimation=i}(),function(){"use strict";var a=Autodesk.Viewing.Private,b=function(a,b){this.animations=[],this.viewer=a,this.keys=[],this.isPlaying=!1,this.isPaused=!0,this.updateFlag=0,this.duration=b,this.currentTime=0,this.onPlayCallback=null,this.animationHandler=new Autodesk.Viewing.Private.AnimationHandler,this.areCameraAnimationsPaused=!1,this.UPDATE_SCENE=1,this.UPDATE_CAMERA=2};b.prototype.destroy=function(){this.stop(),this.viewer=null,this.keys=null,this.animations=null,this.isPlaying=!1,this.isPaused=!1,this.animationHandler=null},b.prototype.add=function(b){function c(a){function b(a,b,c){for(b=a.length;c=--b;)for(;c--;)a[b]!==a[c]||a.splice(c,1)}a.sort(function(a,b){return a-b}),b(a)}if(!(!b.hierarchy||b.hierarchy.length<1||!b.hierarchy[0].keys||b.hierarchy[0].keys.length<2)){var d=null,e=this;if("camera"===b.type?(d=new a.CameraAnimation(e.viewer.camera,b,e),e.animations.push(d)):"annotation"===b.type?(d=new a.AnnotationAnimation(null,b,e),e.animations.push(d)):"polyline"===b.type?(d=new a.PolylineAnimation(null,b,e),e.animations.push(d)):("mesh"===b.type||"visibility"===b.type)&&e.viewer.model.getData().instanceTree.enumNodeFragments(b.id,function(c){var f=e.viewer.getFragmentProxy(e.viewer.model,c);f&&(d="mesh"===b.type?new a.MeshAnimation(f,b,e):new a.VisibilityAnimation(f,b,b.id,e),e.animations.push(d))},!0),d){for(var f=0,g=b.hierarchy.length;g>f;f++)for(var h=b.hierarchy[f].keys,i=0;i<h.length;i++)void 0===h[i].xk&&e.keys.push(h[i].time);c(e.keys)}this.updateFlag|=this.UPDATE_SCENE}},b.prototype.update=function(a){this.animationHandler.update(a);var b=this.updateFlag;return this.isPlaying&&!this.isPaused&&(this.currentTime+=a,this.currentTime=Math.min(this.currentTime,this.duration),this.onPlayCallback&&this.onPlayCallback(this.duration>0?this.currentTime/this.duration*100:0),this.currentTime>=this.duration&&this.pause(),b|=this.UPDATE_SCENE),this.updateFlag=0,b},b.prototype.play=function(a,b){if(this.onPlayCallback=b,this.currentTime>=this.duration&&this["goto"](0),this.isPlaying)return void this.pause();for(var c=0;c<this.animations.length;c++){var d=this.animations[c];d.play(a)}this.isPlaying=!0,this.isPaused=!1},b.prototype.pause=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.isPaused===this.isPaused&&b.pause()}this.isPaused=!this.isPaused,this.areCameraAnimationsPaused=this.isPaused},b.prototype.pauseCameraAnimations=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b instanceof Autodesk.Viewing.Private.CameraAnimation&&b.pause()}this.areCameraAnimationsPaused=!this.areCameraAnimationsPaused},b.prototype.stop=function(){for(var a=0;a<this.animations.length;a++){var b=this.animations[a];b.stop()}this.isPlaying=!1,this.isPaused=!1},b.prototype["goto"]=function(a){if(void 0!==a){for(var b=0;b<this.animations.length;b++){var c=this.animations[b];c["goto"](a)}this.isPlaying=!0,this.isPaused=!0,this.currentTime=a,this.updateFlag|=this.UPDATE_SCENE}},b.prototype.next=function(){function a(a,b){for(var c=-1,d=0;d<b.length;d++)if(b[d]>a){c=b[d];break}return 0>c?b[b.length-1]:c}var b=a(this.currentTime,this.keys);this["goto"](b);
},b.prototype.prev=function(){function a(a,b){for(var c=-1,d=b.length-1;d>-1;d--)if(b[d]<a){c=b[d];break}return 0>c?b[0]:c}var b=a(this.currentTime,this.keys);this["goto"](b)},a.KeyFrameAnimator=b}(),void 0===ENABLE_DEBUG)var ENABLE_DEBUG=!0;if(void 0===ENABLE_TRACE)var ENABLE_TRACE=!0;var RENDER_NORMAL=0,RENDER_HIGHLIGHTED=1,RENDER_HIDDEN=2,RENDER_FINISHED=3;!function(){"use strict";function a(a,d){function e(a){var b=window.devicePixelRatio;b||(b=1);var c=Autodesk.Viewing.InitParametersSetting;c.canvas=a,c.devicePixelRatio=b;var d=new FireflyWebGLRenderer(c);return d.autoClear=!1,d.sortObjects=!1,d}function f(a){var b=E,c=!0,d=b==RENDER_NORMAL,e=w.settings.idbuffer&&b!=RENDER_HIDDEN;b==RENDER_HIDDEN?a.overrideMaterial=A.fadeMaterial:b==RENDER_HIGHLIGHTED&&(a.overrideMaterial=A.highlightMaterial),w.renderScenePart(a,c,d,e),a.overrideMaterial=null}function g(a){R>0&&(S=.8*S+.2*(a-R)),A.fpsCallback&&A.fpsCallback(A.fps())}function h(a){if(A.keyFrameAnimator){var b=R>0?(a-R)/1e3:0,c=A.keyFrameAnimator.update(b);if(c&&(A.sceneUpdated(!0),c&A.keyFrameAnimator.UPDATE_CAMERA))return!0}return!1}function i(){r&&(A.camera.aspect=s/t,A.camera.clientWidth=s,A.camera.clientHeight=t,w.setSize(s,t),A.controls.handleResize(),z&&z.setSize(s,t),A.invalidate(!0,!0,!0),r=!1,A.api.fireEvent({type:Autodesk.Viewing.VIEWER_RESIZE_EVENT,width:s,height:t}))}function j(){if((y.enabled||z)&&!A.is2d){var a;if(a=A.model&&!A.model.isLoadDone()?A.model.getData().bbox:A.getVisibleBounds(!0,!1)){y.needClear=!0;var b=A.camera,c=a.clone(),d=new THREE.Vector3(1,0,0),e=c.center(),f=c.size();if(b.worldUpTransform&&(d.applyMatrix4(b.worldUpTransform),c.applyMatrix4(b.worldUpTransform),f=c.size()),f.multiply(new THREE.Vector3(1.25,1.01,1.25)),f.x=f.z=Math.max(f.x,f.z),y.setTransform(e,f,b.worldup,d),z){var g=(new THREE.Vector3).subVectors(e,b.worldup.clone().multiplyScalar(f.y/2));z.setTransform(g,b.worldup,f)}}}}function k(a){N&&(j(),N=!1)}function l(a){for(var b in A.selectionMeshes){var c=A.selectionMeshes[b];c.model.getFragmentList().getWorldMatrix(c.fragId,c.matrix)}}function m(a){r&&i(),u.updateMaterials();var b=h(a),c=A.controls.update(a),d=c||b||x;K=K||d,M=M||d,M&&l(a),M=M||w.overlayUpdate(a);var e=A.model&&(A.model.isLoadDone()||1==A.model.myData.partPacksLoadDone),j=A.progressiveRender?A.targetFrameTime:1e10,m=j,n=V;if(N&&k(a),K||L){if(e&&A.signalProgress(0,null),P>0){var o=a-P;Q=.75*Q+.25*o}P=a,C>Q&&B>j?A.targetFrameTime+=1:Q>C&&j>D&&(A.targetFrameTime-=1),A.updateCameraMatrices(),w.beginScene(A.scene,A.camera,A.lights,K),d&&A.api.fireEvent(A.cameraChangedEvent),n&&(n.hasHighlighted()?(E=RENDER_HIGHLIGHTED,n.reset(A.camera,E,d|K)):(E=RENDER_NORMAL,n.reset(A.camera,E,d|K)))}else P=-1;var p=W(K);M=M||p,X(K),n.isEmpty()||n.isDone()||(m=n.renderSome(f,m),n.isDone()&&E===RENDER_HIGHLIGHTED&&(E=RENDER_NORMAL,n.reset(A.camera,E),m=n.renderSome(f,m)),d||M||(g(a),w.composeFinalFrame()),n.isDone()?(E===RENDER_NORMAL&&!n.areAllVisible()&&A.showGhosting?(!z||z.finished)&&(E=RENDER_HIDDEN,n.reset(A.camera,E)):(E=RENDER_FINISHED,w.renderScenePart(A.sceneAfter,!0,!0,!0),w.composeFinalFrame(d&&A.skipAOWhenMoving,!0)),e&&A.signalProgress(100,null)):e&&A.signalProgress(100*n.getRenderProgress(),null)),M&&(w.renderScenePart(A.sceneAfter,!0,!0,!0),!n.isEmpty()&&n.isDone()||A.showOverlaysWhileMoving?(A.renderOverlays(),n.isEmpty()||n.isDone()||(M=!0)):w.clearAllOverlays(),w.composeFinalFrame((d||n.isEmpty()||!n.isDone())&&A.skipAOWhenMoving,n&&n.isDone()),g(a)),H&&!d&&A.skipAOWhenMoving&&w.composeFinalFrame(),H=d,R=a,n&&n.needsRender()?(L=!0,n.resetNeedsRender()):L=!1,K=!1,x=!1}function n(a,b){b.updateMatrixWorld(!0),b.traverse(function(b){var c=b.geometry;void 0!==c&&c.visible&&(c.boundingBox||c.computeBoundingBox(),Z.copy(c.boundingBox),Z.applyMatrix4(b.matrixWorld),a.union(Z))})}function o(){var a=new THREE.Box3,b=A.overlayScenes;for(var c in b)b.hasOwnProperty(c)&&n(a,b[c].scene);return n(a,A.scene),a}function p(a){var b=";base64,";if(-1==a.indexOf(b)){var c=a.split(","),d=c[0].split(":")[1],e=decodeURIComponent(c[1]);return new Blob([e],{type:d})}for(var c=a.split(b),d=c[0].split(":")[1],e=window.atob(c[1]),f=e.length,g=new Uint8Array(f),h=0;f>h;++h)g[h]=e.charCodeAt(h);return new Blob([g],{type:d})}var q,r,s,t,u,v,w,x,y,z,A=this,B=1e3/15,C=1e3/30,D=1e3/120,E=RENDER_NORMAL,F=-1,G=-1,H=!1,I=new THREE.Vector3(0,1,0),J="y",K=!1,L=!1,M=!1,N=!1,O=0,P=0,Q=0,R=0,S=1e3/60,T=!0,U=!1,V=new c.RenderScene,W=function(){var a,b=10,c=10,d=0,e=0,f=0;return function(g){if(!y.enabled||A.is2d||V.isEmpty()||T)return!1;if(g&&(y.rendered=!1),a!=V.getGeomScenes()&&(y.needClear=!0),y.needClear&&(y.clear(),y.needClear=!1,a=V.getGeomScenes(),d=a.length,e=0,f=Math.max(Math.ceil(d/b),c)),y.isValid())y.rendered||z&&z.progressive||(y.renderShadow(A.camera,w.getColorTarget()),y.rendered=!0);else{for(var h=0;f>h&&d>e;){var i=a[e];i&&(i.forceVisible=!0,y.renderIntoShadow(i),i.forceVisible=!1,h++),e++}if(e>=d)return y.postprocess(),y.rendered||z&&z.progressive||(y.renderShadow(A.camera,w.getColorTarget()),y.rendered=!0),!0}return!1}}(),X=function(){var a,b=20,c=1,d=0,e=0,f=0;return function(g){if(!(!z||z.finished&&!g||A.is2d||V.isEmpty()||T)){if(g){if(z.clear(),z.updateCamera(A.camera),z.rendered=!1,z.finished=!1,z.isGroundCulled())return;a=V.getGeomScenes(),d=a.length,e=0,f=Math.max(Math.ceil(d/b),c)}if(!z.isGroundCulled()){for(var h=0;f>h&&d>e;){var i=a[e];i&&(i.forceVisible=!0,z.renderIntoReflection(i),i.forceVisible=!1,h++),e++}d>e?z.rendered=!1:z.finished=!0,z.rendered||z.isGroundCulled()||!(z.finished||z.progressive&&!V.isDone())||(z.postprocess(A.camera,u),y.enabled&&y.isValid()&&(y.renderShadow(A.camera,z.outTarget),y.rendered=!0),z.renderReflection(A.camera,w.getColorTarget()),z.rendered=!0,V.isDone()&&(A.showGhosting&&!V.areAllVisible()?(E=RENDER_HIDDEN,V.reset(A.camera,E)):w.presentBuffer()))}}}}();this.run=function(){q=0,function a(b){q=window.requestAnimationFrame(a),m(b)}()},this.toggleProgressive=function(a){this.progressiveRender=a,K=!0},this.toggleGhosting=function(a){this.showGhosting=a,K=!0},this.toggleOverlaysWhileMoving=function(a){this.showOverlaysWhileMoving=a},this.togglePostProcess=function(a,b){w.initPostPipeline(a,b),this.fireRenderOptionChanged(),K=!0},this.toggleCelShading=function(a){w.toggleCelShading(a),this.fireRenderOptionChanged(),K=!0},this.toggleGroundShadow=function(a){y.enabled!==a&&(y.enabled=a,y.needClear=!0,j(),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundShadowColor=function(a){y.enabled&&(y.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundShadowAlpha=function(a){y.enabled&&(y.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleGroundReflection=function(a){a&&z||!a&&!z||(a?(z=new Autodesk.Viewing.Shaders.GroundReflection(v,this.canvas.clientWidth,this.canvas.clientHeight),z.setClearColors(this.clearColorTop,this.clearColorBottom),z.progressive=!0,z.toggleEnvMapBackground(U),z.setEnvRotation(w.getEnvRotation()),j()):(z.cleanup(),z=void 0),this.fireRenderOptionChanged(),this.invalidate(!0,!1,!1))},this.setGroundReflectionColor=function(a){z&&(z.setColor(a),this.invalidate(!0,!1,!1))},this.setGroundReflectionAlpha=function(a){z&&(z.setAlpha(a),this.invalidate(!0,!1,!1))},this.toggleEnvMapBackground=function(a){U=a,w.toggleEnvMapBackground(a),z&&z.toggleEnvMapBackground(a),this.invalidate(!0,!0,!1)},this.isEnvMapBackground=function(){return U},this.toggleRenderPrism=function(a){u.setRenderPrism(a)},this.setOptimizeNavigation=function(a){this.skipAOWhenMoving=a},this.renderOverlays=function(){var a=this.lightsOn;a||this.toggleLights(!0,!0);var b;this.dir_light1&&(b=this.dir_light1.intensity,this.dir_light1.intensity=1),w.renderOverlays(this.overlayScenes,this.lights),a||this.toggleLights(!1,!0),this.dir_light1&&(this.dir_light1.intensity=b),M=!1},this.setLayerVisible=function(a,b){this.matman().setLayerVisible(a,b)},this.isLayerVisible=function(a){return this.matman().isLayerVisible(a)},this.updateCameraMatrices=function(){var a=new THREE.Matrix4,b=new THREE.Matrix4,c=new THREE.Box3;return function(){var d=this.camera;if(a.compose(d.position,d.quaternion,d.scale),b.getInverse(a),d.worldup&&this.setWorldUp(d.worldup),this.model){var e=this.getVisibleBounds(!0,M);c.copy(e),c.applyMatrix4(b);var f=1e-5*(c.max.z-c.min.z),g=.5*(c.max.y-c.min.y),h=-(c.max.z+f)-g,i=-(c.min.z-f)+g;if(d.isPerspective&&(h=Math.max(h,Math.min(1,1e-4*Math.abs(i-h)))),i=Math.max(i,h),d.near=h,d.far=i,d.updateProjectionMatrix(),this.model.is2d()){var j,k=this.intersectGroundViewport(new THREE.Vector3(0,0,1));j=k?d.position.distanceTo(k):d.position.distanceTo(e.center());var l=w.settings.deviceHeight/(2*j*Math.tan(THREE.Math.degToRad(.5*d.fov)));u.updatePixelScale(l)}else{var m,n=u.getCutPlanesRaw();if(n&&n.length){var o=n[0],p=d.target.clone().sub(d.position).normalize(),q=p.dot(o);if(0===q)m=e.center();else{var r=-(d.position.clone().dot(o)+o.w)/q;m=e.clampPoint(p.multiplyScalar(r).add(d.position))}}else m=e.center();var j=d.position.distanceTo(m),l=w.settings.deviceHeight/(2*j*Math.tan(THREE.Math.degToRad(.5*d.fov)));u.updatePixelScale(l)}}}}(),this.initLights=function(a){var b=c.LightPresets[F].lightMultiplier;this.lightNode=new THREE.Object3D,this.dir_light1=new THREE.DirectionalLight((new THREE.Color).setRGB(1,1,1),b),this.dir_light1.position.set(-1,0,1),this.dir_light1.position.multiplyScalar(1e3*a),this.lightNode.add(this.dir_light1),this.amb_light=new THREE.AmbientLight((new THREE.Color).setRGB(1,1,1)),this.camera.add(this.lightNode),this.toggleLights(0!==b)},this.toggleLights=function(a,b){if(this.amb_light&&this.lightNode){a&&!this.lightsOn?(this.lights=[this.dir_light1,this.amb_light],this.lightsOn=!0):!a&&this.lightsOn&&(this.lightsOn=!1,this.lights=[]);var d=c.LightPresets[F],e=d.ambientLightColor,f=d.directLightColor;this.lightsOn?(b&&this.amb_light?this.amb_light.color.setRGB(.5*f[0],.5*f[1],.5*f[2]):e&&this.amb_light&&this.amb_light.color.setRGB(e[0],e[1],e[2]),f&&this.dir_light1&&this.dir_light1.color.setRGB(f[0],f[1],f[2])):e&&this.amb_light&&b&&this.amb_light.color.setRGB(e[0],e[1],e[2])}},this.syncCamera=function(a){this.camera.updateProjectionMatrix(),a&&this.setWorldUp(this.api.navigation.getWorldUpVector()),x=!0},this.setViewFromFile=function(a,b){var c,d=a.getDefaultCamera();if(d)c=d;else{c={};var e=a.getBoundingBox(),f=e.size();if(c.target=e.center(),a.is2d()){c.isPerspective=!1;var g=f.x/f.y,h=this.camera.aspect;h>g?c.orthoScale=f.y:c.orthoScale=f.x/h,c.up=new THREE.Vector3(0,0,1),c.position=c.target.clone(),c.position.z+=c.orthoScale,c.target.y+=1e-6*f.y}else c.isPerspective=!0,c.fov=this.camera.fov,c.up=this.camera.up.clone(),c.position=c.target.clone(),c.position.z+=1.5*Math.max(f.x,f.y,f.z)}this.setViewFromCamera(c,b)},this.adjustOrthoCamera=function(a){if(!a.isPerspective&&this.model){var b=this.model.getBoundingBox(),c=b.size(),d=a.target.clone().sub(a.position);if(d.length()>1e3*c.length()){var e=a.position.distanceTo(b.center());a.target.copy(a.position).add(d.normalize().multiplyScalar(e))}else a.position.copy(a.target).add(d.normalize().multiplyScalar(-a.orthoScale))}},this.setViewFromCamera=function(a,b){this.adjustOrthoCamera(a);var c=this.model?this.model.getUpVector():null;this.model&&-1!=this.model.getData().basePath.indexOf("SaRang")&&(c=[0,0,1]);var d;d=c?(new THREE.Vector3).fromArray(c):Autodesk.Viewing.Navigation.snapToAxis(a.up.clone()),a.up=d;var e=this.api.navigation;if(b){var f=this.camera;f.up.copy(a.up),f.position.copy(a.position),f.target.copy(a.target),a.isPerspective?f.fov=a.fov:(f.saveFov=a.fov,f.fov=Autodesk.Viewing.UnifiedCamera.ORTHO_FOV),f.isPerspective=a.isPerspective,f.orthoScale=a.orthoScale,f.dirty=!0,e.setWorldUpVector(f.up),e.setView(f.position,f.target),e.setPivotPoint(f.target),this.syncCamera(!0)}else this.camera.isPerspective=a.isPerspective,d=e.computeOrthogonalUp(a.position,a.target),e.setRequestTransitionWithUp(!0,a.position,a.target,a.fov,d,a.up);x=!0},this.setViewFromViewBox=function(a,b,c,d){if(a.is2d()){var e={},f=a.getBoundingBox(),g={width:b[2]-b[0],height:b[3]-b[1]};g.aspect=g.width/g.height,g.centerX=b[0]+g.width/2,g.centerY=b[1]+g.height/2;var h=this.camera.aspect;h>g.aspect?e.orthoScale=g.height:e.orthoScale=g.width/h,e.isPerspective=!1,e.position=new THREE.Vector3(g.centerX,g.centerY,f.center().z+e.orthoScale),e.target=new THREE.Vector3(g.centerX,g.centerY,f.center().z),e.target.y+=1e-6*g.height,e.up=new THREE.Vector3(0,0,1),this.setViewFromCamera(e,d)}},this.setWorldUp=function(a){if(!I.equals(a)){I.copy(a);var b=Math.abs(a.x);J="x",Math.abs(a.y)>b&&(J="y",b=Math.abs(a.y)),Math.abs(a.z)>b&&(J="z");var c=function(a,b){var c=(new THREE.Vector3).crossVectors(b,a).normalize(),d=Math.acos(a.dot(b));return(new THREE.Matrix4).makeRotationAxis(c,d)},d=new THREE.Vector3(0,1,0);A.camera.worldUpTransform=c(d,a),this.sceneUpdated(!1)}},this.addModel=function(a){if(a){var b=!!this.model,d=a.is2d();if(this.model||(this.model=a,w.setUnitScale(a.getUnitScale())),V.addModel(a),this.selector.addModel(a),this.visibilityManager.addModel(a),d){u.initLayersTexture(a);var e=u.create2DMaterial(a.getData(),{},!0),f=u.findMaterial(a.getData(),e);if(w.enter2DMode(f),!b){this.is2d=!0,G=F,this.setLightPreset(c.DefaultLightPreset2d);var g=a.getData();if(g.hidePaper){var h=g.bgColor,i=h>>16&255,j=h>>8&255,k=255&h;this.setClearColors(i,j,k,i,j,k)}}}if(this.api.navigation.setIs2D(d&&!b),this.api.setActiveNavigationTool(),!b){this.setViewFromFile(a,!0),this.controls.recordHomeView();var l=a.getBoundingBox(),m=.5*l.size().length();this.initLights(m)}d||this.setLightPresetFromFile(a)||this.setLightPreset(F,!0),this.fireRenderOptionChanged(),this.invalidate(!0)}},this.getSvfMaterialId=function(a){return this.model.getFragmentList().getSvfMaterialId(a)},this.getMaterials=function(){return u},this.createThreeMesh=function(a,b,c,d){var e,f=a.getData();if(b.isLines){var g=!!b.attributes.color,h=new THREE.LineBasicMaterial({vertexColors:g});if(!g){var i=u.findMaterial(f,c);h.color=i.color}u.addMaterialNonHDR(f.basePath+c+"_line_"+h.id,h),e=new THREE.Mesh(b,h,!f.animations),e.isLine=!0,f.hasLines=!0}else{var h=u.findMaterial(f,c);h&&(h.svfMatId=c),u.applyGeometryFlagsToMaterial(h,b),e=new THREE.Mesh(b,h,!f.animations),e.materialId=parseInt(c),b.is2d&&(e.is2d=!0)}return d&&(e.matrix&&e.matrix.copy(d),e.matrixWorld.copy(d)),e.matrixAutoUpdate=!1,e.frustumCulled=!1,e},this.onLoadComplete=function(a){function b(){if(c.animations){d.keyFrameAnimator=new Autodesk.Viewing.Private.KeyFrameAnimator(d,c.animations.duration);for(var a in c.animations.animations)d.keyFrameAnimator.add(c.animations.animations[a]);d.keyFrameAnimator["goto"](0),d.api.fireEvent({type:Autodesk.Viewing.ANIMATION_READY_EVENT})}d.api.removeEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,b)}T=!1,this.signalProgress(100,""),this.sceneUpdated(!1),this.is2d&&(this.selectionMaterial2d=u.init2DSelectionMaterial(a),this.createOverlayScene("selection2d",this.selectionMaterial2d));var c=a.getData();V.getGeometryList().printStats(),c.hasLines&&u.togglePolygonOffset(!0);var d=this;a.isObjectTreeCreated()?b():this.api.addEventListener(Autodesk.Viewing.OBJECT_TREE_CREATED_EVENT,b),this.api.fireEvent({type:Autodesk.Viewing.GEOMETRY_LOADED_EVENT,model:a})},this.signalProgress=function(a,b){this.api.fireEvent({type:Autodesk.Viewing.PROGRESS_UPDATE_EVENT,percent:a,message:b})},this.resize=function(a,b){r=!0,s=a,t=b},this.unloadModel=function(a){V.removeModel(a)&&(this.keyFrameAnimator&&(this.keyFrameAnimator.destroy(),this.keyFrameAnimator=null),a.dtor(this.glrenderer()),u.cleanup(a.getData()),a.isLoadDone()&&a.getData().propWorker.dtor(),a.loader&&a.loader.dtor(),this.selector.removeModel(a),this.visibilityManager.removeModel(a),a===this.model&&(this.model=null,V.isEmpty()||(this.model=V.getModels()[0])),this.api.fireEvent({type:b.MODEL_UNLOADED_EVENT,model:a}),this.invalidate(!0))},this.unloadCurrentModel=function(){this.is2d&&(this.is2d=void 0,this.selectionMaterial2d=null,this.removeOverlay("selection2d"),w.exit2DMode()),w.beginScene(this.scene,this.camera,this.lights,!0),w.composeFinalFrame(),this.model=null;for(var a=V.getModels(),b=a.length-1;b>=0;b--)this.unloadModel(a[b]);G>=0&&(F=G)};var Y=function(a,b,c){b.depthWrite=!1,b.depthTest=!0,b.side=THREE.DoubleSide,c.depthWrite=!1,c.depthTest=!0,c.side=THREE.DoubleSide,A.createOverlayScene(a,b,c)};this.createOverlayScene=function(a,b,c,d){b&&u.addMaterialNonHDR(a+"_pre",b),c&&u.addMaterialNonHDR(a+"_post",c);var e=new THREE.Scene;e.__lights=this.scene.__lights,this.overlayScenes[a]={scene:e,camera:d,materialPre:b,materialPost:c}},this.removeOverlayScene=function(a){var b=this.overlayScenes[a];b&&(delete this.overlayScenes[a],this.invalidate(!1,!1,!0))},this.addOverlay=function(a,b){this.overlayScenes[a].scene.add(b),this.invalidate(!1,!1,!0)},this.addMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.addOverlay(a,b[c])},this.removeOverlay=function(a,b){this.overlayScenes[a].scene.remove(b),this.invalidate(!1,!1,!0)},this.removeMultipleOverlays=function(a,b){for(var c in b)b.hasOwnProperty(c)&&this.removeOverlay(a,b[c])},this.clearOverlay=function(a){if(this.overlayScenes[a]){var b,c,d=this.overlayScenes[a].scene;for(c=d.children.length-1;c>=0;--c)b=d.children[c],b&&d.remove(b);this.invalidate(!1,!1,!0)}},this.setClearColors=function(a,b,c,d,e,f){if(this.clearColorTop=new THREE.Vector3(a/255,b/255,c/255),this.clearColorBottom=new THREE.Vector3(d/255,e/255,f/255),!u.reflectionCube||u.reflectionCube.isBgColor){var g=u.setCubeMapFromColors(this.clearColorTop,this.clearColorBottom);w.setCubeMap(g)}w.setClearColors(this.clearColorTop,this.clearColorBottom),z&&z.setClearColors(this.clearColorTop,this.clearColorBottom),K=!0,this.fireRenderOptionChanged()};var Z=new THREE.Box3;this.getVisibleBounds=function(a,b){var c=new THREE.Box3;return V.isEmpty()||(n(c,this.scene),c=V.getVisibleBounds(a).union(c),b&&(c=o().union(c))),c},this.getFitBounds=function(a){var b;return this.is2d&&(a=!0),a||null===this.selector||(b=this.selector.getSelectionBounds()),(!b||b.empty())&&(b=this.getVisibleBounds()),b},this.getRenderProxy=function(a,b){return a.getFragmentList().getVizmesh(b)},this.getFragmentProxy=function(a,b){return new c.FragmentPointer(a.getFragmentList(),b)},this.getRenderProxyCount=function(a){return a.getFragmentList().getCount()},this.getRenderProxyDbIds=function(a,b){return a.getFragmentList().getDbIds(b)},this.isWholeModelVisible=function(a){return V?V.areAllVisible():!0},this.highlightObjectNode=function(a,b,c,d){a.is2d()&&u.highlightObject2D(b,c);var e=this,f=a.getData().instanceTree;if(f&&!a.is2d())f.enumNodeFragments(b,function(b){e.highlightFragment(a,b,c,d)},!1);else{var g=b;if(a.is2d()&&(g=a.getData().fragments.dbId2fragId[b]),Array.isArray(g))for(var h=0;h<g.length;h++)e.highlightFragment(a,g[h],c,d);else e.highlightFragment(a,g,c,d)}},this.highlightFragment=function(a,b,c,d){var e=this.getRenderProxy(a,b);if(e){var f=!d||e.is2d,g=a.id+":"+b;if(f){var h=a.is2d()?"selection2d":"selection";if(c){var i=new THREE.Mesh(e.geometry,e.material);i.matrix.copy(e.matrixWorld),i.matrixAutoUpdate=!1,i.matrixWorldNeedsUpdate=!0,i.frustumCulled=!1,i.model=a,i.fragId=b,this.addOverlay(h,i),this.selectionMeshes[g]=i}else this.selectionMeshes[g]&&(this.removeOverlay(h,this.selectionMeshes[g]),delete this.selectionMeshes[g])}f&&c||a.setHighlighted(b,c)&&this.invalidate(!0)}},this.explode=function(a){a!=O&&(O=a,V.explode(a),this.sceneUpdated(!0),this.api.fireEvent({type:b.EXPLODE_CHANGE_EVENT}))},this.getExplodeScale=function(){return O},this.setGhostingBrightness=function(a){a?this.fadeMaterial.color=new THREE.Color(1052688):this.fadeMaterial.color=new THREE.Color(16777215),this.fadeMaterial.needsUpdate=!0},this.setLightPreset=function(a,b){if(F!=a||b){(0>a||c.LightPresets.length<=a)&&(a=c.DefaultLightPreset),F=a;var d=c.LightPresets[a];if(d&&d.path){var e="res/environments/"+d.path,f=c.getResourceUrl(e+"_mipdrop."+(d.type||"")+".dds"),g=c.getResourceUrl(e+"_irr."+(d.type||"")+".dds");u.setIrradianceMap(g,d.E_bias);var h=u.setCubeMap(f,d.E_bias);w.setCubeMap(h),u.setEnvExposure(-d.E_bias),this.setTonemapExposureBias(d.E_bias),this.setTonemapMethod(d.tonemap),this.setGhostingBrightness(d.darkerFade)}else{u.setIrradianceMap(null);var h=u.setCubeMap(null);w.setCubeMap(h),u.setEnvExposure(0),this.setTonemapExposureBias(0),this.setTonemapMethod(0),this.setGhostingBrightness(!1)}var i=Autodesk.Viewing.Shaders.SAOShader.uniforms.radius.value,j=Autodesk.Viewing.Shaders.SAOShader.uniforms.intensity.value;d.hasOwnProperty("saoRadius")&&(i=d.saoRadius),d.hasOwnProperty("saoIntensity")&&(j=d.saoIntensity),w.setAOOptions(i,j);var k=d.bgColorGradient;k||(k=c.BackgroundPresets.Custom),this.setClearColors(k[0],k[1],k[2],k[3],k[4],k[5]);var l=1;null!==d.lightMultiplier&&void 0!==d.lightMultiplier&&(l=d.lightMultiplier),this.dir_light1&&(this.toggleLights(0!==l),this.dir_light1.intensity=l,d.lightDirection&&(this.dir_light1.position.set(-d.lightDirection[0],-d.lightDirection[1],-d.lightDirection[2]),this.dir_light1.position.multiplyScalar(1e3*this.model.getData().bbox.size().length()))),u.setEnvRotation(d.rotation||0),w.setEnvRotation(d.rotation||0),z&&z.setEnvRotation(d.rotation||0),this.invalidate(!0,!1,!0),this.fireRenderOptionChanged()}},this.setLightPresetFromFile=function(a){var b=a.getMetadata("renderEnvironmentStyle","value",null);if(null===b||""===b)return!1;for(var d=a.getMetadata("renderEnvironmentExposureBias","value",null),e=a.getMetadata("renderEnvironmentExposureBase","value",null),f=!1,g=0;g<c.LightPresets.length;g++)if(b===c.LightPresets[g].name){null!==d&&null!==e&&(c.LightPresets[g].E_bias=d+e),this.setLightPreset(g),f=!0;break}var h=a.getMetadata("renderEnvironmentBackgroundColor","value",null);h&&this.setClearColors(255*h[0],255*h[1],255*h[2],255*h[0],255*h[1],255*h[2]);var i=a.getMetadata("renderEnvironmentBackgroundFromEnvironment","value",null);i&&this.toggleEnvMapBackground(!0);var j=a.getMetadata("renderEnvironmentRotation","value",null);return j&&(u.setEnvRotation(j),w.setEnvRotation(j),z&&z.setEnvRotation(j)),f},this.setTonemapMethod=function(a){a!=w.getToneMapMethod()&&(w.setTonemapMethod(a),u.setTonemapMethod(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.setTonemapExposureBias=function(a){a!=w.getExposureBias()&&(w.setTonemapExposureBias(a),u.setTonemapExposureBias(a),this.fireRenderOptionChanged(),this.invalidate(!0))},this.dtor=function(){window.cancelAnimationFrame(q),this.unloadCurrentModel(),this.controls=null,this.canvas=null,this.loader=null,this.selector.dtor(),this.selector=null,this.model=null,this.visibilityManager=null,V=null,w=null,u.dtor(),u=null},this.hideLines=function(a){return V&&!V.isEmpty()?(V.hideLines(a),this.sceneUpdated(!0),!0):!1},this.getCutPlanes=function(){return u.getCutPlanes()},this.setCutPlanes=function(a){u.setCutPlanes(a),this.sceneUpdated(),this.api.fireEvent({type:Autodesk.Viewing.CUTPLANES_CHANGE_EVENT})},this.fireRenderOptionChanged=function(){u.toggleMRTSetting(),this.api.fireEvent({type:Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT})},this.viewportToRay=function(a,b){var c=this.camera;a.z=-1;var d=new THREE.Vector3(a.x,a.y,1);return a=a.unproject(c),d=d.unproject(c),d.sub(a).normalize(),b||(b=new THREE.Ray),b.set(c.isPerspective?c.position:a,d),b},this.rayIntersect=function(a,b,c){var d=V.rayIntersect(a.origin,a.direction,b,c);if(this.sceneAfter.children.length){var e=new THREE.Raycaster(a.origin,a.direction,this.camera.near,this.camera.far),f=[];VBIntersector.intersectObject(this.sceneAfter,e,f,!0),f.length&&(!d||f[0].distance<d.distance)&&(d=f[0])}if(!d)return null;var g=d.fragId,h=d.point,i=d.face,j=d.model,k=d.dbId;if(void 0===k&&void 0!==g){k=j.getFragmentList().getDbIds(g);var l=j.getData().instanceTree;l||(k=g)}return{dbId:k,fragId:g,intersectPoint:h,face:i,model:j}},this.castRayViewport=function(){var a=new THREE.Ray;return function(b,c,d){return V?(this.viewportToRay(b,a),this.rayIntersect(a,c,d)):{}}}(),this.clientToViewport=function(a,b){var c=A.canvas.getBoundingClientRect();return new THREE.Vector3((a+.5)/c.width*2-1,2*-((b+.5)/c.height)+1,1)},this.viewportToClient=function(a,b){var c=A.canvas.getBoundingClientRect();return new THREE.Vector3(.5*(a+1)*c.width-.5,(b-1)*-.5*c.height-.5,0)},this.castRay=function(a,b,c){return this.castRayViewport(this.clientToViewport(a,b),c)},this.intersectGroundViewport=function(a){var b=this.camera,c="z";this.is2d||(c=J);var d=a;d.z=-1;var e=new THREE.Vector3(d.x,d.y,1);d=d.unproject(b),e=e.unproject(b),e.sub(d).normalize();var f=e;if(Math.abs(f[c])<1e-6)return null;var g;g=b.isPerspective?b.position:d;var h=this.model?this.model.getBoundingBox().min[c]:0,i=(h-g[c])/f[c];return f.multiplyScalar(i),f.add(g),f},this.intersectGround=function(a,b){return this.intersectGroundViewport(this.clientToViewport(a,b))},this.hitTestViewport=function(a,b){var c;if(A.is2d){var d=w.idAtPixel(a.x,a.y);if(0>=d)return null;var e=this.intersectGroundViewport(a);c={intersectPoint:e,dbId:d,fragId:A.model.getData().fragments.dbId2fragId[d],model:A.model}}else c=this.castRayViewport(a,b);return c},this.hitTest=function(a,b,c){return A.hitTestViewport(this.clientToViewport(a,b),c)},this.snappingHitTestViewport=function(a,b){var c;if(A.is2d){var d=w.idAtPixels(a.x,a.y,17);if(0>d)return null;var e=this.intersectGroundViewport(a);c={intersectPoint:e,dbId:d,fragId:A.model.getData().fragments.dbId2fragId[d]}}else{var d=w.idAtPixel(a.x,a.y);c=this.castRayViewport(a,b,d>0?[d]:null)}return c},this.snappingHitTest=function(a,b,c){return this.snappingHitTestViewport(this.clientToViewport(a,b),c)},this.rolloverObjectViewport=function(a){w.rolloverObjectViewport(a.x,a.y)&&this.invalidate(!1,!1,!0)},this.rolloverObject=function(a,b){this.rolloverObjectViewport(this.clientToViewport(a,b))},this.rolloverObjectNode=function(a){var b=[],c=A.model.getData().instanceTree;if(c){if(c.enumNodeChildren(a,function(a){b.push(a)},!0),b.length>1){var d=b.shift();b.sort(function(a,b){return a-b}),b.unshift(d)}}else b.push(a);w.rolloverObjectViewport(null,null,b)&&this.invalidate(!1,!1,!0)},this.getScreenShotBuffer=function(a,b,c){w.presentBuffer();var d=A.canvas.toDataURL("image/png");if(!a||!b)return d;var e,f,g=0,h=0;a>b||a/b>s/t?(e=a,f=t/s*a,h=b/2-f/2):(f=b,e=s/t*b,g=a/2-e/2);var i=window.URL.createObjectURL(p(A.canvas.toDataURL("image/png"))),j=new Image;j.src=i;var k=document.createElement("canvas"),l=k.getContext("2d");k.width=a,k.height=b,j.onload=function(){l.drawImage(j,g,h,e,f);var a=k.toDataURL("image/png"),b=window.URL.createObjectURL(p(k.toDataURL("image/png")));c?c(a):window.open(b)}},this.getScreenShot=function(a,b,c){w.presentBuffer();var d=window.URL.createObjectURL(p(A.canvas.toDataURL("image/png")));if(!a||!b)return d;var e,f,g=0,h=0;a>b||a/b>s/t?(e=a,f=t/s*a,h=b/2-f/2):(f=b,e=s/t*b,g=a/2-e/2);var i=new Image;i.src=d;var j=document.createElement("canvas"),k=j.getContext("2d");j.width=a,j.height=b,i.onload=function(){k.drawImage(i,g,h,e,f);var a=window.URL.createObjectURL(p(j.toDataURL("image/png")));c?c(a):window.open(a)}},this.modelQueue=function(){return V},this.glrenderer=function(){return v},this.renderer=function(){return w},this.worldUp=function(){return I},this.worldUpName=function(){return J},this.setUserRenderContext=function(a){w=a?a:new RenderContext,w.init(v,this.canvas.clientWidth,this.canvas.clientHeight),w.setClearColors(this.clearColorTop,this.clearColorBottom),this.invalidate(!0),this.sceneUpdated(!1)},this.invalidate=function(a,b,c){K=K||a,L=L||b,M=M||c},this.sceneUpdated=function(a){this.invalidate(!0,!1,!0),V&&a&&V.invalidateVisibleBounds(),N=!0},this.currentLightPreset=function(){return F},this.matman=function(){return u},this.fps=function(){return 1e3/S},this.setFPSTargets=function(a,b,c){B=1e3/c,D=1e3/a,C=1e3/b,this.targetFrameTime=C},this.api=d,this.canvas=a,this.loader=null,v=e(a),w=new RenderContext,w.init(v,a.clientWidth,a.clientHeight),u=new c.MaterialManager(this),init_UnifiedCamera(),this.camera=new Autodesk.Viewing.UnifiedCamera(a.clientWidth,a.clientHeight),this.lights=[],this.cameraChangedEvent=this.camera.getCameraChangedEvent(),this.scene=new THREE.Scene,this.sceneAfter=new THREE.Scene,this.sceneAfter.sortObjects=!1,this.overlayScenes={},this.selectionMaterial2d=null,this.selectionMaterialBase=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.selectionMaterialTop=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:.15,transparent:!0}),this.selectionMaterialTop.packedNormals=!0,this.selectionMaterialBase.packedNormals=!0,Y("selection",this.selectionMaterialBase,this.selectionMaterialTop),this.selectionMeshes={},this.fadeMaterial=new THREE.MeshPhongMaterial({color:16777215,opacity:.1,reflectivity:0,transparent:!0,depthWrite:!1}),this.fadeMaterial.packedNormals=!0,u.addMaterial("__fadeMaterial__",this.fadeMaterial,!0),this.highlightMaterial=new THREE.MeshPhongMaterial({color:6724095,specular:526344,emissive:3361911,ambient:0,opacity:1,transparent:!1}),this.highlightMaterial.packedNormals=!0,u.addMaterial("__highlightMaterial__",this.highlightMaterial,!0),this.progressiveRender=!0,(isAndroidDevice()||isIOSDevice())&&(B*=2,D*=2,C*=2),this.targetFrameTime=C,this.controls={update:function(a){},handleResize:function(){},recordHomeView:function(){},uninitialize:function(){}},this.selector=new c.MultiModelSelector(this),this.visibilityManager=new c.MultiModelVisibilityManager(this),this.showGhosting=!0,this.showOverlaysWhileMoving=!0,this.skipAOWhenMoving=!1,this.keyFrameAnimator=null;var $=c.LightPresets[c.DefaultLightPreset].bgColorGradient;this.setClearColors($[0],$[1],$[2],$[3],$[4],$[5]),y=new Autodesk.Viewing.Shaders.GroundShadow(v),y.enabled=!0,u.addMaterialNonHDR("groundShadowDepthMaterial",y.getDepthMaterial()),u.addMaterialNonHDR("normalsMaterial",w.getDepthMaterial()),w.beginScene(this.scene,this.camera,this.lights,!0),w.composeFinalFrame(),this.messageClient=null,this.presenceChannelId=null,this.p2p=null,this.viewtx=null,this.interceptor=null,this.joinLiveReviewSession=function(a){!function(){var a=Autodesk.Viewing,b=a.Private;b.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},b.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;b[1]===!0||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),
v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c){o&&this.detach(),this.viewer=o=c,w=new b.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),s.addEventListener("viewerState",d),o.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||o.addEventListener(a.CAMERA_CHANGE_EVENT,h),o.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(a.SELECTION_CHANGED_EVENT,l),o.addEventListener(a.ISOLATE_EVENT,l),o.addEventListener(a.HIDE_EVENT,l),o.addEventListener(a.SHOW_EVENT,l),o.addEventListener(a.HIGHLIGHT_EVENT,l),o.addEventListener(a.EXPLODE_CHANGE_EVENT,l),o.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))},this.detach=function(){s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(a.CAMERA_CHANGE_EVENT,h),o.removeEventListener(a.SELECTION_CHANGED_EVENT,l),o.removeEventListener(a.ISOLATE_EVENT,l),o.removeEventListener(a.HIDE_EVENT,l),o.removeEventListener(a.SHOW_EVENT,l),o.removeEventListener(a.HIGHLIGHT_EVENT,l),o.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},b.ViewTransceiver.prototype.constructor=b.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(b.ViewTransceiver.prototype)}(),this.messageClient||(this.messageClient=c.MessageClient.GetInstance()),this.presenceChannelId||(this.presenceChannelId=window.location.host),this.messageClient.isConnected()||this.messageClient.connect(a),this.viewtx||(this.viewtx=new c.ViewTransceiver(this.messageClient)),this.viewtx.channelId=a,this.viewtx.attach(global_viewer_instance),this.p2p||(this.p2p=new c.P2PClient(this.messageClient)),this.messageClient.join(this.viewtx.channelId),this.interceptor||(this.interceptor=new c.InteractionInterceptor(this.viewtx)),d.toolController.registerTool(this.interceptor),d.toolController.activateTool(this.interceptor.getName())},this.leaveLiveReviewSession=function(){this.p2p.hangup(),this.viewtx.detach(d),this.messageClient.disconnect()},this.log=function(a){c.logger&&c.logger.log(a)}}var b=Autodesk.Viewing,c=b.Private;b.InitParametersSetting={canvas:null,antialias:!1,alpha:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1,depth:!1,devicePixelRatio:null},a.prototype.constructor=a,Autodesk.Viewing.Private.Viewer3DImpl=a}(),Autodesk.Viewing.Private.ViewerState=function(a){function b(){var a=Math.round(4294967295*Math.random()),b=Date.now();return a.toString(16)+b.toString(16)}var c=!0;this.getState=function(d){var e=a.navigation,f=Autodesk.Viewing.Private,g={};g.guid=b(),g.seedURN=this.getSeedUrn(),g.overrides=this.getTransformsOverrides();var h=g.objectSet;Array.isArray(h)||(g.objectSet=h=[]),a.model&&!a.model.is2d()&&(h[0]={id:this.getSelectedNodes(),isolated:a.getIsolatedNodes(),hidden:a.getHiddenNodes(),explodeScale:a.getExplodeScale(),idType:"lmv"}),a.model&&a.model.is2d()&&(h[0]={id:this.getSelectedNodes(),isolated:this.getVisibleLayers2d(),hidden:[],idType:"lmv"});var i=g.viewport;i||(i=g.viewport={});var j=e.getCamera().isPerspective;i.name="",i.eye=e.getPosition().toArray(),i.target=e.getTarget().toArray(),i.up=e.getCamera().up.toArray(),i.worldUpVector=e.getWorldUpVector().toArray(),i.pivotPoint=e.getPivotPoint().toArray(),i.distanceToOrbit=e.getPivotPlaneDistance(),i.aspectRatio=this.getAspectRatio(),i.projection=j?"perspective":"orthographic",i.isOrthographic=!j,j?i.fieldOfView=e.getVerticalFov():i.orthographicHeight=this.getOrthographicHeight();var k=g.renderOptions;if(k||(k=g.renderOptions={}),k.environment=f.LightPresets[a.impl.currentLightPreset()].name,k.ambientOcclusion={enabled:a.impl.renderer().settings.sao,radius:a.impl.renderer().getAORadius(),intensity:a.impl.renderer().getAOIntensity()},k.toneMap={method:a.impl.renderer().getToneMapMethod(),exposure:a.impl.renderer().getExposureBias(),lightMultiplier:this.getToneMapIntensity()},k.appearance={ghostHidden:a.impl.showGhosting,ambientShadow:a.prefs.ambientShadows,antiAliasing:a.impl.renderer().settings.antialias,progressiveDisplay:a.prefs.progressiveRendering,displayLines:a.prefs.lineRendering},a.model&&!a.model.is2d())for(var l=g.cutplanes=[],m=a.getCutPlanes(),n=0;n<m.length;n++)l.push(m[n].toArray());for(var o in a.loadedExtensions)a.loadedExtensions[o].getState(g);return d&&d!==c&&this.applyFilter(g,d),g},this.restoreState=function(b,d,e){if(!b)return stderr("restoreState has no viewer state to restore from."),!1;if(!a||!a.model)return stderr("restoreState has no viewer or model to restore."),!1;d&&d!==c&&(b=JSON.parse(JSON.stringify(b)),this.applyFilter(b,d));var f=a.navigation;if(f.getTransitionActive())return stderr("Abort restoreState, animation in progress..."),!1;if(a.model&&Array.isArray(b.objectSet)&&b.objectSet.length>0){var g=b.objectSet[0],h=a.impl?a.impl.selector:null;if(a.model.getRootId()){var i=g.id;i&&h&&(i=this.toIntArray(i),h.setSelection(i));var j=g.isolated||[];if(j=this.toIntArray(j),a.isolate(j),0===j.length){var k=g.hidden||null;k&&k.length>0&&(k=this.toIntArray(k),a.hide(k))}if("explodeScale"in g){var l=parseFloat(g.explodeScale);a.explode&&(a.explode(l),a.explodeSlider&&(a.explodeSlider.value=l))}}if(a.model.is2d()){var m=g.id||[];if(m){if(h){var n=m.map(function(a){return{dbId:a,fragIds:0}});h.setSelection(n)}}else h.clearSelection(!0);var o=g.isolated;Array.isArray(o)&&o.length>0?(a.setLayerVisible(null,!1),a.impl.setLayerVisible(o,!0)):a.setLayerVisible(null,!0)}}var p=b.viewport;if(p){var q=this.getVector3FromArray(p.eye,f.getPosition()),r=this.getVector3FromArray(p.up,f.getCamera().up),s=this.getVector3FromArray(p.target,f.getTarget()),t="fieldOfView"in p?parseFloat(p.fieldOfView):f.getVerticalFov(),u=this.getVector3FromArray(p.worldUpVector,null);if(!u){var v=a.model?a.model.getUpVector():null;u=v?(new THREE.Vector3).fromArray(v):new THREE.Vector3(0,1,0)}var w=f.getCamera().isPerspective;"isOrthographic"in p&&(w=!p.isOrthographic);var x=this.getOrthographicHeight();"orthographicHeight"in p&&(x=Number(p.orthographicHeight));var y={position:q,target:s,up:r,worldup:u,aspect:a.impl.camera.aspect,fov:t,orthoScale:x,isPerspective:w};this.restoreCameraState(y,e)}var z=b.renderOptions;if(z){var A=a.prefs.ambientShadows,B=a.prefs.antialiasing,C=z.ambientOcclusion;if(C){"enabled"in C&&(A=C.enabled);var D="radius"in C?C.radius:null,E="intensity"in C?C.intensity:null;null!==D&&null!==E&&(a.impl.renderer().setAOOptions(D,E),a.impl.renderer().composeFinalFrame(!1))}if("environment"in z){var F=this.getLightPresetIndex(z.environment);-1!==F&&a.setLightPreset(F)}var G=z.toneMap;if(G){var H="lightMultiplier"in G?G.lightMultiplier:null,I="exposure"in G?G.exposure:null;null!==H&&null!==I&&(a.impl.dir_light1&&(a.impl.dir_light1.intensity=Math.pow(2,H)),a.impl.renderer().setTonemapExposureBias(I,H),a.impl.invalidate(!0))}var J=z.appearance;J&&("antiAliasing"in J&&(B=J.antiAliasing),"progressiveDisplay"in J&&a.setProgressiveRendering(J.progressiveDisplay),"ghostHidden"in J&&a.setGhosting(J.ghostHidden),"displayLines"in J&&a.hideLines(!J.displayLines)),a.setQualityLevel(A,B)}if(Array.isArray(b.cutplanes)&&a.model&&!a.model.is2d()){for(var K=[],L=0;L<b.cutplanes.length;L++){var M=b.cutplanes[L];Array.isArray(M)&&M.length>=4&&K.push(new THREE.Vector4(M[0],M[1],M[2],M[3]))}a.setCutPlanes(K)}for(var N in a.loadedExtensions)a.loadedExtensions[N].restoreState(b,e);return!0},this.restoreCameraState=function(b,c){a.impl.adjustOrthoCamera(b);var d=a.navigation;c?(b.isPerspective?d.toPerspective():d.toOrthographic(),d.setCameraUpVector(b.up),d.setWorldUpVector(b.worldup),d.setView(b.position,b.target),d.setPivotPoint(b.target),d.setVerticalFov(b.fov,!1),a.impl.syncCamera(!0)):(a.impl.camera.isPerspective=b.isPerspective,d.setRequestTransitionWithUp(!0,b.position,b.target,b.fov,b.up,b.worldup))},this.toIntArray=function(a){var b=[];if(Array.isArray(a))for(var c=0,d=a.length;d>c;++c)b.push(parseInt(a[c]));return b},this.extractSelectedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.id)}return[]},this.extractIsolatedNodeIds=function(a){if(a&&Array.isArray(a.objectSet)&&a.objectSet.length>0){var b=a.objectSet[0];return this.toIntArray(b.isolated)}return[]},this.getVector3FromArray=function(a,b){return a instanceof Array&&a.length>2?(a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]),(new THREE.Vector3).fromArray(a)):b},this.getSelectedNodes=function(){return a.impl&&a.impl.selector?a.impl.selector.getSelection():[]},this.getVisibleLayers2d=function(){var b=[],c=a.impl.matman(),d=c.layersMap;for(var e in d)d.hasOwnProperty(e)&&c.isLayerVisible(e)&&b.push(e);return b},this.getAspectRatio=function(){var b=a.navigation.getScreenViewport(),c=b.width/b.height;return c},this.getOrthographicHeight=function(){var b=a.navigation.getCamera();return b.isPerspective?0:Math.abs(2*b.orthographicCamera.top)},this.getSeedUrn=function(){return a.model&&a.model.loader?a.model.loader.svfUrn||"":""},this.getTransformsOverrides=function(){return{transformations:[]}},this.getToneMapIntensity=function(){var b=0;return a.impl.dir_light1&&(b=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),b},this.getLightPresetIndex=function(a){for(var b=Autodesk.Viewing.Private,c=0;c<b.LightPresets.length;c++)if(b.LightPresets[c].name===a)return c;return-1},this.applyFilter=function(a,b){if(b!==!0)for(var c in a)if(a.hasOwnProperty(c)){var d=b[c];void 0===d?(delete a[c],stderr("[applyFilter] C - skipping key ["+c+"] from viewerState; unspecified in filter.")):"boolean"==typeof d?d===!1&&(delete a[c],stderr("[applyFilter] D - skipping key ["+c+"] from viewerState; explicit filtering.")):d instanceof Object?a[c]instanceof Object?this.applyFilter(a[c],b[c]):stderr("[applyFilter] A - Invalid filter Object for key ["+c+"]"):stderr("[applyFilter] B - Invalid filter value for key ["+c+"]")}}},Autodesk.Viewing.Private.ViewerState.prototype.constructor=Autodesk.Viewing.Private.ViewerState,AutodeskNamespace("Autodesk.Viewing.i18n"),function(){function a(a,b){if(!b||"function"==typeof b)return a;for(var c in b)a[c]=b[c];return a}function b(a,b,c){var d,e=0,f=a.length,g=void 0===f||"[object Array]"!==Object.prototype.toString.apply(a)||"function"==typeof a;if(c)if(g){for(d in a)if(b.apply(a[d],c)===!1)break}else for(;f>e&&b.apply(a[e++],c)!==!1;);else if(g){for(d in a)if(b.call(a[d],d,a[d])===!1)break}else for(;f>e&&b.call(a[e],e,a[e++])!==!1;);return a}function c(a){return"string"==typeof a?a.replace(/[&<>"'\/]/g,function(a){return H[a]}):a}function d(a){var b=function(a){if(window.XMLHttpRequest)return a(null,new XMLHttpRequest);if(window.ActiveXObject)try{return a(null,new ActiveXObject("Msxml2.XMLHTTP"))}catch(b){return a(null,new ActiveXObject("Microsoft.XMLHTTP"))}return a(new Error)},c=function(a){if("string"==typeof a)return a;var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},d=function(a){a=a.replace(/\r\n/g,"\n");for(var b="",c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b+=String.fromCharCode(d):d>127&&2048>d?(b+=String.fromCharCode(d>>6|192),b+=String.fromCharCode(63&d|128)):(b+=String.fromCharCode(d>>12|224),b+=String.fromCharCode(d>>6&63|128),b+=String.fromCharCode(63&d|128))}return b},e=function(a){var b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a=d(a);var c,e,f,g,h,i,j,k="",l=0;do c=a.charCodeAt(l++),e=a.charCodeAt(l++),f=a.charCodeAt(l++),g=c>>2,h=(3&c)<<4|e>>4,i=(15&e)<<2|f>>6,j=63&f,isNaN(e)?i=j=64:isNaN(f)&&(j=64),k+=b.charAt(g)+b.charAt(h)+b.charAt(i)+b.charAt(j),c=e=f="",g=h=i=j="";while(l<a.length);return k},f=function(){for(var a=arguments[0],b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d])}return a},g=function(a,d,e,h){"function"==typeof e&&(h=e,e={}),e.doNotCache=e.doNotCache||!1,e.data=e.data||{},e.headers=e.headers||{},e.jsonp=e.jsonp||!1,e.async=void 0===e.async?!0:e.async;var i,j=f({accept:"*/*","content-type":"application/x-www-form-urlencoded;charset=UTF-8"},g.headers,e.headers);if(i="application/json"===j["content-type"]?JSON.stringify(e.data):c(e.data),"GET"===a){var k=[];if(i&&(k.push(i),i=null),e.doNotCache&&k.push("_="+(new Date).getTime()),e.jsonp&&(k.push("callback="+e.jsonp),k.push("jsonp="+e.jsonp)),k=k.join("&"),k.length>1&&(d+=d.indexOf("?")>-1?"&"+k:"?"+k),e.jsonp){var l=document.getElementsByTagName("head")[0],m=document.createElement("script");return m.type="text/javascript",m.src=d,void l.appendChild(m)}}b(function(b,c){if(b)return h(b);c.open(a,d,e.async);for(var f in j)j.hasOwnProperty(f)&&c.setRequestHeader(f,j[f]);c.onreadystatechange=function(){if(4===c.readyState){var a=c.responseText||"";if(!h)return;h(c.status,a)}},c.send(i)})},h={authBasic:function(a,b){g.headers.Authorization="Basic "+e(a+":"+b)},connect:function(a,b,c){return g("CONNECT",a,b,c)},del:function(a,b,c){return g("DELETE",a,b,c)},get:function(a,b,c){return g("GET",a,b,c)},head:function(a,b,c){return g("HEAD",a,b,c)},headers:function(a){g.headers=a||{}},isAllowed:function(a,b,c){this.options(a,function(a,d){c(-1!==d.text().indexOf(b))})},options:function(a,b,c){return g("OPTIONS",a,b,c)},patch:function(a,b,c){return g("PATCH",a,b,c)},post:function(a,b,c){return g("POST",a,b,c)},put:function(a,b,c){return g("PUT",a,b,c)},trace:function(a,b,c){return g("TRACE",a,b,c)}},i=a.type?a.type.toLowerCase():"get";h[i](a.url,a,function(b,c){200===b?a.success(c,b,null):a.error(c,b,null)})}function e(a,b){"function"==typeof a&&(b=a,a={}),a=a||{},L.extend(G,a),delete G.fixLng,"string"==typeof G.ns&&(G.ns={namespaces:[G.ns],defaultNs:G.ns}),"string"==typeof G.fallbackNS&&(G.fallbackNS=[G.fallbackNS]),("string"==typeof G.fallbackLng||"boolean"==typeof G.fallbackLng)&&(G.fallbackLng=[G.fallbackLng]),G.interpolationPrefixEscaped=L.regexEscape(G.interpolationPrefix),G.interpolationSuffixEscaped=L.regexEscape(G.interpolationSuffix),G.lng||(G.lng=L.detectLanguage()),G.lng?G.useCookie&&L.cookie.create(G.cookieName,G.lng,G.cookieExpirationTime,G.cookieDomain):(G.lng=G.fallbackLng[0],G.useCookie&&L.cookie.remove(G.cookieName)),E=L.toLanguages(G.lng),y=E[0],L.log("currentLng set to: "+y);var c=s;if(a.fixLng&&(c=function(a,b){return b=b||{},b.lng=b.lng||c.lng,s(a,b)},c.lng=y),N.setCurrentLng(y),G.resStore)return C=G.resStore,F=!0,void(b&&b(c));var d=L.toLanguages(G.lng);"string"==typeof G.preload&&(G.preload=[G.preload]);for(var e=0,f=G.preload.length;f>e;e++)for(var g=L.toLanguages(G.preload[e]),h=0,i=g.length;i>h;h++)d.indexOf(g[h])<0&&d.push(g[h]);Autodesk.Viewing.i18n.sync.load(d,G,function(a,d){C=d,F=!0,b&&b(c)})}function f(a,b){"string"==typeof a&&(a=[a]);for(var c=0,d=a.length;d>c;c++)G.preload.indexOf(a[c])<0&&G.preload.push(a[c]);return e(b)}function g(a,b,c){"string"!=typeof b?(c=b,b=G.ns.defaultNs):G.ns.namespaces.indexOf(b)<0&&G.ns.namespaces.push(b),C[a]=C[a]||{},C[a][b]=C[a][b]||{},L.extend(C[a][b],c)}function h(a,b){"string"!=typeof b&&(b=G.ns.defaultNs),C[a]=C[a]||{},C[a][b]={}}function i(a){G.ns.defaultNs=a}function j(a,b){k([a],b)}function k(a,b){var c={dynamicLoad:G.dynamicLoad,resGetPath:G.resGetPath,getAsync:G.getAsync,customLoad:G.customLoad,ns:{namespaces:a,defaultNs:""}},d=L.toLanguages(G.lng);"string"==typeof G.preload&&(G.preload=[G.preload]);for(var e=0,f=G.preload.length;f>e;e++)for(var g=L.toLanguages(G.preload[e]),h=0,i=g.length;i>h;h++)d.indexOf(g[h])<0&&d.push(g[h]);for(var j=[],k=0,l=d.length;l>k;k++){var m=!1,n=C[d[k]];if(n)for(var o=0,p=a.length;p>o;o++)n[a[o]]||(m=!0);else m=!0;m&&j.push(d[k])}j.length?B.sync._fetch(j,c,function(c,d){var e=a.length*j.length;L.each(a,function(a,c){G.ns.namespaces.indexOf(c)<0&&G.ns.namespaces.push(c),L.each(j,function(a,f){C[f]=C[f]||{},C[f][c]=d[f][c],e--,0===e&&b&&(G.useLocalStorage&&B.sync._storeLocal(C),b())})})}):b&&b()}function l(a,b,c){return"function"==typeof b?(c=b,b={}):b||(b={}),b.lng=a,e(b,c)}function m(){return y}function n(a,b,c,d){if(!a)return a;if(d=d||b,a.indexOf(d.interpolationPrefix||G.interpolationPrefix)<0)return a;var e=d.interpolationPrefix?L.regexEscape(d.interpolationPrefix):G.interpolationPrefixEscaped,f=d.interpolationSuffix?L.regexEscape(d.interpolationSuffix):G.interpolationSuffixEscaped,g="HTML"+f;return L.each(b,function(b,h){var i=c?c+G.keyseparator+b:b;"object"==typeof h&&null!==h?a=n(a,h,i,d):d.escapeInterpolation||G.escapeInterpolation?(a=a.replace(new RegExp([e,i,g].join(""),"g"),h),a=a.replace(new RegExp([e,i,f].join(""),"g"),L.escape(h))):a=a.replace(new RegExp([e,i,f].join(""),"g"),h)}),a}function o(a,b){var c=",",d="{",e="}",f=L.extend({},b);for(delete f.postProcess;-1!=a.indexOf(G.reusePrefix)&&(D++,!(D>G.maxRecursion));){var g=a.lastIndexOf(G.reusePrefix),h=a.indexOf(G.reuseSuffix,g)+G.reuseSuffix.length,i=a.substring(g,h),j=i.replace(G.reusePrefix,"").replace(G.reuseSuffix,"");if(-1!=j.indexOf(c)){var k=j.indexOf(c);if(-1!=j.indexOf(d,k)&&-1!=j.indexOf(e,k)){var l=j.indexOf(d,k),m=j.indexOf(e,l)+e.length;try{f=L.extend(f,JSON.parse(j.substring(l,m))),j=j.substring(0,k)}catch(n){}}}var o=v(j,f);a=a.replace(i,o)}return a}function p(a){return a.context&&("string"==typeof a.context||"number"==typeof a.context)}function q(a){return void 0!==a.count&&"string"!=typeof a.count&&1!==a.count}function r(a,b){b=b||{};var c=t(a,b),d=w(a,b);return void 0!==d||d===c}function s(a,b){if(b=b||{},!F){L.log("i18next not finished initialization. you might have called t function before loading resources finished.");var c=a.indexOf(":");0>c?c=0:c++;var d=b.defaultValue||a.substr(c);return d&&(d=n(d,b)),d}return D=0,v.apply(null,arguments)}function t(a,b){return void 0!==b.defaultValue?b.defaultValue:a}function u(){for(var a=[],b=1;b<arguments.length;b++)a.push(arguments[b]);return{postProcess:"sprintf",sprintf:a}}function v(a,b){if(b&&"object"!=typeof b?"sprintf"===G.shortcutFunction?b=u.apply(null,arguments):"defaultValue"===G.shortcutFunction&&(b={defaultValue:b}):b=b||{},void 0===a||null===a)return"";"string"==typeof a&&(a=[a]);var c=a[0];if(a.length>1)for(var d=0;d<a.length&&(c=a[d],!r(c,b));d++);var e,f=t(c,b),g=w(c,b),h=b.lng?L.toLanguages(b.lng):E,i=b.ns||G.ns.defaultNs;c.indexOf(G.nsseparator)>-1&&(e=c.split(G.nsseparator),i=e[0],c=e[1]),void 0===g&&G.sendMissing&&(b.lng?M.postMissing(h[0],i,c,f,h):M.postMissing(G.lng,i,c,f,h));var j=b.postProcess||G.postProcess;void 0!==g&&j&&O[j]&&(g=O[j](g,c,b));var k=f;if(f.indexOf(G.nsseparator)>-1&&(e=f.split(G.nsseparator),k=e[1]),k===c&&G.parseMissingKey&&(f=G.parseMissingKey(f)),void 0===g&&(f=n(f,b),f=o(f,b),j&&O[j])){var l=t(c,b);g=O[j](l,c,b)}return void 0!==g?g:f}function w(a,b){b=b||{};var c,d,e=t(a,b),f=E;if(!C)return e;if("cimode"===f[0].toLowerCase())return e;if(b.lng&&(f=L.toLanguages(b.lng),!C[f[0]])){var g=G.getAsync;G.getAsync=!1,Autodesk.Viewing.i18n.sync.load(f,G,function(a,b){L.extend(C,b),G.getAsync=g})}var h=b.ns||G.ns.defaultNs;if(a.indexOf(G.nsseparator)>-1){var i=a.split(G.nsseparator);h=i[0],a=i[1]}if(p(b)){c=L.extend({},b),delete c.context,c.defaultValue=G.contextNotFound;var j=h+G.nsseparator+a+"_"+b.context;if(d=s(j,c),d!=G.contextNotFound)return n(d,{context:b.context})}if(q(b)){c=L.extend({},b),delete c.count,c.defaultValue=G.pluralNotFound;var k=h+G.nsseparator+a+G.pluralSuffix,l=N.get(f[0],b.count);if(l>=0?k=k+"_"+l:1===l&&(k=h+G.nsseparator+a),d=s(k,c),d!=G.pluralNotFound)return n(d,{count:b.count,interpolationPrefix:b.interpolationPrefix,interpolationSuffix:b.interpolationSuffix})}for(var m,r=a.split(G.keyseparator),u=0,x=f.length;x>u&&void 0===m;u++){for(var y=f[u],z=0,A=C[y]&&C[y][h];r[z];)A=A&&A[r[z]],z++;if(void 0!==A){var B=Object.prototype.toString.apply(A);if("string"==typeof A)A=n(A,b),A=o(A,b);else if("[object Array]"!==B||G.returnObjectTrees||b.returnObjectTrees){if(null===A&&G.fallbackOnNull===!0)A=void 0;else if(null!==A)if(G.returnObjectTrees||b.returnObjectTrees){if("[object Number]"!==B&&"[object Function]"!==B&&"[object RegExp]"!==B){var D="[object Array]"===B?[]:{};L.each(A,function(c){D[c]=v(h+G.nsseparator+a+G.keyseparator+c,b)}),A=D}}else G.objectTreeKeyHandler&&"function"==typeof G.objectTreeKeyHandler?A=G.objectTreeKeyHandler(a,A,y,h,b):(A="key '"+h+":"+a+" ("+y+")' returned an object instead of string.",L.log(A))}else A=A.join("\n"),A=n(A,b),A=o(A,b);"string"==typeof A&&""===A.trim()&&G.fallbackOnEmpty===!0&&(A=void 0),m=A}}if(void 0===m&&!b.isFallbackLookup&&(G.fallbackToDefaultNS===!0||G.fallbackNS&&G.fallbackNS.length>0))if(b.isFallbackLookup=!0,G.fallbackNS.length){for(var F=0,H=G.fallbackNS.length;H>F;F++)if(m=w(G.fallbackNS[F]+G.nsseparator+a,b)){var I=m.indexOf(G.nsseparator)>-1?m.split(G.nsseparator)[1]:m,J=e.indexOf(G.nsseparator)>-1?e.split(G.nsseparator)[1]:e;if(I!==J)break}}else m=w(a,b);return m}function x(){var a,b=[];if("undefined"!=typeof window&&(!function(){for(var a=window.location.search.substring(1),c=a.split("&"),d=0;d<c.length;d++){var e=c[d].indexOf("=");if(e>0){var f=c[d].substring(0,e),g=c[d].substring(e+1);b[f]=g}}}(),b[G.detectLngQS]&&(a=b[G.detectLngQS])),!a&&"undefined"!=typeof document&&G.useCookie){var c=L.cookie.read(G.cookieName);c&&(a=c)}return a||"undefined"==typeof navigator||(a=navigator.language?navigator.language:navigator.userLanguage),a}Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null==this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!=d?d=0:0!=d&&d!=1/0&&d!=-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var y,z=this,A=z.jQuery||z.Zepto,B={},C={},D=0,E=[],F=!1;"undefined"!=typeof module&&module.exports?module.exports=B:(A&&(A.i18n=A.i18n||B),z.i18n=z.i18n||B);var G={lng:void 0,load:"current",preload:[],lowerCaseLng:!1,returnObjectTrees:!1,fallbackLng:["dev"],fallbackNS:[],detectLngQS:"setLng",ns:"translation",fallbackOnNull:!0,fallbackOnEmpty:!1,fallbackToDefaultNS:!1,nsseparator:":",keyseparator:".",selectorAttr:"data-i18n",debug:!1,resGetPath:"res/locales/__lng__/__ns__.json",resPostPath:"res/locales/add/__lng__/__ns__",getAsync:!0,postAsync:!0,resStore:void 0,useLocalStorage:!1,localStorageExpirationTime:6048e5,dynamicLoad:!1,sendMissing:!1,sendMissingTo:"fallback",sendType:"POST",interpolationPrefix:"__",interpolationSuffix:"__",reusePrefix:"$t(",reuseSuffix:")",pluralSuffix:"_plural",pluralNotFound:["plural_not_found",Math.random()].join(""),contextNotFound:["context_not_found",Math.random()].join(""),escapeInterpolation:!1,defaultValueFromContent:!0,useDataAttrOptions:!1,cookieExpirationTime:void 0,useCookie:!0,cookieName:"i18next",cookieDomain:void 0,objectTreeKeyHandler:void 0,postProcess:void 0,parseMissingKey:void 0,shortcutFunction:"sprintf"},H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},I=function(a){for(var b,c,d=!1,e=!1,f="",g=0;g<a.length;g++)if(b=a[g],c=a[g+1],e||"\\"===a[g-1]||'"'!==b||(d=!d),d)f+=b;else{if(e||b+c!=="//")if("single"===e&&b+c==="\r\n")e=!1,g++;else if("single"===e&&"\n"===b)e=!1;else{if(!e&&b+c==="/*"){e="multi",g++;continue}if("multi"===e&&b+c==="*/"){e=!1,g++;continue}}else e="single",g++;e||(f+=b)}return f},J={create:function(a,b,c,d){var e;if(c){var f=new Date;f.setTime(f.getTime()+60*c*1e3),e="; expires="+f.toGMTString()}else e="";d=d?"domain="+d+";":"",document.cookie=a+"="+b+e+";"+d+"path=/"},read:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},remove:function(a){this.create(a,"",-1)}},K={create:function(a,b,c,d){},read:function(a){return null},remove:function(a){}},L={extend:A?A.extend:a,each:A?A.each:b,ajax:A?A.ajax:"undefined"!=typeof document?d:function(){},cookie:"undefined"!=typeof document?J:K,detectLanguage:x,escape:c,log:function(a){G.debug&&"undefined"!=typeof console&&console.log(a)},toLanguages:function(a){var b=[];if("string"==typeof a&&a.indexOf("-")>-1){var c=a.split("-");a=G.lowerCaseLng?c[0].toLowerCase()+"-"+c[1].toLowerCase():c[0].toLowerCase()+"-"+c[1].toUpperCase(),"unspecific"!==G.load&&b.push(a),"current"!==G.load&&b.push(c[0])}else b.push(a);for(var d=0;d<G.fallbackLng.length;d++)-1===b.indexOf(G.fallbackLng[d])&&G.fallbackLng[d]&&b.push(G.fallbackLng[d]);return b},regexEscape:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}};L.applyReplacement=n;var M={load:function(a,b,c){b.useLocalStorage?M._loadLocal(a,b,function(d,e){for(var f=[],g=0,h=a.length;h>g;g++)e[a[g]]||f.push(a[g]);f.length>0?M._fetch(f,b,function(a,b){L.extend(e,b),M._storeLocal(b),c(null,e)}):c(null,e)}):M._fetch(a,b,function(a,b){c(null,b)})},_loadLocal:function(a,b,c){var d={},e=(new Date).getTime();if(window.localStorage){var f=a.length;L.each(a,function(a,g){var h=window.localStorage.getItem("res_"+g);h&&(h=JSON.parse(h),h.i18nStamp&&h.i18nStamp+b.localStorageExpirationTime>e&&(d[g]=h)),f--,0===f&&c(null,d)})}},_storeLocal:function(a){if(window.localStorage)for(var b in a)a[b].i18nStamp=(new Date).getTime(),window.localStorage.setItem("res_"+b,JSON.stringify(a[b]))},_fetch:function(a,b,c){var d=b.ns,e={};if(b.dynamicLoad){var f=function(a,b){c(null,b)};if("function"==typeof b.customLoad)b.customLoad(a,d.namespaces,b,f);else{var g=n(b.resGetPath,{lng:a.join("+"),ns:d.namespaces.join("+")});g=Autodesk.Viewing.Private.getResourceUrl(g),L.ajax({url:g,success:function(a,b,c){L.log("loaded: "+g),f(null,a.json())},error:function(a,b,c){L.log("failed loading: "+g),f("failed loading resource.json error: "+c)},dataType:"text",async:b.getAsync})}}else{var h,i=d.namespaces.length*a.length;L.each(d.namespaces,function(d,f){L.each(a,function(a,d){var g=function(a,b){a&&(h=h||[],h.push(a)),e[d]=e[d]||{},e[d][f]=b,i--,0===i&&c(h,e)};"function"==typeof b.customLoad?b.customLoad(d,f,b,g):M._fetchOne(d,f,b,g)})})}},_fetchOne:function(a,b,c,d){var e=n(c.resGetPath,{lng:a,ns:b});e=Autodesk.Viewing.Private.getResourceUrl(e),L.ajax({url:e,success:function(a,b,c){L.log("loaded: "+e);var f=I(a);d(null,JSON.parse(f))},error:function(a,b,c){if(b&&200==b||a&&a.status&&200==a.status)L.log("There is a typo in: "+e);else if(b&&404==b||a&&a.status&&404==a.status)L.log("Does not exist: "+e);else{var f=b?b:a&&a.status?a.status:null;L.log(f+" when loading "+e)}d(c,{})},dataType:"text",async:c.getAsync})},postMissing:function(a,b,c,d,e){var f={};f[c]=d;var g=[];if("fallback"===G.sendMissingTo&&G.fallbackLng[0]!==!1)for(var h=0;h<G.fallbackLng.length;h++)g.push({lng:G.fallbackLng[h],url:n(G.resPostPath,{lng:G.fallbackLng[h],ns:b})});else if("current"===G.sendMissingTo||"fallback"===G.sendMissingTo&&G.fallbackLng[0]===!1)g.push({lng:a,url:n(G.resPostPath,{lng:a,ns:b})});else if("all"===G.sendMissingTo)for(var h=0,i=e.length;i>h;h++)g.push({lng:e[h],url:n(G.resPostPath,{lng:e[h],ns:b})});for(var j=0,k=g.length;k>j;j++){var l=g[j];L.ajax({url:l.url,type:G.sendType,data:f,success:function(a,e,f){L.log("posted missing key '"+c+"' to: "+l.url);for(var g=c.split("."),h=0,i=C[l.lng][b];g[h];)i=h===g.length-1?i[g[h]]=d:i[g[h]]=i[g[h]]||{},h++},error:function(a,b,d){L.log("failed posting missing key '"+c+"' to: "+l.url)},dataType:"json",async:G.postAsync})}}},N={rules:{ach:{name:"Acholi",numbers:[1,2],plurals:function(a){return Number(a>1)}},af:{name:"Afrikaans",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ak:{name:"Akan",numbers:[1,2],plurals:function(a){return Number(a>1)}},am:{name:"Amharic",numbers:[1,2],plurals:function(a){return Number(a>1)}},an:{name:"Aragonese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ar:{name:"Arabic",numbers:[0,1,2,3,11,100],plurals:function(a){return Number(0===a?0:1==a?1:2==a?2:a%100>=3&&10>=a%100?3:a%100>=11?4:5)}},arn:{name:"Mapudungun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ast:{name:"Asturian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ay:{name:"Aymar",numbers:[1],plurals:function(a){return 0}},az:{name:"Azerbaijani",numbers:[1,2],plurals:function(a){return Number(1!=a)}},be:{name:"Belarusian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},bg:{name:"Bulgarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bn:{name:"Bengali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},bo:{name:"Tibetan",numbers:[1],plurals:function(a){return 0}},br:{name:"Breton",numbers:[1,2],plurals:function(a){return Number(a>1)}},bs:{name:"Bosnian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},ca:{name:"Catalan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},cgg:{name:"Chiga",numbers:[1],plurals:function(a){return 0}},cs:{name:"Czech",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&4>=a?1:2)}},csb:{name:"Kashubian",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},cy:{name:"Welsh",numbers:[1,2,3,8],plurals:function(a){return Number(1==a?0:2==a?1:8!=a&&11!=a?2:3)}},da:{name:"Danish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},de:{name:"German",numbers:[1,2],plurals:function(a){return Number(1!=a)}},dz:{name:"Dzongkha",numbers:[1],plurals:function(a){return 0}},el:{name:"Greek",numbers:[1,2],plurals:function(a){return Number(1!=a)}},en:{name:"English",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eo:{name:"Esperanto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es:{name:"Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},es_ar:{name:"Argentinean Spanish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},et:{name:"Estonian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},eu:{name:"Basque",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fa:{name:"Persian",numbers:[1],plurals:function(a){return 0}},fi:{name:"Finnish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fil:{name:"Filipino",numbers:[1,2],plurals:function(a){return Number(a>1)}},fo:{name:"Faroese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fr:{name:"French",numbers:[1,2],plurals:function(a){return Number(a>1)}},fur:{name:"Friulian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},fy:{name:"Frisian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ga:{name:"Irish",numbers:[1,2,3,7,11],
plurals:function(a){return Number(1==a?0:2==a?1:7>a?2:11>a?3:4)}},gd:{name:"Scottish Gaelic",numbers:[1,2,3,20],plurals:function(a){return Number(1==a||11==a?0:2==a||12==a?1:a>2&&20>a?2:3)}},gl:{name:"Galician",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gu:{name:"Gujarati",numbers:[1,2],plurals:function(a){return Number(1!=a)}},gun:{name:"Gun",numbers:[1,2],plurals:function(a){return Number(a>1)}},ha:{name:"Hausa",numbers:[1,2],plurals:function(a){return Number(1!=a)}},he:{name:"Hebrew",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hi:{name:"Hindi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hr:{name:"Croatian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},hu:{name:"Hungarian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},hy:{name:"Armenian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ia:{name:"Interlingua",numbers:[1,2],plurals:function(a){return Number(1!=a)}},id:{name:"Indonesian",numbers:[1],plurals:function(a){return 0}},is:{name:"Icelandic",numbers:[1,2],plurals:function(a){return Number(a%10!=1||a%100==11)}},it:{name:"Italian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ja:{name:"Japanese",numbers:[1],plurals:function(a){return 0}},jbo:{name:"Lojban",numbers:[1],plurals:function(a){return 0}},jv:{name:"Javanese",numbers:[0,1],plurals:function(a){return Number(0!==a)}},ka:{name:"Georgian",numbers:[1],plurals:function(a){return 0}},kk:{name:"Kazakh",numbers:[1],plurals:function(a){return 0}},km:{name:"Khmer",numbers:[1],plurals:function(a){return 0}},kn:{name:"Kannada",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ko:{name:"Korean",numbers:[1],plurals:function(a){return 0}},ku:{name:"Kurdish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},kw:{name:"Cornish",numbers:[1,2,3,4],plurals:function(a){return Number(1==a?0:2==a?1:3==a?2:3)}},ky:{name:"Kyrgyz",numbers:[1],plurals:function(a){return 0}},lb:{name:"Letzeburgesch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ln:{name:"Lingala",numbers:[1,2],plurals:function(a){return Number(a>1)}},lo:{name:"Lao",numbers:[1],plurals:function(a){return 0}},lt:{name:"Lithuanian",numbers:[1,2,10],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&(10>a%100||a%100>=20)?1:2)}},lv:{name:"Latvian",numbers:[1,2,0],plurals:function(a){return Number(a%10==1&&a%100!=11?0:0!==a?1:2)}},mai:{name:"Maithili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mfe:{name:"Mauritian Creole",numbers:[1,2],plurals:function(a){return Number(a>1)}},mg:{name:"Malagasy",numbers:[1,2],plurals:function(a){return Number(a>1)}},mi:{name:"Maori",numbers:[1,2],plurals:function(a){return Number(a>1)}},mk:{name:"Macedonian",numbers:[1,2],plurals:function(a){return Number(1==a||a%10==1?0:1)}},ml:{name:"Malayalam",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mn:{name:"Mongolian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},mnk:{name:"Mandinka",numbers:[0,1,2],plurals:function(a){return Number(1==a?1:2)}},mr:{name:"Marathi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ms:{name:"Malay",numbers:[1],plurals:function(a){return 0}},mt:{name:"Maltese",numbers:[1,2,11,20],plurals:function(a){return Number(1==a?0:0===a||a%100>1&&11>a%100?1:a%100>10&&20>a%100?2:3)}},nah:{name:"Nahuatl",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nap:{name:"Neapolitan",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nb:{name:"Norwegian Bokmal",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ne:{name:"Nepali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nl:{name:"Dutch",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nn:{name:"Norwegian Nynorsk",numbers:[1,2],plurals:function(a){return Number(1!=a)}},no:{name:"Norwegian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},nso:{name:"Northern Sotho",numbers:[1,2],plurals:function(a){return Number(1!=a)}},oc:{name:"Occitan",numbers:[1,2],plurals:function(a){return Number(a>1)}},or:{name:"Oriya",numbers:[2,1],plurals:function(a){return Number(1!=a)}},pa:{name:"Punjabi",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pap:{name:"Papiamento",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pl:{name:"Polish",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},pms:{name:"Piemontese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ps:{name:"Pashto",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt:{name:"Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},pt_br:{name:"Brazilian Portuguese",numbers:[1,2],plurals:function(a){return Number(1!=a)}},rm:{name:"Romansh",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ro:{name:"Romanian",numbers:[1,2,20],plurals:function(a){return Number(1==a?0:0===a||a%100>0&&20>a%100?1:2)}},ru:{name:"Russian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},sah:{name:"Yakut",numbers:[1],plurals:function(a){return 0}},sco:{name:"Scots",numbers:[1,2],plurals:function(a){return Number(1!=a)}},se:{name:"Northern Sami",numbers:[1,2],plurals:function(a){return Number(1!=a)}},si:{name:"Sinhala",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sk:{name:"Slovak",numbers:[1,2,5],plurals:function(a){return Number(1==a?0:a>=2&&4>=a?1:2)}},sl:{name:"Slovenian",numbers:[5,1,2,3],plurals:function(a){return Number(a%100==1?1:a%100==2?2:a%100==3||a%100==4?3:0)}},so:{name:"Somali",numbers:[1,2],plurals:function(a){return Number(1!=a)}},son:{name:"Songhay",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sq:{name:"Albanian",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sr:{name:"Serbian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},su:{name:"Sundanese",numbers:[1],plurals:function(a){return 0}},sv:{name:"Swedish",numbers:[1,2],plurals:function(a){return Number(1!=a)}},sw:{name:"Swahili",numbers:[1,2],plurals:function(a){return Number(1!=a)}},ta:{name:"Tamil",numbers:[1,2],plurals:function(a){return Number(1!=a)}},te:{name:"Telugu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tg:{name:"Tajik",numbers:[1,2],plurals:function(a){return Number(a>1)}},th:{name:"Thai",numbers:[1],plurals:function(a){return 0}},ti:{name:"Tigrinya",numbers:[1,2],plurals:function(a){return Number(a>1)}},tk:{name:"Turkmen",numbers:[1,2],plurals:function(a){return Number(1!=a)}},tr:{name:"Turkish",numbers:[1,2],plurals:function(a){return Number(a>1)}},tt:{name:"Tatar",numbers:[1],plurals:function(a){return 0}},ug:{name:"Uyghur",numbers:[1],plurals:function(a){return 0}},uk:{name:"Ukrainian",numbers:[1,2,5],plurals:function(a){return Number(a%10==1&&a%100!=11?0:a%10>=2&&4>=a%10&&(10>a%100||a%100>=20)?1:2)}},ur:{name:"Urdu",numbers:[1,2],plurals:function(a){return Number(1!=a)}},uz:{name:"Uzbek",numbers:[1,2],plurals:function(a){return Number(a>1)}},vi:{name:"Vietnamese",numbers:[1],plurals:function(a){return 0}},wa:{name:"Walloon",numbers:[1,2],plurals:function(a){return Number(a>1)}},wo:{name:"Wolof",numbers:[1],plurals:function(a){return 0}},yo:{name:"Yoruba",numbers:[1,2],plurals:function(a){return Number(1!=a)}},zh:{name:"Chinese",numbers:[1],plurals:function(a){return 0}}},addRule:function(a,b){N.rules[a]=b},setCurrentLng:function(a){if(!N.currentRule||N.currentRule.lng!==a){var b=a.split("-");N.currentRule={lng:a,rule:N.rules[b[0]]}}},get:function(a,b){function c(b,c){var d;if(d=N.currentRule&&N.currentRule.lng===a?N.currentRule.rule:N.rules[b]){var e=d.plurals(c),f=d.numbers[e];return 2===d.numbers.length&&1===d.numbers[0]&&(2===f?f=-1:1===f&&(f=1)),f}return 1===c?"1":"-1"}var d=a.split("-");return c(d[0],b)}},O={},P=function(a,b){O[a]=b},Q=function(){function a(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()}function b(a,b){for(var c=[];b>0;c[--b]=a);return c.join("")}var c=function(){return c.cache.hasOwnProperty(arguments[0])||(c.cache[arguments[0]]=c.parse(arguments[0])),c.format.call(null,c.cache[arguments[0]],arguments)};return c.format=function(c,d){var e,f,g,h,i,j,k,l=1,m=c.length,n="",o=[];for(f=0;m>f;f++)if(n=a(c[f]),"string"===n)o.push(c[f]);else if("array"===n){if(h=c[f],h[2])for(e=d[l],g=0;g<h[2].length;g++){if(!e.hasOwnProperty(h[2][g]))throw Q('[sprintf] property "%s" does not exist',h[2][g]);e=e[h[2][g]]}else e=h[1]?d[h[1]]:d[l++];if(/[^s]/.test(h[8])&&"number"!=a(e))throw Q("[sprintf] expecting number but found %s",a(e));switch(h[8]){case"b":e=e.toString(2);break;case"c":e=String.fromCharCode(e);break;case"d":e=parseInt(e,10);break;case"e":e=h[7]?e.toExponential(h[7]):e.toExponential();break;case"f":e=h[7]?parseFloat(e).toFixed(h[7]):parseFloat(e);break;case"o":e=e.toString(8);break;case"s":e=(e=String(e))&&h[7]?e.substring(0,h[7]):e;break;case"u":e=Math.abs(e);break;case"x":e=e.toString(16);break;case"X":e=e.toString(16).toUpperCase()}e=/[def]/.test(h[8])&&h[3]&&e>=0?"+"+e:e,j=h[4]?"0"==h[4]?"0":h[4].charAt(1):" ",k=h[6]-String(e).length,i=h[6]?b(j,k):"",o.push(h[5]?e+i:i+e)}return o.join("")},c.cache={},c.parse=function(a){for(var b=a,c=[],d=[],e=0;b;){if(null!==(c=/^[^\x25]+/.exec(b)))d.push(c[0]);else if(null!==(c=/^\x25{2}/.exec(b)))d.push("%");else{if(null===(c=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(b)))throw"[sprintf] huh?";if(c[2]){e|=1;var f=[],g=c[2],h=[];if(null===(h=/^([a-z_][a-z_\d]*)/i.exec(g)))throw"[sprintf] huh?";for(f.push(h[1]);""!==(g=g.substring(h[0].length));)if(null!==(h=/^\.([a-z_][a-z_\d]*)/i.exec(g)))f.push(h[1]);else{if(null===(h=/^\[(\d+)\]/.exec(g)))throw"[sprintf] huh?";f.push(h[1])}c[2]=f}else e|=2;if(3===e)throw"[sprintf] mixing positional and named placeholders is not (yet) supported";d.push(c)}b=b.substring(c[0].length)}return d},c}(),R=function(a,b){return b.unshift(a),Q.apply(null,b)};P("sprintf",function(a,b,c){return c.sprintf?"[object Array]"===Object.prototype.toString.apply(c.sprintf)?R(a,c.sprintf):"object"==typeof c.sprintf?Q(a,c.sprintf):a:a});var S=function(){function a(a){var b,c,d=a.split(/\[|\]/);return 1===d.length?(b=null,c=d[0]):3===d.length&&(b=d[1],c=d[2]),[b,c]}Array.prototype.forEach.call(document.querySelectorAll("[data-i18n]"),function(b){var c=b.getAttribute("data-i18n"),d=a(c),e=d[0],f=d[1],g=Autodesk.Viewing.i18n.translate(f);g?e?b.setAttribute(e,g):b.textContent=g:e?b.setAttribute(e,f):b.textContent=f})};Autodesk.Viewing.i18n.init=e,Autodesk.Viewing.i18n.setLng=l,Autodesk.Viewing.i18n.preload=f,Autodesk.Viewing.i18n.addResourceBundle=g,Autodesk.Viewing.i18n.removeResourceBundle=h,Autodesk.Viewing.i18n.loadNamespace=j,Autodesk.Viewing.i18n.loadNamespaces=k,Autodesk.Viewing.i18n.localize=S,Autodesk.Viewing.i18n.setDefaultNamespace=i,Autodesk.Viewing.i18n.t=s,Autodesk.Viewing.i18n.translate=s,Autodesk.Viewing.i18n.exists=r,Autodesk.Viewing.i18n.detectLanguage=L.detectLanguage,Autodesk.Viewing.i18n.pluralExtensions=N,Autodesk.Viewing.i18n.sync=M,Autodesk.Viewing.i18n.functions=L,Autodesk.Viewing.i18n.lng=m,Autodesk.Viewing.i18n.addPostProcessor=P,Autodesk.Viewing.i18n.options=G}(),function(){"use strict";var a=(Autodesk.Viewing.UI,function(a,b,c,d){this.kMinWdth=100,this.kMinHeight=100,this.visibilityCallbacks=[],this.movedSinceLastClick=!1,this.parentContainer=a,this.container=document.createElement("div"),this.container.id=b,this.container.lastWidth="",this.container.dockRight=!1,this.container.dockBottom=!1,this.titleLabel=c,d=d||{},d.hasOwnProperty("localizeTitle")||(d.localizeTitle=!0),this.options=d,this.container.classList.add("dockingPanel"),a.appendChild(this.container),this.listeners=[],this.initialize(),this.setVisible(!1)});a.prototype.initialize=function(){this.title=this.createTitleBar(this.titleLabel||this.container.id),this.container.appendChild(this.title),this.initializeMoveHandlers(this.title),this.setTitle(this.titleLabel||this.container.id,this.options),this.closer=this.createCloseButton(),this.container.appendChild(this.closer)},a.prototype.uninitialize=function(){for(var a=0;a<this.listeners.length;++a){var b=this.listeners[a];b.target.removeEventListener(b.eventId,b.callback)}this.listeners=[],this.visibilityCallbacks=[],this.parentContainer.removeChild(this.container),this.parentContainer=null,this.container=null,this.title=null,this.closer=null},a.prototype.addVisibilityListener=function(a){this.visibilityCallbacks.push(a)},a.prototype.setVisible=function(a){if(a){var b=this.getContainerBoundingRect();if(this.container.dockRight){var c=b.width,d=300,e=this.container.lastWidth||this.container.style.width;e||(e=this.container.getBoundingClientRect().width),e&&(d=parseInt(e)),this.container.style.left=c-d+"px"}if(this.container.dockBottom){var f=b.height,g=300,h=this.container.lastHeight||this.container.style.height;h||(h=this.container.getBoundingClientRect().height),h&&(g=parseInt(h)),this.container.style.top=f-g+"px"}this.container.style.maxHeight=b.height+"px",this.container.style.maxWidth=b.width+"px",this.container.style.display="block"}else this.container.lastWidth=this.container.style.width,this.container.lastHeight=this.container.style.height,this.container.style.display="none";for(var i=0;i<this.visibilityCallbacks.length;i++)this.visibilityCallbacks[i](a)},a.prototype.isVisible=function(){return"block"===this.container.style.display},a.prototype.visibilityChanged=function(){},a.prototype.initializeMoveHandlers=function(a){function b(a){var b=m.style.minWidth?parseInt(m.style.minWidth):n.kMinWdth,c=m.style.minHeight?parseInt(m.style.minHeight):n.kMinHeight,d=n.getContainerBoundingRect();m.style.maxWidth&&parseInt(m.style.width)>parseInt(m.style.maxWidth)&&(m.style.width=m.style.maxWidth),m.style.maxHeight&&parseInt(m.style.height)>parseInt(m.style.maxHeight)&&(m.style.height=m.style.maxHeight),parseInt(m.style.width)<b&&(m.style.width=b+"px"),parseInt(m.style.height)<c&&(m.style.height=c+"px"),"touchmove"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),k+=a.screenX-g,l+=a.screenY-h,e=i+k,f=j+l;var o=parseInt(m.style.width),p=parseInt(m.style.height);isNaN(o)&&(o=n.container.getBoundingClientRect().width),isNaN(p)&&(p=n.container.getBoundingClientRect().height),5>e&&(e=0),5>f&&(f=0),m.dockRight=!1,m.dockBottom=!1,d.width-5<e+o&&(e=d.width-o,m.dockRight=!0),d.height-5<f+p&&(f=d.height-p,m.dockBottom=!0),m.style.left=e+"px",m.style.top=f+"px",m.style.maxWidth=d.width-e+"px",m.style.maxHeight=d.height-f+"px",g=a.screenX,h=a.screenY,n.onMove(a,e,f)}function c(a){window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",c),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",c),n.onEndMove(a,e,f)}function d(a){"touchstart"===a.type&&(a.screenX=a.touches[0].screenX,a.screenY=a.touches[0].screenY),g=a.screenX,h=a.screenY,k=0,l=0,i=n.container.offsetLeft,j=n.container.offsetTop,window.addEventListener("mousemove",b,!1),window.addEventListener("mouseup",c,!1),window.addEventListener("touchmove",b,!1),window.addEventListener("touchend",c,!1),a.preventDefault(),n.onStartMove(a,i,j)}var e,f,g,h,i,j,k,l,m=this.container,n=this;n.addEventListener(a,"mousedown",d),n.addEventListener(a,"touchstart",d)},a.prototype.initializeCloseHandler=function(a){var b=this;b.addEventListener(a,"click",function(a){b.setVisible(!1)},!1)},a.prototype.createScrollContainer=function(a){var b=document.createElement("div"),c=b.classList;return c.add("dockingPanelScroll"),c.add(a&&a.left?"left":"right"),a&&a.heightAdjustment&&(b.style.height="calc(100% - "+a.heightAdjustment+"px)"),a.marginTop&&(b.style.marginTop=a.marginTop+"px"),b.id=this.container.id+"-scroll-container",this.container.appendChild(b),this.scrollContainer=b,b},a.prototype.createTitleBar=function(a){var b=document.createElement("div");b.className="dockingPanelTitle",b.textContent=a;var c=this;return c.addEventListener(b,"click",function(a){c.movedSinceLastClick||c.onTitleClick(a),c.movedSinceLastClick=!1}),c.addEventListener(b,"dblclick",function(a){c.onTitleDoubleClick(a)}),b},a.prototype.setTitle=function(a,b){b&&b.localizeTitle?(this.title.setAttribute("data-i18n",a),a=Autodesk.Viewing.i18n.translate(a)):this.title.removeAttribute("data-i18n"),this.title.textContent=a},a.prototype.createCloseButton=function(){var a=document.createElement("div");return a.className="dockingPanelClose",a.innerHTML="&times;",this.initializeCloseHandler(a),a},a.prototype.onStartMove=function(a,b,c){},a.prototype.onEndMove=function(a,b,c){},a.prototype.onMove=function(a,b,c){this.movedSinceLastClick=!0},a.prototype.onTitleClick=function(a){},a.prototype.onTitleDoubleClick=function(a){},a.prototype.addEventListener=function(a,b,c){a.addEventListener(b,c),this.listeners.push({target:a,eventId:b,callback:c})},a.prototype.removeEventListener=function(a,b,c){for(var d=0;d<this.listeners.length;++d){var e=this.listeners[d];if(e.target===a&&e.eventId===b&&e.callback===c)return a.removeEventListener(b,c),this.listeners.splice(d,1),!0}return!1},a.prototype.getContentSize=function(){return{height:this.container.clientHeight,width:this.container.clientWidth}},a.prototype.resizeToContent=function(a){if(this.isVisible()){var b=this.getContentSize(),c=b.height,d=this.container.getBoundingClientRect(),e=this.getContainerBoundingRect(),f=75,g=a&&a.maxHeight?a.maxHeight-d.top:e.height-d.top;g-=f,c>g&&(c=g),this.container.style.height=c.toString()+"px"}},a.prototype.getContainerBoundingRect=function(){return this.parentContainer.getBoundingClientRect()},Autodesk.Viewing.UI.DockingPanel=a}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=function(b,c,d,e){a.DockingPanel.call(this,b,c,d,e),this.container.classList.add("modelStructurePanel"),e=e||{},e.heightAdjustment||(e.heightAdjustment=40),e.marginTop||(e.marginTop=0),e.left=!0,this.createScrollContainer(e),this.options=e,this.instanceTree=null,this.tree=null,this.selectedNodes=[],this.uiCreated=!1;var f=this;this.addVisibilityListener(function(a){a&&(f.uiCreated||f.createUI(),f.resizeToContent())})};b.prototype=Object.create(a.DockingPanel.prototype),b.prototype.constructor=b,b.prototype.setModel=function(a,b){this.instanceTree=a,this.modelTitle=b,this.isVisible()?this.createUI():this.uiCreated=!1},b.prototype.createUI=function(){var b=this,c=b.instanceTree;if(c){var d=function(){var c=new a.TreeDelegate;return c.getTreeNodeId=function(a){return"object"==typeof a?(stderr("Object used instead of dbId. Fix it."),a.dbId):a},c.getTreeNodeLabel=function(a){var c=this.getTreeNodeId(a),d=b.instanceTree.getNodeName(c);return d||"Object "+c},c.getTreeNodeClass=function(a){return b.getNodeClass(a)},c.isTreeNodeGroup=function(a){return b.isGroupNode(a)},c.shouldCreateTreeNode=function(a){return b.shouldInclude(a)},c.onTreeNodeClick=function(a,c,d){b.onClick(c,d)},c.onTreeNodeRightClick=function(a,c,d){b.onRightClick(c,d)},c.onTreeNodeDoubleClick=function(a,c,d){b.onDoubleClick(c,d)},c.onTreeNodeIconClick=function(a,c,d){b.onIconClick(c,d)},c.forEachChild=function(a,c){var d=this.getTreeNodeId(a);b.instanceTree.enumNodeChildren(d,c)},c.onTreeNodeHover=function(a,c,d){b.onHover(c,d)},c};b.selectedNodes=[];var e=b.modelTitle;e||b.options&&b.options.defaultTitle&&(e=b.options.defaultTitle);var f={};if(e||(e="Browser",f.localizeTitle=!0),b.setTitle(e,f),b.tree){for(;b.scrollContainer.hasChildNodes();)b.scrollContainer.removeChild(b.scrollContainer.lastChild);b.title.removeEventListener("click",b.onTitleClick),b.title.removeEventListener("dblclick",b.onTitleDoubleClick)}var g,h=this.rootId=c.getRootId(),i=c.getNodeName(h),j=0,k=0;c.enumNodeChildren(h,function(a){k||(g=c.getNodeName(a),j=a),k++});var l=d();this.myDelegate=l;var m=1===k&&i===g,n={excludeRoot:m,localize:!0};b.tree=new a.Tree(l,h,b.scrollContainer,n),b.options&&b.options.hasOwnProperty("startCollapsed")&&!b.options.startCollapsed||(b.tree.setAllCollapsed(!0),b.tree.setCollapsed(h,!1),m&&b.tree.setCollapsed(j,!1)),this.uiCreated=!0}},b.prototype.getNodeLabel=function(a){return this.myDelegate.getNodeLabel(a)},b.prototype.getNodeClass=function(a){return""},b.prototype.isGroupNode=function(a){var b=this.myDelegate.getTreeNodeId(a);return this.instanceTree.getChildCount(b)},b.prototype.shouldInclude=function(a){return!0},b.prototype.onClick=function(a,b){this.setSelection([a])},b.prototype.onDoubleClick=function(a,b){},b.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))},b.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();c.isTreeNodeGroup(a)&&(this.tree.setCollapsed(a,b),this.resizeToContent())},b.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();return b.isTreeNodeGroup(a)?this.tree.isCollapsed(a):!1},b.prototype.onRightClick=function(a,b){},b.prototype.onTitleClick=function(a){},b.prototype.onTitleDoubleClick=function(a){},b.prototype.onHover=function(a,b){},b.prototype.setSelection=function(a){if(this.tree){var b,c;for(b=0;b<this.selectedNodes.length;++b)for(c=this.instanceTree.getNodeParentId(this.selectedNodes[b]);c;)this.tree.removeClass(c,"ancestor-selected"),c=this.instanceTree.getNodeParentId(c);var d=[];for(b=0;b<a.length;++b)for(d.push(a[b]),c=this.instanceTree.getNodeParentId(a[b]);c;)this.tree.addClass(c,"ancestor-selected"),c=this.instanceTree.getNodeParentId(c);this.selectedNodes=a,this.tree.setSelection(d)}},b.prototype.getContentSize=function(){var a=this.tree;if(a){var b=a.getRootContainer();if(b)return{height:b.clientHeight+this.options.heightAdjustment+35,width:b.clientWidth}}return{height:0,width:0}},b.prototype.addClass=function(a,b){return null!==this.tree&&this.tree.addClass(a,b)},b.prototype.removeClass=function(a,b){return null!==this.tree&&this.tree.removeClass(a,b)},Autodesk.Viewing.UI.ModelStructurePanel=b}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=function(b,c,d,e){function f(){function b(a){return"category"===a.type}var c=new a.TreeDelegate;return c.getTreeNodeId=function(a){return a.name+(a.hasOwnProperty("value")?a.value:"")+(a.hasOwnProperty("category")?a.category:"")},c.getTreeNodeClass=function(a){return b(a)?g.getCategoryClass(a):g.getPropertyClass(a)},c.isTreeNodeGroup=function(a){return b(a)},c.onTreeNodeClick=function(a,c,d){b(c)?g.onCategoryClick(c,d):g.onPropertyClick(c,d)},c.onTreeNodeRightClick=function(a,c,d){b(c)?g.onCategoryRightClick(c,d):g.onPropertyRightClick(c,d)},c.onTreeNodeDoubleClick=function(a,c,d){b(c)?g.onCategoryDoubleClick(c,d):g.onPropertyDoubleClick(c,d)},c.onTreeNodeIconClick=function(a,c,d){b(c)?g.onCategoryIconClick(c,d):g.onPropertyIconClick(c,d)},c.createTreeNode=function(a,c,d){var e=null;e=b(a)?g.displayCategory(a,c,d):g.displayProperty(a,c,d),e&&(g.highlightableElements[this.getTreeNodeId(a)]=e)},c}a.DockingPanel.call(this,b,c,d,e),this.container.classList.add("propertyPanel"),this.container.dockRight=!0,this.createScrollContainer({left:!1,heightAdjustment:45,marginTop:0}),this.highlightableElements={};var g=this,h=f();this.tree=new a.Tree(h,null,this.scrollContainer,{})};b.prototype=Object.create(a.DockingPanel.prototype),b.prototype.constructor=b,b.prototype.setProperties=function(a,b){this.removeAllProperties();for(var c=[],d=[],e=0;e<a.length;e++){var f=a[e];if(!f.hidden){var g=a[e].displayCategory;g&&"string"==typeof g&&""!==g?c.push(f):d.push(f)}}if(c.length+d.length===0)return void this.showNoProperties();for(var e=0;e<c.length;e++){var f=c[e],h=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type);this.addProperty(f.displayName,h,f.displayCategory)}for(var i=c.length>0,e=0;e<d.length;e++){var f=d[e],h=Autodesk.Viewing.Private.formatValueWithUnits(f.displayValue,f.units,f.type);this.addProperty(f.displayName,h,i?"Other":"",i?{localizeCategory:!0}:{})}},b.prototype.showNoProperties=function(){this.removeAllProperties();var a=this.tree.myRootContainer,b=document.createElement("div");b.className="noProperties";var c="No properties to display";b.setAttribute("data-i18n",c),b.textContent=Autodesk.Viewing.i18n.translate(c),a.appendChild(b)},b.prototype.showDefaultProperties=function(){this.showNoProperties(),this.resizeToContent()},b.prototype.areDefaultPropertiesShown=function(){return!this.hasProperties()},b.prototype.addProperty=function(a,b,c,d){var e=this.tree.getElementForNode({name:a,value:b,category:c});if(e)return!1;var f=null,g={name:a,value:b,type:"property"};return c?(f=this.tree.getElementForNode({name:c}),f||(f=this.tree.createElement_({name:c,type:"category"},this.tree.myRootContainer,d&&d.localizeCategory?{localize:!0}:null)),g.category=c):f=this.tree.myRootContainer,this.tree.createElement_(g,f,d&&d.localizeProperty?{localize:!0}:null),!0},b.prototype.hasProperties=function(){for(var a in this.highlightableElements)return!0;return!1},b.prototype.removeProperty=function(a,b,c,d){var e={name:a,value:b,category:c},f=this.tree.getElementForNode(e);return f?(delete this.highlightableElements[this.tree.delegate().getTreeNodeId(e)],f.parentNode.removeChild(f),!0):!1},b.prototype.removeAllProperties=function(){this.highlightableElements={},this.tree.clear()},b.prototype.setCategoryCollapsed=function(a,b){var c=this.tree.delegate().getTreeNodeId(a);this.tree.setCollapsed(c,b)},b.prototype.isCategoryCollapsed=function(a){var b=this.tree.delegate().getTreeNodeId(a);return this.tree.isCollapsed(b)},b.prototype.getContentSize=function(){var a=this.tree.myRootContainer;return{height:a.clientHeight+55,width:a.clientWidth}},b.prototype.highlight=function(a,b){function c(b){var c=b.innerHTML,d=c.replace(/(<highlight>|<\/highlight>)/gim,"");if(c!==d&&(b.innerHTML=d),a&&""!==a){var e=new RegExp("(\\b"+a+"\\b)","gim"),f=d.replace(e,"<highlight>$1</highlight>");b.innerHTML=f}}for(var d in this.highlightableElements)for(var e=this.highlightableElements[d],f=0;f<e.length;++f)c(e[f])},b.prototype.displayCategory=function(a,b,c){var d=document.createElement("div"),e=a.name;return c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e,d.title=e,d.className="categoryName",b.appendChild(d),[d]},b.prototype.displayProperty=function(a,b,c){var d=document.createElement("div"),e=a.name;c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e,d.title=e,d.className="propertyName";var f=document.createElement("div");f.className="separator";var g=document.createElement("div");return g.textContent=a.value,g.title=a.value,g.className="propertyValue",b.appendChild(d),b.appendChild(f),b.appendChild(g),[d,g]},b.prototype.getCategoryClass=function(a){return"category"},b.prototype.getPropertyClass=function(a){return"property"},b.prototype.onCategoryClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},b.prototype.onPropertyClick=function(a,b){},b.prototype.onCategoryIconClick=function(a,b){this.setCategoryCollapsed(a,!this.isCategoryCollapsed(a))},b.prototype.onPropertyIconClick=function(a,b){},b.prototype.onCategoryDoubleClick=function(a,b){},b.prototype.onPropertyDoubleClick=function(a,b){},b.prototype.onCategoryRightClick=function(a,b){},b.prototype.onPropertyRightClick=function(a,b){},Autodesk.Viewing.UI.PropertyPanel=b}(),function(){var a=function(a){this.viewer=a,this.menus=[],this.open=!1};a.prototype.constructor=a,a.prototype.show=function(a,b){var c=this.viewer.container.getBoundingClientRect();Array.isArray(a.changedPointers)&&a.changedPointers.length>0&&(a.clientX=a.changedPointers[0].clientX,a.clientY=a.changedPointers[0].clientY);var d=a.clientX-c.left,e=a.clientY-c.top;if(!this.open){var f=this;this.showMenu(b,d,e),this.open=!0,this.hideEventListener=function(a){"menuItem"!==a.target.className&&f.hide(a)},this.isTouch="press"===a.type,document.body.addEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener,!0)}},a.prototype.showMenu=function(a,b,c){var d,e=document.createElement("div"),f=[];e.className="menu",this.viewer.container.appendChild(e),this.menus.push(e);for(var g=0;g<a.length;++g){var h=a[g],i=h.title,j=h.target;d=this.createMenuItem(e,i),"function"==typeof j?this.addCallbackToMenuItem(d,j):Array.isArray(j)?f.push({menuItem:d,target:j}):console.warn("Invalid context menu option:",i,j)}var k=e.getBoundingClientRect(),l=k.width,m=k.height,n=this.viewer.container.getBoundingClientRect(),o=n.width,p=n.height,q=isTouchDevice()&&!this.viewer.navigation.getUseLeftHandedInput();for(q&&(b-=l),0>b&&(b=0),b+l>o&&(b=o-l,0>b&&(b=0)),0>c&&(c=0),c+m>p&&(c=p-m,0>c&&(c=0)),e.style.top=Math.round(c)+"px",e.style.left=Math.round(b)+"px",g=0;g<f.length;++g){var r=f[g];d=r.menuItem,k=d.getBoundingClientRect(),b=Math.round((q?k.left:k.right)-n.left),c=Math.round(k.top-n.top),this.addSubmenuCallbackToMenuItem(d,r.target,b,c)}},a.prototype.createMenuItem=function(a,b){var c=document.createElement("div");return c.className="menuItem",c.setAttribute("data-i18n",b),c.textContent=Autodesk.Viewing.i18n.translate(b),a.appendChild(c),c},a.prototype.addCallbackToMenuItem=function(a,b){var c=this;a.addEventListener("click",function(a){return c.hide(),b(),a.preventDefault(),!1},!1)},a.prototype.addSubmenuCallbackToMenuItem=function(a,b,c,d){var e=this;a.addEventListener("click",function(){e.showMenu(b,c,d)},!1)},a.prototype.hide=function(){if(this.open){for(var a=0;a<this.menus.length;++a)this.menus[a]&&this.menus[a].parentNode.removeChild(this.menus[a]);return this.menus=[],this.open=!1,document.body.removeEventListener(this.isTouch?"touchstart":"mousedown",this.hideEventListener),this.isTouch=!1,!0}return!1},Autodesk.Viewing.Private.ContextMenu=a}(),function(){"use strict";var a=(Autodesk.Viewing.UI,Autodesk.Viewing.Private),b=function(b){this.viewer=b,this.contextMenu=new a.ContextMenu(b)};b.prototype.constructor=b,b.prototype.show=function(a){var b=this.viewer.getSelectionCount(),c=this.viewer.getSelectionVisibility(),d={numSelected:b,hasSelected:b>0,hasVisible:c.hasVisible,hasHidden:c.hasHidden},e=this.buildMenu(a,d);this.viewer.runContextMenuCallbacks(e,d),e&&0<e.length&&this.contextMenu.show(a,e)},b.prototype.hide=function(){return this.contextMenu.hide()},b.prototype.buildMenu=function(a,b){return null},Autodesk.Viewing.UI.ObjectContextMenu=b}(),Autodesk.Viewing.Private.Preferences=function(a,b){function c(){var a=b+"test",c=window.localStorage;try{return c.setItem(a,"1"),c.removeItem(a),!0}catch(d){return!1}}function d(a,c){return k?(a=b+a,"undefined"!=typeof c?localStorage[a]=c:c=localStorage[a],c):void 0}function e(a,b){if("string"!=typeof a||"function"==typeof l[a])return void stderr("Preferences: invalid name="+a);var c=d(a);if(ok=!1,void 0!==c)try{c=JSON.parse(c),ok=!0}catch(e){}l[a]=ok?c:b,h[a]={}}b||(b="Autodesk.Viewing.Preferences.");var f={},g={},h={},i="PrefChanged",j="PrefReset",k=c(),l=this;a.addEventListener(i,function(a){var b=g[a.name];if(b){var c=b.changed;c&&c(a.value)}}),a.addEventListener(j,function(a){for(var b in g)if(g.hasOwnProperty(b)){var c=g[b].reset;c&&c(l[b])}}),this.load=function(a){f=a;for(var b in f)f.hasOwnProperty(b)&&e(b,f[b])},this.tag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(f);for(var c=0;c<b.length;++c)h[b[c]][a]=!0}},this.untag=function(a,b){if(a){b?Array.isArray(b)||(b=[b]):b=Object.keys(f);for(var c=0;c<b.length;++c)h[b[c]][a]=!1}},this.add=function(a,b,c){if(!f.hasOwnProperty(a)){if(f[a]=b,e(a,b),c){Array.isArray(c)||(c=[c]);for(var d=0;d<c.length;++d)this.tag(c[d],a)}return!0}return stderr("Preferences: "+a+" already exists"),!1},this.remove=function(a,c){return f.hasOwnProperty(a)?(delete f[a],delete h[a],delete this[a],c&&k&&(a=b+a,delete localStorage[a]),!0):!1},this.reset=function(b,c){b&&void 0===c&&(c=!0);for(var d in f)if(f.hasOwnProperty(d)){if(b){var e=!!h[d][b];if(c&&!e||!c&&e)continue}this.set(d,f[d],!1)&&a.fireEvent({type:j,name:d,value:this[d]})}},this.get=function(a){return this[a]},this.set=function(b,c,e){if(this[b]!==c){this[b]=c,d(b,c),(void 0===e||e)&&a.fireEvent({type:i,name:b,value:c});var f=Autodesk.Viewing.Private.logger;
return f&&f.log({category:"pref_changed",name:b,value:c}),!0}return!1},this.addListeners=function(a,b,c){g[a]={changed:b,reset:c}},this.removeListeners=function(a){void 0!==g[a]&&delete g[a]}},AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.formatValueWithUnits=function(a,b,c,d){function e(a){var b=a>=0?Math.floor(a):Math.ceil(a),c=a-b;return{intPart:b,fracPart:c}}function f(a,b,c){var d="";return c&&0===a&&(d+="-"),d+=b>0?a.toFixed(b):a.toFixed(0)}function g(a,b,c){for(var d="",g=12,h=1,i=0>a,j=0;b>j;++j)h*=2;a>0?a+=.5/h:a-=.5/h;var k,l;c?l=a:(k=e(a/g).intPart,d+=f(k,0,i)+"' ",l=a-k*g,0>l&&(l=-l));var m=e(l).intPart,n=e((l-m)*h).intPart;if((0===n||0!==m)&&(d+=f(m,0)),0!==n){for(0>m&&0>n&&(n=-n);n%2===0;)n/=2,h/=2;0!==m&&(d+="-"),d+=f(n,0)+"/"+f(h,0)}return d+='"'}function h(a,b){var c="";0>a&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=100*d.fracPart;return c+f(g,0)+" m "+f(h,b)+" cm"}function i(a,b){var c="";0>a&&(c="-",a=Math.abs(a));var d=e(a),g=d.intPart,h=12*d.fracPart;return c+f(g,0)+"' "+f(h,b)+'"'}var j;return void 0===d&&(d=3),1===c?j=Autodesk.Viewing.i18n.translate(a?"Yes":"No"):2!==c&&3!==c||!isNaN(a)?"ft-and-fractional-in"===b?j=g(12*a,d):"ft-and-fractional-in^2"===b?j=g(12*a,d)+" "+String.fromCharCode(178):"ft-and-decimal-in"===b?j=i(a,d):"ft-and-decimal-in^2"===b?j=i(a,d)+" "+String.fromCharCode(178):"decimal-in"===b||"in"===b||"inch"===b?j=f(a,d)+'"':"decimal-in^2"===b||"in^2"===b||"inch^2"===b?j=f(a,d)+'" '+String.fromCharCode(178):"decimal-ft"===b||"ft"===b||"feet"===b||"foot"===b?j=f(a,d)+"'":"decimal-ft^2"===b||"ft^2"===b||"feet^2"===b||"foot^2"===b?j=f(a,d)+"' "+String.fromCharCode(178):"fractional-in"===b?j=g(a,d,!0):"fractional-in^2"===b?j=g(a,d,!0)+" "+String.fromCharCode(178):"m-and-cm"===b?j=h(a,d):"m-and-cm^2"===b?j=h(a,d)+" "+String.fromCharCode(178):3===c&&b?(b=b.replace("^2",String.fromCharCode(178)),b=b.replace("^3",String.fromCharCode(179)),j=f(a,d)+" "+b):j=b?a+" "+b:3===c?f(a,d):a:j="NaN",j},Autodesk.Viewing.Private.convertUnits=function(a,b,c,d){if(a===b)return c;var e=1;switch(b){case"mm":e=1e3;break;case"cm":e=100;break;case"m":e=1;break;case"in":e=39.37007874;break;case"ft":e=3.280839895;break;case"ft-and-fractional-in":e=3.280839895;break;case"ft-and-decimal-in":e=3.280839895;break;case"decimal-in":e=39.37007874;break;case"decimal-ft":e=3.280839895;break;case"fractional-in":e=39.37007874;break;case"m-and-cm":e=1}var f=1;switch(a){case"mm":f=.001;break;case"cm":f=.01;break;case"m":f=1;break;case"in":f=.0254;break;case"ft":f=.3048;break;case"ft-and-fractional-in":f=.3048;break;case"ft-and-decimal-in":f=.3048;break;case"decimal-in":f=.0254;break;case"decimal-ft":f=.3048;break;case"fractional-in":f=.0254;break;case"m-and-cm":f=1}return"square"===d?c*Math.pow(e*f,2):c*e*f},AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;b.OptionSlider=function(b,c,d,e,f){function g(a){a.target!=h.stepperElement&&(h.stepperElement.value=h.sliderElement.value),h.fireChangeEvent()}var h=this;this.tbody=e;var i=f&&f.insertAtIndex?f.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(i);var j=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),this.sliderElement=document.createElement("input"),this.sliderElement.type="range",this.sliderElement.id=b+"_slider",this.sliderElement.min=c,this.sliderElement.max=d,j.appendChild(this.caption),j.appendChild(this.sliderElement),j=this.sliderRow.insertCell(1),this.stepperElement=document.createElement("input"),this.stepperElement.type="number",this.stepperElement.id=b+"_stepper",this.stepperElement.min=c,this.stepperElement.max=d,this.stepperElement.step=1,this.stepperElement.style.width="64px",j.appendChild(this.stepperElement),this.blockEvent=!1,this.stepperElement.addEventListener("change",function(a){a.target!=h.sliderElement&&(h.sliderElement.value=h.stepperElement.value),h.fireChangeEvent()},!1),this.sliderElement.addEventListener("change",g,!1),this.sliderElement.addEventListener("input",g,!1)},b.OptionSlider.prototype.constructor=b.OptionSlider,a.EventDispatcher.prototype.apply(b.OptionSlider.prototype),b.OptionSlider.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.value=this.sliderElement.value;var a=new CustomEvent("change",{detail:{target:this,value:this.sliderElement.value}});this.dispatchEvent(a)}},b.OptionSlider.prototype.setValue=function(a){this.blockEvent=!0,this.value=a,this.sliderElement.value=a,this.stepperElement.value=a,this.blockEvent=!1},b.OptionSlider.prototype.setDisabled=function(a){this.sliderElement.disabled=a,this.stepperElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox=function(b,c,d,e){var f=this;this.tbody=c;var g=e&&e.insertAtIndex?e.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(g);var h=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),h.appendChild(this.caption),h=this.sliderRow.insertCell(1),this.checkElement=document.createElement("input"),this.checkElement.type="checkbox",this.checkElement.id=b+"_check",this.checkElement.checked=d,h.appendChild(this.checkElement),this.blockEvent=!1,this.checked=d,this.checkElement.addEventListener("change",function(a){f.fireChangeEvent()},!1),isTouchDevice()&&(this.sliderRowHammer=new Hammer.Manager(this.sliderRow,{recognizers:[[Hammer.Tap]],inputClass:Hammer.TouchInput}),this.sliderRowHammer.on("tap",function(a){a.preventDefault(),a.target.click()})),this.checkElement.addEventListener("click",function(a){a.stopPropagation()},!1),this.sliderRow.addEventListener("click",function(a){f.checkElement.disabled||(f.checkElement.checked=!f.checkElement.checked,f.fireChangeEvent())},!1)},b.OptionCheckbox.prototype.constructor=b.OptionCheckbox,a.EventDispatcher.prototype.apply(b.OptionCheckbox.prototype),b.OptionCheckbox.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.checked=this.checkElement.checked;var a=new CustomEvent("change",{detail:{target:this,value:this.checkElement.checked}});this.dispatchEvent(a)}},b.OptionCheckbox.prototype.setValue=function(a){this.blockEvent=!0,this.checked=a,this.checkElement.checked=a,this.blockEvent=!1},b.OptionCheckbox.prototype.setDisabled=function(a){this.checkElement.disabled=a,this.caption.disabled=a},b.OptionCheckbox.prototype.setVisibility=function(a){a?this.sliderRow.style.display="table-row":this.sliderRow.style.display="none"},b.OptionDropDown=function(b,c,d,e,f){var g=this;this.tbody=c;var h=f&&f.insertAtIndex?f.insertAtIndex:-1;this.sliderRow=this.tbody.insertRow(h);var i=this.sliderRow.insertCell(0);this.caption=document.createElement("div"),this.caption.setAttribute("data-i18n",b),this.caption.textContent=a.i18n.translate(b),i.appendChild(this.caption),i=this.sliderRow.insertCell(1),this.dropdownElement=document.createElement("select"),this.dropdownElement.id=b+"_dropdown",this.dropdownElement.className="optionDropDown";for(var j=0;j<d.length;j++){var k=document.createElement("option");k.value=j,k.setAttribute("data-i18n",d[j]),k.textContent=a.i18n.translate(d[j]),this.dropdownElement.add(k)}this.selectedIndex=this.dropdownElement.selectedIndex=e,i.appendChild(this.dropdownElement),i.style.paddingLeft="5px",i.style.paddingRight="5px",this.blockEvent=!1,this.dropdownElement.addEventListener("change",function(a){g.fireChangeEvent()},!1)},b.OptionDropDown.prototype.constructor=b.OptionDropDown,a.EventDispatcher.prototype.apply(b.OptionDropDown.prototype),b.OptionDropDown.prototype.setSelectedIndex=function(a){this.blockEvent=!0,this.selectedIndex=this.dropdownElement.selectedIndex=a,this.blockEvent=!1},b.OptionDropDown.prototype.setSelectedValue=function(a){this.blockEvent=!0,this.dropdownElement.selectedValue=a,this.selectedIndex=this.dropdownElement.selectedIndex,this.blockEvent=!1},b.OptionDropDown.prototype.fireChangeEvent=function(){if(!this.blockEvent){this.selectedIndex=this.dropdownElement.selectedIndex;var a=new CustomEvent("change",{detail:{target:this,value:this.selectedIndex}});this.dispatchEvent(a)}},b.OptionDropDown.prototype.setDisabled=function(a){this.dropdownElement.disabled=a,this.caption.disabled=a}}(),function(){"use strict";var a=function(a){this.bg=document.createElement("div"),this.bg.className="progressbg",this.fg=document.createElement("div"),this.fg.className="progressfg",this.bg.appendChild(this.fg),this.lastValue=-1,a.appendChild(this.bg),this.widthScale=this.fg.clientWidth};a.prototype.setPercent=function(a){a!=this.lastValue&&(this.lastValue=a,a>=99?this.bg.style.visibility="hidden":(this.bg.style.visibility="visible",this.fg.style.width=this.widthScale*a*.01+"px"))},Autodesk.Viewing.Private.ProgressBar=a}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.RenderOptionsPanel=function(a){var b=this,c=Autodesk.Viewing.Private;this.viewer=a,Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"RenderOptionsPanel","Rendering Options"),this.table=document.createElement("table"),this.table.className="tftable",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.createScrollContainer({heightAdjustment:70,marginTop:20}),this.scrollContainer.appendChild(this.table),this.container.style.width="320px",this.container.style.top="260px",this.container.style.left="220px",this.container.style.height="460px",this.container.dockRight=!0;var d=[];for(var e in a.impl.BackgroundPresets)d.push(e);this.bgSelect=new c.OptionDropDown("Background Color",this.tbody,d,-1),this.updateBgColorIndex(),this.addEventListener(this.bgSelect,"change",function(c){var d=b.bgSelect.value,e=a.BackgroundPresets[d];a.prefs.set("backgroundColorPreset",JSON.stringify(e)),a.impl.setClearColors(e[0],e[1],e[2],e[3],e[4],e[5])}),this.celToggle=new c.OptionCheckbox("Cel Shaded",this.tbody,!0),this.addEventListener(this.celToggle,"change",function(c){var d=b.celToggle.checked;a.prefs.set("celShaded",d),a.impl.toggleCelShading(d)}),this.saoToggle=new c.OptionCheckbox("AO Enabled",this.tbody,!0),this.addEventListener(this.saoToggle,"change",function(c){var d=b.saoToggle.checked;a.prefs.set("ambientShadows",d),a.setQualityLevel(d,a.impl.renderer().settings.antialias)}),this.saoRadius=new c.OptionSlider("AO Radius",0,100,this.tbody),this.saoRadius.setValue(10),this.saoRadius.sliderElement.step=this.saoRadius.stepperElement.step=1,this.addEventListener(this.saoRadius,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame(!1)}),this.saoIntensity=new c.OptionSlider("AO Intensity",0,3,this.tbody),this.saoIntensity.setValue(.75),this.saoIntensity.sliderElement.step=this.saoIntensity.stepperElement.step=.1,this.addEventListener(this.saoIntensity,"change",function(c){a.impl.renderer().setAOOptions(parseInt(b.saoRadius.value),parseFloat(b.saoIntensity.value)),a.impl.renderer().composeFinalFrame(!1)}),this.groundShadowAlpha=new c.OptionSlider("Shadow Alpha",0,2,this.tbody),this.groundShadowAlpha.setValue(1),this.groundShadowAlpha.sliderElement.step=this.groundShadowAlpha.stepperElement.step=.1,this.addEventListener(this.groundShadowAlpha,"change",function(c){a.setGroundShadowAlpha(parseFloat(b.groundShadowAlpha.value))}),this.groundShadowColor=new c.OptionCheckbox("Shadow Color",this.tbody),_isIE11||(this.groundShadowColor.checkElement.type="color"),this.addEventListener(this.groundShadowColor,"change",function(c){var d=b.groundShadowColor.checkElement.value;a.setGroundShadowColor(new THREE.Color(parseInt(d.substr(1,7),16)))}),this.groundReflectionAlpha=new c.OptionSlider("Reflection Alpha",0,2,this.tbody),this.groundReflectionAlpha.setValue(1),this.groundReflectionAlpha.sliderElement.step=this.groundReflectionAlpha.stepperElement.step=.1,this.addEventListener(this.groundReflectionAlpha,"change",function(c){a.setGroundReflectionAlpha(parseFloat(b.groundReflectionAlpha.value))}),this.groundReflectionColor=new c.OptionCheckbox("Reflection Color",this.tbody),_isIE11||(this.groundReflectionColor.checkElement.type="color"),this.addEventListener(this.groundReflectionColor,"change",function(c){var d=b.groundReflectionColor.checkElement.value;a.setGroundReflectionColor(new THREE.Color(parseInt(d.substr(1,7),16)))});for(var f=[],g=0;g<c.LightPresets.length;g++)f.push(c.LightPresets[g].name);this.envSelect=new c.OptionDropDown("Environment",this.tbody,f,a.impl.currentLightPreset()),this.addEventListener(this.envSelect,"change",function(c){var d=b.envSelect.selectedIndex;a.setLightPreset(d)});var h=a.impl.renderer().getToneMapMethod();this.toneMapMethod=new c.OptionDropDown("Tonemap Method",this.tbody,["None","Canon-Lum","Canon-RGB"],h),this.addEventListener(this.toneMapMethod,"change",function(){var c=b.toneMapMethod.selectedIndex;a.impl.setTonemapMethod(c)}),this.exposureBias=new c.OptionSlider("Exposure Bias",-30,30,this.tbody),this.exposureBias.setValue(a.impl.renderer().getExposureBias()),this.exposureBias.sliderElement.step=this.exposureBias.stepperElement.step=.1,this.addEventListener(this.exposureBias,"change",function(c){a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.exposureBias.setDisabled(0==h),this.whiteScale=new c.OptionSlider("Light Intensity",-5,20,this.tbody);var i=0;a.impl.dir_light1&&(i=0!=a.impl.dir_light1.intensity?Math.log(a.impl.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(i),this.whiteScale.sliderElement.step=this.whiteScale.stepperElement.step=.1,this.addEventListener(this.whiteScale,"change",function(c){a.impl.dir_light1.intensity=Math.pow(2,b.whiteScale.value),a.impl.setTonemapExposureBias(b.exposureBias.value,b.whiteScale.value)}),this.fovAngle=new c.OptionSlider("FOV-degrees",6.88,100,this.tbody),this.fovAngle.setValue(a.getFOV()),this.addEventListener(this.fovAngle,"change",function(c){a.setFOV(parseFloat(b.fovAngle.value))}),this.addEventListener(this.viewer,Autodesk.Viewing.CAMERA_CHANGE_EVENT,function(c){var d=parseFloat(b.fovAngle.value),e=a.getFOV();d!=e&&b.fovAngle.setValue(e)}),this.addEventListener(this.viewer,Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,function(a){b.syncUI()}),this.addVisibilityListener(function(){b.resizeToContent()})},Autodesk.Viewing.Private.RenderOptionsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Private.RenderOptionsPanel.prototype.constructor=Autodesk.Viewing.Private.RenderOptionsPanel,Autodesk.Viewing.Private.RenderOptionsPanel.prototype.getContentSize=function(){return{height:this.table.clientHeight+75,width:this.table.clientWidth}},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.updateBgColorIndex=function(){var a,b=this.viewer.impl,c=b.clearColorTop,d=b.clearColorBottom,e=[255*c.x|0,255*c.y|0,255*c.z|0,255*d.x|0,255*d.y|0,255*d.z|0];for(var f in Autodesk.Viewing.Private.BackgroundPresets){var g,h=Autodesk.Viewing.Private.BackgroundPresets[f];for(g=0;6>g&&h[g]==e[g];g++);if(6==g){a=f;break}}if(!a){a="Custom";for(var i=Autodesk.Viewing.Private.BackgroundPresets[a],j=0;6>j;j++)i[j]=e[j]}this.bgSelect.setSelectedValue(a)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.syncUI=function(){var a=this.viewer.impl,b=0;a.dir_light1&&(b=0!=a.dir_light1.intensity?Math.log(a.dir_light1.intensity)/Math.log(2):-1e-20),this.whiteScale.setValue(b),this.exposureBias.setValue(a.renderer().getExposureBias()),this.updateBgColorIndex();var c=a.renderer().getToneMapMethod();this.toneMapMethod.setSelectedIndex(c),this.envSelect.setSelectedIndex(a.currentLightPreset()),this.exposureBias.setDisabled(0==c),this.saoToggle.setValue(a.renderer().settings.sao),this.saoRadius.setDisabled(!a.renderer().settings.sao),this.saoIntensity.setDisabled(!a.renderer().settings.sao),this.saoRadius.setValue(a.renderer().getAORadius()),this.saoIntensity.setValue(a.renderer().getAOIntensity()),this.groundShadowAlpha.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundShadowColor.setDisabled(!this.viewer.prefs.get("groundShadow")),this.groundReflectionAlpha.setDisabled(!this.viewer.prefs.get("groundReflection")),this.groundReflectionColor.setDisabled(!this.viewer.prefs.get("groundReflection")),this.fovAngle.setValue(this.viewer.getFOV()),this.celToggle.setValue(a.renderer().settings.toonShaded)},Autodesk.Viewing.Private.RenderOptionsPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.table=null,this.tbody=null,this.bgSelect=null,this.saoToggle=null,this.saoRadius=null,this.saoIntensity=null,this.groundShadowAlpha=null,this.envSelect=null,this.toneMapMethod=null,this.exposureBias=null,this.whiteScale=null,this.fovAngle=null,this.viewer=null},function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.UI,c=function(c,d,e){this.viewer=c,this.tree=null,this.layersRoot=null,this.visibilityImages={},this.isMac=-1!==navigator.userAgent.search("Mac OS");var f="Layer Manager",g=c.config.viewableName,h=!0;g&&"W2D"!==g&&(f=a.i18n.translate(f)+": "+g,h=!1),this.filterImageId=e+"-layerFilterImageId",b.DockingPanel.call(this,c.container,e,f,{localizeTitle:h}),this.container.classList.add("layersPanel"),this.filterContainer=document.createElement("div"),this.filterContainer.className="filterBox",this.filterContainer.id=this.container.id+"-search-container",this.container.appendChild(this.filterContainer),this.createScrollContainer({heightAdjustment:105,marginTop:5});var i=this;c.model?i.build():i.addEventListener(c,a.GEOMETRY_LOADED_EVENT,function(){i.build()}),this.addVisibilityListener(function(){i.resizeToContent()})};c.prototype=Object.create(b.DockingPanel.prototype),c.prototype.constructor=c,c.prototype.uninitialize=function(){b.DockingPanel.prototype.uninitialize.call(this),this.viewer=null,this.tree=null,this.layersRoot=null,this.visibilityImages=null,this.scrollContainer=null,this.filterContainer=null},c.prototype.build=function(){function c(){var a=new b.TreeDelegate;return a.getTreeNodeId=function(a){return a.id},a.getTreeNodeLabel=function(a){return f.getNodeLabel(a)},a.getTreeNodeClass=function(a){return f.getNodeClass(a)},a.isTreeNodeGroup=function(a){return f.isGroupNode(a)},a.shouldCreateTreeNode=function(a){return f.shouldInclude(a)},a.onTreeNodeClick=function(a,b,c){f.onClick(b,c)},a.onTreeNodeRightClick=function(a,b,c){f.onRightClick(b,c)},a.onTreeNodeDoubleClick=function(a,b,c){f.onDoubleClick(b,c)},a.onTreeNodeIconClick=function(a,b,c){f.onIconClick(b,c)},a.createTreeNode=function(a,b){f.createNode(a,b)},a}function d(){j&&clearTimeout(j),j=setTimeout(e,500)}function e(){function a(c){var d=[];if(-1!==c.name.toLowerCase().indexOf(b))d.push(c);else if(!c.isLayer)for(var e=c.children,f=0;f<e.length;++f)d=d.concat(a(e[f]));return d}if(i.value){var b=i.value.toLowerCase();m&&0<m.childCount&&k.setLayerVisible(a(m),!0,!0)}else k.setLayerVisible(null,!0);j=null}var f=this,g=document.createElement("div");g.className="filterSearch",f.filterContainer.appendChild(g);var h=document.createElement("div");h.className="filterImage",h.id=f.filterImageId,h.title=a.i18n.translate("Show/hide all layers"),g.appendChild(h),f.visibilityImages[f.filterImageId]=h,f.addEventListener(h,"click",function(a){f.onImageClick(null,a),a.stopPropagation()});var i=this.filterField=document.createElement("input");i.className="filterInput",i.placeholder=a.i18n.translate("Enter filter term"),i.setAttribute("data-i18n","[placeholder]Enter filter term"),i.type="search",i.incremental="incremental",g.appendChild(i);var j=null,k=f.viewer;i.addEventListener("keyup",function(a){d()}),i.addEventListener("click",function(a){return""===i.value?void k.setLayerVisible(null,!0):void setTimeout(function(){""===i.value&&(k.setLayerVisible(null,!0),a.preventDefault())},1)});var l=c(),m=f.layersRoot=f.viewer.model.getLayersRoot();m&&(f.tree=new b.Tree(l,m,f.scrollContainer,{excludeRoot:!0}),f.resizeToContent(),f.update(),f.addEventListener(f.viewer,a.LAYER_VISIBILITY_CHANGED_EVENT,function(){f.update()}))},c.prototype.update=function(){function a(a,b){var c;c=1===b?"layerVisible":0===b?"layerHidden":"layerMixed",a.classList.remove("layerVisible","layerHidden","layerMixed"),a.classList.add(c)}function b(a,b){0===b?e.tree.addClass(a.id,"dim"):e.tree.removeClass(a.id,"dim")}function c(a){var b;if(0<a.length)for(var c=0;c<a.length;++c){var d=a[c];if(void 0===b?b=d:0===d&&1===b?b=-1:1===d&&0===b&&(b=-1),-1===b)break}else b=0;return b}function d(f){var g=f.id,h=e.visibilityImages[g];if(!f.isLayer){for(var i=f.children,j=[],k=0;k<i.length;++k)j=j.concat(d(i[k]));var l=c(j);return a(h,l),b(f,l),j}var m=e.viewer.isLayerVisible(f)?1:0;return a(h,m),b(f,m),[m]}var e=this,f=this.layersRoot&&0<this.layersRoot.childCount?d(e.layersRoot):[],g=e.visibilityImages[e.filterImageId];a(g,c(f))},c.prototype.setLayerVisible=function(a,b){var c=a?a.id:this.filterImageId,d=this.visibilityImages[c].className,e="layerVisible"!==d;this.viewer.setLayerVisible(a,e,b),this.filterField.value=""},c.prototype.getNodeLabel=function(a){return a.isLayer||0===a.childCount?a.name:a.name+" ("+a.childCount+")"},c.prototype.getNodeClass=function(a){return""},c.prototype.isGroupNode=function(a){return!a.isLayer},c.prototype.shouldInclude=function(a){return!0},c.prototype.onIconClick=function(a,b){this.setGroupCollapsed(a,!this.isGroupCollapsed(a))},c.prototype.setGroupCollapsed=function(a,b){var c=this.tree.delegate();if(c.isTreeNodeGroup(a)){var d=c.getTreeNodeId(a);this.tree.setCollapsed(d,b),this.resizeToContent()}},c.prototype.isGroupCollapsed=function(a){var b=this.tree.delegate();if(b.isTreeNodeGroup(a)){var c=b.getTreeNodeId(a);return this.tree.isCollapsed(c)}return!1},c.prototype.onClick=function(a,b){},c.prototype.onDoubleClick=function(a,b){},c.prototype.onRightClick=function(a,b){},c.prototype.onImageClick=function(a,b){},c.prototype.getContentSize=function(){var a=this.filterContainer,b=a.clientHeight+80,c=a.clientWidth,d=this.tree;if(d){var e=d.getRootContainer();if(e)return{height:e.clientHeight+b,width:Math.max(e.clientWidth,c)}}return{height:b,width:c}},c.prototype.createNode=function(b,c){var d=document.createElement("div");c.children&&c.children.length>0?c.insertBefore(d,c.children[0]):c.appendChild(d),d.title=a.i18n.translate("Show/hide this layer"),this.visibilityImages[b.id]=d;var e=document.createElement("label");e.textContent=this.getNodeLabel(b),c.appendChild(e);var f=this;this.addEventListener(d,"click",function(a){f.onImageClick(b,a),a.stopPropagation()})},Autodesk.Viewing.UI.LayersPanel=c}(),AutodeskNamespace("Autodesk.Viewing.UI"),Autodesk.Viewing.UI.SettingsPanel=function(a,b,c,d){Autodesk.Viewing.UI.DockingPanel.call(this,a,b,c,d),this.panelTabs=[],this.tabIdToIndex={},this.controls={},this.controlIdCount=0;var e=this,f=d&&void 0!==d.width?d.width:340;this.container.style.maxWidth="800px",this.container.style.minWidth=f+"px",this.container.style.top="100px",this.container.style.left=a.offsetWidth/2-170+"px",this.container.style.position="absolute",this.tabContainer=document.createElement("div"),this.tabContainer.className="settings-tabs",this.container.appendChild(this.tabContainer),this.tabs=document.createElement("ul"),this.tabContainer.appendChild(this.tabs),this.heightAdjustment=d&&d.heightAdjustment?d.heightAdjustment:110,this.createScrollContainer({left:!1,heightAdjustment:this.heightAdjustment,marginTop:0}),this.mouseOver=!1,this.addEventListener(this.container,"mouseover",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver)return!0;for(var c=0;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this){b.preventDefault&&b.preventDefault(),e.mouseOver=!0;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.remove("selectedmouseout");return!0}b=b.parentNode}}),this.addEventListener(this.container,"mouseout",function(a){var b=a.toElement||a.relatedTarget;if(e.mouseOver){for(;b&&b.parentNode&&b.parentNode!=window;){if(b.parentNode==this||b==this)return b.preventDefault&&b.preventDefault(),!1;b=b.parentNode}e.mouseOver=!1;for(var c=0;c<e.panelTabs.length;c++)e.panelTabs[c].classList.contains("tabselected")&&e.panelTabs[c].classList.add("selectedmouseout")}})},Autodesk.Viewing.UI.SettingsPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.UI.SettingsPanel.prototype.constructor=Autodesk.Viewing.UI.SettingsPanel,Autodesk.Viewing.UI.SettingsPanel.prototype.setVisible=function(a){a&&(this.container.style.display="block"),Autodesk.Viewing.UI.DockingPanel.prototype.setVisible.call(this,a)},Autodesk.Viewing.UI.SettingsPanel.prototype.addTab=function(a,b,c){function d(b){e.selectTab(a)}var e=this;if(void 0!==this.tabIdToIndex[a])return!1;var f=c&&void 0!==c.className?c.className:null,g=c&&void 0!==c.width?c.width:200,h=c&&void 0!==c.index?c.index:this.panelTabs.length,i=document.createElement("li");i.id=a;var j=document.createElement("a"),k=document.createElement("span");k.setAttribute("data-i18n",b),k.textContent=Autodesk.Viewing.i18n.translate(b),j.appendChild(k),i.appendChild(j),this.tabs.appendChild(i);var l=document.createElement("table");l.id=a+"-table",l.className="settings-table tftable "+f;var m=document.createElement("tbody");l.appendChild(m),this.scrollContainer.appendChild(l),this.addEventListener(i,"touchstart",touchStartToClick),this.addEventListener(i,"click",d),this.panelTabs.push(i),this.tabIdToIndex[a]=h;var n=this.container.style.minWidth?parseInt(this.container.style.minWidth):0;return g>n&&(this.container.style.minWidth=g+"px"),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.removeTab=function(a){var b=this.tabIdToIndex[a];if(!b)return!1;this.panelTabs.splice(b,1),this.tabs.removeChild(tabDom),this.tabIdToIndex={};for(var c=this.panelTabs.length,d=0;c>d;d++){var e=this.panelTabs[d];this.tabIdToIndex[e.id]=d}return!0},Autodesk.Viewing.UI.SettingsPanel.prototype.hasTab=function(a){var b=this.tabIdToIndex[a],c=this.panelTabs[b];return void 0!==c},Autodesk.Viewing.UI.SettingsPanel.prototype.selectTab=function(a){if(this.isTabSelected(a))return!1;for(var b=this.panelTabs.length,c=0;b>c;c++){var d=this.panelTabs[c],e=document.getElementById(d.id+"-table");a===d.id?(d.classList.add("tabselected"),e.style.display="table",this.mouseOver||d.classList.add("selectedmouseout")):(d.classList.remove("tabselected"),e.style.display="none",this.mouseOver||this.panelTabs[c].classList.remove("selectedmouseout"))}return this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.isTabSelected=function(a){var b=this.tabIdToIndex[a],c=this.panelTabs[b];return c&&c.classList.contains("tabselected")},Autodesk.Viewing.UI.SettingsPanel.prototype.addCheckbox=function(a,b,c,d,e){var f=this.tabIdToIndex[a];if(void 0===f)return null;var g=document.getElementById(a+"-table"),h=new Autodesk.Viewing.Private.OptionCheckbox(b,g.tBodies[0],c,e);return h.changeListener=function(a){var b=a.detail.target.checked;d(b)},this.addEventListener(h,"change",h.changeListener),this.addControl(a,h)},Autodesk.Viewing.UI.SettingsPanel.prototype.addSlider=function(a,b,c,d,e,f,g){var h=this.tabIdToIndex[a];if(void 0===h)return null;var i=document.getElementById(a+"-table"),j=new Autodesk.Viewing.Private.OptionSlider(b,c,d,i.tBodies[0],g);return j.setValue(e),j.sliderElement.step=j.stepperElement.step=1,this.addEventListener(j,"change",function(a){f(a)}),this.addControl(a,j)},Autodesk.Viewing.UI.SettingsPanel.prototype.addDropDownMenu=function(a,b,c,d,e,f){var g=this.tabIdToIndex[a];if(void 0===g)return null;var h=document.getElementById(a+"-table"),i=new Autodesk.Viewing.Private.OptionDropDown(b,h.tBodies[0],c,d,f);return this.addEventListener(i,"change",function(a){e(a)}),this.addControl(a,i)},Autodesk.Viewing.UI.SettingsPanel.prototype.addControl=function(a,b,c){var d=this.tabIdToIndex[a];if(void 0===d)return null;if(!b.hasOwnProperty("sliderRow")){var e=c&&c.insertAtIndex?c.insertAtIndex:-1,f=c&&c.caption?c.caption:null,g=document.getElementById(a+"-table");e>g.length&&(e=-1);var h=g.tBodies[0].insertRow(e),i=h.insertCell(0);if(f){var j=document.createElement("div");j.setAttribute("data-i18n",f),j.textContent=Autodesk.Viewing.i18n.translate(f),i.appendChild(j),i=h.insertCell(1)}else i.colSpan=2;i.appendChild(b),b.sliderRow=h,b.tbody=g.tBodies[0]}var k="adsk_settings_control_id_"+this.controlIdCount.toString();return this.controlIdCount=this.controlIdCount+1,this.controls[k]=b,this.resizeToContent(),k},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeSlider=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeCheckbox=function(a){return this.removeControl(a)},Autodesk.Viewing.UI.SettingsPanel.prototype.removeControl=function(a){var b;if(b="object"==typeof a&&a.tbody?a:this.controls[a],void 0===b)return!1;var c=b.tbody,d=b.sliderRow,e=d.rowIndex;return c.deleteRow(e),delete this.controls[a],this.resizeToContent(),!0},Autodesk.Viewing.UI.SettingsPanel.prototype.getControl=function(a){return void 0!==this.controls[a]?this.controls[a]:null},Autodesk.Viewing.UI.SettingsPanel.prototype.getContentSize=function(){for(var a=this.heightAdjustment,b=this.panelTabs.length>this.panelTabs[0]?0:null,c=0;c<this.panelTabs.length;c++){var d=this.panelTabs[c];if(this.isTabSelected(d.id)){b=d;break}}if(b){var e=document.getElementById(d.id+"-table");a+=e.clientHeight}return{height:a,width:this.container.clientWidth}},function(){"use strict";var a=function(){};a.instances=[],a.displayError=function(b,c,d,e,f){var g=document.createElement("div");g.className="alertBox error",b.appendChild(g);var h=e;h||(h="img-item-not-found");var i=document.createElement("div");i.className="alertBoxImage "+h,g.appendChild(i);var j=document.createElement("div");j.className="alertBoxMsg",g.appendChild(j);var k=d;k||(k=Autodesk.Viewing.i18n.translate("Error Occurred",{defaultValue:"Error Occurred"}));var l=document.createElement("div");l.className="alertBoxTitle",l.textContent=k,j.appendChild(l);var m=document.createElement("div");if(m.className="alertBoxText",m.textContent=c,j.appendChild(m),f){var n=document.createElement("div");n.className="alertBoxContent",j.appendChild(n);var o=document.createElement("ul");o.className="alertBoxContent";for(var p=0;p<f.length;p++){var q=f[p];if(q){var r=document.createElement("li");o.appendChild(r);var s=this.extractList(q);if(s.list.length){var t=this.generateListElement(list);o.appendChild(t)}r.innerHTML=s.msg}}n.appendChild(o)}var u=document.createElement("div");u.className="alertBoxOK",u.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var v={alertBox:g,container:b};u.addEventListener("click",function(c){g.style.visibility="hidden",b.removeChild(g),a.instances.splice(a.instances.indexOf(v),1)}),g.appendChild(u),g.style.visibility="visible",a.instances.push(v)},a.displayErrors=function(b,c,d){var e=document.createElement("div");e.className="alertBox errors",b.appendChild(e);var f=c;f||(f="img-item-not-found");var g=document.createElement("div");g.className="alertBoxImage "+f,e.appendChild(g);var h=document.createElement("div");h.className="alertBoxMsg errors",e.appendChild(h);for(var i=0;i<d.length;i++){var j=d[i].header;j||(j=Autodesk.Viewing.i18n.translate("Error",{defaultValue:"Error"}));var k=document.createElement("div");k.className="alertBoxTitle errors",k.textContent=j,h.appendChild(k);var l=document.createElement("div");l.className="alertBoxText errors";var m=d[i].msg,n=this.extractList(m);if(n.list.length){var o=document.createElement("div"),p=this.generateListElement(n.list);o.appendChild(p),l.textContent=n.msg,l.appendChild(o)}else l.textContent=m;if(h.appendChild(l),d[i].hints){var q=document.createElement("ul");q.className="alertBoxContent";for(var r=d[i].hints,s=0;s<r.length;s++){var t=r[s];if(t){var u=document.createElement("li");q.appendChild(u);var n=this.extractList(t);if(n.list.length){var p=this.generateListElement(n.list);
q.appendChild(p)}u.innerHTML=n.msg}}h.appendChild(q)}}var v=document.createElement("div");v.className="alertBoxOK",v.textContent=Autodesk.Viewing.i18n.translate("OK",{defaultValue:"OK"});var w={alertBox:e,container:b};v.addEventListener("click",function(c){e.style.visibility="hidden",b.removeChild(e),a.instances.splice(a.instances.indexOf(w),1)}),e.appendChild(v),e.style.visibility="visible",a.instances.push(w)},a.extractList=function(a){var b={msg:a,list:[]};if(a&&-1!=a.indexOf("<ul>")){var c=a.split("<ul>");b.msg=c[0],c=c[1].split("</ul>"),b.list=c[0].split(", "),1===b.list.length&&(b.list=c[0].split(","))}return b},a.generateListElement=function(a){for(var b=document.createElement("ul"),c=0;c<a.length;c++){var d=document.createElement("li");d.textContent=a[c],b.appendChild(d)}return b},a.dismiss=function(){if(a.instances.length>0){var b=a.instances.pop();return b.alertBox.style.visibility="hidden",b.container.removeChild(b.alertBox),!0}return!1},Autodesk.Viewing.Private.AlertBox=a}(),function(){"use strict";var a=Autodesk.Viewing,b=function(){};b.instances=[],b.displayMessage=function(c,d,e,f,g){if(!(b.instances.length>0)){var h=d.msgTitleKey,i=d.msgTitleDefaultValue||h,j=d.messageKey,k=d.messageDefaultValue||j,l=d.buttonText,m=d.checkboxChecked||!1,n=document.createElement("div");n.className="hud",c.appendChild(n);var o=document.createElement("div");if(o.className="hudTitle",o.textContent=a.i18n.translate(h,{defaultValue:i}),o.setAttribute("data-i18n",h),n.appendChild(o),e){var p=document.createElement("div");p.className="hudClose",p.innerHTML="&times;",p.addEventListener("click",function(a){b.dismiss(),e&&e(a)}),n.appendChild(p)}var q=document.createElement("div");if(q.className="hudMessage",q.textContent=a.i18n.translate(j,{defaultValue:k}),q.setAttribute("data-i18n",j),n.appendChild(q),f){var r=document.createElement("div");r.className="hudButton",r.textContent=a.i18n.translate(l,{defaultValue:l}),r.setAttribute("data-i18n",l),r.addEventListener("click",f),n.appendChild(r)}if(g){var s=document.createElement("div"),t=document.createElement("input");t.className="hudCheckbox",t.type="checkbox",t.checked=m,s.appendChild(t);var u="Do not show this message again",v=document.createElement("label");v.setAttribute("for",u),v.setAttribute("data-i18n",u),v.textContent=a.i18n.translate(u,{defaultValue:u}),s.appendChild(v),t.addEventListener("change",g),n.appendChild(s)}var w={hudMessage:n,container:c};b.instances.push(w)}},b.dismiss=function(){if(b.instances.length>0){var a=b.instances.pop();return a.hudMessage.style.visibility="hidden",a.container.removeChild(a.hudMessage),!0}return!1},Autodesk.Viewing.Private.HudMessage=b}(),function(){"use strict";var a=Autodesk.Viewing.UI,b=Autodesk.Viewing.Private,c=function(){};c.prototype.constructor=c,c.prototype.isTreeNodeGroup=function(a){throw"isTreeNodeGroup is not implemented."},c.prototype.getTreeNodeId=function(a){throw"getTreeNodeId is not implemented."},c.prototype.getTreeNodeLabel=function(a){return a.name},c.prototype.shouldCreateTreeNode=function(a){return!0},c.prototype.forEachChild=function(a,b){for(var c=a.children?a.children.length:0,d=0;c>d;++d){var e=a.children[d];b(e)}},c.prototype.createTreeNode=function(a,b,c){var d=document.createElement("label");b.appendChild(d);var e=this.getTreeNodeLabel(a);c&&c.localize&&(d.setAttribute("data-i18n",e),e=Autodesk.Viewing.i18n.translate(e)),d.textContent=e},c.prototype.onTreeNodeClick=function(a,b,c){},c.prototype.onTreeNodeIconClick=function(a,b,c){a.delegate().isTreeNodeGroup(b)&&a.setCollapsed(b,!a.isCollapsed(b))},c.prototype.onTreeNodeDoubleClick=function(a,b,c){},c.prototype.onTreeNodeRightClick=function(a,b,c){},c.prototype.getTreeNodeClass=function(a){return""},c.prototype.onTreeNodeHover=function(a,b,c){};var d=function(a,b,c,d){this.myDelegate=a,this.mySelectedNodes=[],this.myOptions=d||{};var e="treeview";this.myGroupNodes=[],this.nodeToElement={},this.nodeIdToNode={};var f=this.myRootContainer=this.createHtmlElement_(c,"div",e),g=this.rootElem=this.createElement_(b,f,d,0);this.setInputHandlers_(),d&&d.excludeRoot&&g.classList.add("exclude")};d.prototype.constructor=d,d.prototype.show=function(a){var b=this.myRootContainer;a?b.style.display="block":b.style.display="none"},d.prototype.getRootContainer=function(){return this.myRootContainer},d.prototype.getElementForNode=function(a){return"number"!=typeof a&&"string"!=typeof a&&(a=this.myDelegate.getTreeNodeId(a)),this.nodeToElement[a]},d.prototype.delegate=function(){return this.myDelegate},d.prototype.isCollapsed=function(a){return this.hasClass(a,"collapsed")},d.prototype.setCollapsed=function(a,b,c){b?(this.addClass(a,"collapsed",c),this.removeClass(a,"expanded",c)):(this.addClass(a,"expanded",c),this.removeClass(a,"collapsed",c))},d.prototype.setAllCollapsed=function(a){var b,c;a?(b=function(a){return a.classList.contains("expanded")},c=function(a){a.classList.add("collapsed"),a.classList.remove("expanded")}):(b=function(a){return a.classList.contains("collapsed")},c=function(a){a.classList.add("expanded"),a.classList.remove("collapsed")});for(var d=0;d<this.myGroupNodes.length;++d){var e=this.myGroupNodes[d];b(e)&&c(e)}},d.prototype.addToSelection=function(a){function b(a){var b=c.mySelectedNodes.indexOf(a);return-1===b?(c.mySelectedNodes.push(a),!0):!1}for(var c=this,d=a.length,e=0;d>e;++e){var f=a[e];b(f)&&this.addClass(f,"selected")}},d.prototype.removeFromSelection=function(a){function b(a){var b=c.mySelectedNodes.indexOf(a);return-1!==b?(c.mySelectedNodes.splice(b,1),!0):!1}for(var c=this,d=a.length-1;d>=0;--d){var e=a[d];b(e)&&this.removeClass(e,"selected")}},d.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedNodes),this.addToSelection(a),this.mySelectedNodes},d.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedNodes)},d.prototype.isSelected=function(a){return this.hasClass(a,"selected")},d.prototype.scrollTo=function(a){var b=this.getElementForNode(a);if(b){var c=b.offsetTop;for(b=b.parentNode;b&&b!=this.myRootContainer;)c+=b.offsetTop,b=b.parentNode;this.myRootContainer.parentNode.scrollTop=c}},d.prototype.addClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.add(b),d=d.parentNode}else d.classList.add(b);return!0}return!1},d.prototype.removeClass=function(a,b,c){var d=this.getElementForNode(a);if(d){if(c){d=d.parentNode;for(var e=this.myOptions.excludeRoot?this.rootElem:this.myRootContainer;d&&d!==e;)d.classList.remove(b),d=d.parentNode}else d.classList.remove(b);return!0}return!1},d.prototype.hasClass=function(a,b){return this.getElementForNode(a).classList.contains(b)},d.prototype.clear=function(){for(var a=this.myRootContainer;a.hasChildNodes();)a.removeChild(a.lastChild);this.nodeToElement={},this.nodeIdToNode={}},d.prototype.createElement_=function(a,b,c,d){function e(b,d,e,f){var h=g.createHtmlElement_(b,d,e),i=g.myDelegate.getTreeNodeId(f);h.setAttribute("lmv-nodeId",i);var j=g.createHtmlElement_(h,"header"),k=g.createHtmlElement_(j,"icon");return k.addEventListener("click",function(b){g.myDelegate.onTreeNodeIconClick(g,a,b),b.stopPropagation(),b.preventDefault()},!1),g.myDelegate.createTreeNode(a,j,c),h}if(!a)return null;if(!this.myDelegate.shouldCreateTreeNode(a))return null;var f,g=this,h=this.myDelegate.getTreeNodeId(a);if(g.myDelegate.isTreeNodeGroup(a)){f=e(b,"group","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.left="0px"),g.myGroupNodes.push(f),g.myDelegate.forEachChild(a,function(a){g.createElement_(a,f,c,d+1)})}else{f=e(b,"leaf","expanded",a),g.nodeToElement[h]=f,g.nodeIdToNode[h]=a;var i=g.myOptions.excludeRoot?1:0;d==i&&(f.style.marginLeft="0px")}var j=g.myDelegate.getTreeNodeClass(a);return j&&f.classList.add(j),f},d.prototype.setInputHandlers_=function(){var a=this,b=this.myRootContainer,c=null,d=function(d){var e=null,f=!1;do d&&d!==b?d.hasAttribute("lmv-nodeId")?(e=d,f=!0):d=d.parentElement:(e=null,f=!0);while(!f);if(e){var g=e.getAttribute("lmv-nodeId");return a.nodeIdToNode[g]||c}return c};isTouchDevice()&&(this.hammer=new Hammer.Manager(b,{recognizers:[[Hammer.Tap,{event:"doubletap",taps:2,interval:400,threshold:6,posThreshold:30}],[Hammer.Press,{event:"press",time:500}]],inputClass:Hammer.TouchInput}),this.hammer.on("doubletap",function(b){var e=d(b.target);e!==c&&a.myDelegate.onTreeNodeDoubleClick(a,e,b)}),this.hammer.on("press",function(b){var e=d(b.target);e!==c&&a.myDelegate.onTreeNodeRightClick(a,e,b)})),b.addEventListener("click",function(b){var e=d(b.target);e!==c&&(a.myDelegate.onTreeNodeClick(a,e,b),b.stopPropagation(),b.preventDefault())},!1),b.addEventListener("dblclick",function(b){var e=d(b.target);e!==c&&(a.myDelegate.onTreeNodeDoubleClick(a,e,b),b.stopPropagation(),b.preventDefault())},!1),b.addEventListener("contextmenu",function(b){var e=d(b.target);e!==c&&(a.myDelegate.onTreeNodeRightClick(a,e,b),b.stopPropagation(),b.preventDefault())},!1),b.addEventListener("mouseover",function(b){var e=d(b.target);e!==c&&(a.myDelegate.onTreeNodeHover(a,e,b),b.stopPropagation(),b.preventDefault())},!1),b.addEventListener("mouseout",function(b){var c=-1;a.myDelegate.onTreeNodeHover(a,c,b),b.stopPropagation(),b.preventDefault()},!1)},d.prototype.createHtmlElement_=function(a,b,c){var d=document.createElement(b);return a.appendChild(d),c&&(d.className=c),d},d.prototype.iterate=function(a,b){if(a&&this.myDelegate.shouldCreateTreeNode(a)){var c=this.getElementForNode(a);if(c){b(a,c);var d=this;this.myDelegate.forEachChild(a,function(a){d.iterate(a,b)})}}},b.TreeDelegate=a.TreeDelegate=c,b.Tree=a.Tree=d}(),function(){"use strict";var a=function(){};a.prototype.constructor=a,a.prototype.getNodeId=function(a){throw"getId is not implemented."},a.prototype.getNodeLabel=function(a){return a.name},a.prototype.getNodeClass=function(a){return""},a.prototype.hasThumbnail=function(a){return!1},a.prototype.getThumbnail=function(a){return null},a.prototype.onNodeClick=function(a,b,c){},a.prototype.onNodeHover=function(a,b,c){},a.prototype.selectItem=function(a){},a.prototype.deselectItem=function(a){},a.prototype.hasContent=function(a){return!1},a.prototype.addContent=function(a,b){};var b=function(a,b,c){this.myDelegate=a,this.mySelectedIds=[];var d="browserview";this.myRootContainerId=c+"-"+d,this.idToElement={},this.myRootContainer=document.createElement("div"),this.myRootContainer.id=this.myRootContainerId,this.myRootContainer.classList.add(d);var e=document.getElementById(c);e.appendChild(this.myRootContainer),this.createElements(b,this.myRootContainer)};b.prototype.constructor=b,b.prototype.show=function(a){a?(this.myRootContainer.classList.remove("browserHidden"),this.myRootContainer.classList.add("browserVisible"),this.myRootContainer.style.display="block"):(this.myRootContainer.classList.remove("browserVisible"),this.myRootContainer.classList.add("browserHidden"),this.myRootContainer.style.display="none")},b.prototype.getRootContainer=function(){return this.myRootContainer},b.prototype.delegate=function(){return this.myDelegate},b.prototype.addToSelection=function(a){function b(a){var b=c.mySelectedIds.indexOf(a);return-1==b?(c.mySelectedIds.push(a),!0):!1}for(var c=this,d=0,e=a.length;e>d;++d){var f=a[d];if(b(f)){var g=c.idToElement[f];void 0===g?c.myDelegate.selectItem(f):g.classList.add("selected")}}},b.prototype.removeFromSelection=function(a){function b(a){var b=c.mySelectedIds.indexOf(a);return-1!=b?(c.mySelectedIds.splice(b,1),!0):!1}for(var c=this,d=a.length-1;d>=0;--d){var e=a[d];if(b(e)){var f=this.idToElement[e];void 0===f?c.myDelegate.deselectItem(e):f.classList.remove("selected")}}},b.prototype.setSelection=function(a){return this.removeFromSelection(this.mySelectedIds),this.addToSelection(a),this.mySelectedIds},b.prototype.clearSelection=function(){this.removeFromSelection(this.mySelectedIds)},b.prototype.createElements=function(a,b){if(a)for(var c=this,d=0;d<a.length;d++){var e=a[d];c.createElement(e,b)}},b.prototype.createElement=function(a,b){var c=this,d=c.myDelegate.getNodeId(a),e=document.createElement("item");b.appendChild(e),this.idToElement[d]=e,e.onmouseover=function(){c.myDelegate.onNodeHover(c,a)},e.onclick=function(b){c.myRootContainer.querySelector(".flipped").removeClass("flipped"),c.myDelegate.onNodeClick(c,a,b)};var f=document.createElement("div");f.classList.add("card"),e.appendChild(f);var g=document.createElement("div");g.classList.add("browserElement"),f.appendChild(g);var h=c.myDelegate.getNodeLabel(a),i=document.createElement("label");i.innerHTML=h,g.appendChild(i),i.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)};var j=c.myDelegate.getThumbnail(a);if(j){var k=document.createElement("img");k.classList.add("thumb"),k.src=j,g.appendChild(k),k.onclick=function(b){c.myDelegate.onNodeClick(c,a,b)}}c.myDelegate.hasContent(a)&&c.myDelegate.addContent(a,f),e.classList.add(c.myDelegate.getNodeClass(a))},Autodesk.Viewing.Private.BrowserDelegate=a,Autodesk.Viewing.Private.Browser=b}(),AutodeskNamespace("Autodesk.Viewing.Private"),function(){var a=Autodesk.Viewing.Private;a.WEBGL_HELP_LINK=null,a.ErrorInfoData={1:{img:"img-reload","globalized-msg":"Viewer-UnknownFailure","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message> <hint>Try loading the item again. </hint><hint>Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},2:{img:"img-unsupported","globalized-msg":"Viewer-BadData","default-msg":"<title> Sorry </title><message>The item you are trying to view was not processed completely. </message><hint>Try loading the item again.</hint><hint>Please upload the file again to see if that fixes the issue.</hint>"},3:{img:"img-reload","globalized-msg":"Viewer-NetworkError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},4:{img:"img-unloack","globalized-msg":"Viewer-AccessDenied","default-msg":"<title> No access </title><message>Sorry. You dont have the required privileges to access this item.</message><hint> Please contact the author</hint>"},5:{img:"img-item-not-found","globalized-msg":"Viewer-FileNotFound","default-msg":'<title> Sorry </title><message>We cant display the item you are looking for. It may not have been processed yet. It may have been moved, deleted, or you may be using a corrupt file or unsupported file format.</message><hint> Try loading the item again.</hint><hint> Please upload the file again to see if that fixes the issue.</hint><hint> <a href="http://help.autodesk.com/view/ADSK360/ENU/?guid=GUID-488804D0-B0B0-4413-8741-4F5EE0FACC4A" target="_blank">See a list of supported formats.</a></hint>'},6:{img:"img-reload","globalized-msg":"Viewer-ServerError","default-msg":"<title> Sorry </title><message>We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},7:{img:"img-reload","globalized-msg":"Viewer-UnhandledResponseCode","default-msg":"<title> Network problem </title><message>Sorry. We seem to have some technical difficulties and couldn't complete your request.</message><hint> Try loading the item again.</hint><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"},8:{img:"img-unsupported","globalized-msg":"Viewer-WebGlNotSupported","default-msg":'<title>Sorry</title><message>We can\'t show this item because this browser doesn\'t support WebGL.</message><hint>Try Google Chrome, Mozilla Firefox, or another browser that supports WebGL 3D graphics.</hint><hint>For more information, see the <a href="WEBGL_HELP" target="_blank">A360 browser reqirements.</a></hint>'},9:{img:"img-item-not-found","globalized-msg":"Viewer-NoViewable","default-msg":"<title> No viewable content </title><message>Theres nothing to display for this item. It may not have been processed or it may not have content we can display.</message><hint> Please contact the author.</hint><hint> Please upload the file again to see if that fixes the issue.</hint>"},10:{img:"img-unsupported","globalized-msg":"Viewer-WebGlDisabled","default-msg":'<title>Sorry</title><message>We can\'t show this item because WebGL is disabled on this device.</message><hint> For more information see the <a href="WEBGL_HELP" target="_blank">A360 Help.</a></hint>'},11:{img:"img-unsupported","globalized-msg":"Viewer-RTCError","default-msg":"<title> Sorry </title><message>We couldnt connect to the Collaboration server.</message><hint> Please verify your Internet connection, and refresh the browser to see if that fixes the problem.</hint>"}},a.currentError=null,a.currentErrors=null,a.ErrorHandler=function(){},a.ErrorHandler.prototype.constructor=a.ErrorHandler,a.ErrorHandler.getErrorCode=function(a){return 403===a||401===a?Autodesk.Viewing.ErrorCodes.NETWORK_ACCESS_DENIED:404===a?Autodesk.Viewing.ErrorCodes.NETWORK_FILE_NOT_FOUND:a>=500?Autodesk.Viewing.ErrorCodes.NETWORK_SERVER_ERROR:Autodesk.Viewing.ErrorCodes.NETWORK_UNHANDLED_RESPONSE_CODE},a.ErrorHandler.reportError=function(b,c,d,e,f,g){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){if(a.logger){var h={category:"error",code:c,message:d,httpStatusCode:e,httpStatusText:f};a.logger.log(h,!0)}a.ErrorHandler.currentError=[b,c,d,g];var i=a.ErrorInfoData[c];if(i){var j={defaultValue:""};j.defaultValue=i["default-msg"];var k=i.img,l=i["globalized-msg"],m=this.parseErrorString(l,j);if(c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_DISABLED||c===Autodesk.Viewing.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED)for(var n=a.WEBGL_HELP_LINK||"http://www.autodesk.com/a360-browsers",o=0;o<m.hints.length;o++){var p=m.hints[o].indexOf('href="WEBGL_HELP"');-1!==p&&(m.hints[o]=m.hints[o].replace('href="WEBGL_HELP"','href="'+n+'"'))}a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}else{var k="img-unsupported",j={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"};this.parseArguments(d,j);var m=this.parseErrorString(c,j);m.header||(m.header="warning"===g?Autodesk.Viewing.i18n.translate("header-warning"):""),a.AlertBox.displayError(b,m.msg,m.header,k,m.hints)}}},a.ErrorHandler.reportErrors=function(b,c){if(a.ErrorHandler.currentError=null,a.ErrorHandler.currentErrors=null,c){a.ErrorHandler.currentErrors=[b,c];for(var d={defaultValue:"",interpolationPrefix:"{",interpolationSuffix:"}"},e=[],f=0;f<c.length;f++)if(c[f].code){this.parseArguments(c[f].message,d);var g=this.parseErrorString(c[f].code,d);if(g.header||(g.header="warning"===c[0].type?Autodesk.Viewing.i18n.translate("header-warning",{defaultValue:"Warning"}):""),e.push(g),a.logger){var h={category:"error",code:c[f].code,message:c[f].message};a.logger.log(h,!0)}}if(e.length){var i="img-unsupported";a.AlertBox.displayErrors(b,i,e)}}},a.ErrorHandler.parseArguments=function(a,b){if(a)if("string"==typeof a)b.defaultValue=a;else{b.defaultValue=a[0];for(var c=1;c<a.length;c++){var d=c-1,e=d.toString();b[e]=a[c]}}},a.ErrorHandler.parseErrorString=function(a,b){var c={msg:null,msgList:null,header:null,hints:null};if(!a)return c;var d=Autodesk.Viewing.i18n.translate(a,b);if(!d)return c;if(-1!=d.indexOf("<title>")){var e=d.split("<title>")[1].split("</title>");c.header=e[0],d=e[1]}if(d&&-1!=d.indexOf("<message>")){var e=d.split("<message>")[1].split("</message>");c.msg=e[0],d=e[1]}else c.msg=d;if(d&&-1!=d.indexOf("<hint>")){c.hints=[];for(var f=d.split("<hint>"),g=0;g<f.length;g++){var h=f[g].split("</hint")[0];c.hints.push(h)}}return c},a.ErrorHandler.localize=function(){if(a.AlertBox.instances.length>0)if(a.AlertBox.dismiss(),a.ErrorHandler.currentError){var b=a.ErrorHandler.currentError.shift(),c=a.ErrorHandler.currentError;a.ErrorHandler.reportError(b,c[0],c[1],c[2])}else{var b=a.ErrorHandler.currentErrors.shift(),d=a.ErrorHandler.currentErrors[0];a.ErrorHandler.reportErrors(b,d)}}}(),function(){"use strict";var a=function(a,b){this.viewer=a,this.options=b};a.prototype.load=function(){return!0},a.prototype.unload=function(){return!0},a.prototype.getState=function(a){},a.prototype.restoreState=function(a,b){return!0},Autodesk.Viewing.Extension=a}(),function(){"use strict";var a=function(){function a(a,b){return d.hasOwnProperty(a)?!1:(d[a]=b,!0)}function b(a){return d.hasOwnProperty(a)?d[a]:null}function c(a){return d.hasOwnProperty(a)?(delete d[a],!0):!1}var d={};return{registerExtension:a,getExtension:b,unregisterExtension:c}},b=new a,c=function(){};c.prototype={loadExtension:function(a,c){this.loadedExtensions||(this.loadedExtensions={});var d=!1;if(this.getExtension(a))stderr("Extension already loaded: "+a);else{var e=b.getExtension(a);if(e){var f=new e(this,c);d=f.load(),d&&(this.loadedExtensions[a]=f,stderr("Extension loaded: "+a))}else stderr("Extension not found: "+a)}return d},getExtension:function(a){return this.loadedExtensions&&a in this.loadedExtensions?this.loadedExtensions[a]:null},unloadExtension:function(a){var b=!1,c=this.getExtension(a);return c?(b=c.unload(),stderr("Extension unloaded: "+a),delete this.loadedExtensions[a]):stderr("Extension not found: "+a),b},apply:function(a){var b=c.prototype;a.loadExtension=b.loadExtension,a.getExtension=b.getExtension,a.unloadExtension=b.unloadExtension}},Autodesk.Viewing.theExtensionManager=b,Autodesk.Viewing.ExtensionMixin=c}(),function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.Private;a.ESCAPE_EVENT="escape",a.PROGRESS_UPDATE_EVENT="progress",a.FULLSCREEN_MODE_EVENT="fullScreenMode",a.NAVIGATION_MODE_CHANGED_EVENT="navmode",a.VIEWER_STATE_RESTORED_EVENT="viewerStateRestored",a.VIEWER_RESIZE_EVENT="viewerResize",a.VIEWER_UNINITIALIZED="viewerUninitialized",a.MODEL_ROOT_LOADED_EVENT="svfLoaded",a.GEOMETRY_LOADED_EVENT="geometryLoaded",a.OBJECT_TREE_CREATED_EVENT="propertyDbLoaded",a.OBJECT_TREE_UNAVAILABLE_EVENT="propertyDbUnavailable",a.MODEL_UNLOADED_EVENT="modelUnloaded",a.SELECTION_CHANGED_EVENT="selection",a.AGGREGATE_SELECTION_CHANGED_EVENT="aggregateSelection",a.ISOLATE_EVENT="isolate",a.HIDE_EVENT="hide",a.SHOW_EVENT="show",a.HIGHLIGHT_EVENT="highlight",a.CAMERA_CHANGE_EVENT="cameraChanged",a.EXPLODE_CHANGE_EVENT="explodeChanged",a.CUTPLANES_CHANGE_EVENT="cutplanesChanged",a.TOOL_CHANGE_EVENT="toolChanged",a.RENDER_OPTION_CHANGED_EVENT="renderOptionChanged",a.LAYER_VISIBILITY_CHANGED_EVENT="layerVisibility",a.RESET_EVENT="reset",a.ANIMATION_READY_EVENT="animationReady",a.NAVIGATION_MODE={ORBIT:0,PAN:1,DOLLY:2,ROLL:3,FOV:4,TOUCH_PAN_DOLLY:5,TOUCH_ROLL:6,OTHER:7};var c=isIOSDevice()||isAndroidDevice();a.DefaultSettings={ambientShadows:!0,antialiasing:!c,groundShadow:!0,groundReflection:!1,progressiveRendering:!0,environmentMap:!1,openPropertiesOnSelect:!1,ghosting:!0,viewCube:!c,lineRendering:!0,lightPreset:b.DefaultLightPreset,backgroundColorPreset:null,reverseMouseZoomDir:!1,reverseHorizontalLookDirection:!1,reverseVerticalLookDirection:!1,alwaysUsePivot:!1,zoomTowardsPivot:!1,orbitPastWorldPoles:!0,leftHandedMouseSetup:!1,clickToSetCOI:!1,optimizeNavigation:c,fusionOrbit:!0,fusionOrbitConstrained:!0,useFirstPersonNavigation:!0,envMapBackground:!1,renderPrism:!0};var d=function(a,c){if(this.clientContainer=a,this.container=document.createElement("div"),this.container.className="adsk-viewing-viewer",this.container.style.height="100%",this.container.style.width="100%",this.container.style.overflow="hidden",this.container.classList.add(isTouchDevice()?"touch":"notouch"),this.clientContainer.appendChild(this.container),this.config=c,this.contextMenu=null,this.contextMenuCallbacks={},this.__firefoxLMBfix=!1,this.started=!1,"CANVAS"===this.container.nodeName)throw"Viewer must be initialized on a div [temporary]";this.canvasWrap=document.createElement("div"),this.canvasWrap.classList.add("canvas-wrap"),this.canvas=document.createElement("canvas"),this.canvas.tabIndex=0,this.canvasWrap.appendChild(this.canvas),this.container.appendChild(this.canvasWrap),this.canvas.viewer=this,this.running=!1,this._pushedTool="",this._defaultNavigationTool="",this.stats={category:"misc_stats",explode_count:0,get_props_count:0,isolate_count:0},this.prefs=new b.Preferences(this,"Autodesk.Viewing.Private.GuiViewer3D.SavedSettings.")};d.prototype.constructor=d,a.EventDispatcher.prototype.apply(d.prototype),a.ScreenModeMixin.prototype.apply(d.prototype),a.ExtensionMixin.prototype.apply(d.prototype),d.ScreenMode=a.ScreenMode,d.kDefaultCanvasConfig={click:{onObject:["selectOnly"],offObject:["deselectAll"]},clickAlt:{onObject:["setCOI"],offObject:["setCOI"]},clickCtrl:{onObject:["selectToggle"],offObject:["deselectAll"]},clickShift:{onObject:["selectToggle"],offObject:["deselectAll"]},disableSpinner:!1,disableMouseWheel:!1,disableTwoFingerSwipe:!1},d.prototype.start=function(){if(this.started)return 0;var a=this.initialize();if(0===a&&(this.started=!0,this.config&&this.config.hasOwnProperty("extensions")))for(var b=this.config.extensions,c=0;c<b.length;++c)this.loadExtension(b[c],this.config);return a},d.prototype.registerUniversalHotkeys=function(){var b,c,d,e=this,f=a.theHotkeyManager.KEYCODES;b=function(){return e.navigation.setRequestFitToView(!0),!0},a.theHotkeyManager.pushHotkeys("Autodesk.FitToView",[{keycodes:[f.f],onPress:b}]),b=function(){return e.navigation.setRequestHomeView(!0),!0},a.theHotkeyManager.pushHotkeys("Autodesk.Home",[{keycodes:[f.h],onPress:b},{keycodes:[f.HOME],onPress:b}]),c=function(){return e.objectContextMenu&&e.objectContextMenu.hide()?!0:(e.fireEvent({type:a.ESCAPE_EVENT}),!0)},a.theHotkeyManager.pushHotkeys("Autodesk.Escape",[{keycodes:[f.ESCAPE],onRelease:c}]),b=function(){return d=e.getActiveNavigationTool(),e.setActiveNavigationTool("pan")},c=function(){return e.setActiveNavigationTool(d)};var g=[{keycodes:[f.SHIFT],onPress:b,onRelease:c},{keycodes:[f.SPACE],onPress:b,onRelease:c}];a.theHotkeyManager.pushHotkeys("Autodesk.Pan",g,{tryUntilSuccess:!0})},d.prototype.createControls=function(){var b=this,c=b.impl;return b.navigation=new a.Navigation(c.camera),b.__initAutoCam(c),b.utilities=new a.ViewingUtilities(c,b.autocam,b.navigation),b.clickHandler=new a.DefaultHandler(c,b.navigation,b.utilities),b.toolController=new a.ToolController(c,b,b.autocam,b.utilities,b.clickHandler),b.toolController.registerTool(new a.GestureHandler(b)),b.toolController.registerTool(a.theHotkeyManager),b.toolController.activateTool(a.theHotkeyManager.getName()),b.registerUniversalHotkeys(),b.toolController.registerTool(new a.OrbitDollyPanTool(c,b)),b.toolController.activateTool("gestures"),b.toolController},d.prototype.initialize=function(){var c=detectWebGL();if(0>=c)return-1===c?a.ErrorCodes.BROWSER_WEBGL_NOT_SUPPORTED:a.ErrorCodes.BROWSER_WEBGL_DISABLED;var e=this;this.onResizeCallback=function(a){e.resize()},window.addEventListener("resize",this.onResizeCallback,!1),this.setScreenModeDelegate(this.config?this.config.screenModeDelegate:void 0),this.initContextMenu(),this.localize();var f=this.getDimensions();this.canvas.width=f.width,this.canvas.height=f.height,isIOSDevice()&&window.devicePixelRatio&&(this.canvas.width/=window.devicePixelRatio,this.canvas.height/=window.devicePixelRatio),this.impl=new b.Viewer3DImpl(this.canvas,this),this.impl.controls=this.createControls(),this.setDefaultNavigationTool("orbit"),this.model=null,this.impl.controls&&this.impl.controls.setAutocam(this.autocam);var g=this.config&&this.config.canvasConfig?this.config.canvasConfig:d.kDefaultCanvasConfig;if(this.setCanvasClickBehavior(g),this.loader=document.createElement("div"),this.loader.id="loader",this.loader.className="spinner",this.container.appendChild(this.loader),!g.disableSpinner)for(var h=1;3>=h;h++){var i=document.createElement("div");i.className="bounce"+h,this.loader.appendChild(i)}return this.initSettings(),this.viewerState=new b.ViewerState(this),this.config&&this.config.hasOwnProperty("startOnInitialize")&&!this.config.startOnInitialize||this.run(),window.NOP_VIEWER=this,0},d.prototype.setUp=function(a){if(this.config=a,this.config&&this.config.hasOwnProperty("extensions"))for(var b=this.config.extensions,c=0;c<b.length;++c)this.loadExtension(b[c],this.config);var e=this.config&&this.config.canvasConfig?this.config.canvasConfig:d.kDefaultCanvasConfig;this.setCanvasClickBehavior(e)},d.prototype.tearDown=function(){if(this.clearSelection(),this.loadedExtensions){for(var a in this.loadedExtensions)try{this.unloadExtension(a)}catch(c){stderr("Failed to unload extension: "+a),console.log("  error: "+c.message),console.error("  stack:\n"+c.stack);var d=b.logger;d&&d.log({category:"error_unload_extension",extensionId:a,error_message:c.message,call_stack:c.stack})}this.loadedExtensions=null}this.__logStats(),this.loader.style.display="block",this.model=null,this.impl.unloadCurrentModel()},d.prototype.run=function(){this.running||(this.resize(),this.running=!0,this.impl.run())},d.prototype.localize=function(){a.i18n.localize()},d.prototype.__logStats=function(a){var c=b.logger;c&&(this.stats.explode_count||this.stats.get_props_count||this.stats.isolate_count)&&(c.log(this.stats,a),this.stats.explode_count=0,this.stats.get_props_count=0,this.stats.isolate_count=0)},d.prototype.__initAutoCam=function(a){function b(a){d.autocamCamera.isPerspective!==e.isPerspective&&(d.autocamCamera.isPerspective?d.navigation.toPerspective():d.navigation.toOrthographic()),d.navigation.setVerticalFov(d.autocamCamera.fov,!1),d.navigation.setView(d.autocamCamera.position,d.autocamCamera.target),d.navigation.setPivotPoint(d.autocamCamera.pivot),d.navigation.setCameraUpVector(d.autocamCamera.up),a&&d.navigation.setWorldUpVector(d.autocamCamera.worldup),d.impl.syncCamera(a)}function c(a){d.utilities?d.utilities.pivotActive(a,!1):d.impl.controls.pivotActive(a,!1)}var d=this,e=a.camera;e.pivot||(e.pivot=new THREE.Vector3(0,0,0)),e.target||(e.target=new THREE.Vector3(0,0,0)),e.worldup||(e.worldup=e.up.clone()),d.autocamCamera=e.clone(),d.autocamCamera.target=e.target.clone(),d.autocamCamera.pivot=e.pivot.clone(),d.autocamCamera.worldup=e.worldup.clone(),d.autocam=new Autocam(d.autocamCamera,d.navigation),d.autocam.cameraChangedCallback=b,d.autocam.pivotDisplayCallback=c,d.autocam.canvas=d.canvas,d.addEventListener("cameraChanged",function(a){var b=a.camera;d.autocam.sync(b)}),d.autocam.sync(e)},d.prototype.uninitialize=function(c){window.removeEventListener("resize",this.onResizeCallback,!1),this.onResizeCallback=null,this.canvas.parentNode.removeChild(this.canvas),this.canvas.viewer=null,this.canvas=null,this.canvasWrap=null,this.viewerState=null,this.__logStats();var d=b.logger;d&&d.log({category:"viewer_destroy"},!0),this.toolController&&(this.toolController.uninitialize(),this.toolController=null,this.clickHandler=null,this.utilities=null),this.navigation&&(this.navigation.uninitialize(),this.navigation=null),this.impl&&(this.impl.dtor(),this.impl=null),this.loader=null,this.model=null,this.prefs=null,this.autocam.dtor(),this.autocam=null,this.autocamCamera=null,a.theHotkeyManager.popHotkeys("Autodesk.FitToView"),a.theHotkeyManager.popHotkeys("Autodesk.Home"),a.theHotkeyManager.popHotkeys("Autodesk.Escape"),a.theHotkeyManager.popHotkeys("Autodesk.Pan"),a.theHotkeyManager.popHotkeys("Autodesk.Orbit"),this.onDefaultContextMenu&&(this.container.removeEventListener("contextmenu",this.onDefaultContextMenu,!1),this.onDefaultContextMenu=null),this.container&&this.container.parentNode&&this.container.parentNode.removeChild(this.container),this.container=null,this.screenModeDelegate&&(this.screenModeDelegate.uninitialize(),this.screenModeDelegate=null),this.clientContainer=null,this.config=null,this.listeners={},this.contextMenu=null,this.contextMenuCallbacks=null,
this.fireEvent(a.VIEWER_UNINITIALIZED),this.listeners={},stderr("viewer destroy")},d.prototype.finish=function(){this.tearDown(),this.uninitialize()},d.prototype.load=function(a,b,c,d){var e={ids:null,sharedPropertyDbPath:b};return this.loadModel(a,e,c,d)},d.prototype.loadModel=function(b,c,d,e){function f(){if(j.model.is2d())a.theHotkeyManager.popHotkeys("Autodesk.Orbit");else{var b,c=function(){return b=j.getActiveNavigationTool(),j.setActiveNavigationTool("orbit")},d=function(){return j.setActiveNavigationTool(b)},e=[{keycodes:[a.theHotkeyManager.KEYCODES.ALT],onPress:c,onRelease:d}];a.theHotkeyManager.pushHotkeys("Autodesk.Orbit",e,{tryUntilSuccess:!0})}}function g(a){j.model=a,j.impl.addModel(j.model),j.loader.style.display="None",j.model.is2d()&&j.activateLayerState("Initial"),f(),d&&d()}function h(a,b,c,d){j.loader.style.display="None",e&&e(a,b,c,d)}function i(){j.impl.needsRender=!0,j.removeEventListener(a.GEOMETRY_LOADED_EVENT,i)}var j=this;c=c||{},this.addEventListener(a.GEOMETRY_LOADED_EVENT,i);var k,l=b.toLowerCase().match(/\.([a-z0-9]+$)/),m=l?l[1]:null;return k=c&&c.fileLoader?c.fileLoader:a.FileLoaderManager.getFileLoaderForExtension(m),new k(this.impl).loadFile(b,c,g,h)},d.prototype.getDimensions=function(){if(this.container){var b={};return this.getScreenMode()===a.ScreenMode.kFullScreen?(b.width=screen.width,b.height=screen.height):b=this.container.getBoundingClientRect(),{width:b.width,height:b.height}}return null},d.prototype.resize=function(){return this.impl.resize(this.container.clientWidth,this.container.clientHeight)},d.prototype.getCamera=function(){return this.impl.camera},d.prototype.getState=function(a){return this.viewerState.getState(a)},d.prototype.restoreState=function(b,c,d){var e=this.viewerState.restoreState(b,c,d);return e&&this.fireEvent({type:a.VIEWER_STATE_RESTORED_EVENT,value:e}),e},d.prototype.setViewFromArray=function(a,b){this.setActiveNavigationTool("orbit");var c=this.model?this.model.getData().globalOffset:{x:0,y:0,z:0},d={position:new THREE.Vector3(a[0]-c.x,a[1]-c.y,a[2]-c.z),target:new THREE.Vector3(a[3]-c.x,a[4]-c.y,a[5]-c.z),up:new THREE.Vector3(a[6],a[7],a[8]),aspect:a[9],fov:THREE.Math.radToDeg(a[10]),orthoScale:a[11],isPerspective:!a[12]};this.impl.setViewFromCamera(d)},d.prototype.setViewFromViewBox=function(a,b){var c=this.model;if(c&&!c.is2d())return void console.warn("Viewer3D.setViewFromViewBox is not applicable to 3D");if(b&&b.length){var d,e=c.getData().metadata,f=e.views;for(d=0;d<f.length&&f[d].name!=b;d++);if(d<f.length){var g=f[d].layer_state;g&&this.activateLayerState(g)}}this.impl.setViewFromViewBox(this.model,a,b,!1)},d.prototype.activateLayerState=function(b){if(b&&b.length){var c=this.model.getData().metadata,d=c.layer_states;if(!d)return;var e;for(e=0;e<d.length&&d[e].name!=b;e++);if(e<d.length){var f=d[e],g=f.visible_layers,h={};if(g&&0<g.length)for(var i=0;i<g.length;i++)h[g[i]]=1;var j=[],k=[];for(var l in c.layers){var m=c.layers[l].name;1===h[m]?j.push(l):k.push(l)}this.impl.setLayerVisible(j,!0),this.impl.setLayerVisible(k,!1),this.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}}},d.prototype.getLayerStates=function(){function a(a,b){var c=Object.getOwnPropertyNames(a),d=Object.getOwnPropertyNames(b);if(c.length!==d.length)return!1;for(var e=0;e<c.length;++e){var f=c[e];if(a[f]!==b[f])return!1}return!0}var b=this.model,c=b?b.getData().metadata:null,d=c?c.layers:null,e=c?c.layer_states:null;if(!d||!e)return null;var f,g={},h={};for(var i in d)if(d.hasOwnProperty(i)){var j=parseInt(i),k=d[i];f="string"==typeof k?k:k.name,g[f]=!0,this.impl.isLayerVisible(j)&&(h[f]=!0)}var l,m,n=[];for(l=0;l<e.length;++l){var o=e[l],p=o.visible_layers,q={};if(!o.hidden){if(p&&0<p.length)for(m=0;m<p.length;++m)f=p[m],g.hasOwnProperty(f)&&(q[f]=!0);n.push({name:o.name,description:o.description,active:a(h,q)})}}return 0<n.length?n:null},d.prototype.setViewFromFile=function(){this.setActiveNavigationTool(),this.impl.setViewFromFile(this.model)},d.prototype.getProperties=function(b,c,d){this.stats.get_props_count++,this.model?this.model.getProperties(b,c,d):d&&d(a.ErrorCodes.BAD_DATA,"Properties failed to load since model does not exist")},d.prototype.getObjectTree=function(b,c){this.model?this.model.getObjectTree(b,c):c&&c(a.ErrorCodes.BAD_DATA,"ObjectTree failed to load since model does not exist")},d.prototype.setCanvasClickBehavior=function(a){if(this.impl.controls.hasOwnProperty("setClickBehavior")&&this.impl.controls.setClickBehavior(a),this.clickHandler&&this.clickHandler.setClickBehavior(a),a&&a.disableMouseWheel&&this.toolController.setMouseWheelInputEnabled(!1),a&&a.disableTwoFingerSwipe){var b=this.toolController.getTool("gestures");b&&b.disableTwoFingerSwipe()}},d.prototype.search=function(b,c,d,e){this.searchText=b,this.model?this.model.search(b,c,d,e):d&&d(a.ErrorCodes.BAD_DATA,"Search failed since model does not exist")},d.prototype.getHiddenNodes=function(){return this.impl.visibilityManager.getHiddenNodes()},d.prototype.getIsolatedNodes=function(){return this.model&&this.model.is2d()?(console.warn("Viewer3D.getIsolatedNodes is not yet implemented for 2D"),[]):this.impl.visibilityManager.getIsolatedNodes()},d.prototype.isolate=function(a){if(this.model&&this.model.is2d())return void console.warn("Viewer3D.isolate is not yet implemented for 2D");var c=this;this.model.getObjectTree(function(){c.stats.isolate_count++,c.impl.visibilityManager.isolate(a)});var d=b.logger;d&&d.log({category:"isolate"})},d.prototype.isolateById=function(a){return console.warn("isolateById() is deprecated. Use isolate() instead."),this.isolate(a)},d.prototype.setBackgroundColor=function(a,b,c,d,e,f){this.impl.setClearColors(a,b,c,d,e,f)},d.prototype.toggleSelect=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.toggleSelect is not yet implemented for 2D"):void this.impl.selector.toggleSelection(a)},d.prototype.select=function(a){"number"==typeof a&&(a=[a]),this.impl.selector.setSelection(a)},d.prototype.clearSelection=function(){this.impl.selector.clearSelection();var a=b.logger;a&&a.log({category:"clearselection"})},d.prototype.getSelectionVisibility=function(){return this.impl.selector.getSelectionVisibility()},d.prototype.getSelectionCount=function(){return this.impl.selector.getSelectionLength()},d.prototype.setSelectionMode=function(a){this.impl.selector.setSelectionMode(a)},d.prototype.getSelection=function(){return this.impl.selector.getSelection()},d.prototype.getAggregateSelection=function(a){var b=this.impl.selector.getAggregateSelection();if(a)for(var c=0;c<b.length;c++)for(var d=0;d<b[c].selection.length;d++)a(b[c].model,b[c].selection[d]);return b},d.prototype.hide=function(a){if(this.model&&this.model.is2d())return void console.warn("Viewer3D.hide is not yet implemented for 2D");var c=b.logger;c&&c.log({category:"hide"}),this.impl.visibilityManager.hide(a)},d.prototype.hideById=function(a){this.hide(a)},d.prototype.show=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.show is not yet implemented for 2D"):void this.impl.visibilityManager.show(a)},d.prototype.showAll=function(){this.impl.visibilityManager.isolate(),this.model.is2d()&&this.setLayerVisible(null,!0);var a=b.logger;a&&a.log({category:"showall"})},d.prototype.toggleVisibility=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.toggleVisibility is not yet implemented for 2D"):void this.impl.visibilityManager.toggleVisibility(a)},d.prototype.areAllVisible=function(){return this.impl.isWholeModelVisible(this.model)},d.prototype.explode=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.explode is not applicable to 2D"):(this.stats.explode_count++,void this.impl.explode(a))},d.prototype.getExplodeScale=function(){return this.model&&this.model.is2d()?(console.warn("Viewer3D.getExplodeScale is not applicable to 2D"),0):this.impl.getExplodeScale()},d.prototype.setQualityLevel=function(a,b){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setQualityLevel is not applicable to 2D"):(this.prefs.set("ambientShadows",a),this.prefs.set("antialiasing",b),void this.impl.togglePostProcess(a,b))},d.prototype.setGhosting=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGhosting is not applicable to 2D"):(this.prefs.set("ghosting",a),void this.impl.toggleGhosting(a))},d.prototype.setGroundShadow=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundShadow is not applicable to 2D"):(this.prefs.set("groundShadow",a),void this.impl.toggleGroundShadow(a))},d.prototype.setGroundReflection=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundReflection is not applicable to 2D"):(this.prefs.set("groundReflection",a),void this.impl.toggleGroundReflection(a))},d.prototype.setEnvMapBackground=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setEnvMapBackground is not applicable to 2D"):(this.prefs.set("envMapBackground",a),void this.impl.toggleEnvMapBackground(a))},d.prototype.setRenderPrism=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setRenderPrism is not applicable to 2D"):(this.prefs.set("renderPrism",a),void this.impl.toggleRenderPrism(a))},d.prototype.setProgressiveRendering=function(a){this.prefs.set("progressiveRendering",a),this.impl.toggleProgressive(a)},d.prototype.setOptimizeNavigation=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setOptimizeNaviation is not applicable to 2D"):(this.prefs.set("optimizeNavigation",a),void this.impl.setOptimizeNavigation(a))},d.prototype.setActiveNavigationTool=function(b){if(b===this._pushedTool||!b&&!this._pushedTool)return!0;if(this._pushedTool){if(!this.impl.controls.deactivateTool(this._pushedTool))return!1;this._pushedTool=null}var c=!b||b===this.getDefaultNavigationToolName();return c&&null===this._pushedTool?(this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this.getDefaultNavigationToolName()}),!0):this.impl.controls.activateTool(b)?(this._pushedTool=b,this.fireEvent({type:a.NAVIGATION_MODE_CHANGED_EVENT,id:this._pushedTool}),!0):!1},d.prototype.getActiveNavigationTool=function(){return this._pushedTool?this._pushedTool:this._defaultNavigationTool},d.prototype.setDefaultNavigationTool=function(a){this._defaultNavigationTool&&this.impl.controls.deactivateTool(this._defaultNavigationTool),this._pushedTool&&this.impl.controls.deactivateTool(this._pushedTool),this.impl.controls.activateTool(a),this._defaultNavigationTool=a,this._pushedTool&&this.impl.controls.activateTool(this._pushedTool)},d.prototype.getDefaultNavigationToolName=function(){return this._defaultNavigationTool},d.prototype.getFOV=function(){return this.navigation.getVerticalFov()},d.prototype.setFOV=function(a){this.navigation.setVerticalFov(a,!0)},d.prototype.getFocalLength=function(){return this.navigation.getFocalLength()},d.prototype.setFocalLength=function(a){this.navigation.setFocalLength(a,!0)},d.prototype.hideLines=function(b){function c(){d.impl.hideLines(b),d.removeEventListener(a.GEOMETRY_LOADED_EVENT,c)}this.prefs.set("lineRendering",!b);var d=this;this.impl.hideLines(b)||this.addEventListener(a.GEOMETRY_LOADED_EVENT,c)},d.prototype.applyCamera=function(a,b){this.impl.setViewFromCamera(a,!0),b&&this.fitToView()},d.prototype.fitToView=function(c){var d=this,e=!0,f=d.model,g=function(){var b=null;if(Array.isArray(c)&&c.length>0){for(var i=new THREE.Box3,j=new THREE.Box3,k=f.getData().instanceTree,l=f.getFragmentList(),m=0;m<c.length;m++)k.enumNodeFragments(c[m],function(a){l.getWorldBounds(a,j),i.union(j)},!0);i.empty()||(b=i)}return(!b||b.empty())&&(b=d.impl.getFitBounds()),d.navigation.fitBounds(!1,b),d.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,h),d.removeEventListener(a.GEOMETRY_LOADED_EVENT,g),e},h=function(){f&&f.isLoadDone()?g():(e=!1,d.addEventListener(a.GEOMETRY_LOADED_EVENT,g))},i=f.getData().propertydb,j=i&&i.attrs.length>0,k=b.logger;k&&k.log({category:"navigation",name:"fit"}),!f.is2d()&&j&&null!==c&&void 0!==c?f&&f.isObjectTreeCreated()?h():(e=!1,this.addEventListener(a.OBJECT_TREE_CREATED_EVENT,h)):this.navigation.fitBounds(!1,this.impl.getFitBounds(!0))},d.prototype.setClickConfig=function(a,b,c){var d=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in d){var e=d[a];if(b in e)return e[b]=c,!0}return!1},d.prototype.getClickConfig=function(a,b){var c=this.clickHandler?this.clickHandler.getClickBehavior():this.impl.controls.getClickBehavior();if(a in c){var d=c[a];if(b in d)return d[b]}return null},d.prototype.setClickToSetCOI=function(a,b){b!==!1&&this.prefs.set("clickToSetCOI",a);var c=this.getClickConfig("click","onObject");a?-1===c.indexOf("setCOI")&&this.setClickConfig("click","onObject",["setCOI"]):c.indexOf("setCOI")>=0&&this.setClickConfig("click","onObject",["selectOnly"])},d.prototype.initSettings=function(){this.prefs.load(a.DefaultSettings),this.prefs.tag("3d"),this.prefs.tag("2d"),this.prefs.untag("2d",["viewCube","alwaysUsePivot","zoomTowardsPivot","reverseHorizontalLookDirection","reverseVerticalLookDirection","orbitPastWorldPoles","clickToSetCOI","ghosting","optimizeNavigation","ambientShadows","antialiasing","groundShadow","groundReflection","lineRendering","lightPreset","envMapBackground","renderPrism"]),this.setQualityLevel(this.prefs.ambientShadows,this.prefs.antialiasing),this.setGroundShadow(this.prefs.groundShadow),this.setGroundReflection(this.prefs.groundReflection),this.setGhosting(this.prefs.ghosting),this.setProgressiveRendering(this.prefs.progressiveRendering),this.setClickToSetCOI(this.prefs.clickToSetCOI),this.setOptimizeNavigation(this.prefs.optimizeNavigation),this.hideLines(!this.prefs.lineRendering),this.setEnvMapBackground(this.prefs.envMapBackground),this.setRenderPrism(this.prefs.renderPrism),this.navigation.setUsePivotAlways(this.prefs.alwaysUsePivot),this.navigation.setReverseZoomDirection(this.prefs.reverseMouseZoomDir),this.navigation.setReverseHorizontalLookDirection(this.prefs.reverseHorizontalLookDirection),this.navigation.setReverseVerticalLookDirection(this.prefs.reverseVerticalLookDirection),this.navigation.setZoomTowardsPivot(this.prefs.zoomTowardsPivot),this.navigation.setOrbitPastWorldPoles(this.prefs.orbitPastWorldPoles),this.navigation.setUseLeftHandedInput(this.prefs.leftHandedMouseSetup);var b=this.prefs.backgroundColorPreset;if(b)try{var c=JSON.parse(b);this.impl.setClearColors(c[0],c[1],c[2],c[3],c[4],c[5])}catch(d){this.prefs.set("backgroundColorPreset",null)}var e=this.prefs.lightPreset;this.impl.setLightPreset(e)},d.prototype.setLightPreset=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setLightPreset is not applicable to 2D"):(this.prefs.set("lightPreset",a),void this.impl.setLightPreset(a))},d.prototype.setUsePivotAlways=function(a){this.prefs.set("alwaysUsePivot",a),this.navigation.setUsePivotAlways(a)},d.prototype.setReverseZoomDirection=function(a){this.prefs.set("reverseMouseZoomDir",a),this.navigation.setReverseZoomDirection(a)},d.prototype.setReverseHorizontalLookDirection=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setReverseHorizontalLookDirection is not applicable to 2D"):(this.prefs.set("reverseHorizontalLookDirection",a),void this.navigation.setReverseHorizontalLookDirection(a))},d.prototype.setReverseVerticalLookDirection=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setReverseVerticalLookDirection is not applicable to 2D"):(this.prefs.set("reverseVerticalLookDirection",a),void this.navigation.setReverseVerticalLookDirection(a))},d.prototype.setZoomTowardsPivot=function(a){this.prefs.set("zoomTowardsPivot",a),this.navigation.setZoomTowardsPivot(a)},d.prototype.setOrbitPastWorldPoles=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setOrbitPastWorldPoles is not applicable to 2D"):(this.prefs.set("orbitPastWorldPoles",a),void this.navigation.setOrbitPastWorldPoles(a))},d.prototype.setUseLeftHandedInput=function(a){this.prefs.set("leftHandedMouseSetup",a),this.navigation.setUseLeftHandedInput(a)},d.prototype.setLayerVisible=function(b,c,d){function e(a,b){var c=[];if(a.isLayer)c.push(a.index);else for(var d=a.children,f=0;f<d.length;++f)c=c.concat(e(d[f]));return c}if(this.model&&!this.model.is2d())return void console.warn("Viewer3D.setLayerVisible is not yet implemented for 3D");var f=this,g=f.model.getLayersRoot();if(g&&0!==g.childCount){null===b&&(b=[g]),Array.isArray(b)||(b=[b]),d&&(f.impl.setLayerVisible(e(g),!1),c=!0);for(var h=[],i=0;i<b.length;++i)h=h.concat(e(b[i]));f.impl.setLayerVisible(h,c),f.fireEvent({type:a.LAYER_VISIBILITY_CHANGED_EVENT})}},d.prototype.isLayerVisible=function(a){return this.model&&!this.model.is2d()?(console.warn("Viewer3D.isLayerVisible is not yet implemented for 3D"),!1):!!(a&&a.isLayer&&this.impl.isLayerVisible(a.index))},d.prototype.anyLayerHidden=function(){function a(c){if(c.isLayer)return!b.impl.isLayerVisible(c.index);for(var d=c.children,e=0;e<d.length;++e)if(a(d[e]))return!0;return!1}if(this.model&&!this.model.is2d())return console.warn("Viewer3D.anyLayerHidden is not yet implemented for 3D"),!1;var b=this,c=b.model.getLayersRoot();return!(!c||!a(c))},d.prototype.setGroundShadowColor=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundShadowColor is not applicable to 2D"):void this.impl.setGroundShadowColor(a)},d.prototype.setGroundShadowAlpha=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundShadowAlpha is not applicable to 2D"):void this.impl.setGroundShadowAlpha(a)},d.prototype.setGroundReflectionColor=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundReflectionColor is not applicable to 2D"):void this.impl.setGroundReflectionColor(a)},d.prototype.setGroundReflectionAlpha=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.setGroundReflectionAlpha is not applicable to 2D"):void this.impl.setGroundReflectionAlpha(a)},d.prototype.getCutPlanes=function(){return this.model&&this.model.is2d()?(console.warn("Viewer3D.getCutPlanes is not applicable to 2D"),[]):this.impl.getCutPlanes()},d.prototype.setCutPlanes=function(a){return this.model&&this.model.is2d()?void console.warn("Viewer3D.getCutPlanes is not applicable to 2D"):void this.impl.setCutPlanes(a)},d.prototype.getScreenShot=function(a,b,c){return this.impl.getScreenShot(a,b,c)},d.prototype.getScreenShotBuffer=function(a,b,c){return this.impl.getScreenShotBuffer(a,b,c)},d.prototype.setContextMenu=function(a){this.contextMenu&&this.contextMenu.hide(),this.contextMenu=a||null},d.prototype.setDefaultContextMenu=function(){var a=Autodesk.Viewing.Extensions;return a&&a.ViewerObjectContextMenu?(this.setContextMenu(new a.ViewerObjectContextMenu(this)),!0):!1},d.prototype.triggerContextMenu=function(a){return this.config&&this.config.onTriggerContextMenuCallback&&this.config.onTriggerContextMenuCallback(a),this.contextMenu?(this.contextMenu.show(a),!0):!1},d.prototype.triggerSelectionChanged=function(a){this.config&&this.config.onTriggerSelectionChangedCallback&&this.config.onTriggerSelectionChangedCallback(a)},d.prototype.triggerDoubleTapCallback=function(a){this.config&&this.config.onTriggerDoubleTapCallback&&this.config.onTriggerDoubleTapCallback(a)},d.prototype.triggerSingleTapCallback=function(a){this.config&&this.config.onTriggerSingleTapCallback&&this.config.onTriggerSingleTapCallback(a)},d.prototype.initContextMenu=function(){function a(a){var b=a.button;"buttons"in a&&(!c.__firefoxLMBfix||1&a.buttons?2===b&&1&a.buttons&&(b=0,c.__firefoxLMBfix=!0):(c.__firefoxLMBfix=!1,b=0));var d=c.navigation?c.navigation.getUseLeftHandedInput():!1,e=d?0:2;return b===e?!0:!1}var b=!this.config||(this.config.hasOwnProperty("disableBrowserContextMenu")?this.config.disableBrowserContextMenu:!0);b&&(this.onDefaultContextMenu=function(a){a.preventDefault()},this.container.addEventListener("contextmenu",this.onDefaultContextMenu,!1));var c=this,d=this.canvas||this.container;d.addEventListener("mousedown",function(b){a(b)&&(c.startX=b.clientX,c.startY=b.clientY)}),d.addEventListener("mouseup",function(b){return a(b)&&b.clientX===c.startX&&b.clientY===c.startY&&c.triggerContextMenu(b),!0},!1)},d.prototype.registerContextMenuCallback=function(a,b){this.contextMenuCallbacks[a]=b},d.prototype.unregisterContextMenuCallback=function(a){return a in this.contextMenuCallbacks?(delete this.contextMenuCallbacks[a],!0):!1},d.prototype.runContextMenuCallbacks=function(a,b){for(var c in this.contextMenuCallbacks)this.contextMenuCallbacks.hasOwnProperty(c)&&this.contextMenuCallbacks[c](a,b)},d.prototype.playAnimation=function(a){var b=this.impl.keyFrameAnimator;b&&b.play(0,a)},d.prototype.joinLiveReview=function(a){this.impl.joinLiveReviewSession(a)},d.prototype.leaveLiveReview=function(){this.impl.leaveLiveReviewSession()},d.prototype.getAttributeToIdMap=function(b,c){this.model?this.model.getAttributeToIdMap(b,c):c&&c(a.ErrorCodes.UNKNOWN_FAILURE,"Function getAttributeToIdMap failed")},d.prototype.setModelUnits=function(a){this.model&&(this.model.getData().overriddenUnits=a)},d.prototype.worldToClient=function(a){var b=new THREE.Vector4(a.x,a.y,a.z,1);return b.applyMatrix4(this.impl.camera.matrixWorldInverse),b.applyMatrix4(this.impl.camera.projectionMatrix),b.w>0&&(b.x/=b.w,b.y/=b.w,b.z/=b.w),this.impl.viewportToClient(b.x,b.y)},d.prototype.clientToWorld=function(a,b){var c=null,d=this.model,e=d.getData();if(d.is2d()){var f=this.impl.intersectGround(a,b);if(f){f.z=0;var g=e.bbox;(e.hidePaper||g.containsPoint(f))&&(c={point:f})}}else{var h=function(a,b,c,d){var e=d.impl.clientToViewport(a,b);return e.z=c,e.unproject(d.impl.camera),e},i=function(a,b,c){var d=h(a,b,-1,c),e=h(a,b,1,c);return e.sub(d),e.normalize(),new THREE.Ray(d,e)},j=i(a,b,this),k=new THREE.Raycaster;k.set(j.origin,j.direction);var l=this.impl.modelQueue();c=l.rayIntersect(j.origin,j.direction)}return c},Autodesk.Viewing.Viewer3D=d}(),Autodesk.Viewing.ErrorCodes={UNKNOWN_FAILURE:1,BAD_DATA:2,NETWORK_FAILURE:3,NETWORK_ACCESS_DENIED:4,NETWORK_FILE_NOT_FOUND:5,NETWORK_SERVER_ERROR:6,NETWORK_UNHANDLED_RESPONSE_CODE:7,BROWSER_WEBGL_NOT_SUPPORTED:8,BAD_DATA_NO_VIEWABLE_CONTENT:9,BROWSER_WEBGL_DISABLED:10,RTC_ERROR:11},function(){"use strict";function a(a,b,c,e){a.application="autodesk";var f=new XMLHttpRequest;f.open("POST",ACM_SESSION_URL,!0),f.setRequestHeader("Content-Type","application/json"),f.setRequestHeader("Authorization","Bearer "+b),f.onload=function(){200===f.status&&(d.ACM_SESSION_ID=JSON.parse(f.responseText).acmsession),e()},f.onerror=c,f.ontimeout=c,f.send(JSON.stringify(a)),delete a.application}function b(a){var b={};for(var c in a)-1!=c.indexOf("x-ads-acm")&&(b[c]=a[c]);return b}function c(a){for(var b in a)if("oauth2AccessToken"===b)return a[b];return null}var d=Autodesk.Viewing;d.HTTP_REQUEST_HEADERS={},d.ACM_SESSION_ID=void 0;var e=function(a,b){function c(a){if(a){var b=a.children?a.children.length:0;if("geometry"===a.type&&b){for(var d=0,f=0;b>f;f++){var g=a.children[f];g&&"view"===g.type&&(e.myViewGeometry[g.guid]=a,d++)}e.myNumViews[a.guid]=d}else if("application/autodesk-db"==a.mime&&a.urn)0===a.urn.indexOf("urn:adsk.objects:os.object")?e.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("%2F")+3):e.myPropertyDb=a.urn.substr(0,a.urn.lastIndexOf("/")+1);else if(b>0)for(var f=0;b>f;f++)c(a.children[f])}}function d(a){if(a)for(var b=a.children?a.children.length:0,c=0;b>c;c++)a.children[c].parent=a,d(a.children[c])}this.myPath=b,this.myData=a,this.myViewGeometry={},this.myNumViews={},this.myPropertyDb=null;var e=this;c(a),d(this.myData)};e.prototype.constructor=e,e.load=function(f,g,h,i){function j(a){if(-1===a.indexOf("urn:")){if(-1!==a.indexOf("://"))return a;var b=a;return 0!==b.indexOf("/")&&(b="/"+b),window.location.protocol+"//"+window.location.host+b}return a}function k(a){var b=e.getSubItemsWithProperties(a.getRootItem(),{type:"folder",role:"viewable"},!0),c=b[0],d=e.getSubItemsWithProperties(c,{type:"geometry"},!0);return d.length}function l(a,b){var c=[],d=0,e=0;b=b||"children";var f=function(a){var g=a[b]||[],h=a.messages||[],i=h.filter(function(a){return"error"===a.type});i.length>0&&(d+=1),"inprogress"===a.status&&(e+=1),Array.prototype.push.apply(c,h.slice(0));for(var j=g.length;j--;f(g[j]));};f(a);var g="translated";g=d>0?"failed":g,g=e>0?"processing":g;for(var h=c.length;h--;c[h].$translation=g);return c}function m(){function a(a){var b=/<[^>]*script/;if(b.test(a))return void(h&&h(d.ErrorCodes.BAD_DATA,"Malicious document content detected Abort loading"));var f="string"==typeof a?JSON.parse(a):a,i=new e(f,c);if(k(i)>0){var j=l(i.getRootItem());g&&g(i,j)}else if(h){var j=l(i.getRootItem()),m=d.ErrorCodes.BAD_DATA_NO_VIEWABLE_CONTENT,n="No viewable content";h(m,n,j)}}function b(a,b,c){var e=l(c);if(h){var f="Error: "+a+" ("+b+")",g=d.Private.ErrorHandler.getErrorCode(a);h(g,f,a,b,e)}}var c=j(f),i={headers:d.HTTP_REQUEST_HEADERS,withCredentials:!!auth};try{d.Private.ViewingService.get(VIEWING_URL,"bubbles",c,a,b,i)}catch(m){if(h){var n="An exception occurred while loading the document",o=d.ErrorCodes.UNKNOWN_FAILURE;h(o,n,null)}}}if("function"!=typeof arguments[1]&&(console.log("Document.load called with deprecated (auth) parameter"),"function"==typeof arguments[2]&&(g=arguments[2]),"function"==typeof arguments[3]&&(h=arguments[3])),i){var n=b(i),o=c(i);d.HTTP_REQUEST_HEADERS=n,a(n,o,h,m)}else m()},e.prototype.getFullPath=function(a){if(!a)return a;var b=a;return d.Private.offline?b=decodeURIComponent(d.Private.offlineResourcePrefix)+b.substr(b.indexOf("/")):0===a.indexOf("urn")?b=VIEWING_URL+"/items/"+a:0===a.indexOf("$file$")&&-1!==this.myPath.indexOf("/bubble.json")&&(b=this.myPath.replace("/bubble.json","")+a.replace("$file$","")),b},e.prototype.getThumbnailPath=function(a,b,c){var e=b?b:200,f=c?c:200,g=VIEWING_URL+"/thumbnails/"+this.myData.urn+"?guid="+encodeURIComponent(a.guid)+"&width="+e+"&height="+f;return d.ACM_SESSION_ID&&(g+="&acmsession="+d.ACM_SESSION_ID),g},e.prototype.getViewablePath=function(a){if("geometry"===a.type){var b=[];if("3d"===a.role?b=e.getSubItemsWithProperties(a,{mime:"application/autodesk-svf"},!1):"2d"===a.role&&(b=e.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1),0==b.length&&(b=e.getSubItemsWithProperties(a,{role:"tileRoot"},!0))),b.length>0)return this.getFullPath(b[0].urn)}else if("view"===a.type){var c=this.getViewGeometry(a);if(c)return this.getViewablePath(c)}return""},e.prototype.getPropertyDbPath=function(){return this.myPropertyDb},e.prototype.getRootItem=function(){return this.myData},e.prototype.getPath=function(){return this.myPath},e.prototype.getItemById=function(a){function b(c){if(!c)return null;for(var d in c){var e=c[d];if("guid"===d&&e===a)return c;if(null!==e&&"object"==typeof e&&"parent"!==d){var f=b(e);if(f)return f}}return null}return b(this.myData)},e.getSubItemsWithProperties=function(a,b,c){function d(a,b){for(var c in b)if(!(c in a)||b[c]!==a[c])return!1;return!0}var f=[];if(!a)return[];for(var g=a.children?a.children.length:0,h=0;g>h;h++){var i=a.children[h];d(i,b)&&f.push(i),c&&f.push.apply(f,e.getSubItemsWithProperties(i,b,c))}return f},e.prototype.getViewGeometry=function(a){return this.myViewGeometry[a.guid]},e.prototype.getNumViews=function(a){return this.myNumViews[a.guid]||0},e.prototype.getParentId=function(a){var b=this.getItemById(a);if(!b)return null;var c=b.parent;return c?c.guid:null},e.prototype.getMessages=function(a,b){var c=[];if(!a)return c;var d=null;b&&(d=this.getRootItem());for(var e=a;e&&(!b||parent!==d);){if(e.messages)for(var f=0;f<e.messages.length;f++)c.push(e.messages[f]);e=e.parent}return c},d.Document=e}(),AutodeskNamespace("Autodesk.Viewing"),Autodesk.Viewing.Navigation=function(a){var b=6.88,c=100,d=1e-6;this.__options={dollyToPivot:!1,orbitPastPoles:!0,reverseDolly:!1,reverseHorizontalLook:!1,reverseVerticalLook:!1,useLeftHandedInput:!1,usePivotAlways:!1,lockNavigation:!1},this.__pivotIsSetFlag=!1,this.__fitToViewRequested=!1,this.__homeViewRequested=!1,this.__transitionActive=!1,this.__destinationView=null,this.__is2D=!1,this.__isTouchDevice=!1,this.__kEpsilon=d;var e=null,f={left:0,top:0,width:1,height:1};this.uninitialize=function(){this.setCamera(null)},this.setCamera=function(a){a!==e&&(e=a,a&&(a.hasOwnProperty("target")||(a.target=new THREE.Vector3(0,0,0)),a.hasOwnProperty("pivot")||(a.pivot=new THREE.Vector3(0,0,0)),a.worldup=a.up.clone(),a.dirty=!0))},this.getCamera=function(){return e},this.setScreenViewport=function(a){f=a},this.getScreenViewport=function(){return f},this.__setUp=function(a){if(a&&e){var b=a.clone().normalize(),c=b.sub(e.worldup);if(0!==c.lengthSq())return e.worldup.copy(a).normalize(),e.dirty=!0,!0}return!1},this.__getUp=function(){return e?e.worldup:new THREE.Vector3(0,1,0)},this.setView=function(a,b){e&&a&&b&&!this.__options.lockNavigation&&(e.position.copy(a),e.target.copy(b),e.dirty=!0)},this.orientCameraUp=function(){e&&!this.__options.lockNavigation&&(e.up.copy(this.getAlignedUpVector()),e.dirty=!0)},this.getPivotPoint=function(){return e?e.pivot.clone():new THREE.Vector3(0,0,0)},this.setPivotPoint=function(a){e&&a&&!this.__options.lockNavigation&&(e.pivot.copy(a),e.dirty=!0)},this.getPosition=function(){return e?e.position.clone():new THREE.Vector3(0,0,1)},this.setPosition=function(a){e&&a&&!this.__options.lockNavigation&&(e.position.copy(a),e.dirty=!0)},this.setTarget=function(a){e&&a&&!this.__options.lockNavigation&&(e.target.copy(a),e.dirty=!0)},this.getTarget=function(){return e?e.target.clone():new THREE.Vector3(0,0,0)},this.getEyeVector=function(){return e?e.target.clone().sub(e.position):new THREE.Vector3(0,0,-1)},this.getFovMin=function(){return b},this.getFovMax=function(){return c},this.isPointVisible=function(a){var b=(new THREE.Frustum).setFromMatrix(e.projectionMatrix.clone().multiply(e.matrixWorldInverse));return b.containsPoint(a)},this.setVerticalFov=function(a,f){if((!e||e.isPerspective)&&(b>a?a=b:a>c&&(a=c),e&&!this.__options.lockNavigation)){if(Math.abs(e.fov-a)<=d)return;if(f){var g=this.__pivotIsSetFlag&&this.isPointVisible(this.getPivotPoint()),h=this.getPosition(),i=this.getEyeVector(),j=THREE.Math.degToRad(e.fov),k=THREE.Math.degToRad(a),l=g?this.getPivotPlaneDistance():i.length(),m=l*Math.tan(.5*j)/Math.tan(.5*k),n=i.normalize().multiplyScalar(l-m);this.setPosition(h.add(n)),g&&this.setTarget(this.getTarget().add(n))}e.setFov(a),e.dirty=!0}},this.computeFit=function(a,b,d,e){if(!e||e.empty())return{position:a,target:b};var f=e.center(),g=e.size(),h=.5*Math.sqrt(g.x*g.x+g.y*g.y+g.z*g.z);if(0===h&&(h=1),!this.getIs2D()){var i=Math.max(1,.9+d/c*.5);h*=i}var j=a.clone().sub(b).normalize(),k=h/Math.tan(THREE.Math.degToRad(.5*d));j.multiplyScalar(k);var l=f.clone().add(j);return{position:l,target:f}},this.computeOrthogonalUp=function(a,b){var c=this.__getUp(),d=b.clone().sub(a);if(0===d.lengthSq())return d.copy(c);var e=d.clone().cross(c);return 0===e.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z-=1e-4,e.crossVectors(d,c)),e.cross(d).normalize()},this.fitBounds=function(a,b,c){var d=this.getTarget(),f=this.getPosition();if(this.__options.lockNavigation||!b||b.empty())return{position:f,target:d};var g=this.getVerticalFov(),h=this.computeFit(f,d,g,b),i=c?this.computeOrthogonalUp(f,d):e.up;return a?(e.up.copy(i),this.setView(h.position,h.target)):this.setRequestTransitionWithUp(!0,h.position,h.target,g,i),this.setPivotPoint(h.target),this.setPivotSetFlag(!0),h},this.updateCamera=function(){e&&(e.updateProjectionMatrix(),this.orient(e,e.target,e.position,e.up),e.dirty=!1)},this.setCamera(a)},Autodesk.Viewing.Navigation.prototype.constructor=Autodesk.Viewing.Navigation,Autodesk.Viewing.Navigation.prototype.setIs2D=function(a){this.__is2D=!!a},Autodesk.Viewing.Navigation.prototype.getIs2D=function(){return this.__is2D},Autodesk.Viewing.Navigation.prototype.setIsTouchDevice=function(a){
this.__isTouchDevice=!!a},Autodesk.Viewing.Navigation.prototype.getIsTouchDevice=function(){return this.__isTouchDevice},Autodesk.Viewing.Navigation.prototype.orient=function(){function a(){b||(b=new THREE.Matrix4,c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3)}var b,c,d,e;return function(f,g,h,i){a();var j=b.elements;e.subVectors(h,g).normalize(),0===e.lengthSq()&&(e.z=1),c.crossVectors(i,e).normalize(),0===c.lengthSq()&&(i.z>i.y?e.y-=1e-4:e.z+=1e-4,c.crossVectors(i,e).normalize()),d.crossVectors(e,c),j[0]=c.x,j[4]=d.x,j[8]=e.x,j[1]=c.y,j[5]=d.y,j[9]=e.y,j[2]=c.z,j[6]=d.z,j[10]=e.z,f.setRotationFromMatrix(b)}}(),Autodesk.Viewing.Navigation.prototype.fov2fl=function(a){var b=12,c=THREE.Math.degToRad(a);return 0>=c&&(c=1e-4),Math.round(b/Math.tan(.5*c))},Autodesk.Viewing.Navigation.prototype.fl2fov=function(a){var b=12;0>=a&&(a=1e-4);var c=2*Math.atan(b/a);return THREE.Math.radToDeg(c)},Autodesk.Viewing.Navigation.prototype.setCameraUpVector=function(a){if(!this.__options.lockNavigation){var b=this.getCamera();b.up.copy(a),b.dirty=!0}},Autodesk.Viewing.Navigation.prototype.getCameraUpVector=function(){var a=this.getCameraRightVector(!1),b=this.getEyeVector();return a.cross(b).normalize()},Autodesk.Viewing.Navigation.prototype.getAlignedUpVector=function(){var a=this.getCameraRightVector(!0),b=this.getEyeVector();return a.cross(b).normalize()},Autodesk.Viewing.Navigation.prototype.getCameraRightVector=function(a){var b=new THREE.Vector3,c=a?this.getWorldUpVector():this.getCamera().up,d=this.getEyeVector();return b.crossVectors(d,c),0===b.lengthSq()&&(c.z>c.y?d.y-=1e-4:d.z+=1e-4,b.crossVectors(d,c)),b.normalize()},Autodesk.Viewing.Navigation.prototype.setWorldUpVector=function(a,b){this.__options.lockNavigation||(this.__setUp(a),b&&this.orientCameraUp())},Autodesk.Viewing.Navigation.prototype.getWorldUpVector=function(){return this.__getUp().clone()},Autodesk.Viewing.Navigation.prototype.getWorldRightVector=function(){var a=new THREE.Vector3;return a.copy(this.__getUp()),Math.abs(a.z)<=Math.abs(a.y)?a.set(a.y,-a.x,0):a.z>=0?a.set(a.z,0,-a.x):a.set(-a.z,0,a.x),a.normalize()},Autodesk.Viewing.Navigation.prototype.getVerticalFov=function(){return this.getCamera().fov},Autodesk.Viewing.Navigation.prototype.getHorizontalFov=function(){var a=this.getScreenViewport();return this.getCamera().fov*(a.width/a.height)},Autodesk.Viewing.Navigation.prototype.getFocalLength=function(){return this.fov2fl(this.getVerticalFov())},Autodesk.Viewing.Navigation.prototype.setFocalLength=function(a,b){this.setVerticalFov(this.fl2fov(a),b)},Autodesk.Viewing.Navigation.prototype.setReverseZoomDirection=function(a){this.__options.reverseDolly=!!a},Autodesk.Viewing.Navigation.prototype.setReverseHorizontalLookDirection=function(a){return this.getIs2D()?void console.warn("Autodesk.Viewing.Navigation.setReverseHorizontalLookDirection is not applicable to 2D"):void(this.__options.reverseHorizontalLookDirection=!!a)},Autodesk.Viewing.Navigation.prototype.setReverseVerticalLookDirection=function(a){return this.getIs2D()?void console.warn("Autodesk.Viewing.Navigation.setReverseVerticalLookDirection is not applicable to 2D"):void(this.__options.reverseVerticalLookDirection=!!a)},Autodesk.Viewing.Navigation.prototype.getReverseZoomDirection=function(){return this.__options.reverseDolly},Autodesk.Viewing.Navigation.prototype.getReverseHorizontalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseHorizontalLookDirection is not applicable to 2D"),!1):this.__options.reverseHorizontalLookDirection},Autodesk.Viewing.Navigation.prototype.getReverseVerticalLookDirection=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.getReverseVerticalLookDirection is not applicable to 2D"),!1):this.__options.reverseVerticalLookDirection},Autodesk.Viewing.Navigation.prototype.setZoomTowardsPivot=function(a){this.__options.dollyToPivot=!!a},Autodesk.Viewing.Navigation.prototype.getZoomTowardsPivot=function(){return this.__options.dollyToPivot},Autodesk.Viewing.Navigation.prototype.setOrbitPastWorldPoles=function(a){return this.getIs2D()?void console.warn("Autodesk.Viewing.Navigation.setOrbitPastWorldPoles is not applicable to 2D"):void(this.__options.orbitPastPoles=!!a)},Autodesk.Viewing.Navigation.prototype.getOrbitPastWorldPoles=function(){return this.getIs2D()?(console.warn("Autodesk.Viewing.Navigation.orbitPastWorldPoles is not applicable to 2D"),!1):this.__options.orbitPastPoles},Autodesk.Viewing.Navigation.prototype.setUsePivotAlways=function(a){this.__options.usePivotAlways=!!a},Autodesk.Viewing.Navigation.prototype.getUsePivotAlways=function(){return this.__options.usePivotAlways},Autodesk.Viewing.Navigation.prototype.setUseLeftHandedInput=function(a){this.__options.useLeftHandedInput=!!a},Autodesk.Viewing.Navigation.prototype.getUseLeftHandedInput=function(){return this.__options.useLeftHandedInput},Autodesk.Viewing.Navigation.prototype.setIsLocked=function(a){this.__options.lockNavigation=!!a},Autodesk.Viewing.Navigation.prototype.getIsLocked=function(){return this.__options.lockNavigation},Autodesk.Viewing.Navigation.prototype.setPivotSetFlag=function(a){this.__options.lockNavigation||(this.__pivotIsSetFlag=!!a)},Autodesk.Viewing.Navigation.prototype.getPivotSetFlag=function(){return this.__pivotIsSetFlag},Autodesk.Viewing.Navigation.prototype.setRequestFitToView=function(a){this.__options.lockNavigation||(this.__fitToViewRequested=!!a)},Autodesk.Viewing.Navigation.prototype.getRequestFitToView=function(){return this.__fitToViewRequested},Autodesk.Viewing.Navigation.prototype.setRequestHomeView=function(a){this.__options.lockNavigation||(this.__homeViewRequested=!!a)},Autodesk.Viewing.Navigation.prototype.getRequestHomeView=function(){return this.__homeViewRequested},Autodesk.Viewing.Navigation.prototype.setRequestTransition=function(a,b,c,d,e){a?this.__destinationView={position:b.clone(),coi:c.clone(),fov:d,up:this.getCamera().up.clone(),worldUp:this.getWorldUpVector(),reorient:e}:this.__destinationView=null},Autodesk.Viewing.Navigation.prototype.setRequestTransitionWithUp=function(a,b,c,d,e,f){a?this.__destinationView={position:b.clone(),coi:c.clone(),fov:d,up:e.clone(),worldUp:f?f:this.getWorldUpVector(),reorient:!1}:this.__destinationView=null},Autodesk.Viewing.Navigation.prototype.getRequestTransition=function(){return this.__destinationView},Autodesk.Viewing.Navigation.prototype.setTransitionActive=function(a){this.__transitionActive=!!a},Autodesk.Viewing.Navigation.prototype.getTransitionActive=function(){return this.__transitionActive},Autodesk.Viewing.Navigation.prototype.getWorldSize=function(a){var b=this.getScreenViewport(),c=b.width/b.height,d=2*a*Math.tan(THREE.Math.degToRad(.5*this.getCamera().fov)),e=d*c;return new THREE.Vector2(e,d)},Autodesk.Viewing.Navigation.prototype.getWorldPoint=function(a,b){b=1-b,a=2*a-1,b=2*b-1;var c,d=this.getCamera();d.isPerspective&&(c=new THREE.Vector3(a,b,1),c=c.unproject(d));var e,f,g=this.getEyeVector(),h=this.getPosition();if(!d.isPerspective||isNaN(c.x)){var i=this.getWorldSize(g.length()),j=this.getCameraRightVector(!1).multiplyScalar(.5*a*i.x),k=this.getCameraUpVector().multiplyScalar(.5*b*i.y);e=g.clone().add(j).add(k).normalize()}else e=c.sub(h).normalize();var l=this.getPivotPoint(),m=this.__pivotIsSetFlag&&(this.getIs2D()||d.isPerspective&&this.isPointVisible(l));if(m){var n=e.dot(g);f=0!==n?Math.abs(l.sub(h).dot(g))/n:l.sub(h).length()}else f=d.isPerspective?.5*(d.near+d.far):d.orthoScale;return e.multiplyScalar(f).add(h)},Autodesk.Viewing.Navigation.prototype.getPivotPlaneDistance=function(){var a=this.getPivotPoint(),b=this.getEyeVector(),c=this.getPosition();return a.sub(c).dot(b.normalize())},Autodesk.Viewing.Navigation.prototype.panRelative=function(a,b,c){var d=this.getWorldSize(c),e=a*d.x,f=b*d.y,g=this.getCameraRightVector(!1).multiplyScalar(e),h=this.getCameraUpVector().multiplyScalar(f),i=g.add(h);this.setView(this.getPosition().add(i),this.getTarget().add(i))},Autodesk.Viewing.Navigation.prototype.dollyFromPoint=function(a,b){if(!(Math.abs(a)<=this.__kEpsilon)){var c=this.getPosition(),d=b.clone().sub(c),e=d.length(),f=e+a,g=10*this.__kEpsilon;g>f&&(f=g);var h=f/e;if(Math.abs(h-1)>this.__kEpsilon){d.multiplyScalar(h),d.set(-d.x,-d.y,-d.z);var i=d.add(b),j=this.getEyeVector();this.getCamera().isPerspective||j.multiplyScalar(h),this.setView(i,j.add(i))}}},Autodesk.Viewing.Navigation.prototype.toPerspective=function(){if(this.getIs2D())return void console.warn("Autodesk.Viewing.Navigation.toPerspective is not applicable to 2D");var a=this.getCamera();this.__options.lockNavigation||a.isPerspective||(a.toPerspective(),a.dirty=!0)},Autodesk.Viewing.Navigation.prototype.toOrthographic=function(){var a=this.getCamera();!this.__options.lockNavigation&&a.isPerspective&&(a.toOrthographic(),a.dirty=!0)},Autodesk.Viewing.Navigation.snapToAxis=function(a){var b=new THREE.Vector3(Math.abs(a.x),Math.abs(a.y),Math.abs(a.z));return b.x>b.y&&b.x>b.z?a.set(a.x>0?1:-1,0,0):b.y>b.x&&b.y>b.z?a.set(0,a.y>0?1:-1,0):a.set(0,0,a.z>0?1:-1),a},function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=function(a,b){this.appContainerId=a,this.container=document.getElementById(a),this.options=b,this.myRegisteredViewers={},this.myDocument=null,this.myCurrentViewer=null,this.urn=null,this.selectedItem=null};c.prototype.k3D="3D",c.prototype.k2D="2D",c.prototype.finish=function(){this.myCurrentViewer&&(this.myCurrentViewer.finish(),this.myCurrentViewer=null)},c.prototype.registerViewer=function(a,b,c){c=c||{},this.options&&this.options.hasOwnProperty("disableBrowserContextMenu")&&(c.hasOwnProperty("disableBrowserContextMenu")||(c.disableBrowserContextMenu=this.options.disableBrowserContextMenu)),this.myRegisteredViewers[a]={},this.myRegisteredViewers[a]["class"]=b,this.myRegisteredViewers[a].config=c},c.prototype.getViewerClass=function(a){return this.myRegisteredViewers.hasOwnProperty(a)?this.myRegisteredViewers[a]["class"]:null},c.prototype.getViewerContainer=function(){return document.getElementById(this.appContainerId)},c.prototype.getViewer=function(a,b,c){if(a in this.myRegisteredViewers){var d,e={},f=this.myRegisteredViewers[a].config;for(d in f)f.hasOwnProperty(d)&&(e[d]=f[d]);for(d in b)if(b.hasOwnProperty(d)){var g=b[d],h=Array.isArray(g),i=e[d],j=Array.isArray(i);h&&j?(g?h||(g=[g]):g=[],i?j||(i=[i]):i=[],e[d]=i.concat(g)):e[d]=g}var k=this.myRegisteredViewers[a]["class"];if(this.myCurrentViewer&&this.myCurrentViewer.__proto__.constructor===k)return this.myCurrentViewer.tearDown(),this.myCurrentViewer.setUp(e),this.myCurrentViewer;this.setCurrentViewer(null);for(var l=this.getViewerContainer();l.hasChildNodes();)l.removeChild(l.lastChild);var m=new k(l,e),n=m.start();if(0===n)return this.setCurrentViewer(m),m;c&&c(n,"Viewer failed to initialize")}return null},c.prototype.setCurrentViewer=function(a){this.myCurrentViewer&&this.myCurrentViewer.finish(),this.myCurrentViewer=a},c.prototype.getCurrentViewer=function(){return this.myCurrentViewer},c.prototype.loadDocument=function(c,d,e,f){var g=this;b.logger&&b.logger.log({category:"load_document",urn:0==c.indexOf("urn:")?c.substring(4):c}),a.Document.load(c,function(a,b){g.myDocument=a,g.onDocumentLoaded(a,b),d&&d(a,b)},function(a,b,c,d,f){g.onDocumentFailedToLoad(b,a,f),e&&e(a,b,c,d,f)},f)},c.prototype.onDocumentLoaded=function(a,b){console.log(a,b)},c.prototype.onDocumentFailedToLoad=function(a,b,c){console.log(a,b,c)},c.prototype.getDefaultGeometry=function(a){for(var b=0,c=a.length;c>b;++b){var d=a[b].useAsDefault;if(d===!0||"true"===d)return a[b]}return a[0]},c.prototype.selectItem=function(a,c,d){var e=this.myDocument.getViewablePath(a);if(e){var f,g,h,i,j;if("geometry"===a.type&&"3d"===a.role){var k=a.properties;if(k)for(var l in k)if(k.hasOwnProperty(l)&&k[l]._UnitLinear){j=k[l]._UnitLinear;break}f=this.k3D,h=a.name,i=a}else if("view"===a.type&&"3d"===a.role)g=a,f=this.k3D,i=this.myDocument.getViewGeometry(a),i&&(h=i.name);else if("geometry"===a.type&&"2d"===a.role){var m=Autodesk.Viewing.Document.getSubItemsWithProperties(a,{mime:"application/autodesk-f2d"},!1);f=m.length>0?this.k3D:this.k2D,h=a.name,i=a}else"view"===a.type&&"2d"===a.role&&(g=a,f=this.k3D,i=this.myDocument.getViewGeometry(a),i&&(h=i.name));var n=b.logger;if(n){var o=e.indexOf("urn:");n.log({category:"load_viewable",role:a.role,type:a.type,urn:-1!==o?e.substring(o+4):e})}var p=this.myDocument.getMessages(a,!0);if(f){var q=this,r=this.myCurrentViewer&&this.urn===e,s=null;s=g&&g.camera?function(){q.myCurrentViewer.setViewFromArray(g.camera,g.name),j&&q.myCurrentViewer.setModelUnits(j),c&&c(q.myCurrentViewer,a,p)}:g&&g.viewbox?function(){q.myCurrentViewer.setViewFromViewBox(g.viewbox,g.name),j&&q.myCurrentViewer.setModelUnits(j),c&&c(q.myCurrentViewer,a,p)}:r?function(){q.myCurrentViewer.setViewFromFile(),j&&q.myCurrentViewer.setModelUnits(j),c&&c(q.myCurrentViewer,a,p)}:function(){j&&q.myCurrentViewer.setModelUnits(j),c&&c(q.myCurrentViewer,a,p)};var t=function(a,b,c,e){d&&d(a,b,c,e,p)},u=!1;if(r)s&&s(),u=!0;else{this.urn=null;var v={defaultModelStructureTitle:h,viewableName:h};a.hasOwnProperty("extensions")&&(v.extensions=Array.isArray(a.extensions)?a.extensions:[a.extensions]);var w=this.getViewer(f,v,d);w&&w.load(this.myDocument.getFullPath(e),this.myDocument.getPropertyDbPath(),s,t)&&(this.urn=e,u=!0)}if(u)return this.selectedItem=a,this.onItemSelected(a,i),!0}}return!1},c.prototype.onItemSelected=function(a,b){if(stderr("Selected URL: http://"+location.host+location.pathname+"?document=urn:"+this.myDocument.getRootItem().guid+"&item="+encodeURIComponent(a.guid)),this.itemSelectedObservers)for(var c=this.getCurrentViewer(),d=0;d<this.itemSelectedObservers.length;++d){var e=this.itemSelectedObservers[d];e.onItemSelected&&e.onItemSelected(c,a,b)}},c.prototype.addItemSelectedObserver=function(a){this.itemSelectedObservers||(this.itemSelectedObservers=[]),this.itemSelectedObservers.push(a)},c.prototype.selectItemById=function(a,b,c){var d=this.myDocument.getItemById(a);return d?this.selectItem(d,b,c):!1},c.prototype.getSelectedItem=function(){return this.selectedItem},a.ViewingApplication=c}(),AutodeskNamespace("Autodesk.Viewing.Private"),Autodesk.Viewing.Private.ViewCubeUi=function(a){this.viewer=a,this.cube=null,this.viewcube=null,this.infoButton=null,this.homeViewContainer=null},Autodesk.Viewing.Private.ViewCubeUi.prototype={constructor:Autodesk.Viewing.UI.ViewCube,create:function(){var a=this.viewer.config,b=a&&void 0!==a.wantInfoButton?a.wantInfoButton:!0;b&&this.initInfoButton(),this.initHomeButton()},initInfoButton:function(){if(!(0<document.getElementsByClassName("infoButton").length)){this.infoButton=document.createElement("div"),this.infoButton.className="infoButton",this.infoButton.style.cursor="pointer",this.viewer.container.appendChild(this.infoButton);var a=this;this.infoButton.addEventListener("click",function(b){var c=a.viewer.getPropertyPanel(!0),d=!c.areDefaultPropertiesShown()||!c.isVisible();d&&c.showDefaultProperties(),d!==c.isVisible()&&c.setVisible(d)})}},initHomeButton:function(){if(!(0<document.getElementsByClassName("homeViewWrapper").length)){var a=document.createElement("div");a.className="homeViewWrapper",a.style.cursor="pointer",this.viewer.container.appendChild(a),this.homeViewContainer=a;var b=this;a.addEventListener("click",function(a){b.viewer.navigation.setRequestHomeView(!0)}),this._initHomeMenu(a)}},_initHomeMenu:function(a){var b=this.viewer,c=b.autocam,d=this;this.hideHomeViewMenu=function(a){h.style.display="none",document.removeEventListener("click",d.hideHomeViewMenu)};var e=document.createElement("div");e.className="homeViewMenuHandle";var f=document.createElement("img"),g="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEBSURBVHja7JcxCsIwFIb/V3oFx04v4iB4A3ev4Ak9iOABOhQcageHDh7iuVSwpW1eYmIFEwiFQvN9SZP/ERIRLNkyLNySQBLIhy+I6AhgE5F5FZHTpACAbV3X61h0Zs5nVwBAJiL0rd+eNuHvnQIArTEmplhrE7gAWEUUePSO/Vg1jJgFvQyYWoFoWTDMgLlNWDFzIyIUqjNzA6DSCpwBlMaYW4iZd+OU3bh2ARG5h5J4h3fj6nIghIQNbg2iTyQ0cFUS+kho4eoodpFwgTvVAo2EK9y5GM1J+MC9quGYhC98shaoPiQqAOwB7Hzhrxn1umMrABy6pxeT0t3w7wWeAwD5qe4YizvzugAAAABJRU5ErkJggg==";f.src=g,f.width=f.height=18,e.appendChild(f),e.addEventListener("mouseover",function(a){f.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsSAAALEgHS3X78AAAAIGNIUk0AAH7FAACLdgAA9UcAAIsOAABxUAAA6BUAADlYAAAfBMec4XAAAAEVSURBVHja7JcxDoJAEEX/rvY2HMEb6AEsaTDxBngKIzfgDBR6AxJtiI0egN7Ght6GWBIYGzVKQHaQDYU7yYSwxb5HMvs3CCJCnyXRcxkBIzAsLwyWpx0ARyNzn29m81oBAE60mmqj237smBkwAl9PAfIssv3Y1kbMs+j9VZQvIyHEGMBI40enRHSpFdCcBR8ZUJcD2rKgnAH1Q5gmnu3HXcOBNPGUBIrQDbqUeMKL0A2UBIjo2pXEO5yIrso50IVEE7wxiH6RUIErJWEbCVW4chRzJDhw1l2gIsGFPzdmNQBLLrZr6R7pcL69WrpHkovtGoDF2o8rUCXRFt5aoCzRFl4pwCwLwOTxBGOeXi3Mv+HfC9wHAAIQ03ZDDGqmAAAAAElFTkSuQmCC"}),e.addEventListener("mouseleave",function(a){f.src=g}),a.appendChild(e);var h=document.createElement("div");h.className="homeViewMenu",this.viewer.container.appendChild(h);var i=document.createElement("div");i.className="homeViewMenuItem",i.textContent=Autodesk.Viewing.i18n.translate("Set current view as Home"),h.appendChild(i),i.addEventListener("click",function(a){c.setCurrentViewAsHome(!1),d.hideHomeViewMenu(a)});var j=document.createElement("div");j.className="homeViewMenuItem",j.textContent=Autodesk.Viewing.i18n.translate("Focus and set as Home"),h.appendChild(j),j.addEventListener("click",function(a){c.setCurrentViewAsHome(!0),d.hideHomeViewMenu(a)});var k=document.createElement("div");k.className="homeViewMenuItem",k.textContent=Autodesk.Viewing.i18n.translate("Reset Home"),h.appendChild(k),k.addEventListener("click",function(a){c.resetHome(),d.hideHomeViewMenu(a)}),a.addEventListener("mouseover",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(e.style.display="block")}),a.addEventListener("mouseleave",function(a){e.style.display="none"}),e.addEventListener("click",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(h.style.display="block",document.addEventListener("click",d.hideHomeViewMenu)),a.stopPropagation()}),a.addEventListener("contextmenu",function(a){(b.model&&b.model.is2d()||b.prefs&&!b.prefs.viewCube)&&(h.style.display="block",document.addEventListener("click",d.hideHomeViewMenu))})},displayViewCube:function(a,b){if(b!==!1&&this.viewer.prefs.set("viewCube",a),a&&!this.cube)this.viewcube=document.createElement("div"),this.viewcube.className="viewcube",this.viewer.container.appendChild(this.viewcube),this.cube=new Autocam.ViewCube("cube",this.viewer.autocam,this.viewcube,LOCALIZATION_REL_PATH);else if(!this.cube)return void this._positionHomeButton();this.viewcube.style.display=a?"block":"none",this._positionHomeButton(),a&&this.viewer.autocam.refresh()},_positionHomeButton:function(){if(this.homeViewContainer){var a,b=this.cube&&this.viewcube&&"block"===this.viewcube.style.display,c=this.viewer.container.getBoundingClientRect(),d=this.homeViewContainer.getBoundingClientRect();if(b){var e=this.viewcube.getBoundingClientRect();a=c.left+c.width-e.left-d.width}else if(this.infoButton){var f=this.infoButton.getBoundingClientRect();a=c.left+c.width-f.left+f.width-d.width}else a=10;this.homeViewContainer.style.right=a+"px"}},uninitialize:function(){this.viewcube&&(this.viewer.container.removeChild(this.viewcube),this.viewcube=null),this.infoButton=null,this.cube&&(this.cube.dtor(),this.cube=null),this.homeViewContainer=null,this.hideHomeViewMenu=null,this.viewer=null}},function(){"use strict";var a=Autodesk.Viewing,b=Autodesk.Viewing.Private,c=Autodesk.Viewing.UI,d=Autodesk.Viewing.Extensions;a.TOOLBAR_CREATED_EVENT="toolbarCreated",a.TOOLBAR={NAVTOOLSID:"navTools",MODELTOOLSID:"modelTools",SETTINGSTOOLSID:"settingsTools"};var e=function(b,c){c||(c={}),c.startOnInitialize=!1,a.Viewer3D.call(this,b,c),this.toolbar=null,this.dockingPanels=[],this.modelstructure=null,this.layersPanel=null};e.prototype=Object.create(a.Viewer3D.prototype),e.prototype.constructor=e,e.prototype.initialize=function(){var c=a.Viewer3D.prototype.initialize.call(this);if(c>0)return c;var d=this;if(this.toolController){var e=new a.HotGestureTool(this);this.toolController.registerTool(e),this.toolController.activateTool(e.getName())}return this.getToolbar(!0),this.addEventListener(a.FULLSCREEN_MODE_EVENT,function(a){d.resizePanels({viewer:d}),d.updateFullscreenButton(a.mode)}),this.contextMenu||this.setDefaultContextMenu(),this.progressbar=new b.ProgressBar(this.container),this.addEventListener(a.PROGRESS_UPDATE_EVENT,function(a){void 0!==a.percent&&d.progressbar.setPercent(a.percent)},!1),this.selectionActive=!1,this.addEventListener(a.SELECTION_CHANGED_EVENT,function(a){if(d.selectionActive=a.dbIdArray.length>0,d.prefs.openPropertiesOnSelect){var b=d.getPropertyPanel(!0);b.setVisible(d.selectionActive)}}),this.addEventListener(a.ISOLATE_EVENT,function(a){(d.prefs.openPropertiesOnSelect||a.nodeIdArray[0]===d.model.getRootId())&&d.propertygrid&&d.propertygrid.setVisible(a.nodeIdArray.length>0||d.selectionActive)}),this.addEventListener(a.VIEWER_STATE_RESTORED_EVENT,function(a){d.renderoptions&&d.renderoptions.syncUI();var b=d.getSettingsPanel(!0);b&&b.syncUI()}),this.addEventListener(a.VIEWER_RESIZE_EVENT,function(a){d.resizePanels(),d.viewCubeUi&&d.viewCubeUi.cube&&d.viewCubeUi.cube.refreshCube(),d.updateToolbarButtons(a.width,a.height),d.centerToolBar&&d.centerToolBar()}),this.initEscapeHandlers(),this.localize(),this.run(),0},e.prototype.uninitialize=function(){this.viewerSettingsPanel&&(this.viewerSettingsPanel.uninitialize(),this.viewerSettingsPanel=null),this.modelstructure&&(this.modelstructure.uninitialize(),this.modelstructure=null),this.layersPanel&&(this.layersPanel.uninitialize(),this.layersPanel=null),this.propertygrid&&(this.propertygrid.uninitialize(),this.propertygrid=null),this.renderoptions&&(this.renderoptions.uninitialize(),this.renderoptions=null),this.viewerOptionButton&&(this.show3dOptionsNavigationTab=null,this.show3dOptionsPerformanceTab=null,this.viewerOptionButton=null),a.theHotkeyManager.popHotkeys("Autodesk.ROLL"),a.theHotkeyManager.popHotkeys("Autodesk.FOV"),this.removeEventListener(a.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.onRenderOptionChanged=null,this.progressbar=null,this.modelTools=null,this.navTools=null,this.settingsTools=null,this.debugMenu=null,this.modelStats=null,this.explodeSlider=null,this.explodeSubmenu=null,this.centerToolBar=null,this.viewCubeUi.uninitialize(),this.viewCubeUi=null,this.toolbar=null,a.Viewer3D.prototype.uninitialize.call(this)},e.prototype.setUp=function(b){b||(b={}),b.startOnInitialize=!1,this.getToolbar(!0),a.Viewer3D.prototype.setUp.call(this,b)},e.prototype.tearDown=function(){a.Viewer3D.prototype.tearDown.call(this),this.toolbar&&(this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.modelstructure&&this.setModelStructurePanel(null),this.propertygrid&&this.setPropertyPanel(null),this.viewerSettingsPanel&&this.setSettingsPanel(null),this.layersPanel&&this.setLayersPanel(null),this.renderoptions&&(this.removePanel(this.renderoptions),this.renderoptions.uninitialize(),this.renderoptions=null),this.removeEventListener(a.GEOMETRY_LOADED_EVENT,this.initViewCube)},e.prototype.loadModel=function(b,c,d,e){var f=this;this.initViewCube=function(){f.displayViewCube(f.prefs.viewCube),f.removeEventListener(a.GEOMETRY_LOADED_EVENT,f.initViewCube)};var g=this.config.disabledExtensions;-1==b.indexOf(".f2d")||this.impl.model?(this.createUI("3d"),-1===this.getDefaultNavigationToolName().indexOf("orbit")&&this.setDefaultNavigationTool("orbit"),f.prefs.useFirstPersonNavigation?this.loadExtension("Autodesk.FirstPerson",null):this.loadExtension("Autodesk.Beeline",null),this.loadExtension("Autodesk.Viewing.Oculus",null),this.prefs.fusionOrbit&&this.loadExtension("Autodesk.Viewing.FusionOrbit",null),(!g||g&&!g.measure)&&this.loadExtension("Autodesk.Measure",null),(!g||g&&!g.section)&&this.loadExtension("Autodesk.Section",null),this.addEventListener(a.GEOMETRY_LOADED_EVENT,this.initViewCube)):(this.createUI("2d"),f.prefs.useFirstPersonNavigation?this.unloadExtension("Autodesk.FirstPerson"):this.unloadExtension("Autodesk.Beeline"),this.setDefaultNavigationTool("pan"),this.setClickToSetCOI(!1,!1),this.displayViewCube(!1,!1),(!g||g&&!g.measure)&&this.loadExtension("Autodesk.Measure",null));var h=function(){if(f.modelstructure){var b=function(a){var b=f.config.defaultModelStructureTitle?f.config.defaultModelStructureTitle:"";f.modelstructure.setModel(a,b)},c=function(a){};f.model.getObjectTree(b,c)}f.removeEventListener(a.OBJECT_TREE_CREATED_EVENT,h)};return this.addEventListener(a.OBJECT_TREE_CREATED_EVENT,h),a.Viewer3D.prototype.loadModel.call(this,b,c,d,e)},e.prototype.createUI=function(d){var e=this;this.initHotkeys(d),this.loadExtension("Autodesk.DefaultTools.NavTools",{mode:d}),this.initModelTools(d),ENABLE_DEBUG&&this.initDebugTools(),this.fireEvent({type:a.TOOLBAR_CREATED_EVENT}),this.viewCubeUi||(this.viewCubeUi=new b.ViewCubeUi(this)),this.viewCubeUi.create(),this.centerToolBar=function(){e.toolbar.container.style.left="calc(50% - "+e.toolbar.getDimensions().width/2+"px)"},this.toolbar.addEventListener(c.ToolBar.Event.SIZE_CHANGED,this.centerToolBar),this.initModality(),this.resize()},e.prototype.addOptionToggle=function(b,c,d,e,f){var g=f?this.prefs[f]:null;d="boolean"==typeof g?g:d;var h=document.createElement("li");h.className="toolbar-submenu-listitem";var i=document.createElement("input");i.className="toolbar-submenu-checkbox",i.type="checkbox",i.id=c,h.appendChild(i);var j=document.createElement("label");return j.setAttribute("for",c),j.setAttribute("data-i18n",c),j.textContent=a.i18n.translate(c),h.appendChild(j),b.appendChild(h),i.checked=d,i.addEventListener("touchstart",touchStartToClick),j.addEventListener("touchstart",touchStartToClick),h.addEventListener("touchstart",touchStartToClick),i.addEventListener("click",function(a){e(i.checked),a.stopPropagation()}),j.addEventListener("click",function(a){a.stopPropagation()}),h.addEventListener("click",function(a){e(!i.checked),a.stopPropagation()}),f&&this.prefs.addListeners(f,function(a){i.checked=a},function(a){i.checked=a,e(a)}),i},e.prototype.addOptionList=function(b,c,d,e,f,g){var h=this.prefs[g];e="number"==typeof h?h:e;var i=function(a){var b=a.target.selectedIndex;f(b),a.stopPropagation()},j=document.createElement("select");j.className="optionDropDown",j.id="selectMenu_"+c;for(var k=0;k<d.length;k++){var l=document.createElement("option");l.value=k,l.setAttribute("data-i18n",d[k]),l.textContent=Autodesk.Viewing.i18n.translate(d[k]),j.add(l)}var m=document.createElement("li");m.className="toolbar-submenu-select";var n=document.createElement("div");return n.className="toolbar-submenu-selectlabel",n.setAttribute("for",c),n.setAttribute("data-i18n",c),n.textContent=a.i18n.translate(c),m.appendChild(n),m.appendChild(j),b.appendChild(m),j.selectedIndex=e,j.onchange=i,j.addEventListener("touchstart",function(a){a.stopPropagation()}),j.addEventListener("click",function(a){a.stopPropagation()}),g&&this.prefs.addListeners(g,function(a){j.selectedIndex=a},function(a){j.selectedIndex=a,f(a)}),j},e.prototype.showViewer3dOptions=function(a){var b=this.getSettingsPanel(!0);a&&b.isVisible()&&b.setVisible(!1),b.setVisible(a)},e.prototype.showRenderingOptions=function(a){this.renderoptions.setVisible(a)},e.prototype.showLayerManager=function(a){this.layersPanel.setVisible(a)},e.prototype.initHotkeys=function(b){var c,d,e=this,f=a.theHotkeyManager.KEYCODES;if("3d"===b){var g;c=function(){return e.toolController.getIsLocked()?!1:(g=e.getActiveNavigationTool(),e.setActiveNavigationTool("fov"),!0)},d=function(){return e.toolController.getIsLocked()?!1:(e.setActiveNavigationTool(g),!0)},a.theHotkeyManager.pushHotkeys("Autodesk.FOV",[{keycodes:[f.CONTROL,f.SHIFT],onPress:c,onRelease:d}],{tryUntilSuccess:!0})}var h;c=function(){return e.toolController.getIsLocked()?!1:(h=e.getActiveNavigationTool(),e.setActiveNavigationTool("worldup"),!0)},d=function(){return e.toolController.getIsLocked()?!1:(e.setActiveNavigationTool(h),!0)},a.theHotkeyManager.pushHotkeys("Autodesk.ROLL",[{keycodes:[f.ALT,f.SHIFT],onPress:c,onRelease:d}],{tryUntilSuccess:!0})},e.prototype.setModelStructurePanel=function(b){var d=this;return b instanceof a.UI.ModelStructurePanel||null===b?(this.modelstructure&&(this.modelstructure.setVisible(!1),this.removePanel(this.modelstructure),this.modelstructure.uninitialize()),this.modelstructure=b,b&&(this.addPanel(this.modelstructure),b.addVisibilityListener(function(a){a&&d.onPanelVisible(b,d),d.settingsTools.structurebutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)}),d.model&&d.model.getObjectTree(function(a){d.modelstructure.setModel(a)})),!0):!1},e.prototype.setLayersPanel=function(b){var d=this;return this.model&&!this.model.is2d()?(console.warn("av.Viewer3D.setLayersPanel is not yet implemented for 3D"),!1):b instanceof a.UI.LayersPanel||!b?(this.layersPanel&&(this.layersPanel.setVisible(!1),this.removePanel(this.layersPanel),this.layersPanel.uninitialize()),this.layersPanel=b,b&&(this.addPanel(b),b.addVisibilityListener(function(a){a&&d.onPanelVisible(b,d),d.settingsTools.layerButton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)})),!0):!1},e.prototype.setPropertyPanel=function(b){var d=this;return b instanceof a.UI.PropertyPanel||!b?(this.propertygrid&&(this.propertygrid.setVisible(!1),this.removePanel(this.propertygrid),this.propertygrid.uninitialize()),this.propertygrid=b,b&&(this.addPanel(b),b.addVisibilityListener(function(a){a&&d.onPanelVisible(b,d),d.settingsTools.propertiesbutton.setState(a?c.Button.State.ACTIVE:c.Button.State.INACTIVE)})),!0):!1},e.prototype.getPropertyPanel=function(a){return!this.propertygrid&&a&&this.setPropertyPanel(new d.ViewerPropertyPanel(this)),this.propertygrid},e.prototype.setSettingsPanel=function(b){return b instanceof a.UI.SettingsPanel||!b?(this.viewerSettingsPanel&&(this.viewerSettingsPanel.setVisible(!1),this.removePanel(this.viewerSettingsPanel),this.viewerSettingsPanel.uninitialize()),this.viewerSettingsPanel=b,b&&this.addPanel(b),!0):!1},e.prototype.getSettingsPanel=function(a){return!this.viewerSettingsPanel&&a&&this.setSettingsPanel(new d.ViewerSettingsPanel(this,this.model.is2d()?"2d":"3d")),this.viewerSettingsPanel},e.prototype.initModelTools=function(e){var f=this;if("3d"===e){if(!f.modelstructure){var g={docStructureConfig:f.config.docStructureConfig};f.setModelStructurePanel(new d.ViewerModelStructurePanel(f,"Browser",g))}var h=new c.Button("toolbar-modelStructureTool");h.setToolTip("Model browser"),h.setIcon("adsk-icon-structure"),h.onClick=function(a){f.showModelStructurePanel(!f.modelstructure.isVisible())},this.settingsTools.addControl(h),this.settingsTools.structurebutton=h,this.initExplodeSlider()}else{var i=new d.ViewerLayersPanel(this);this.setLayersPanel(i);var j=new c.Button("toolbar-layersTool");j.setToolTip("Layer Manager"),j.setIcon("adsk-icon-layers"),j.onClick=function(a){f.layersPanel||f.setLayersPanel(new d.ViewerLayersPanel(f)),f.showLayerManager(!f.layersPanel.isVisible())},this.settingsTools.addControl(j),this.settingsTools.layerButton=j}f.addEventListener(a.RESET_EVENT,function(){f.model&&!f.model.is2d()&&(f.explode(0),f.explodeSlider.value=0),f.showAll()});var k=new c.Button("toolbar-propertiesTool");k.setToolTip("Properties"),k.setIcon("adsk-icon-properties"),k.onClick=function(a){var b=f.getPropertyPanel(!0);b.setVisible(!b.isVisible())},k.setVisible(!f.prefs.openPropertiesOnSelect),this.settingsTools.addControl(k),this.settingsTools.propertiesbutton=k;var l=new d.ViewerSettingsPanel(this,e);this.setSettingsPanel(l);var m=new c.Button("toolbar-settingsTool");if(this.viewerOptionButton=m,m.setIcon("adsk-icon-settings"),m.setToolTip("Settings"),this.settingsTools.addControl(m),this.createViewerOptionsMenu(e),ENABLE_DEBUG&&"3d"===e){
this.renderoptions=new b.RenderOptionsPanel(this),this.addPanel(this.renderoptions);var n=new c.Button("toolbar-renderOptionsTool");n.setToolTip("Rendering options"),n.setIcon("adsk-icon-settings-render"),n.onClick=function(a){f.showRenderingOptions(!f.renderoptions.isVisible())},this.settingsTools.addControl(n)}if(this.canChangeScreenMode()){var o=new c.Button("toolbar-fullscreenTool",{collapsible:!1});o.setToolTip("Full screen"),o.setIcon("adsk-icon-fullscreen"),o.onClick=function(a){f.nextScreenMode()},this.settingsTools.addControl(o),this.settingsTools.fullscreenbutton=o,this.updateFullscreenButton(this.getScreenMode())}},e.prototype.setPropertiesOnSelect=function(a){this.settingsTools.propertiesbutton.setVisible(!a)},e.prototype.addDivider=function(a){var b=document.createElement("li");return b.className="toolbar-submenu-horizontal-divider",a.appendChild(b),b},e.prototype.createViewerOptionsMenu=function(e){function f(a){var b=g.getSettingsPanel(!0);b.isVisible()&&b.isTabSelected(a)?g.showViewer3dOptions(!1):(g.showViewer3dOptions(!0),b.selectTab(a))}var g=this,h=document.createElement("div");if(h.id="toolbar-settingsToolSubmenu",h.classList.add("toolbar-submenu"),h.classList.add("toolbar-settings-sub-menu"),h.classList.add("adsk-hidden"),h.mode=e,this.container.appendChild(h),"3d"===e){for(var i=[],j=0;j<b.LightPresets.length;j++)i.push(b.LightPresets[j].name);this.viewerOptionButton.envList=this.addOptionList(h,"Background and lighting",i,4,function(a){g.blockEvent||g.setLightPreset(a)},"lightPreset"),this.onRenderOptionChanged=function(a){g.blockEvent=!0,g.viewerOptionButton.envList&&(g.viewerOptionButton.envList.selectedIndex=g.impl.currentLightPreset()),g.blockEvent=!1;var b=g.getSettingsPanel(!0);b.syncUI()},g.addEventListener(a.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),this.viewerOptionButton.displayLines=this.addOptionToggle(h,"Display Lines",!0,function(a){g.hideLines(!a)},"lineRendering"),this.addDivider(h)}var k=document.createElement("li");k.className="toolbar-submenu-listitem";var l=document.createElement("label");l.setAttribute("data-i18n","Performance and appearance settings"),l.textContent=a.i18n.translate("Performance and appearance settings"),k.appendChild(l),this.show3dOptionsPerformanceTab=function(){f(d.ViewerSettingTab.Performance)},this.viewerOptionButton.performanceOption=k,this.viewerOptionButton.performanceOption.addEventListener("touchstart",touchStartToClick),this.viewerOptionButton.performanceOption.addEventListener("click",this.show3dOptionsPerformanceTab),h.appendChild(this.viewerOptionButton.performanceOption),this.addDivider(h);var m=document.createElement("li");m.className="toolbar-submenu-listitem";var n=document.createElement("label");n.setAttribute("data-i18n","Navigation and selection settings"),n.textContent=a.i18n.translate("Navigation and selection settings"),m.appendChild(n),this.show3dOptionsNavigationTab=function(){f(d.ViewerSettingTab.Navigation)},this.viewerOptionButton.navigationOption=m,this.viewerOptionButton.navigationOption.addEventListener("touchstart",touchStartToClick),this.viewerOptionButton.navigationOption.addEventListener("click",this.show3dOptionsNavigationTab),h.appendChild(m),h.style.width=h.getBoundingClientRect().width+"px",this.container.removeChild(h),this.viewerOptionButton.onClick=function(a){h.classList.toggle("adsk-hidden"),this.setState(this.getState()===c.Button.State.ACTIVE?c.Button.State.INACTIVE:c.Button.State.ACTIVE)},this.viewerOptionButton.container.appendChild(h),this.viewerOptionButton.subMenu=h},e.prototype.removeViewerOptionsMenu=function(a){var b=this.viewerOptionButton;b.container.removeChild(b.subMenu),"3d"===a&&(this.removeEventListener(Autodesk.Viewing.RENDER_OPTION_CHANGED_EVENT,this.onRenderOptionChanged),b.envList=null),b.navigationOption.removeEventListener("touchstart",touchStartToClick),b.navigationOption.removeEventListener("click",this.show3dOptionsNavigationTab),b.navigationOption=null,b.performanceOption.removeEventListener("touchstart",touchStartToClick),b.performanceOption.removeEventListener("click",this.show3dOptionsPerformanceTab),b.performanceOption=null},e.prototype.initDebugTools=function(){var a=new c.ControlGroup("debugTools");this.debugMenu=a;var b=new c.Button("toolbar-debugTool");b.setIcon("adsk-icon-bug"),a.addControl(b),this.debugMenu.debugSubMenuButton=b,this.createDebugSubmenu(this.debugMenu.debugSubMenuButton),this.toolbar.addControl(a)},e.prototype.createDebugSubmenu=function(a){function c(){d.localize()}var d=this,e=document.createElement("div");e.id="toolbar-debugToolSubmenu",e.classList.add("toolbar-submenu"),e.classList.add("toolbar-settings-sub-menu"),e.classList.add("adsk-hidden"),this.debugMenu.subMenu=e,this.debugMenu.subMenu.style.minWidth="180px",this.container.appendChild(e),this.initModelStats(),this.addDivider(e),this.addDivider(e);var f=["English","Chinese Simplified","Chinese Traditional","Japanese","Czech","Korean","Polish","Russian","French","German","Italian","Spanish","Portuguese Brazil","Turkish"],g=["en","zh-Hans","zh-Hant","ja","cs","ko","pl","ru","fr","de","it","es","pt-br","tr"],h=d.selectedLanguage?d.selectedLanguage:0,i=this.addOptionList(e,"Language",f,h,function(a){var e=g[a];d.selectedLanguage=a,b.setLanguage(e,c)},null);i.parentNode.style.paddingBottom="15px",this.addDivider(this.debugMenu.subMenu);var j=["UNKNOWN FAILURE","BAD DATA","NETWORK ERROR","NETWORK ACCESS DENIED","NETWORK FILE NOT FOUND","NETWORK SERVER ERROR","NETWORK UNHANDLED RESPONSE CODE","BROWSER WEBGL NOT SUPPORTED","BAD DATA NO VIEWABLE CONTENT"],k=this.addOptionList(e,"Error",j,0,function(a){var c=a+1;b.ErrorHandler.reportError(d.container,c,"")},null);k.parentNode.style.paddingBottom="15px";var l=e.getBoundingClientRect();this.debugMenu.subMenu.style.width=l.width+"px",this.container.removeChild(e),a.container.appendChild(e);var m=l.left+l.width,n=this.container.getBoundingClientRect().right;if(m>n){var o=-(m-n+10)+"px";this.debugMenu.subMenu.style.left=o}a.onMouseOver=function(a){e.classList.remove("adsk-hidden")},a.onMouseOut=function(a){e.classList.add("adsk-hidden")},isTouchDevice()&&(a.onClick=function(a){e.classList.toggle("adsk-hidden")})},e.prototype.initModelStats=function(){function b(a){var b=d.impl,c="",e=d.model;e&&(c+="Geom&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().geomPolyCount+"<br>",c+="Instance&nbsp;polys:&nbsp;"+b.modelQueue().getGeometryList().instancePolyCount+"<br>",c+="Fragments:&nbsp;"+b.modelQueue().getFragmentList().getCount()+"<br>",c+="Geoms:&nbsp;"+b.modelQueue().getGeometryList().geoms.length+"<br>",c+="Loading&nbsp;time:&nbsp;"+(b.model.loader.loadTime/1e3).toFixed(2)+" s<br>"),c+="# "+(a||""),d.modelStats.innerHTML=c}function c(){d.modelStats=document.createElement("div"),d.modelStats.className="statspanel",d.container.appendChild(d.modelStats),d.addEventListener(a.PROGRESS_UPDATE_EVENT,function(a){a.message&&b(a.message)}),d.fpsDisplay=document.createElement("div"),d.fpsDisplay.className="fps",d.container.appendChild(d.fpsDisplay)}var d=this;this.addOptionToggle(this.debugMenu.subMenu,"Model statistics",!1,function(a){a&&!d.modelStats&&(c(),b("")),d.modelStats.style.visibility=a?"visible":"hidden",d.fpsDisplay.style.visibility=a?"visible":"hidden",a?d.impl.fpsCallback=function(a){d.fpsDisplay.textContent=""+(0|a)}:d.impl.fpsCallback=null})},e.prototype.initEscapeHandlers=function(){var c=this;this.addEventListener(a.ESCAPE_EVENT,function(a){if(!c.contextMenu||!c.contextMenu.hide()){if(c.renderoptions&&c.renderoptions.isVisible())return void c.renderoptions.setVisible(!1);if(c.getActiveNavigationTool()!==c.getDefaultNavigationToolName())return c.toolController&&c.toolController.setIsLocked(!1),c.setActiveNavigationTool(),void b.HudMessage.dismiss();if(c.selectionActive)return void c.clearSelection();if(!c.areAllVisible())return void c.showAll();if(!b.AlertBox.dismiss()){for(var d=0;d<c.dockingPanels.length;++d){var e=c.dockingPanels[d];if("none"!==e.container.style.display&&""!==e.container.style.display)return void(e.container===c.modelstructure?c.showModelStructurePanel(!1):e.setVisible(!1))}c.escapeScreenMode()}}})},e.prototype.displayViewCube=function(a,b){this.viewCubeUi.displayViewCube(a,b)},e.prototype.getToolbar=function(b){if(!this.toolbar&&b){var c=a.UI;this.toolbar=new c.ToolBar("guiviewer3d-toolbar"),this.navTools=new c.RadioButtonGroup(a.TOOLBAR.NAVTOOLSID),this.modelTools=new c.ControlGroup(a.TOOLBAR.MODELTOOLSID),this.settingsTools=new c.ControlGroup(a.TOOLBAR.SETTINGSTOOLSID),this.toolbar.addControl(this.navTools),this.toolbar.addControl(this.modelTools),this.toolbar.addControl(this.settingsTools),this.container.appendChild(this.toolbar.container)}return this.toolbar},e.prototype.showModelStructurePanel=function(a){this.modelstructure.setVisible(a)},e.prototype.onPanelVisible=function(a){this.dockingPanels.splice(this.dockingPanels.indexOf(a),1),this.dockingPanels.splice(0,0,a)},e.prototype.updateFullscreenButton=function(b){var c="adsk-icon-fullscreen";switch(b){case a.ScreenMode.kNormal:this.isScreenModeSupported(a.ScreenMode.kFullBrowser)||(c="adsk-icon-fullscreen");break;case a.ScreenMode.kFullBrowser:c=this.isScreenModeSupported(a.ScreenMode.kFullScreen)?"adsk-icon-fullscreen":"adsk-icon-fullscreen-exit";break;case a.ScreenMode.kFullScreen:c="adsk-icon-fullscreen-exit"}this.settingsTools.fullscreenbutton.setIcon(c)},e.prototype.localize=function(){if(a.i18n.localize(),this.viewerOptionButton&&this.viewerOptionButton.subMenu){var c=this.viewerOptionButton.subMenu.mode;this.removeViewerOptionsMenu(c),this.createViewerOptionsMenu(c)}this.debugMenu&&this.debugMenu.debugSubMenuButton&&(this.debugMenu.debugSubMenuButton.container.removeChild(this.debugMenu.subMenu),this.createDebugSubmenu(this.debugMenu.debugSubMenuButton)),b.ErrorHandler.localize()},e.prototype.addPanel=function(a){var b=this.dockingPanels.indexOf(a);return-1===b?(this.dockingPanels.push(a),!0):!1},e.prototype.removePanel=function(a){var b=this.dockingPanels.indexOf(a);return b>-1?(this.dockingPanels.splice(b,1),!0):!1},e.prototype.resizePanels=function(a){a=a||{};var b=this.toolbar.getDimensions().height,c=this.getDimensions(),d=c.height;a.dimensions&&a.dimensions.height?d=a.dimensions.height:a.dimensions={height:c.height,width:c.width},a.dimensions.height=d-b;var e=a?a.viewer:null;e||(e=this);var f=a?a.dockingPanels:null;f||(f=e.dockingPanels);var g,h,i=e.container.getBoundingClientRect(),j=i.top,k=i.bottom,l=i.left,m=i.right;a&&a.dimensions?(g=a.dimensions.width,h=a.dimensions.height,k=a.dimensions.height):(g=i.width,h=i.height);for(var n=0;n<f.length;++n){var o=f[n].container,p=o.getBoundingClientRect(),q=p.top,r=p.bottom,s=p.left,t=p.right,u=p.width,v=p.height;u&&v&&(u>g&&(u=Math.round(g),o.style.width=u+"px"),v>h&&(v=Math.round(h),o.style.height=v+"px"),(t>m||o.dockRight)&&(s=Math.round(m-u-l),o.style.left=s+"px"),(r>k||o.dockBottom)&&(q=Math.round(k-v-j),0>q&&(q=0),o.style.top=q+"px"),o.style.maxWidth=Math.round(g)+"px",o.style.maxHeight=Math.round(h)+"px")}},e.prototype.initExplodeSlider=function(){var a=this,d=new c.Button("toolbar-explodeTool");d.setIcon("adsk-icon-explode"),d.setToolTip("Explode model"),a.modelTools.addControl(d,{index:0});var e='<div class="explode-submenu" style="display:none"><input class="explode-slider" type="range" min="0" max="1" step="0.01" value="0"/></div>';this.explodeSubmenu=stringToDOM(e);var f;f=document.querySelector("#toolbar-explodeTool").parentNode,this.explodeSubmenu.classList.add("ios"),f.appendChild(this.explodeSubmenu);var g=this.explodeSubmenu.querySelector(".explode-slider");a.explodeSlider=g,g.oninput=function(b){a.explode(g.value)},g.onchange=function(b){a.explode(g.value)},this.explodeSubmenu.onclick=function(a){a.stopPropagation()};var h=d.container.querySelector(".adsk-control-tooltip");d.onClick=function(e){var f=d.getState();f===c.Button.State.INACTIVE?(d.setState(c.Button.State.ACTIVE),h.style.display="none",a.explodeSubmenu.style.display="",b.logger&&b.logger.log({category:"tool_changed",name:"explode"})):f===c.Button.State.ACTIVE&&(d.setState(c.Button.State.INACTIVE),h.style.display="",g.parentNode.style.display="none",a.explode(0),a.explodeSlider.value=0)}},e.prototype.initInspectTools=function(){var a=new c.Button("toolbar-inspectTools");a.setToolTip("Inspect"),a.setIcon("measure"),a.setVisible(!1),this.modelTools.addControl(a);var b=new c.RadioButtonGroup("toolbar-inspectSubMenu");b.addClass("toolbar-vertical-group"),b.setVisible(!1),this.modelTools.addControl(b),a.container.insertBefore(b.container,a.container.firstChild),a.onMouseOver=function(){b.setVisible(!0)},a.onMouseOut=function(){b.setVisible(!1)},isTouchDevice()&&(a.onClick=function(a){b.setVisible(!b.isVisible())})},e.prototype.initModality=function(){function a(b){for(var c=2,d=0;c>d&&b.parentElement;){var e=b.id;if(0===e.indexOf("toolbar-")){if(e.indexOf("arrow")===e.length-5)return;var f=a(b.parentElement);return f||b}b=b.parentElement,d++}}function b(a){return a.id.substring(8,a.id.length)}function c(a){return a.classList.contains("active")}function d(a){a.dispatchEvent(new Event("click"))}function e(a,b,c){h[a]=c?b:void 0}function f(f){if(!f.target.classList.contains("clickoff")){var i=a(f.target);if(i){var j=b(i);if(g[j]&&!("sectionTool"===j&&(f.target.classList.contains("adsk-icon-section-analysis")||f.target.querySelector(".adsk-icon-section-analysis"))||h[j]&&(e(j,i,!1),c(i)))){for(var k in h){var l=h[k];if(l){var m=b(l);c(l)?g[j][m]||d(l):e(m,l,!1)}}e(j,i,!0)}}}}var g={orbitTools:{explodeTool:1},panTool:{explodeTool:1},zoomTool:{explodeTool:1},beelineTool:{},sectionTool:{},measureTool:{},explodeTool:{}},h={};this.toolbar.container.addEventListener("click",f,!0)},e.prototype.updateToolbarButtons=function(a,b){var c=this.getToolbar(!1);if(c){var d,e;e=a>310?"block":"none",d=this.modelTools.getControl("toolbar-explodeTool"),d&&d.setDisplay(e),e=a>380?"block":"none",d=this.modelTools.getControl("toolbar-collaborateTool"),d&&d.setDisplay(e),e=a>515?"block":"none",d=this.navTools.getControl("toolbar-cameraSubmenuTool"),d&&d.setDisplay(e),e=a>700?"block":"none",d=this.modelTools.getControl("toolbar-measureTool"),d&&d.setDisplay(e),d=this.modelTools.getControl("toolbar-sectionTool"),d&&d.setDisplay(e),e=a>740?"block":"none",d=this.navTools.getControl("toolbar-beelineTool"),d&&d.setDisplay(e),d=this.navTools.getControl("toolbar-firstPersonTool"),d&&d.setDisplay(e),d=this.navTools.getControl("toolbar-zoomTool"),d&&d.setDisplay(e),d=this.navTools.getControl("toolbar-panTool"),d&&d.setDisplay(e),d=this.navTools.getControl("toolbar-orbitTools"),d&&d.setDisplay(e)}},b.GuiViewer3D=e}(),function(){"use strict";function a(a,b){this._id=a,this._isCollapsible=!b||b.collapsible,this._toolTipElement=null,this._listeners={},this.container=document.createElement("div"),this.container.id=a,this.addClass("adsk-control")}var b=Autodesk.Viewing;Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:"Control.VisibilityChanged",COLLAPSED_CHANGED:"Control.CollapsedChanged"},b.EventDispatcher.prototype.apply(a.prototype),a.prototype.constructor=a,a.prototype.container=null,a.prototype.getId=function(){return this._id},a.prototype.setVisible=function(b){var c=!this.container.classList.contains("adsk-hidden");if(c===b)return!1;b?this.container.classList.remove("adsk-hidden"):this.container.classList.add("adsk-hidden");var d={type:a.Event.VISIBILITY_CHANGED,target:this,controlId:this._id,isVisible:b};return this.fireEvent(d),!0},a.prototype.isVisible=function(){return!this.container.classList.contains("adsk-hidden")},a.prototype.setToolTip=function(a){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")===a?!1:(this._toolTipElement||(this._toolTipElement=document.createElement("div"),this._toolTipElement.id=this._id+"-tooltip",this._toolTipElement.classList.add("adsk-control-tooltip"),this.container.appendChild(this._toolTipElement)),this._toolTipElement.setAttribute("data-i18n",a),this._toolTipElement.setAttribute("tooltipText",a),this._toolTipElement.textContent=Autodesk.Viewing.i18n.translate(a,{defaultValue:a}),!0)},a.prototype.getToolTip=function(){return this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")},a.prototype.setCollapsed=function(b){if(!this._isCollapsible||this.isCollapsed()===b)return!1;b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed");var c={type:a.Event.COLLAPSED_CHANGED,isCollapsed:b};return this.fireEvent(c),!0},a.prototype.isCollapsed=function(){return!!this.container.classList.contains("collapsed")},a.prototype.isCollapsible=function(){return this._isCollapsible},a.prototype.addClass=function(a){this.container.classList.add(a)},a.prototype.removeClass=function(a){this.container.classList.remove(a)},a.prototype.getPosition=function(){var a=this.container.getBoundingClientRect();return{top:a.top,left:a.left}},a.prototype.getDimensions=function(){var a=this.container.getBoundingClientRect();return{width:a.width,height:a.height}},a.prototype.setDisplay=function(a){this.container.style.display=a},Autodesk.Viewing.UI.Control=a}(),function(){"use strict";function a(c,d){b.Control.call(this,c,d);var e=this;this._controls=[],this.addClass("adsk-control-group"),this.handleChildSizeChanged=function(b){var c={type:a.Event.SIZE_CHANGED,childEvent:b};e.fireEvent(c)}}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,SIZE_CHANGED:"ControlGroup.SizeChanged",CONTROL_ADDED:"ControlGroup.ControlAdded",CONTROL_REMOVED:"ControlGroup.ControlRemoved"},a.prototype=Object.create(b.Control.prototype),a.prototype.constructor=a,a.prototype.addControl=function(c,d){var e=d&&void 0!==d.index?d.index:this._controls.length;if(null!==this.getControl(c.getId()))return!1;var f={type:a.Event.CONTROL_ADDED,control:c,index:e};return e<this._controls.length?(this.container.insertBefore(c.container,this._controls[e].container),this._controls.splice(e,0,c)):(this.container.appendChild(c.container),this._controls.push(c)),c.addEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),c.addEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),c instanceof a&&c.addEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(f),this.fireEvent(a.Event.SIZE_CHANGED),!0},a.prototype.indexOf=function(a){for(var b=0;b<this._controls.length;b++){var c=this._controls[b];if(c===a||"string"==typeof a&&a===c.getId())return b}return-1},a.prototype.removeControl=function(c){var d="string"==typeof c?this.getControl(c):c;if(!d)return!1;var e=this._controls.indexOf(d);this._controls.splice(e,1),this.container.removeChild(d.container);var f={type:a.Event.CONTROL_REMOVED,control:d,index:e};return d.removeEventListener(b.Control.Event.VISIBILITY_CHANGED,this.handleChildSizeChanged),d.removeEventListener(b.Control.Event.COLLAPSED_CHANGED,this.handleChildSizeChanged),d instanceof a&&d.removeEventListener(a.Event.SIZE_CHANGED,this.handleChildSizeChanged),this.fireEvent(f),this.fireEvent(a.Event.SIZE_CHANGED),!0},a.prototype.getControl=function(a){for(var b=0;b<this._controls.length;b++)if(a===this._controls[b].getId())return this._controls[b];return null},a.prototype.getNumberOfControls=function(){return this._controls.length},a.prototype.setCollapsed=function(b){if(!this._isCollapsible)return!1;var c=!1;return this._controls.forEach(function(a){a.isCollapsible()&&a.setCollapsed(b)&&(c=!0)}),c&&(b?this.container.classList.add("collapsed"):this.container.classList.remove("collapsed"),this.fireEvent({type:a.Event.COLLAPSED_CHANGED,isCollapsed:b})),c},Autodesk.Viewing.UI.ControlGroup=a}(),function(){"use strict";function a(a,c){b.ControlGroup.call(this,a,c),this.removeClass("adsk-control-group"),this.addClass("adsk-toolbar")}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,Autodesk.Viewing.UI.ToolBar=a}(),function(){"use strict";function a(c,d){b.Control.call(this,c,d);var e=this;this._state=a.State.INACTIVE,this.icon=document.createElement("div"),this.icon.classList.add("adsk-button-icon"),this.container.appendChild(this.icon),this.container.addEventListener("click",function(b){e.fireEvent(a.Event.CLICK),e.onClick&&e.onClick(b),b.stopPropagation()}),isTouchDevice()?this.container.addEventListener("touchstart",touchStartToClick):(this.container.addEventListener("mouseover",function(a){e.onMouseOver(a)}),this.container.addEventListener("mouseout",function(a){e.onMouseOut(a)})),this.addClass("adsk-button"),this.addClass(a.StateToClassMap[this._state])}var b=Autodesk.Viewing.UI;a.Event={VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,STATE_CHANGED:"Button.StateChanged",CLICK:"click"},a.State={ACTIVE:0,INACTIVE:1,DISABLED:2},a.StateToClassMap=function(){var b=a.State,c={};return c[b.ACTIVE]="active",c[b.INACTIVE]="inactive",c[b.DISABLED]="disabled",c}(),a.prototype=Object.create(b.Control.prototype),a.prototype.constructor=a,a.prototype.setState=function(b){if(b===this._state)return!1;this.removeClass(a.StateToClassMap[this._state]),this.addClass(a.StateToClassMap[b]),this._state=b;var c={type:a.Event.STATE_CHANGED,state:b};return this.fireEvent(c),!0},a.prototype.setIcon=function(a){this.iconClass&&this.icon.classList.remove(this.iconClass),this.iconClass=a,this.icon.classList.add(a)},a.prototype.getState=function(){return this._state},a.prototype.onClick=function(a){},a.prototype.onMouseOver=function(a){},a.prototype.onMouseOut=function(a){},Autodesk.Viewing.UI.Button=a}(),function(){"use strict";function a(a,c){b.Button.call(this,a,c),this.arrowButton=new b.Button(a+"arrow"),this.arrowButton.addClass("adsk-button-arrow"),this.arrowButton.removeClass("adsk-button"),this.subMenu=new b.RadioButtonGroup(a+"SubMenu"),this.subMenu.addClass("toolbar-vertical-group"),this.subMenu.setVisible(!1),this.container.insertBefore(this.subMenu.container,this.container.firstChild),this.container.insertBefore(this.arrowButton.container,this.container.firstChild);var d=this;this.arrowButton.onClick=function(a){d.subMenu.setVisible(!d.subMenu.isVisible())},this.toggleFlyoutVisible=function(){d.subMenu.setVisible(!d.subMenu.isVisible())},this.onClick=function(a){d.subMenu.setVisible(!d.subMenu.isVisible())},this.subMenuActiveButtonChangedHandler=function(a){a.isActiveButton?(d.setIcon(a.target.getActiveButton().iconClass),d.setToolTip(a.target.getActiveButton().getToolTip()),d.setState(b.Button.State.ACTIVE),d.onClick=a.button.onClick):d.setState(b.Button.State.INACTIVE)},this.subMenu.addEventListener(b.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.subMenuActiveButtonChangedHandler);var e=stringToDOM('<div class="clickoff" style="position:fixed; top:0; left:0; width:100vw; height:100vh;"></div>');this.subMenu.container.insertBefore(e,this.subMenu.container.firstChild),e.addEventListener("click",function(a){d.subMenu.setVisible(!1),a.stopPropagation()})}var b=Autodesk.Viewing.UI;a.prototype=Object.create(b.Button.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a){this.subMenu.addControl(a),a.addEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.removeControl=function(a){a.removeEventListener(b.Button.Event.CLICK,this.toggleFlyoutVisible)},a.prototype.setState=function(a){if(a===b.Button.State.INACTIVE){var c=this.subMenu.getActiveButton();c&&c.setState(b.Button.State.INACTIVE)}b.Button.prototype.setState.call(this,a)},a.prototype.saveAsDefault=function(){this.defaultState={},this._toolTipElement&&this._toolTipElement.getAttribute("tooltipText")&&(this.defaultState.tooltip=this._toolTipElement.getAttribute("tooltipText")),this.defaultState.icon=this.iconClass,this.defaultState.onClick=this.onClick},a.prototype.restoreDefault=function(){this.defaultState&&(this.defaultState.tooltip&&this.setToolTip(this.defaultState.tooltip),this.defaultState.icon&&this.setIcon(this.defaultState.icon),this.onClick=this.defaultState.onClick,this.setState(b.Button.State.INACTIVE))},Autodesk.Viewing.UI.ComboButton=a}(),function(){"use strict";function a(c,d){b.ControlGroup.call(this,c,d);var e=this;this._activeButton=null,this._handleButtonStateChange=function(c){var d=b.Button.State;return c.state!==d.ACTIVE?void(c.target===e._activeButton&&(e._activeButton=null,e.fireEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!1}))):(e._activeButton=c.target,e.fireEvent({type:a.Event.ACTIVE_BUTTON_CHANGED,button:c.target,isActiveButton:!0}),void e._controls.forEach(function(a){a!==c.target&&a.getState()!==d.DISABLED&&a.setState(d.INACTIVE)}))}}var b=Autodesk.Viewing.UI;a.Event={ACTIVE_BUTTON_CHANGED:"RadioButtonGroup.ActiveButtonChanged",VISIBILITY_CHANGED:b.Control.Event.VISIBILITY_CHANGED,COLLAPSED_CHANGED:b.Control.Event.COLLAPSED_CHANGED,CONTROL_ADDED:b.ControlGroup.Event.CONTROL_ADDED,CONTROL_REMOVED:b.ControlGroup.Event.CONTROL_REMOVED,SIZE_CHANGED:b.ControlGroup.Event.SIZE_CHANGED},a.prototype=Object.create(b.ControlGroup.prototype),a.prototype.constructor=a,a.prototype.addControl=function(a,c){return a instanceof b.Button&&b.ControlGroup.prototype.addControl.call(this,a,c)?(a.addEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1},a.prototype.removeControl=function(a){var c="string"==typeof a?this.getControl(a):a;return null!==c&&b.ControlGroup.prototype.removeControl.call(this,c)?(c.removeEventListener(b.Button.Event.STATE_CHANGED,this._handleButtonStateChange),!0):!1},a.prototype.getActiveButton=function(){return this._activeButton},Autodesk.Viewing.UI.RadioButtonGroup=a}(),AutodeskNamespace("Autodesk.Viewing");var proto=MobileCallbacks.prototype;proto.animationReady=function(){this.ios?this.iosSend("animationReady"):this.android&&this.androidSend.animationReady()},proto.onSelectionChanged=function(a){this.ios?this.iosSend("selectionChanged",a):this.android&&this.androidSend.onSelectionChanged(a)},proto.onLongTap=function(a,b){this.ios?this.iosSend("onLongTap",[a,b]):this.android&&this.androidSend.onLongTap(a,b)},proto.onSingleTap=function(a,b){this.ios?this.iosSend("onSingleTap",[a,b]):this.android&&this.androidSend.onSingleTap(a,b)},proto.onDoubleTap=function(a,b){this.ios?this.iosSend("onDoubleTap",[a,b]):this.android&&this.androidSend.onDoubleTap(a,b)},proto.setRTCSession=function(a){this.ios?this.iosSend("setRTCSession",{id:a}):this.android&&this.androidSend.setRTCSessionID(a)},proto.putProperties=function(a,b){this.ios?this.iosSend("putProperties",{name:a,value:b}):this.android&&this.androidSend.putProperties(a,b)},proto.onPropertyRetrievedSuccess=function(){this.ios?this.iosSend("onPropertyRetrievedSuccess"):this.android&&this.androidSend.onPropertyRetrievedSuccess()},proto.onPropertyRetrievedFailOrEmptyProperties=function(){this.ios?this.iosSend("onPropertyRetrievedFailOrEmptyProperties"):this.android&&this.androidSend.onPropertyRetrievedFailOrEmptyProperties()},proto.resetAnimationStatus=function(){this.ios?this.iosSend("resetAnimationStatus"):this.android&&this.androidSend.resetAnimationStatus()},proto.updateAnimationTime=function(a){this.ios?this.iosSend("updateAnimationTime",a):this.android&&this.androidSend.updateAnimationTime(a)},proto.setLoadingProgress=function(a){this.ios?this.iosSend("setLoadingProgress",a):this.android&&this.androidSend.setLoadingProgress(a)},proto.objectTreeCreated=function(){this.ios?this.iosSend("objectTreeCreated"):this.android&&this.androidSend.objectTreeCreated()},proto.geometryLoaded=function(){this.ios?this.iosSend("geometryLoaded"):this.android&&this.androidSend.geometryLoaded()},proto.putSheets=function(a,b){this.ios?this.iosSend("putSheets",[a,b]):this.android&&this.androidSend.putSheets(a,b)},proto.hideLoadingView=function(){this.android&&this.androidSend.hideLoadingView()},Autodesk.Viewing.Extensions.ViewerPanelMixin=function(){this.getContainerBoundingRect=function(){var a=this.parentContainer.getBoundingClientRect(),b={height:0,width:0,left:0,bottom:0,right:0,top:0},c=document.getElementsByClassName("toolbar-menu");return c&&c.length>0&&(b=c[0].getBoundingClientRect()),{height:a.height-b.height,width:a.width,left:a.left,bottom:a.bottom-b.height,right:a.right,top:a.top}}},function(){"use strict";var a=Autodesk.Viewing,b=(Autodesk.Viewing.Private,Autodesk.Viewing.UI),c=Autodesk.Viewing.Extensions,d={click:{onObject:["isolate"]},clickCtrl:{onObject:["toggleVisibility"]}};c.ViewerModelStructurePanel=function(a,c,e){this.viewer=a,e=e||{},e.heightAdjustment=75,b.ModelStructurePanel.call(this,a.container,a.container.id+"ViewerModelStructurePanel",c,e),this.clickConfig=e&&e.docStructureConfig?e.docStructureConfig:d,this.isMac=-1!==navigator.userAgent.search("Mac OS"),this.initSearchBox(),this.prevSearchResults=[],this.prevSearchString=""},c.ViewerModelStructurePanel.prototype=Object.create(b.ModelStructurePanel.prototype),c.ViewerModelStructurePanel.prototype.constructor=c.ViewerModelStructurePanel,c.ViewerPanelMixin.call(c.ViewerModelStructurePanel.prototype),c.ViewerModelStructurePanel.prototype.initialize=function(){b.ModelStructurePanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.SELECTION_CHANGED_EVENT,function(a){c.setSelection(a.nodeArray.slice())}),c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){c.setIsolation(a.nodeIdArray.slice())}),c.addEventListener(c.viewer,a.HIDE_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!0)}),c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.setHidden(a.nodeIdArray.slice(),!1)})},c.ViewerModelStructurePanel.prototype.uninitialize=function(){this.viewer=null,b.ModelStructurePanel.prototype.uninitialize.call(this)},c.ViewerModelStructurePanel.prototype.handleAction=function(a,b){for(var c in a)switch(a[c]){case"selectOnly":this.viewer.select(b);break;case"deselectAll":this.viewer.select([]);break;case"selectToggle":this.viewer.toggleSelect(b);break;case"isolate":this.viewer.isolate(b);break;case"showAll":this.viewer.isolate(null);break;case"focus":this.viewer.fitToView();break;case"hide":this.viewer.hide(b);break;case"show":this.viewer.show(b);break;case"toggleVisibility":this.viewer.toggleVisibility(b)}},c.ViewerModelStructurePanel.prototype.ctrlDown=function(a){return this.isMac&&a.metaKey||!this.isMac&&a.ctrlKey},c.ViewerModelStructurePanel.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c=this,d="click";c.ctrlDown(b)&&(d+="Ctrl"),b.shiftKey&&(d+="Shift"),b.altKey&&(d+="Alt"),this.clickConfig&&this.clickConfig[d]?c.handleAction(this.clickConfig[d].onObject,a):this.viewer.select(a)}},c.ViewerModelStructurePanel.prototype.onDoubleClick=function(a,b){this.handleAction(["focus"],a)},c.ViewerModelStructurePanel.prototype.onHover=function(a,b){this.viewer.impl.rolloverObjectNode(a)},c.ViewerModelStructurePanel.prototype.onRightClick=function(a,b){if(this.isMac&&b.ctrlKey&&0===b.button)return this.clickConfig&&this.clickConfig.clickCtrl?this.handleAction(this.clickConfig.clickCtrl.onObject,a):this.viewer.select(a),null;var c=[],d=!0;if(b.shiftKey||this.isMac&&b.metaKey||b.ctrlKey&&(this.isMac||2===b.button))for(var e=this.viewer.impl.selector.getSelection(),f=0;f<e.length;++f)e[f]!==a?c.push(e[f]):d=!1;return d&&c.push(a),this.viewer.select(c),this.viewer.contextMenu.show(b)},c.ViewerModelStructurePanel.prototype.setHidden=function(a,b){this.uiCreated||this.createUI();for(var c=0;c<a.length;++c)this.tree.iterate(a[c],function(a,c){c.classList.toggle("dim",b),c.classList.toggle("visible",!b)})},c.ViewerModelStructurePanel.prototype.setIsolation=function(a){if(this.rootId){if(this.tree&&this.tree.iterate(this.rootId,function(a,b){b.classList.remove("dim"),b.classList.remove("visible")}),
a.length>0){if(1===a.length&&a[0]===this.rootId)return;this.setHidden([this.rootId],!0),this.setHidden(a,!1)}this.searchbox&&!this.inSearchIsolate&&(this.searchbox.value="")}},c.ViewerModelStructurePanel.prototype.initSearchBox=function(){function b(){if(!f.isSearching){for(var a=0;a<f.prevSearchResults.length;a++)f.tree.setCollapsed(f.prevSearchResults[a],!0,!0);if(0===c.value.length)f.isSearching=!1,f.prevSearchString="",e.isolate();else{if(f.prevSearchString==c.value)return;f.isSearching=!0,e.search(c.value,function(a){if(f.inSearchIsolate=!0,e.isolate(a),f.inSearchIsolate=!1,a.length){for(var b=0;b<a.length;b++)f.tree.setCollapsed(a[b],!1,!0);f.resizeToContent(),f.tree.scrollTo(a[0])}f.prevSearchResults=a,f.isSearching=!1},null,["name"])}}}var c=document.createElement("input");c.className="toolbar-search-box",c.type="search",c.results=5,c.placeholder=a.i18n.translate("Filter by name"),c.incremental="incremental",c.autosave=this.container.id+"search_autosave",c.setAttribute("data-i18n","[placeholder]Filter by name"),this.scrollContainer.parentNode.insertBefore(c,this.scrollContainer),this.searchbox=c;var d,e=this.viewer,f=this,g=500;c.addEventListener("input",function(a){clearTimeout(d),d=setTimeout(b,g)}),c.addEventListener("change",function(a){clearTimeout(d),b()})}}(),function(){"use strict";var a=Autodesk.Viewing,b=a.UI,c=function(a){this.viewer=a,this.currentNodeIds=[],this.currentModel=null,this.isSelection=!1,this.isDirty=!0,this.propertyNodeId=null,b.PropertyPanel.call(this,a.container,"ViewerPropertyPanel","Object Properties Loading...")};c.prototype=Object.create(b.PropertyPanel.prototype),c.prototype.constructor=c,a.Extensions.ViewerPanelMixin.call(c.prototype),c.prototype.initialize=function(){b.PropertyPanel.prototype.initialize.call(this);var c=this;c.addEventListener(c.viewer,a.SELECTION_CHANGED_EVENT,function(a){c.currentNodeIds=a.dbIdArray,c.currentModel=a.model,c.isSelection=a.dbIdArray.length>0,c.isDirty=!0,c.requestProperties()}),c.addEventListener(c.viewer,a.ISOLATE_EVENT,function(a){0==a.nodeIdArray.length&&c.isSelection||(c.currentModel=a.model,c.currentNodeIds=a.nodeIdArray,c.isDirty=!0,c.requestProperties())}),c.addEventListener(c.viewer,a.HIDE_EVENT,function(a){c.isDirty=!0,c.requestProperties()}),c.addEventListener(c.viewer,a.SHOW_EVENT,function(a){c.isDirty=!0,c.requestProperties()}),this.currentModel=c.viewer.model,this.currentNodeIds=c.viewer.getSelection(),0===this.currentNodeIds.length?this.currentNodeIds=c.viewer.getIsolatedNodes():this.isSelection=!0},c.prototype.setTitle=function(a,c){a||(a="Object Properties",c=c||{},c.localizeTitle=!0),b.PropertyPanel.prototype.setTitle.call(this,a,c)},c.prototype.setVisible=function(a){b.DockingPanel.prototype.setVisible.call(this,a),this.requestProperties()},c.prototype.visibilityChanged=function(){b.DockingPanel.prototype.visibilityChanged.call(this),this.isVisible()&&this.requestProperties()},c.prototype.requestProperties=function(){this.isVisible()&&this.isDirty&&(this.currentNodeIds.length>0?this.setNodeProperties(this.currentNodeIds[this.currentNodeIds.length-1]):this.showDefaultProperties(),this.isDirty=!1)},c.prototype.setNodeProperties=function(a){var b=this;this.propertyNodeId=a,b.currentModel.getProperties(a,function(a){if(b.setTitle(a.name),b.setProperties(a.properties),b.highlight(b.viewer.searchText),b.resizeToContent(),b.isVisible()){var c=b.viewer.toolController,d=c.lastClickX,e=c.lastClickY,f=b.container.getBoundingClientRect(),g=f.left,h=f.top,i=f.width,j=f.height,k=b.viewer.canvas.getBoundingClientRect(),l=k.left,m=k.top,n=k.width,o=k.height;d>=g&&g+i>d&&e>=h&&h+j>e&&(g+i/2>d&&l+n>d+i?(b.container.style.left=Math.round(d-l)+"px",b.container.dockRight=!1):d-i>=l?(b.container.style.left=Math.round(d-l-i)+"px",b.container.dockRight=!1):l+n>d+i?(b.container.style.left=Math.round(d-l)+"px",b.container.dockRight=!1):m+o>e+j?(b.container.style.top=Math.round(e-m)+"px",b.container.dockBottom=!1):e-j>=m&&(b.container.style.top=Math.round(e-m-j)+"px",b.container.dockBottom=!1))}})},c.prototype.showDefaultProperties=function(){var a=this.viewer.model.getRootId();a?this.setNodeProperties(a):(this.propertyNodeId=null,this.setTitle("Model Properties",{localizeTitle:!0}),b.PropertyPanel.prototype.showDefaultProperties.call(this))},c.prototype.areDefaultPropertiesShown=function(){var a=this.viewer.model.getRootId();return this.propertyNodeId===a},c.prototype.uninitialize=function(){b.PropertyPanel.prototype.uninitialize.call(this),this.viewer=null},c.prototype.onCategoryClick=function(a,c){b.PropertyPanel.prototype.onCategoryClick.call(this,a,c),this.resizeToContent()},c.prototype.onCategoryIconClick=function(a,c){b.PropertyPanel.prototype.onCategoryIconClick.call(this,a,c),this.resizeToContent()},Autodesk.Viewing.Extensions.ViewerPropertyPanel=c}(),function(){"use strict";var a=function(a){var b=a.container;Autodesk.Viewing.UI.LayersPanel.call(this,a,b,b.id+"ViewerLayersPanel")};a.prototype=Object.create(Autodesk.Viewing.UI.LayersPanel.prototype),a.prototype.constructor=a,Autodesk.Viewing.Extensions.ViewerPanelMixin.call(a.prototype),a.prototype.onClick=function(a,b){if(!this.isMac||!b.ctrlKey){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)}},a.prototype.onRightClick=function(a,b){var c=!(b.shiftKey||b.metaKey||b.ctrlKey);this.setLayerVisible(a,c)},a.prototype.onImageClick=function(a,b){this.isMac&&b.ctrlKey||this.setLayerVisible(a)},a.prototype.onTitleClick=function(a){this.viewer.setLayerVisible(null,!0)},a.prototype.onTitleDoubleClick=function(a){this.viewer.fitToView()},Autodesk.Viewing.Extensions.ViewerLayersPanel=a}(),function(){"use strict";var a=Autodesk.Viewing.Extensions,b=Autodesk.Viewing.UI;a.ViewerSettingTab={Navigation:"navigationtab",Performance:"performancetab"};var c=function(a,c){this.viewer=a,this.is3dMode="3d"===c,b.SettingsPanel.call(this,a.container,"ViewerSettingsPanel","Settings",{width:360,heightAdjustment:155}),this.addTab("navigationtab","Navigation and selection",{className:"navigation"}),this.addTab("performancetab","Performance and appearance",{className:"performance"}),this.restoreDiv=document.createElement("div"),this.restoreDiv.className="viewer-restore-defaults",this.restoreDiv.setAttribute("data-i18n","Restore default settings"),this.restoreDiv.textContent=Autodesk.Viewing.i18n.translate("Restore default settings"),this.addEventListener(this.restoreDiv,"touchstart",touchStartToClick),this.addEventListener(this.restoreDiv,"click",function(){var b=a.model.is2d()?"2d":"3d";a.prefs.reset(b)},!1),this.container.appendChild(this.restoreDiv),this.createNavigationPanel(),this.createPerformancePanel()};c.prototype=Object.create(b.SettingsPanel.prototype),c.prototype.constructor=c,a.ViewerPanelMixin.call(c.prototype),c.prototype.uninitialize=function(){this.viewer=null,b.SettingsPanel.prototype.uninitialize.call(this)},c.prototype.addCheckbox=function(a,c,d,e,f){function g(a){h.prefs.set(f,a),e(a)}var h=this.viewer,i=h.prefs[f];d="boolean"==typeof i?i:d;var j=b.SettingsPanel.prototype.addCheckbox.call(this,a,c,d,g),k=this.getControl(j);return k.saveKey=f,h.prefs.addListeners(f,function(a){k.setValue(a)},function(a){k.setValue(a),e(a)}),j},c.prototype.removeCheckbox=function(a){return this.viewer.prefs.removeListeners(a.saveKey),this.removeEventListener(a,"change",a.changeListener),b.SettingsPanel.prototype.removeCheckbox.call(this,a)},c.prototype.createNavigationPanel=function(){var b=this.viewer,c=a.ViewerSettingTab.Navigation;this.is3dMode&&(this.addCheckbox(c,"Show ViewCube",!0,function(a){b.displayViewCube(a)},"viewCube"),this.addCheckbox(c,"ViewCube acts on pivot",!1,function(a){b.setUsePivotAlways(a)},"alwaysUsePivot"),this.addCheckbox(c,"Zoom towards pivot",!1,function(a){b.setZoomTowardsPivot(a)},"zoomTowardsPivot"),this.addCheckbox(c,"Set pivot with left mouse button",!1,function(a){b.setClickToSetCOI(a)},"clickToSetCOI"),this.addCheckbox(c,"Fusion style orbit",!1,function(a){a?b.loadExtension("Autodesk.Viewing.FusionOrbit",null):b.unloadExtension("Autodesk.Viewing.FusionOrbit",null)},"fusionOrbit"),this.addCheckbox(c,"First person walk",!1,function(a){a?(b.unloadExtension("Autodesk.Beeline",null),b.loadExtension("Autodesk.FirstPerson",null)):(b.unloadExtension("Autodesk.FirstPerson",null),b.loadExtension("Autodesk.Beeline",null))},"useFirstPersonNavigation")),this.addCheckbox(c,"Reverse mouse zoom direction",!1,function(a){b.setReverseZoomDirection(a)},"reverseMouseZoomDir"),this.is3dMode&&this.addCheckbox(c,"Orbit past world poles",!0,function(a){b.setOrbitPastWorldPoles(a)},"orbitPastWorldPoles"),this.addCheckbox(c,"Open properties on select",!0,function(a){b.setPropertiesOnSelect(a)},"openPropertiesOnSelect"),this.addCheckbox(c,"Left handed mouse setup",!1,function(a){b.setUseLeftHandedInput(a)},"leftHandedMouseSetup")},c.prototype.createPerformancePanel=function(){var b=this.viewer,c=a.ViewerSettingTab.Performance;this.is3dMode&&(this.ghosthiddenChkBoxId=this.addCheckbox(c,"Ghost hidden objects",!0,function(a){b.setGhosting(a)},"ghosting"),this.optimizeNavigationhkBoxId=this.addCheckbox(c,"Smooth navigation",isMobileDevice(),function(a){b.setOptimizeNavigation(a)},"optimizeNavigation"),this.antialiasingChkBoxId=this.addCheckbox(c,"Anti-aliasing",!0,function(a){b.setQualityLevel(b.prefs.ambientShadows,a)},"antialiasing"),this.ambientshadowsChkBoxId=this.addCheckbox(c,"Ambient shadows",!0,function(a){b.setQualityLevel(a,b.prefs.antialiasing)},"ambientShadows"),this.groundShadowChkBoxId=this.addCheckbox(c,"Ground shadow",!0,function(a){b.setGroundShadow(a)},"groundShadow"),this.groundReflectionChkBoxId=this.addCheckbox(c,"Ground reflection",!0,function(a){b.setGroundReflection(a)},"groundReflection"),this.envMapBackgroundChkBoxId=this.addCheckbox(c,"Environment map for background",!0,function(a){b.setEnvMapBackground(a)},"envMapBackground")),this.progressiveRenderChkBoxId=this.addCheckbox(c,"Progressive model display",!0,function(a){b.setProgressiveRendering(a)},"progressiveRendering")},c.prototype.syncUI=function(){var a=this.viewer,b=this.getControl(this.antialiasingChkBoxId);b&&b.setValue(a.prefs.antialiasing);var c=this.getControl(this.ambientshadowsChkBoxId);c&&c.setValue(a.prefs.ambientShadows);var d=this.getControl(this.groundShadowChkBoxId);d&&d.setValue(a.prefs.groundShadow);var e=this.getControl(this.groundReflectionChkBoxId);e&&e.setValue(a.prefs.groundReflection);var f=this.getControl(this.envMapBackgroundChkBoxId);f&&f.setValue(a.impl.isEnvMapBackground());var g=this.getControl(this.progressiveRenderChkBoxId);g&&g.setValue(a.prefs.progressiveRendering);var h=this.getControl(this.ghosthiddenChkBoxId);h&&h.setValue(a.prefs.ghosting)},a.ViewerSettingsPanel=c}(),function(){"use strict";function a(a){b.ObjectContextMenu.call(this,a)}var b=Autodesk.Viewing.UI;a.prototype=Object.create(b.ObjectContextMenu.prototype),a.prototype.constructor=a,a.prototype.buildMenu=function(a,b){var c=this,d=[],e=this.viewer.model.is2d();if(!e){var f=this.viewer.container.getBoundingClientRect(),g=a.clientX-f.left,h=a.clientY-f.top,i=c.viewer.impl.hitTest(g,h,!1);if(i&&i.dbId){var j=c.viewer.getSelection();-1==j.indexOf(i.dbId)&&c.viewer.select(i.dbId),b.hasSelected=!0,b.hasVisible=!0}}return!e&&b.hasSelected&&(d.push({title:"Isolate",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection(),c.viewer.isolate(a)}}),b.hasVisible&&d.push({title:"Hide Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection(),c.viewer.hide(a)}}),b.hasHidden&&d.push({title:"Show Selected",target:function(){var a=c.viewer.getSelection();c.viewer.clearSelection(),c.viewer.show(a)}})),e?d.push({title:"Show All Layers",target:function(){c.viewer.setLayerVisible(null,!0)}}):d.push({title:"Show All Objects",target:function(){c.viewer.showAll()}}),!e&&b.hasSelected&&d.push({title:"Focus",target:function(){var a=c.viewer.getSelection();c.viewer.fitToView(a)}}),b.hasSelected&&d.push({title:"Clear Selection",target:function(){c.viewer.clearSelection()}}),d},Autodesk.Viewing.Extensions.ViewerObjectContextMenu=a}(),function(){"use strict";function a(a,b){Autodesk.Viewing.Extension.call(this,a,b)}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360");a.prototype=Object.create(Autodesk.Viewing.Extension.prototype),a.prototype.constructor=a,a.prototype.load=function(){function a(){c.impl.setLightPreset(0,!0),c.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}var c=this.viewer,d=new b.CAMModelStructurePanel(this.viewer,"CAM Model Structure Loading",this.options);return c.setModelStructurePanel(d),c.hideLines(!1),c.setGhosting(!1),c.setQualityLevel(!1,!0),c.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),!0},a.prototype.unload=function(){this.viewer.setModelStructurePanel(null)},b.CAM360Extension=a,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.CAM360",b.CAM360Extension)}(),function(){"use strict";function a(a,b,d){c.ViewerModelStructurePanel.call(this,a,b,d),this.viewer=a}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.CAM360"),c=Autodesk.Viewing.Extensions;a.prototype=Object.create(c.ViewerModelStructurePanel.prototype),a.prototype.constructor=a,a.prototype.sortCamNodes=function(a,b){function c(a,b){function c(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function d(d){var f=c(d.properties,"9429B915-D020-4CEB-971B-6ADD0A5D4BFA");f?("CAM_Setup"==f?e.camSetupNodes.push(a):"CAM_Operation"==f?e.camOperationNodes.push(a):"CAM_Tool"===f?e.camToolNodes.push(a):"CAM_Stock"===f?e.camStockNodes.push(a):"CAM_Folder"==f&&e.camFolderNodes.push(a),e.camNodes.push(a)):e.camModelNodes.push(a),b()}function f(a,c,d){b()}e.viewer.getProperties(a,d,f)}function d(){f.length>0?c(f.shift(),d):b()}this.camNodes=[],this.camModelNodes=[],this.camSetupNodes=[],this.camStockNodes=[],this.camOperationNodes=[],this.camToolNodes=[],this.camFolderNodes=[];var e=this,f=[];a.enumNodeChildren(a.getRootId(),function(a){f.push(a)},!0),f.shift(),d()},a.prototype.setModel=function(a,b){var d=this;d.sortCamNodes(a,function(){c.ViewerModelStructurePanel.prototype.setModel.call(d,a,b),d.SetCAMNodeVisible(!1),d.setVisible(!0),d.ExpandSetupNodes(),d.resizeToContent()})},a.prototype.initialize=function(){function a(c){b.SetCAMNodeVisible(!1),b.removeEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a)}c.ViewerModelStructurePanel.prototype.initialize.call(this);var b=this;this.viewer.model&&this.viewer.model.isLoadDone()||b.addEventListener(b.viewer,Autodesk.Viewing.GEOMETRY_LOADED_EVENT,a),b.addEventListener(b.viewer,Autodesk.Viewing.SHOW_EVENT,function(a){var c=a.nodeIdArray;if(c)for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.SELECTION_CHANGED_EVENT,function(a){var c=a.nodeArray;if(c)for(var d=0;d<c.length;d++)b.HideHightlightCAMNode(c[d])}),b.addEventListener(b.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){var c=a.nodeIdArray;if(c)if(0==c.length)b.SetModelVisible(),b.SetCAMNodeVisible(!0);else for(var d=0;d<c.length;d++)b.setCamNodeVisibility(c[d])})},a.prototype.IsCAMNode=function(a){return-1!==this.camNodes.indexOf(a)},a.prototype.IsCAMSetupNode=function(a){return-1!==this.camSetupNodes.indexOf(a)},a.prototype.IsCAMStockNode=function(a){return-1!==this.camStockNodes.indexOf(a)},a.prototype.IsCAMToolNode=function(a){return-1!==this.camToolNodes.indexOf(a)},a.prototype.IsCAMOperationNode=function(a){return-1!==this.camOperationNodes.indexOf(a)},a.prototype.IsCAMFolderNode=function(a){return-1!==this.camFolderNodes.indexOf(a)},a.prototype.shouldInclude=function(a){return!this.IsCAMStockNode(a)},a.prototype.isGroupNode=function(a){return this.IsCAMOperationNode(a)?!1:c.ViewerModelStructurePanel.prototype.isGroupNode.call(this,a)},a.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)},a.prototype.SetModelVisible=function(){if(this.camModelNodes)for(var a=0;a<this.camModelNodes.length;a++)this.setNodeVisibility(this.camModelNodes[a],!0)},a.prototype.SetCAMNodeVisible=function(a){if(this.camNodes){for(var b=0;b<this.camNodes.length;b++)this.setNodeVisibility(this.camNodes[b],a);this.SetToolNodeVisible(!1)}},a.prototype.SetToolNodeVisible=function(a){if(this.camToolNodes)for(var b=0;b<this.camToolNodes.length;b++)this.setNodeVisibility(this.camToolNodes[b],a)},a.prototype.HideHightlightNode=function(a){var b=this.viewer.impl,c=this;c.instanceTree.enumNodeFragments(a,function(a){b.highlightFragment(c.model,a,!1,!0)},!0)},a.prototype.HideHightlightCAMNode=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;e.instanceTree.enumNodeChildren(a,function(a){b?e.IsCAMStockNode(a)||e.HideHightlightNode(a):c?e.IsCAMToolNode(a)&&e.HideHightlightNode(a):d&&e.HideHightlightNode(a)},!1)},a.prototype.setCamNodeVisibility=function(a){var b=this.IsCAMSetupNode(a),c=this.IsCAMOperationNode(a),d=this.IsCAMFolderNode(a),e=this;b?this.instanceTree.enumNodeChildren(a,function(a){var b=e.IsCAMStockNode(a);e.setNodeVisibility(a,b)}):c?this.instanceTree.enumNodeChildren(a,function(a){e.IsCAMToolNode(a)&&e.setNodeVisibility(a,!1)}):d&&this.instanceTree.enumNodeChildren(a,function(a){e.setNodeVisibility(a,!1)})},a.prototype.onClick=function(a,b){c.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.SetModelVisible(),this.setCamNodeVisibility(a),this.viewer.fitToView()},a.prototype.ExpandSetupNodes=function(){if(this.camSetupNodes)for(var a=0;a<this.camSetupNodes.length;a++)this.tree.setCollapsed(this.camSetupNodes[a],!1)},b.CAMModelStructurePanel=a}(),function(){"use strict";function a(a){var b="";0>a&&(b="-",a=-a);var c=~~(a/3600),d=~~(a%3600/60),e=a%60,f=b;return c>0&&(f+=c+":"+(10>d?"0":"")),f+=d+":"+(10>e?"0":""),f+=e.toFixed(2)}var b=Autodesk.Viewing,c=b.UI,d=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.animTools=null,this.animToolsId="animationTools",this.playButton=null,this.prevAnimationTime=-1};d.prototype=Object.create(b.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){var a=this.viewer;return this.onPlayCallbackBinded=this.onPlayCallback.bind(this),this.onCameraChangeBinded=this.onCameraChange.bind(this),this.onExplodeBinded=this.onExplode.bind(this),this.onResizeBinded=this.onResize.bind(this),this.onEscapeBinded=this.onEscape.bind(this),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.addEventListener(Autodesk.Viewing.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.addEventListener(Autodesk.Viewing.ESCAPE_EVENT,this.onEscapeBinded),a.model&&a.model.isObjectTreeCreated()?this.onAnimationReady():(this.onAnimationReadyBinded=this.onAnimationReady.bind(this),a.addEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded)),!0},d.prototype.unload=function(){var a=this.viewer;if(this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),this.rewind(),a.impl.invalidate(!0,!0,!0),this.onPlayCallbackBinded=null,this.animTools&&(this.animTools.removeControl(this.animTools.timeText.getId()),this.animTools.removeControl(this.animTools.timeline.getId()),this.animTools.removeControl(this.animTools.timeLeftText.getId()),this.animTools.removeControl(this.animTools.forwardButton.getId()),this.animTools.removeControl(this.animTools.backwardButton.getId()),this.animTools.removeControl(this.animTools.closeButton.getId())),this.toolbar&&(this.toolbar.removeControl(this.animTools),this.toolbar.container.parentNode.removeChild(this.toolbar.container),this.toolbar=null),this.playButton){var c=a.getToolbar(!1);c&&c.getControl(b.TOOLBAR.MODELTOOLSID).removeControl(this.playButton.getId())}return a.removeEventListener(b.CAMERA_CHANGE_EVENT,this.onCameraChangeBinded),a.removeEventListener(b.EXPLODE_CHANGE_EVENT,this.onExplodeBinded),a.removeEventListener(b.VIEWER_RESIZE_EVENT,this.onResizeBinded),a.removeEventListener(b.ESCAPE_EVENT,this.onEscapeBinded),this.onToolbarCreatedBinded&&(a.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),!0},d.prototype.play=function(){if(!this.isPlaying()){this.resetExplode(0,!0);var a=this.viewer,b=a.impl.keyFrameAnimator;b&&(this.prevAnimationTime>0&&(b["goto"](this.prevAnimationTime),this.prevAnimationTime=-1),b.play(0,this.onPlayCallbackBinded),this.updatePlayButton(b.isPaused),a.toolbar&&a.toolbar.addClass("toolbar-animationMenuplacer"),this.animTools&&(this.animTools.setVisible(!0),this.animTools.isPositionAdjusted||(this.adjustToolbarPosition(),this.animTools.isPositionAdjusted=!0)))}},d.prototype.pause=function(){if(!this.isPaused()){var a=this.viewer.impl.keyFrameAnimator;a&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.isPlaying=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.isPlaying&&!a.isPaused:!1},d.prototype.isPaused=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.isPaused:!1},d.prototype.rewind=function(){this.setTimelineValue(0)},d.prototype.setTimelineValue=function(a){var b=this.viewer.impl.keyFrameAnimator;if(b){a=Math.min(Math.max(0,a),1);var c=a*b.duration;b["goto"](c),this.updateUI()}},d.prototype.prevKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.prev(),this.updateUI())},d.prototype.nextKeyframe=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(a.next(),this.updateUI())},d.prototype.getDuration=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.duration:0},d.prototype.getDurationLabel=function(){return a(this.getDuration())},d.prototype.getCurrentTime=function(){var a=this.viewer.impl.keyFrameAnimator;return a?a.currentTime:0},d.prototype.getCurrentTimeLabel=function(){return a(this.getCurrentTime())},d.prototype.onAnimationReady=function(){var a=this.viewer;this.onAnimationReadyBinded&&(a.removeEventListener(Autodesk.Viewing.ANIMATION_READY_EVENT,this.onAnimationReadyBinded),this.onAnimationReadyBinded=null),a.impl.keyFrameAnimator&&(a.toolbar&&a.modelTools?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),a.addEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded)))},d.prototype.updateUI=function(){var b=this.viewer.impl.keyFrameAnimator;this.animTools&&b&&(this.animTools.input.value=b.duration>0?b.currentTime/b.duration*100:0,this.animTools.lapse.value=a(b.currentTime),this.animTools.lapseLeft.value=a(b.currentTime-b.duration),this.updatePlayButton(b.isPaused),this.updateToolbarBackground())},d.prototype.onPlayCallback=function(b){if(this.animTools){var c=this.viewer.impl.keyFrameAnimator;this.animTools.input.value=b,this.animTools.lapse.value=a(c.currentTime),this.animTools.lapseLeft.value=a(c.currentTime-c.duration),b>=100&&this.updatePlayButton(!0),this.updateToolbarBackground()}},d.prototype.updatePlayButton=function(a){this.playButton&&(a?(this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play")):(this.playButton.setIcon("toolbar-animationPauseIcon"),this.playButton.setToolTip("Pause")))},d.prototype.resetExplode=function(a,b){var c=this.viewer;c.model.is2d()||0===c.getExplodeScale()||(b&&c.explodeSlider&&(c.explodeSlider.value=a),c.explode(a))},d.prototype.adjustToolbarPosition=function(){var a=this.viewer;if(a.toolbar){var b=a.toolbar.getDimensions().width,c=a.container.getBoundingClientRect().width;b>c&&(b=a.modelTools.getDimensions().width);var d=b-(2*this.animTools.backwardButton.getDimensions().width+3*this.animTools.timeText.getDimensions().width+this.animTools.closeButton.getDimensions().width)+12;this.animTools.input.style.width=d+"px",this.toolbar.container.style.left="calc(50% - "+b/2+"px)"}},d.prototype.hideAnimateToolbar=function(){this.viewer.toolbar&&this.viewer.toolbar.removeClass("toolbar-animationMenuplacer"),this.animTools&&this.animTools.setVisible(!1)},d.prototype.updateToolbarBackground=function(){if(this.animTools){var a=this.animTools.input,b=a.value,c="#ffffff",d="#393939";a.style.background="-webkit-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-moz-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-ms-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="-o-linear-gradient(left,"+c+" "+b+"%, "+d+" "+b+"%)",a.style.background="linear-gradient(to right,"+c+" "+b+"%, "+d+" "+b+"%)"}},d.prototype.onCameraChange=function(){if(this.viewer.toolController.cameraUpdated){var a=this.viewer.impl.keyFrameAnimator;if(!a)return;a.isPlaying&&!a.isPaused&&(a.pause(),this.updatePlayButton(a.isPaused))}},d.prototype.onResize=function(){this.toolbar&&(this.viewer.container.clientWidth<(isTouchDevice()?560:600)?this.toolbar.setCollapsed(!0):(this.toolbar.setCollapsed(!1),this.adjustToolbarPosition()))},d.prototype.onEscape=function(){this.isPlaying()?this.pause():this.hideAnimateToolbar()},d.prototype.onExplode=function(){var a=this.viewer.impl.keyFrameAnimator;a&&(0!==a.currentTime&&(this.prevAnimationTime=a.currentTime,a["goto"](0)),this.updatePlayButton(!0)),this.hideAnimateToolbar()},d.prototype.onToolbarCreated=function(){var d=this.viewer,e=this;this.onToolbarCreatedBinded&&(d.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.toolbar=new c.ToolBar("animation-toolbar"),this.toolbar.addClass("toolbar-animationSubtoolbar"),d.container.appendChild(this.toolbar.container),this.animTools=new c.ControlGroup(this.animToolsId),this.animTools.setVisible(!1),this.toolbar.addControl(this.animTools),this.playButton=new c.Button("toolbar-animationPlay"),this.playButton.setIcon("toolbar-animationPlayIcon"),this.playButton.setToolTip("Play"),this.playButton.onClick=function(){e.isPaused()?e.play():e.pause()},d.modelTools.addControl(this.playButton),d.modelTools.resetModelButton&&(d.modelTools.resetModelButton.onClick=function(b){d.showAll();var c=d.impl.keyFrameAnimator;c&&(c["goto"](0),g.value=0,f.value=a(0),i.value=a(-c.duration),e.updatePlayButton(!0)),e.resetExplode(0,!0),e.updateToolbarBackground()}),this.animTools.backwardButton=new c.Button("toolbar-animationBackward"),this.animTools.backwardButton.setToolTip("Previous keyframe"),this.animTools.backwardButton.onClick=function(a){var b=d.impl.keyFrameAnimator;void 0!==b&&b&&(b.prev(),e.updateUI())},this.animTools.backwardButton.addClass("toolbar-animationButton"),this.animTools.backwardButton.setIcon("toolbar-animationBackwardIcon"),this.animTools.addControl(this.animTools.backwardButton),this.animTools.forwardButton=new c.Button("toolbar-animationForward"),this.animTools.forwardButton.setToolTip("Next keyframe"),this.animTools.forwardButton.onClick=function(a){var b=d.impl.keyFrameAnimator;void 0!==b&&b&&(b.next(),e.updateUI())},this.animTools.forwardButton.addClass("toolbar-animationButton"),this.animTools.forwardButton.setIcon("toolbar-animationForwardIcon"),this.animTools.addControl(this.animTools.forwardButton),this.animTools.timeText=new c.Control("toolbar-animationTimeLapse");var f=this.animTools.lapse=document.createElement("input");f.type="text",f.value="0",f.className="animationTimeLapse",f.disabled=!0,this.animTools.timeText.container.appendChild(f),this.animTools.timeText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeText),this.animTools.timeline=new c.Control("toolbar-animationTimeline");var g=this.animTools.input=document.createElement("input");g.type="range",g.value="0",g.className="animationTimeline",this.animTools.timeline.container.appendChild(g),g.addEventListener("input",function(b){var c=d.impl.keyFrameAnimator;if(void 0!==c&&c){var h=g.value*c.duration/100;f.value=a(h),i.value=a(h-c.duration),c["goto"](h),e.updatePlayButton(c.isPaused),e.updateToolbarBackground()}});var h=document.createElement("div");h.className="adsk-control-tooltip",h.textContent=Autodesk.Viewing.i18n.translate("Click-drag to scrub"),this.animTools.timeline.container.appendChild(h),g.addEventListener("mouseover",function(a){a.target===g&&(h.style.visibility="visible")}),g.addEventListener("mouseout",function(a){a.target===g&&(h.style.visibility="hidden")}),this.animTools.timeline.addClass("toolbar-animationButton"),this.animTools.timeline.addClass("toolbar-animationTimeline"),this.animTools.addControl(this.animTools.timeline),this.animTools.timeLeftText=new c.Control("toolbar-animationRemainingTime");var i=this.animTools.lapseLeft=document.createElement("input");i.type="text",i.value="0",i.className="animationTimeLapse",i.disabled=!0,this.animTools.timeLeftText.container.appendChild(i),this.animTools.timeLeftText.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.timeLeftText),this.animTools.closeButton=new c.Button("toolbar-animationClose"),this.animTools.closeButton.setToolTip("Close animation timeline"),this.animTools.closeButton.onClick=function(){e.hideAnimateToolbar()},this.animTools.closeButton.setIcon("toolbar-animationCloseIcon"),this.animTools.closeButton.addClass("toolbar-animationButton"),this.animTools.addControl(this.animTools.closeButton)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360"),Autodesk.Viewing.Extensions.Fusion360.AnimationExtension=d,b.theExtensionManager.registerExtension("Autodesk.Fusion360.Animation",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),Autodesk.Viewing.Extensions.Oculus.StereoRenderContext=function(a){function b(a){w=a.hResolution/(2*a.vResolution);var b=-1-4*(a.hScreenSize/4-a.lensSeparationDistance/2)/a.hScreenSize;t=a.distortionK[0]+a.distortionK[1]*Math.pow(b,2)+a.distortionK[2]*Math.pow(b,4)+a.distortionK[3]*Math.pow(b,6),v=THREE.Math.radToDeg(2*Math.atan2(a.vScreenSize*t,2*a.eyeToScreenDistance)),u=4*(a.hScreenSize/4-a.interpupillaryDistance/2)/a.hScreenSize;var c=4*(a.hScreenSize/4-a.lensSeparationDistance/2)/a.hScreenSize;r.lensCenter=new THREE.Vector2(c,0),s.lensCenter=new THREE.Vector2(-c,0)}function c(a){d.aspect=e.aspect=w,d.fov=e.fov=v;var b=1/f.getUnitScale(),c=a.target.clone().sub(a.position).cross(a.up).normalize();c.multiplyScalar(1*q.interpupillaryDistance*b),e.position.add(c),e.target.add(c),d.toPerspective(),e.toPerspective(),e.projectionMatrix.elements[12]-=2*u}var d,e,f,g,h,i,j,k,l,m,n,o,p=a?a.useWarp:!0,q=a&&a.HMD?a.HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:.0635,lensSeparationDistance:.0635,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]},r={},s={},t=1,u=0,v=100,w=1;this.init=function(a,c,d){if(init_WarpShader(),h=a,i=c,j=d,k=h.getPixelRatio(),b(q),f=new RenderContext,g=new RenderContext,f.settings.sao=g.settings.sao=!1,f.settings.antialias=g.settings.antialias=!1,f.settings.customPresentPass=g.settings.customPresentPass=p,f.init(h,i/2*t/k,j*t/k),g.init(h,j/2*t/k,j*t/k),this.settings=f.settings,p){l=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader),m=new Autodesk.Viewing.Shaders.LmvShaderPass(WarpShader);for(var e=[l,m],n=0;2>n;n++)e[n].material.blending=THREE.NoBlending,e[n].material.depthWrite=!1,e[n].material.depthTest=!1,e[n].uniforms.hmdWarpParam.value.set(q.distortionK[0],q.distortionK[1],q.distortionK[2],q.distortionK[3]),e[n].uniforms.chromAbParam.value.set(q.chromaAbParameter[0],q.chromaAbParameter[1],q.chromaAbParameter[2],q.chromaAbParameter[3]),e[n].uniforms.scaleIn.value.set(1,1/w),e[n].uniforms.scale.value.set(1/t,1*w/t);e[0].uniforms.lensCenter.value.copy(r.lensCenter),e[1].uniforms.lensCenter.value.copy(s.lensCenter)}},this.revertCameraChanges=function(a){return console.log("REVERT Camera to normal"),d.fov=n,d.aspect=o,d},this.saveCameraState=function(a){console.log(a),n=a.fov,o=a.aspect},this.update=function(a){var b=f.update(a),c=g.update(a);return b||c},this.beginScene=function(a,b,h,i){d=b,e=b.clone(),c(b),f.beginScene(a,d,h,i),g.beginScene(a,e,h,i)},this.renderScenePart=function(a,b,c,d){f.renderScenePart(a,b,c,d),
g.renderScenePart(a,b,c,d)},this.sceneDirty=function(a,b){f.sceneDirty(a,b),g.sceneDirty(a,b)},this.endScene=function(){f.endScene(),g.endScene()},this.clearAllOverlays=function(){f.clearAllOverlays(),g.clearAllOverlays()},this.renderOverlays=function(a){f.renderOverlays(a),g.renderOverlays(a)},this.composeFinalFrame=function(a,b){f.composeFinalFrame(a,b,!0),g.composeFinalFrame(a,b,!0),h.setViewport(0,0,i/2,j),f.presentBuffer(l),h.setViewport(i/2,0,i/2,j),g.presentBuffer(m),h.setViewport(0,0,i,j)},this.cleanup=function(){f.cleanup(),g.cleanup()},this.setSize=function(a,b,c){i=a,j=b,f.setSize(i/2*t/k,j*t/k,c),g.setSize(i/2*t/k,j*t/k,c),h.setSize(a,b)},this.getMaxAnisotropy=function(){return f.getMaxAnisotropy()},this.hasMRT=function(){return f.hasMRT()},this.initPostPipeline=function(a,b,c){a=!1,b=!1,c=!1,f.initPostPipeline(a,b,c),g.initPostPipeline(a,b,c)},this.setClearColors=function(a,b){f.setClearColors(a,b),g.setClearColors(a,b)},this.setAOOptions=function(a,b){f.setAOOptions(a,b),g.setAOOptions(a,b)},this.getAORadius=function(){return f.getAORadius()},this.getAOIntensity=function(){return f.getAOIntensity()},this.setTonemapExposureBias=function(a){f.setTonemapExposureBias(a),g.setTonemapExposureBias(a)},this.getExposureBias=function(){return f.getExposureBias()},this.setTonemapMethod=function(a){f.setTonemapMethod(a),g.setTonemapMethod(a)},this.getToneMapMethod=function(){return f.getToneMapMethod()},this.toggleTwoSided=function(a){f.toggleTwoSided(a),g.toggleTwoSided(a)},this.enter2DMode=function(a){f.enter2DMode(a),g.enter2DMode(a)},this.idAtPixel=function(a,b){return console.warn("idAtPixel not implemented in stereo context."),0},this.overlayUpdate=function(a){f.overlayUpdate(a),g.overlayUpdate(a)},this.rolloverObjectViewport=function(a,b){},this.screenCapture=function(){return console.warn("Screen capture not implemented by stereo render context"),null},this.setUnitScale=function(a){f.setUnitScale(a),g.setUnitScale(a)},this.getUnitScale=function(){return f.getUnitScale()}},AutodeskNamespace("Autodesk.Viewing.Extensions.Oculus"),function(){function a(a){function b(){n.copy(d.matrixWorld),n.elements[12]=0,n.elements[13]=0,n.elements[14]=0,e&&m.set(e[1],e[2],e[3])}function c(){var a=new WebSocket("ws://localhost:8888/ws");a.onopen=function(){console.log("### Oculus Connected ####")},a.onmessage=function(a){var b=a.data;try{e=JSON.parse(b)}catch(c){console.log(b)}},a.onclose=function(){console.log("### Oculus Connection Closed ####")},f=a}var d,e,f,h=a,i=new THREE.Vector3(0,0,0),j=new THREE.Quaternion,k=new THREE.Quaternion,l=new THREE.Matrix4,m=new THREE.Vector3(0,0,0),n=new THREE.Matrix4,o=new THREE.Matrix4,p=0,q=1,r=10,s=.001,t=-1,u=0,v=0,w=0,x=0,y=0,z=0,A=0;g?e=[0,0,0,0,0,0,0,0]:c(),this.getNames=function(){return["headtracker"]},this.getName=function(){return"headtracker"};var B;this.activate=function(a){if(d=h.navigation.getCamera(),b(),h.model){q=1/h.model.getUnitScale();var c=h.model.getBoundingBox();r=1e-4*c.size().length()}(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(B=new Autodesk.Viewing.Extensions.GamepadModule(h),B.activate(this.getName()))},this.deactivate=function(a){d=null,B&&B.deactivate()},this.update=function(b){0>t&&(t=b);var c=b-t;if(d.isPerspective||a.navigation.toPerspective(),g){var h=g.getState();e[0]=p+1,h.orientation&&(e[4]=h.orientation.x,e[5]=h.orientation.y,e[6]=h.orientation.z,e[7]=h.orientation.w),h.position&&(e[1]=h.position.x,e[2]=h.position.y,e[3]=h.position.z)}if(e){var C=e[0];if(C>p){d.position.sub(i),i.set(e[1],e[2],e[3]),i.sub(m),i.multiplyScalar(q),i.applyMatrix4(n),d.position.add(i),u+=(z-A)*c*s,k.setFromAxisAngle(d.worldup,u),j.set(e[4],e[5],e[6],e[7]),k.multiply(j),o.makeRotationFromQuaternion(k),l.multiplyMatrices(n,o);var D=l.elements,E=new THREE.Vector3(-D[8],-D[9],-D[10]),F=d.target.clone().sub(d.position).length();d.up.set(D[4],D[5],D[6]);var G=new THREE.Vector3(D[0],D[1],D[2]),H=E.clone().multiplyScalar((v-x)*c*r);d.position.add(H);var I=G.multiplyScalar((y-w)*c*r);d.position.add(I),d.target.set(d.position.x,d.position.y,d.position.z),d.target.add(E.multiplyScalar(F))}p=C}return f&&1===f.readyState&&f.send("get\n"),B&&(d=B.update(d)),t=b,!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){var c=!1;switch(b){case 38:case 87:v=1,c=!0;break;case 40:case 83:x=1,c=!0;break;case 37:case 65:w=1,c=!0;break;case 39:case 68:y=1,c=!0;break;case 81:z=1,c=!0;break;case 69:A=1,c=!0}return c},this.handleKeyUp=function(a,c){var d=!1;switch(c){case 38:case 87:v=0,d=!0;break;case 40:case 83:x=0,d=!0;break;case 37:case 65:w=0,d=!0;break;case 39:case 68:y=0,d=!0;break;case 81:z=0,d=!0;break;case 69:A=0,d=!0;break;case 32:b(),d=!0}return d},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a,b){return!1},this.handleTouchChange=function(a,b){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,d=(b.Private,b.UI),e=c.Oculus,f=null,g=null;e.Oculus=function(a,c){b.Extension.call(this,a,c),this.viewer=a,this.context=null,this.initialized=!1},e.Oculus.prototype=Object.create(b.Extension.prototype),e.Oculus.prototype.constructor=c.Oculus,e.Oculus.prototype.toggleOculus=function(b){var c=this.viewer;b?this.context||(this.context=new e.StereoRenderContext({useWarp:!f}),this.context.saveCameraState(this.viewer.navigation.getCamera()),c.impl.setUserRenderContext(this.context),c.resize(c.canvas.clientWidth,c.canvas.clientHeight),c.displayViewCube(!1,!1),c.navigation.isPerspective||c.navigation.toPerspective(),f?launchFullscreen(c.impl.canvas,{vrDisplay:f}):launchFullscreen(c.impl.canvas),this.headTracker||(this.headTracker=new a(c),c.toolController.registerTool(this.headTracker)),c.toolController.activateTool("headtracker")):this.context&&(this.viewer.navigation.setCamera(this.context.revertCameraChanges()),this.context=null,c.impl.setUserRenderContext(null),c.displayViewCube(c.prefs.get("viewCube"),!1),c.toolController.deactivateTool("headtracker"),exitFullscreen())},e.Oculus.prototype.createUI=function(){var a=this,b=this.viewer;this.oculusButton=new d.Button("toolbar-oculusTool"),this.oculusButton.setToolTip("Oculus VR Mode"),this.oculusButton.setIcon("oculusIcon"),this.oculusButton.onClick=function(b){a.toggleOculus(!a.context)},b.modelTools.addControl(this.oculusButton)},e.Oculus.prototype.load=function(){function a(c){e.removeEventListener(b.TOOLBAR_CREATED_EVENT,a),h.createUI()}function c(){e.modelTools&&e.modelTools.getNumberOfControls()>0?h.createUI():e.addEventListener(b.TOOLBAR_CREATED_EVENT,a)}function d(a){for(var b=0;b<a.length;++b)if(a[b]instanceof HMDVRDevice){f=a[b];break}if(f){for(var b=0;b<a.length;++b)if(a[b]instanceof PositionSensorVRDevice&&a[b].hardwareUnitId==f.hardwareUnitId){g=a[b];break}f&&g?c():stderr("Didn't find a HMD and sensor!"),h.initialized=!0}}var e=this.viewer,h=this;return navigator.getVRDevices?navigator.getVRDevices().then(d):navigator.mozGetVRDevices?navigator.mozGetVRDevices(d):this.initialized=!0,!0},e.Oculus.prototype.unload=function(){return this.toggleOculus(!1),!0},b.theExtensionManager.registerExtension("Autodesk.Viewing.Oculus",e.Oculus)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Private,c=a.Extensions,d=c.Collaboration;d.InteractionInterceptor=function(a){this.getNames=function(){return["intercept"]},this.getName=function(){return"intercept"},this.activate=function(a){},this.deactivate=function(a){},this.update=function(a){return!1},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(b){return a.takeControl(),!1},this.handleButtonDown=function(b,c){return a.takeControl(),!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(b){return a.updatePointer(b),!1},this.handleGesture=function(b){return a.takeControl(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}},d.ViewTransceiver=function(c){function d(a){p=!0;var b=JSON.parse(a.data.msg);w.restoreState(b),o.impl.invalidate(!0,!1,!0),p=!1}function e(a){return Math.round(1e3*a)/1e3}function f(a){for(var b=0;b<a.length;b++)a[b]=e(a[b])}function g(a){var b=a.data.msg;b[1]===!0||r||(b[0]!=m&&(m=b[0],a.data.lastInControl=b[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:a.data})),q=!1,o.navigation.setView((new THREE.Vector3).set(b[2],b[3],b[4]),(new THREE.Vector3).set(b[5],b[6],b[7])),o.navigation.setCameraUpVector((new THREE.Vector3).set(b[8],b[9],b[10])))}function h(a){if(q||r){var b=a.camera,d=[b.position.x,b.position.y,b.position.z,b.target.x,b.target.y,b.target.z,b.up.x,b.up.y,b.up.z];f(d),d.unshift(r),d.unshift(c.getLocalId()),s.sendMessage("camera",d,n.channelId),m!=d[0]&&(m=d[0],n.dispatchEvent({type:"controlChange",channelId:n.channelId,data:{lastInControl:m}}))}}function i(a,b,c){a&&!u&&(u=document.createElement("div"),u.classList.add("collabPointer")),a&&!v?(o.container.appendChild(u),v=!0):!a&&v&&(o.container.removeChild(u),v=!1),a&&(u.style.left=b-6+"px",u.style.top=c-6+"px")}function j(a){if(!q&&!r){var b=a.data.msg;t.origin.set(b[1],b[2],b[3]),t.direction.set(b[4],b[5],b[6]);var c=t.at(o.getCamera().near);c.project(o.getCamera()),c=o.impl.viewportToClient(c.x,c.y),i(!0,c.x,c.y)}}function k(a){if(q){var b=o.impl.clientToViewport(a.canvasX,a.canvasY);o.impl.viewportToRay(b,t);var d=[t.origin.x,t.origin.y,t.origin.z,t.direction.x,t.direction.y,t.direction.z];f(d),d.unshift(c.getLocalId()),s.sendMessage("pointer",d,n.channelId)}}function l(a){if(!p){var b=w.getState(x);c.sendMessage("state",JSON.stringify(b),n.channelId)}}var m,n=this,o=this.viewer=null,p=!1,q=!1,r=!1,s=this.client=c,t=new THREE.Ray,u=null,v=!1;this.channelId=null;var w,x={seedURN:!1,objectSet:!0,viewport:!1,cutplanes:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}};this.takeControl=function(){q=!0,i(!1)},this.updatePointer=function(a){k(a)},this.connectCamera=function(a){r=!a},this.attach=function(c){o&&this.detach(),this.viewer=o=c,w=new b.ViewerState(o),s.addEventListener("cameraChange",g),s.addEventListener("pointerMove",j),s.addEventListener("viewerState",d),o.hasEventListener(a.CAMERA_CHANGE_EVENT,h)||o.addEventListener(a.CAMERA_CHANGE_EVENT,h),o.hasEventListener(a.SELECTION_CHANGED_EVENT,l)||(o.addEventListener(a.SELECTION_CHANGED_EVENT,l),o.addEventListener(a.ISOLATE_EVENT,l),o.addEventListener(a.HIDE_EVENT,l),o.addEventListener(a.SHOW_EVENT,l),o.addEventListener(a.HIGHLIGHT_EVENT,l),o.addEventListener(a.EXPLODE_CHANGE_EVENT,l),o.addEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.addEventListener(a.CUTPLANES_CHANGE_EVENT,l))},this.detach=function(){s&&(s.removeEventListener("cameraChange",g),s.removeEventListener("viewerState",d)),o&&(o.removeEventListener(a.CAMERA_CHANGE_EVENT,h),o.removeEventListener(a.SELECTION_CHANGED_EVENT,l),o.removeEventListener(a.ISOLATE_EVENT,l),o.removeEventListener(a.HIDE_EVENT,l),o.removeEventListener(a.SHOW_EVENT,l),o.removeEventListener(a.HIGHLIGHT_EVENT,l),o.removeEventListener(a.EXPLODE_CHANGE_EVENT,l),o.removeEventListener(a.LAYER_VISIBILITY_CHANGED_EVENT,l),o.removeEventListener(a.CUTPLANES_CHANGE_EVENT,l),this.viewer=o=null,w=null)}},d.ViewTransceiver.prototype.constructor=d.ViewTransceiver,Autodesk.Viewing.EventDispatcher.prototype.apply(d.ViewTransceiver.prototype)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Collaboration"),function(){var a=Autodesk.Viewing,b=a.Extensions,c=a.Private,d=a.UI,e=b.Collaboration;b.Collaboration.Collaboration=function(b,c){a.Extension.call(this,b,c),c&&c.rtc&&c.rtc.disableRTCToolbarButton&&(this.disableRTCToolbarButton=!0)},b.Collaboration.Collaboration.prototype=Object.create(a.Extension.prototype),b.Collaboration.Collaboration.prototype.constructor=b.Collaboration.Collaboration,b.Collaboration.Collaboration.prototype.initNetwork=function(a){(!this.p2p||a)&&(this.viewtx=new e.ViewTransceiver(this.client),this.interceptor=new e.InteractionInterceptor(this.viewtx),this.viewer.toolController.registerTool(this.interceptor),this.p2p=new c.P2PClient(this.client))},b.Collaboration.Collaboration.prototype.createUI=function(){var a=this,f=this.viewer;if(this.initNetwork(!1),this.panel=new e.DockingCollabPanel(this.viewer,this.client,this.p2p,this.viewtx),b.Collaboration.Collaboration.Panel=this.panel,this.collabButton=new d.Button("toolbar-collaborateTool"),this.collabButton.setToolTip("Live review"),this.collabButton.setIcon("adsk-icon-live-review"),this.collabButton.onClick=function(b){var c=a.panel.isVisible();if(!document.getElementById("collabBox"))if(c||a.inviteDivInstantiated)a.panel.setVisible(!1,!0),a.panel.reset();else{var d=new e.CollabPromptBox,g=f.container;d.start(g,function(){a.panel.setVisible(!0,!0)},"Start a Live Review","Start Review")}},this.disableRTCToolbarButton&&this.collabButton.setVisible(!1,!0),this.panel.addVisibilityListener(function(b){if(b){if(f.model){var e=f.model.getData();a.viewtx.channelId=e.basePath,a.viewtx.attach(f),a.client.connect(a.viewtx.channelId),a.client.join(a.viewtx.channelId)}f.toolController.activateTool(a.interceptor.getName());a.collabButton.setState(d.Button.State.ACTIVE),c.logger&&c.logger.log({category:"viewer_rtc_start"})}else c.logger&&a.client.isConnected()&&c.logger.log({category:"viewer_rtc_stop"}),a.p2p.hangup(),a.viewtx.detach(f),a.viewtx.channelId=null,a.client.disconnect(),a.panel.reset(),f.toolController.deactivateTool(a.interceptor.getName()),a.collabButton.setState(d.Button.State.INACTIVE)}),f.modelTools.addControl(this.collabButton),Autodesk.Viewing.Private.getParameterByName("invited")){var g=new CollabPromptBox,h=f.container;g.start(h,function(){a.panel.setVisible(!0,!0)},"Join a Live Review","Join Review")}},b.Collaboration.Collaboration.prototype.close=function(){this.panel.setVisible(!1,!0),this.panel.reset()},b.Collaboration.Collaboration.prototype.load=function(){function a(){function a(c){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),d.createUI()}d.client=c.MessageClient.GetInstance(d.options?d.options.messageServerURL:void 0),d.socketErrorHandler=function(a){c.ErrorHandler.reportError(b.container,Autodesk.Viewing.ErrorCodes.RTC_ERROR,a.data),d.close()},d.client.addEventListener("socketError",d.socketErrorHandler),d.presenceChannelId=window.location.host,d.client.isConnected(),b.modelTools?d.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a)}var b=this.viewer,d=this;return c.loadDependency("lmv_io","socket.io-1.3.5.js",a),!0},b.Collaboration.Collaboration.prototype.unload=function(){var a=this.viewer;return this.client.removeEventListener("socketError",this.socketErrorHandler),this.socketErrorHandler=null,this.p2p.hangup(),this.viewtx.detach(a),this.client.disconnect(),this.panel&&(this.panel.reset(),this.panel.setVisible(!1),this.panel.uninitialize(),this.panel=null),a.toolController.deactivateTool(this.interceptor.getName()),this.interceptor=null,a.modelTools.removeControl(this.collabButton.getId()),this.collabButton=null,!0},a.theExtensionManager.registerExtension("Autodesk.Viewing.Collaboration",b.Collaboration.Collaboration)}(),function(){function a(a,c,d,e){this.viewer=a,this.client=c,this.p2p=d,this.viewtx=e;var f="CollabPanel";b.UI.DockingPanel.call(this,a.container,f,"Live review"),this.container.classList.add("collabPanel"),this.container.style.height="auto",this.container.dockRight=!0,this.content=document.createElement("div"),this.container.appendChild(this.content),this.content.classList.add("collabPanelContent"),this.tableContainer=document.createElement("div"),this.tableContainer.classList.add("userListTable","dockingPanelScroll"),this.table=document.createElement("table"),this.table.classList.add("tftable"),this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.tableContainer.appendChild(this.table),this.content.appendChild(this.tableContainer),this.inviteDiv=document.createElement("div"),this.inviteDiv.className="collabBoxOK",this.inviteDiv.style["float"]="left",this.inviteDiv.style.width="232px",this.inviteDiv.setAttribute("data-i18n","Invite"),this.inviteDiv.textContent=Autodesk.Viewing.i18n.translate("Invite"),this.content.appendChild(this.inviteDiv),this.inviteDiv.addEventListener("click",function(b){var c=new CollabPromptBox,d=a.container;c.start(d,function(){var a=Autodesk.Viewing.i18n.translate("Please Join My Live Review");document.location.href="mailto:?subject="+a},"Invite Others","Email Invite",!0)}),this.chatHistory=document.createElement("div"),this.chatHistory.classList.add("chatHistory"),this.chatHistory.classList.add("textEntry"),this.chatHistory.classList.add("dockingPanelScroll"),this.content.appendChild(this.chatHistory),this.chatPanel=document.createElement("div"),this.chatPanel.classList.add("chatPanel"),this.textInput=document.createElement("input"),this.textInput.type="text",this.textInput.classList.add("textEntry"),this.textInput.placeholder=Autodesk.Viewing.i18n.translate("Type a message"),this.chatPanel.appendChild(this.textInput),this.content.appendChild(this.chatPanel),this.isCameraConnected=!0;var g=this;this.addEventListener(c,"userListChange",function(a){if(!a.channelId||a.channelId===g.viewtx.channelId){var b=g.client.getChannelInfo(g.viewtx.channelId);b&&g.updateUsers(b.users)}}),this.addEventListener(this.viewtx,"controlChange",function(a){a.channelId===g.viewtx.channelId&&g.updateUserInControl(a.data.lastInControl)}),this.addEventListener(c,"chatReceived",function(a){a.channelId===g.viewtx.channelId&&g.updateChatHistory(a)}),this.textInput.onkeyup=function(a){g.handleChatInput(a)},this.addEventListener(this.p2p,"remoteStreamAdded",function(a){g.videoPanel||g.createVideoPanel(),g.remoteVideo.src=window.URL.createObjectURL(a.data)}),this.addEventListener(this.p2p,"localStreamAdded",function(a){g.videoPanel||g.createVideoPanel(),g.localVideo.src=window.URL.createObjectURL(a.data)}),this.addEventListener(this.p2p,"remoteHangup",function(a){g.removeVideoPanel()})}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=(b.UI,c.Collaboration);Autodesk.Viewing.startLiveReviewSession=function(){e.Panel&&e.Panel.startSession()},Autodesk.Viewing.endLiveReviewSession=function(){e.Panel&&e.Panel.endSession()};a.prototype=Object.create(b.UI.DockingPanel.prototype),a.prototype.constructor=a,a.prototype.startSession=function(){var a=this,b=this.isVisible();if(!b){var c=new CollabPromptBox,d=this.viewer.container;c.start(d,function(){a.setVisible(!0,!0)},"Start a Live Review","Start Review")}},a.prototype.endSession=function(){var a=this.isVisible();a&&(this.setVisible(!1,!0),this.reset())},a.prototype.updateUsers=function(a){for(var b=document.createElement("tbody"),c=0;c<a.length;c++){var d=b.insertRow(-1);d.id=a[c].id;var e=d.insertCell(0);e.style.width="14px",e.style.cursor="default";var f=document.createElement("div");f.classList.add("statusBase"),f.classList.add("statusNormal"),f.innerHTML="&#9679",e.appendChild(f);var g=d.insertCell(1);g.textContent=a[c].name}this.table.replaceChild(b,this.tbody),this.tbody=b,this.fixComponentPlacement()},a.prototype.updateUserInControl=function(a){for(var b=0;b<this.tbody.rows.length;b++){var c=this.tbody.rows[b],d=c.cells[0].childNodes[0];c.id==a?(d.classList.remove("statusNormal"),d.classList.add("statusInControl"),d.innerHTML="&#9784",c.cells[1].style.color="#4CBA36"):(d.classList.remove("statusInControl"),d.classList.add("statusNormal"),d.innerHTML="&#9679",c.cells[1].style.color="#ffffff")}},a.prototype.updateChatHistory=function(a){var b=this.client.getUserById(a.data.from,a.channelId);if("/"!=a.data.msg.charAt(0)){if(this.chatHistory.lastUser!=b.name){var c=document.createElement("p"),d=document.createElement("div");d.classList.add("heading"),d.style["float"]="left",d.style.fontStyle="normal",d.style.color="#857E7E",d.textContent=b.name,c.appendChild(d);var e=document.createElement("div");e.classList.add("heading"),e.style.textAlign="right",e.style.fontStyle="normal",e.style.color="#857E7E",e.textContent=(new Date).toLocaleTimeString(),c.appendChild(e),this.chatHistory.appendChild(c),this.chatHistory.lastUser=b.name}else{var f=document.createElement("br");this.chatHistory.appendChild(f)}var g=document.createElement("span");g.classList.add("messageText"),g.textContent=a.data.msg,this.chatHistory.appendChild(g),this.chatHistory.scrollTop=this.chatHistory.scrollHeight}},a.prototype.handleChatInput=function(a){13==a.which&&0!=this.textInput.value.length&&(this.client.sendChatMessage(this.textInput.value,this.viewtx.channelId),this.textInput.value="",this.textInput.placeholder="")},a.prototype.fixComponentPlacement=function(a){var b=this.tableContainer.offsetHeight+this.chatPanel.offsetHeight;this.videoPanel?(b+=this.videoPanel.offsetHeight,this.chatHistory.style.height="calc(100% - "+b+"px)"):this.chatHistory.style.height="calc(100% - "+b+"px)"},a.prototype.createVideoPanel=function(a){this.videoPanel=document.createElement("div"),this.videoPanel.classList.add("videoPanel"),this.localVideo=document.createElement("video"),this.localVideo.autoplay=!0,this.localVideo.muted=!0,this.localVideo.classList.add("videoInset"),this.videoPanel.appendChild(this.localVideo),this.remoteVideo=document.createElement("video"),this.remoteVideo.autoplay=!0,this.remoteVideo.classList.add("videoMain"),this.videoPanel.appendChild(this.remoteVideo);var b=this,c=document.createElement("div");c.classList.add("dockingPanelClose"),c.innerHTML="&times",c.title=Autodesk.Viewing.i18n.translate("End video call"),c.onclick=function(a){b.p2p.hangup(),b.removeVideoPanel()},this.videoPanel.appendChild(c),this.content.insertBefore(this.videoPanel,this.chatHistory),this.fixComponentPlacement()},a.prototype.removeCollabPrompt=function(){var a=document.getElementById("collabBox");a&&(a.style.visibility="hidden",this.viewer.container.removeChild(a))},a.prototype.removeVideoPanel=function(){this.videoPanel&&this.content.removeChild(this.videoPanel),this.videoPanel=null},a.prototype.reset=function(a){if(this.tbody){var b=document.createElement("tbody");this.table.replaceChild(b,this.tbody),this.tbody=b}this.chatHistory.textContent="",this.textInput.value="",this.removeVideoPanel(),this.removeCollabPrompt()},CollabPromptBox=function(){},CollabPromptBox.prototype.start=function(a,b,c,e,f){if(a&&!document.getElementById("collabBox")){var g=document.createElement("div");g.id="collabBox",g.className="collabBox",a.appendChild(g);var h=document.createElement("div");h.className="collabBoxTitle",h.textContent=Autodesk.Viewing.i18n.translate(c,{defaultValue:c}),g.appendChild(h);var i=document.createElement("span");i.className="collabBoxText";var j="Enter your name";f&&(j="Review URL"),i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i);var k=document.createElement("span");k.className="collabBoxInputContainer",g.appendChild(k);var l=document.createElement("input");if(l.type="text",l.className="collabBoxInputText",f){var m=window.location.toString();m+=-1==m.indexOf("?")?"?invited=true":"&invited=true",Autodesk.Viewing.Private.docItemId&&(m+="&itemid="+Autodesk.Viewing.Private.docItemId),m+="&doNotRedirect=true",l.value=m}k.appendChild(l),l.onkeyup=function(c){13==c.keyCode&&(g.style.visibility="hidden",a.removeChild(g),d.setUserName(l.value),b())};var n=document.createElement("div");if(n.className="collabBoxClose",n.innerHTML="&times;",n.addEventListener("click",function(b){g.style.visibility="hidden",a.removeChild(g)}),g.appendChild(n),f){var i=document.createElement("span");i.className="collabBoxText",i.style.marginTop="0px";var j="Copy and send this URL to invite others";i.textContent=Autodesk.Viewing.i18n.translate(j,{defaultValue:j}),g.appendChild(i)}else{var o=document.createElement("div");o.className="collabBoxOK",o.textContent=Autodesk.Viewing.i18n.translate(e,{defaultValue:e}),o.addEventListener("click",function(c){g.style.visibility="hidden",a.removeChild(g),""!==l.value.trim()&&d.setUserName(l.value),b()}),g.appendChild(o)}g.style.visibility="visible",l.focus(),f&&l.select()}},e.DockingCollabPanel=a,e.CollabPromptBox=CollabPromptBox}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.constructor=Autodesk.Viewing.Extensions.Beeline.BeelineExtension,Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.load=function(){function a(){return f=d.getActiveNavigationTool(),d.setActiveNavigationTool(c.tool.getName()),!0}function b(){return d.setActiveNavigationTool(f?f:d.defaultNavigationToolName),!0}var c=this,d=this.viewer,e=Autodesk.Viewing.UI;this.tool=new Autodesk.Viewing.Extensions.Beeline.BeelineTool(d.impl,d),d.toolController.registerTool(this.tool),this.createUI();var f;this.HOTKEYS_ID="Autodesk.Beeline.Hotkeys";var g=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.CONTROL,Autodesk.Viewing.theHotkeyManager.KEYCODES.ALT],onPress:a,onRelease:b}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,g),this.onToolChanged=function(a){if(-1!==a.toolName.indexOf("beeline")&&c.beelineButton){var b=a.active?e.Button.State.ACTIVE:e.Button.State.INACTIVE;c.beelineButton.setState(b)}},d.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar&&a.getSettingsPanel){var b=a.getToolbar(!0),c=Autodesk.Viewing.UI,d=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),e="toolbar-beelineTool",f=new c.Button(e);f.setToolTip("Walk to"),f.setIcon("adsk-icon-walk"),f.onClick=function(b){var d=f.getState();d===c.Button.State.INACTIVE?a.setActiveNavigationTool("beeline"):d===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.beelineButton=f;var g=d.getControl("toolbar-cameraSubmenuTool");g?d.addControl(this.beelineButton,{index:d.indexOf(g.getId())}):d.addControl(this.beelineButton);var h=this,i=function(){a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,i);var b=Autodesk.Viewing.Extensions.ViewerSettingTab.Navigation,c=a.getSettingsPanel(!0);h.viewerOption_LookHorId=c.addCheckbox(b,"Reverse horizontal look direction",!1,function(b){a.setReverseHorizontalLookDirection(b)},"reverseHorizontalLookDirection"),h.viewerOption_LookVertId=c.addCheckbox(b,"Reverse vertical look direction",!1,function(b){a.setReverseVerticalLookDirection(b)},"reverseVerticalLookDirection")};this.viewer.getSettingsPanel(!1)?i():this.viewer.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,i)}},Autodesk.Viewing.Extensions.Beeline.BeelineExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.beelineButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.beelineButton.getId()),this.beelineButton=null}return a.getSettingsPanel&&(a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookHorId),a.getSettingsPanel(!1).removeCheckbox(this.viewerOption_LookVertId)),a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Beeline",Autodesk.Viewing.Extensions.Beeline.BeelineExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Beeline"),Autodesk.Viewing.Extensions.Beeline.BeelineTool=function(a,b){function c(){o.revertToStartState()}function d(a){var b={};b.target=a.target.clone(),b.worldup=a.worldup.clone(),b.position=a.position.clone(),b.up=a.up.clone();for(var c=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],d=0;d<c.length;d++)b[c[d]]=a[c[d]];return b}function e(a,b){var c=a.target.equals(b.target)&&a.position.equals(b.position)&&a.worldup.equals(b.worldup)&&a.up.equals(b.up);if(!c)return!1;for(var d=["isPerspective","fov","zoom","aspect","left","right","top","bottom"],e=0;e<d.length;e++)if(a[d[e]]!==b[d[e]])return!1;return!0}function f(c){var d=new THREE.Vector3(c.x,c.y,1),e=a.hitTestViewport(d.clone(),!1);if(!e||!e.intersectPoint)return[];var f=new THREE.Raycaster,g=d.clone(),h=a.camera,i=new THREE.Vector3(g.x,g.y,1);g.z=-1,g=g.unproject(h),i=i.unproject(h),i.sub(g).normalize(),f.set(s.isPerspective?h.position:g,i);for(var j=[],k=e.fragId instanceof Array?e.fragId:[e.fragId],l=0;l<k.length;l++){var m=a.getRenderProxy(b.model,k[l]);VBIntersector.meshRayCast(m,f,j)}return j.sort(function(a,b){return a.distance-b.distance}),j}function g(){s.isPerspective||(s.toPerspective(),t.activatePivot(!1)),s.getFocalLength()>k&&s.setFocalLength(k,!0)}var h={GO_TO:0,PASS_THROUGH:1,DEFAULT:0},i=1e3,j=.8,k=28,l=.7,m=0,n=1,o=this,p=b,q=b.container,r=b.autocam,s=b.navigation,t=b.utilities,u=["beeline"],v=m,w=!1,x=0,y=null,z=null,A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Vector3,E=!1,F=new THREE.Vector3,G=new THREE.Vector3,H=null,I=null;this.getNames=function(){return u},this.getName=function(){return u[0]},this.activate=function(a){x=0,b.addEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),r.userLookSpeed=j,this.showHUDMessage(!0)},this.deactivate=function(){b.removeEventListener(Autodesk.Viewing.FULLSCREEN_MODE_EVENT,c),this.revertToStartState(),this.showHUDMessage(!1)},this.getCursor=function(){return w?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAcCAQAAADYBBcfAAAACXBIWXMAABYlAAAWJQFJUiTwAAADGGlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjaY2BgnuDo4uTKJMDAUFBUUuQe5BgZERmlwH6egY2BmYGBgYGBITG5uMAxIMCHgYGBIS8/L5UBFTAyMHy7xsDIwMDAcFnX0cXJlYE0wJpcUFTCwMBwgIGBwSgltTiZgYHhCwMDQ3p5SUEJAwNjDAMDg0hSdkEJAwNjAQMDg0h2SJAzAwNjCwMDE09JakUJAwMDg3N+QWVRZnpGiYKhpaWlgmNKflKqQnBlcUlqbrGCZ15yflFBflFiSWoKAwMD1A4GBgYGXpf8EgX3xMw8BSMDVQYqg4jIKAUICxE+CDEESC4tKoMHJQODAIMCgwGDA0MAQyJDPcMChqMMbxjFGV0YSxlXMN5jEmMKYprAdIFZmDmSeSHzGxZLlg6WW6x6rK2s99gs2aaxfWMPZ9/NocTRxfGFM5HzApcj1xZuTe4FPFI8U3mFeCfxCfNN45fhXyygI7BD0FXwilCq0A/hXhEVkb2i4aJfxCaJG4lfkaiQlJM8JpUvLS19QqZMVl32llyfvIv8H4WtioVKekpvldeqFKiaqP5UO6jepRGqqaT5QeuA9iSdVF0rPUG9V/pHDBYY1hrFGNuayJsym740u2C+02KJ5QSrOutcmzjbQDtXe2sHY0cdJzVnJRcFV3k3BXdlD3VPXS8Tbxsfd99gvwT//ID6wIlBS4N3hVwMfRnOFCEXaRUVEV0RMzN2T9yDBLZE3aSw5IaUNak30zkyLDIzs+ZmX8xlz7PPryjYVPiuWLskq3RV2ZsK/cqSql01jLVedVPrHzbqNdU0n22VaytsP9op3VXUfbpXta+x/+5Em0mzJ/+dGj/t8AyNmf2zvs9JmHt6vvmCpYtEFrcu+bYsc/m9lSGrTq9xWbtvveWGbZtMNm/ZarJt+w6rnft3u+45uy9s/4ODOYd+Hmk/Jn58xUnrU+fOJJ/9dX7SRe1LR68kXv13fc5Nm1t379TfU75/4mHeY7En+59lvhB5efB1/lv5dxc+NH0y/fzq64Lv4T8Ffp360/rP8f9/AA0ADzT6lvFdAAAAIGNIUk0AAHolAACAgwAA+f8AAIDpAAB1MAAA6mAAADqYAAAXb5JfxUYAAAEtSURBVHja7JQxTkJBFEXPQ/xQEDG0ljRYSU1iLN2AtSWlC7Gw04QtGF2ApQVLIDY2hlgIDagJwWCOhf74JXxRYumbaib3ZO7c9zIhq1WBfzAfjJViDWPdYBq/w0pKITjhd7eGJwQkDu2I8rOFHYcmkqgDz4wfoeGZA01BHXtsbSla89ixZsH3an2LtpRUOQde28xFm17PgyPvVK1bl5yYEOtuq3rnyMQCXNJgiiTchuHCnhrGbYBMaXAJULGqlJz54O43bcFdH5xZUqpWJJWW7duza/tDmTWJbbv27Fs2PS2m1iZRNeGcI/aAEevOgCKnbAI7DNjjhUmk1ouf7xgHbLgF3MSzT7wCaxxSiW3hnsf4OngLotj3ILO74CoWTWzOIGcTXab4/6z+CnwbAGjXSZC++vLvAAAAAElFTkSuQmCC), auto":1>=x?"url(data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAQdJREFUeNq0k0GOgzAMRZ+jHI4VO4410qzam0aCjbsoaS1PUgfoWIqAEPnZ3z8AN0DNWoFfVeUbC0BtrOtaISNhC3tvGkC2P7ZtY1kWgHul90JEtCYTkVqo7O844LPyeZ51RJ5atQ3biZeolFJ0miYd1d4nd5A/gB+g7E++AFB7VqzWIkKkfdW/d27P8RpE4p8jRy7Z9ZBOpSEgRRb0MAv0lmxZNEXJj0IACTvwrfeksJBW9a0Z6NEh+vl4UI6qHzHBJ4nyFQv6YoaG3Ls80X7vTIqS1W+vdWvArfuSG/pplPzTBRy6ybaLkSSHAFcThoCe/c6C81n7jUY6a78rHQigftBnQY8BAEubfpuApyq2AAAAAElFTkSuQmCC), auto":null;
},this.update=function(){var a=s.getCamera();w=!1;var c=!1;if(1===x){var e=F.clone().sub(G);if(0!==e.x||0!==e.y){w=!0,G.x+=e.x*l,G.y+=e.y*l;var f=s.getWorldUpVector().dot(s.getCameraUpVector()),g=b.prefs.reverseHorizontalLookDirection?-1:1,h=b.prefs.reverseVerticalLookDirection?-1:1;e.x*=0>f?-g:g,e.y*=h,r.sync(s.getCamera()),r.look(e),c=!0,H=d(a)}}return c},this.revertToStartState=function(){t.pivotActive(!1),v=m,E=!0},this.attemptFlight=function(a,b){var c=f(a);c.length>0&&(A=c[0].point,B=c[c.length-1].point,o.fly(i,b))},this.fly=function(a,b){switch(t.setPivotPoint(b===h.GO_TO?A:B,!0,!0),g(),C=s.getPosition(),z=a,b){case h.GO_TO:D=C.clone().lerp(A,.8);break;case h.PASS_THROUGH:var c=2*r.camera.near,d=B.clone().sub(C).length(),e=c/d;t.setPivotPoint(C.clone().lerp(B,1+10*e),!0,!0),D=C.clone().lerp(B,1+e);break;default:return}v=n,E=!1,y=null,requestAnimationFrame(o.step)},this.step=function(a){var b=s.getCamera();if(!E){if(null===y)H=d(b),y=a;else if(!e(b,H))return void o.revertToStartState();var c=a-y,f=z>c?c/z:1,g=C.clone().lerp(D,f),h=s.getEyeVector();h.multiplyScalar(s.getPivotPoint().sub(s.getPosition()).length()/h.length()),s.setView(g,h.add(g)),H=d(b),t.activatePivot(!1),z>c?requestAnimationFrame(o.step):o.revertToStartState()}},this.handleGesture=function(a){switch(a.type){case"dragstart":return I="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===I?this.handleMouseMove(a):!1;case"dragend":return"drag"===I?(this.handleButtonUp(a,0),I=null,!0):!1}return!1},this.handleButtonDown=function(a,b){return x+=1<<b,0===b?(G.x=F.x=a.canvasX,G.y=F.y=a.canvasY,!0):!1},this.handleButtonUp=function(a,b){return x-=1<<b,0===b?!0:!1},this.handleSingleClick=function(a,b){if(0!==b)return this.revertToStartState(),!1;var c={x:a.normalizedX,y:a.normalizedY};switch(v){case m:o.attemptFlight(c,h.GO_TO);break;case n:o.revertToStartState()}return!0},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return a.pointers&&1===a.pointers.length?(o.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0):!1},this.handleDoubleClick=function(a,b){return 0===b?(o.attemptFlight({x:a.normalizedX,y:a.normalizedY},h.PASS_THROUGH),!0):!1},this.handleMouseMove=function(a){return F.x=a.canvasX,F.y=a.canvasY,1===x?(g(),!0):!1},this.handleBlur=function(a){return this.revertToStartState(),!1},this.showOrthoWarningMessage=function(){var a={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic Beeline",messageDefaultValue:"The view is set to Orthographic. Using this tool will switch to Perspective."};Autodesk.Viewing.Private.HudMessage.displayMessage(q,a)},this.showFocalWarningMessage=function(){var a={msgTitleKey:"Long Focal Length View Set",messageKey:"The view is set to a long focal length",messageDefaultValue:"This view has a long focal length. Using this tool will set a short focal length."};Autodesk.Viewing.Private.HudMessage.displayMessage(q,a)},this.watchCamera=function(a){if(p.toolController.getActiveToolName()===u[0]||p.toolController.getActiveToolName()===u[1]){var b=s.getCamera(),c=b&&!b.isPerspective,d=s.getFocalLength()>k;c?o.showOrthoWarningMessage():d?o.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss()}},this.showHUDMessage=function(a){var b=s.getCamera(),c=b&&!b.isPerspective,d=s.getFocalLength()>k;a&&c?o.showOrthoWarningMessage():a&&d?o.showFocalWarningMessage():Autodesk.Viewing.Private.HudMessage.dismiss(),a?p.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o.watchCamera):p.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,o.watchCamera)}},function(){"use strict";function a(a,b,c){return function(){var e=b.getState();e===d.Button.State.INACTIVE?(a.setActiveNavigationTool(c),b.setState(d.Button.State.ACTIVE)):e===d.Button.State.ACTIVE&&(a.setActiveNavigationTool(),b.setState(d.Button.State.INACTIVE))}}var b=AutodeskNamespace("Autodesk.Viewing.Extensions.DefaultTools"),c=Autodesk.Viewing,d=c.UI,e=function(a,b){c.Extension.call(this,a,b)};e.prototype=Object.create(c.Extension.prototype),e.prototype.constructor=e,e.prototype.load=function(){var a=this.viewer,b=new c.FovTool(a),d=new c.WorldUpTool(a.impl,a);return a.toolController.registerTool(b),a.toolController.registerTool(d),this.createUI(),this.initCameraStateMachine(),this.initFocalLengthOverlay(),!0},e.prototype.createUI=function(){var b=this.viewer,e=b.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID);if(f.returnToDefault=function(){},"3d"===this.options.mode){var g=new d.ComboButton("toolbar-orbitTools");g.setToolTip("Orbit"),g.setIcon("adsk-icon-orbit-constrained"),this.createOrbitSubmenu(g),f.addControl(g),f.orbittoolsbutton=g,g.setState(d.Button.State.ACTIVE),f.returnToDefault=function(){g.setState(d.Button.State.ACTIVE)}}var h=new d.Button("toolbar-panTool");h.setToolTip("Pan"),h.setIcon("adsk-icon-pan"),h.onClick=a(b,h,"pan"),f.addControl(h),f.panbutton=h;var i=new d.Button("toolbar-zoomTool");i.setToolTip("Zoom"),i.setIcon("adsk-icon-zoom"),i.onClick=a(b,i,"dolly"),f.addControl(i),f.dollybutton=i;var j=new d.ComboButton("toolbar-cameraSubmenuTool");j.setToolTip("Camera interactions"),j.setIcon("adsk-icon-camera"),j.saveAsDefault(),this.createCameraSubmenu(j),f.addControl(j),f.camerabutton=j},e.prototype.createOrbitSubmenu=function(b){var e=this.viewer,f=e.getToolbar(!0),g=f.getControl(c.TOOLBAR.NAVTOOLSID),h=new d.Button("toolbar-freeOrbitTool");h.setToolTip("Free orbit"),h.setIcon("adsk-icon-orbit-free"),h.onClick=a(e,h,"freeorbit"),b.addControl(h),g.freeorbitbutton=h;var i=new d.Button("toolbar-orbitTool");i.setToolTip("Orbit"),i.setIcon("adsk-icon-orbit-constrained"),i.onClick=a(e,i,"orbit"),b.addControl(i),g.orbitbutton=i,b.onClick=i.onClick},e.prototype.createCameraSubmenu=function(b){var e=this,f=this.viewer,g=f.getToolbar(!0),h=g.getControl(c.TOOLBAR.NAVTOOLSID);if(isTouchDevice()){var i=new d.Button("toolbar-homeTool");i.setToolTip("Home"),i.setIcon("adsk-icon-home"),i.onClick=function(){f.navigation.setRequestHomeView(!0);var a=f.getDefaultNavigationToolName();f.setActiveNavigationTool(a),b.restoreDefault()},b.addControl(i),h.homebutton=i}var j=new d.Button("toolbar-fitToViewTool");if(j.setToolTip("Fit to view"),j.setIcon("adsk-icon-fit-to-view"),j.onClick=function(a){f.fitToView("3d"===e.options.mode?f.getSelection():void 0);var c=f.getDefaultNavigationToolName();f.setActiveNavigationTool(c),b.restoreDefault()},b.addControl(j),h.fovbutton=j,"3d"===this.options.mode){var k=new d.Button("toolbar-focalLengthTool");k.setToolTip("Focal length"),k.setIcon("adsk-icon-fov"),k.onClick=a(f,k,"fov"),b.addControl(k),h.fovbutton=k}var l=new d.Button("toolbar-rollTool");l.setToolTip("Roll"),l.setIcon("adsk-icon-roll"),l.onClick=a(f,l,"worldup"),b.addControl(l),h.rollbutton=l},e.prototype.initCameraStateMachine=function(a){var b=this,d=this.viewer,e=d.getToolbar(!0),f=e.getControl(c.TOOLBAR.NAVTOOLSID);this.toolChangedHandler=function(a){"fov"===a.toolName&&b.showFocalLengthOverlay(a.active)},d.addEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.navChangedHandler=function(a){d.getDefaultNavigationToolName()===a.id&&f.returnToDefault()},d.addEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler)},e.prototype.initFocalLengthOverlay=function(){var a=this.focallength=document.createElement("div");a.className="focallength";var b=document.createElement("table"),c=document.createElement("tbody");b.appendChild(c),a.appendChild(b),this.viewer.container.appendChild(a);var d=c.insertRow(-1),e=d.insertCell(0);e.setAttribute("data-i18n","Focal Length"),e.textContent=Autodesk.Viewing.i18n.translate("Focal Length"),e=d.insertCell(1),e.textContent="",e.style.width="4em",e.style.textAlign="right",this.fovCell=e,a.style.visibility="hidden"},e.prototype.showFocalLengthOverlay=function(a){function b(a){if(a){var b={msgTitleKey:"Orthographic View Set",messageKey:"The view is set to Orthographic",messageDefaultValue:"The view is set to Orthographic. Changing the focal length will switch to Perspective."};c.Private.HudMessage.displayMessage(h.container,b)}else c.Private.HudMessage.dismiss()}function d(a){a&&e(),g.focallength&&(g.focallength.style.visibility=a?"visible":"hidden")}function e(){var a=h.getFocalLength();i!==a&&(i=a,g.fovCell.textContent=a.toString()+" mm")}function f(a){if(e(),"fov"===h.toolController.getActiveToolName()){var c=h.navigation.getCamera(),f=c&&!c.isPerspective;d(!f),b(f)}}var g=this,h=this.viewer,i=0,j=h.navigation.getCamera(),k=j&&!j.isPerspective;d(a&&!k),b(a&&k),a?h.addEventListener(c.CAMERA_CHANGE_EVENT,f):h.removeEventListener(c.CAMERA_CHANGE_EVENT,f)},e.prototype.unload=function(){return this.destroyUI(),!0},e.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(!b)return!0;var e=b.getControl(c.TOOLBAR.NAVTOOLSID);return e?("3d"===this.options.mode&&(e.orbittoolsbutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.orbittoolsbutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.orbittoolsbutton.getId()),e.orbittoolsbutton=null,e.orbitbutton.onClick=null,e.orbitbutton=null,e.freeorbitbutton.onClick=null,e.freeorbitbutton=null),e.removeControl(e.panbutton.getId()),e.panbutton.onClick=null,e.panbutton=null,e.removeControl(e.dollybutton.getId()),e.dollybutton.onClick=null,e.dollybutton=null,e.camerabutton.subMenu.removeEventListener(d.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,e.camerabutton.subMenuActiveButtonChangedHandler(e)),e.removeControl(e.camerabutton.getId()),e.camerabutton.onClick=null,e.camerabutton=null,e.rollbutton.onClick=null,e.rollbutton=null,e.fovbutton.onClick=null,e.fovbutton=null,this.focallength=null,a.removeEventListener(c.TOOL_CHANGE_EVENT,this.toolChangedHandler),this.toolChangedHandler=null,a.removeEventListener(c.NAVIGATION_MODE_CHANGED_EVENT,this.navChangedHandler),this.navChangedHandler=null,!0):!0},b.NavToolsExtension=e,c.theExtensionManager.registerExtension("Autodesk.DefaultTools.NavTools",e)}(),function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=b.UI,d=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)};d.prototype=Object.create(Autodesk.Viewing.Extension.prototype),d.prototype.constructor=d,d.prototype.onToolbarCreated=function(){this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null,this.createUI()},d.prototype.load=function(){var c=this,d=this.viewer;return this.escapeHotkeyId="Autodesk.Measure.Hotkeys.Escape",d.toolController?(this.tool=new a.MeasureTool(d,{onCloseCallback:function(a){c.enableMeasureTool(!1)}}),d.toolController.registerTool(this.tool),this.viewer.toolbar?this.createUI():(this.bindedOnToolbarCreated=this.onToolbarCreated.bind(this),this.viewer.addEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated)),!0):!1},d.prototype.unload=function(){var a=this.viewer;return this.destroyUI(),this.bindedOnToolbarCreated&&(this.viewer.removeEventListener(b.TOOLBAR_CREATED_EVENT,this.bindedOnToolbarCreated),this.bindedOnToolbarCreated=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},d.prototype.isActive=function(){return this.tool.isActive()},d.prototype.setActive=function(a){return this.enableMeasureTool(a)},d.prototype.toggle=function(){return this.isActive()?this.enableMeasureTool(!1):this.enableMeasureTool(!0),this.isActive()},d.prototype.getMeasurement=function(a,b){var c=null;return this.isActive()&&(c=this.tool.getMeasurement(a,b)),c},d.prototype.getUnitOptions=function(){var a=[{name:"Unknown",type:""},{name:"Decimal feet",type:"decimal-ft"},{name:"Feet and fractional inches",type:"ft"},{name:"Feet and decimal inches",type:"ft-and-decimal-in"},{name:"Decimal inches",type:"decimal-in"},{name:"Fractional inches",type:"fractional-in"},{name:"Meters",type:"m"},{name:"Centimeters",type:"cm"},{name:"Millimeters",type:"mm"},{name:"Meters and centimeters",type:"m-and-cm"}];return a},d.prototype.getPrecisionOptions=function(a){if(a)var b=["1","1/2","1/4","1/8","1/16","1/32","1/64"];else var b=["0","0.1","0.01","0.001","0.0001","0.00001"];return b},d.prototype.getDefaultUnit=function(){var a=this.viewer.model.getDisplayUnit();return a},d.prototype.enableMeasureTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!a&&c?(b.deactivateTool("measure"),this.measureToolButton&&this.measureToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0):!1},d.prototype.createUI=function(){var a=this,d=this.viewer;this.measureToolButton=null;var e=d.getToolbar(!0),f=e.getControl(b.TOOLBAR.MODELTOOLSID);this.measureToolButton=new c.Button("toolbar-measureTool"),this.measureToolButton.setToolTip("Measure"),this.measureToolButton.setIcon("adsk-icon-measure"),this.measureToolButton.onClick=function(b){a.enableMeasureTool(!a.tool.isActive())},this.onMeasureButtonStateChange=function(b){b.state===c.Button.State.ACTIVE?a.enableMeasureTool(!0):b.state===c.Button.State.INACTIVE&&a.enableMeasureTool(!1)},this.measureToolButton.addEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange),f.addControl(this.measureToolButton,{index:0});var g=[{keycodes:[b.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableMeasureTool(!1)}}];b.theHotkeyManager.pushHotkeys(this.escapeHotkeyId,g)},d.prototype.destroyUI=function(){var a=this.viewer;this.measureToolButton&&this.measureToolButton.removeEventListener(c.Button.Event.STATE_CHANGED,this.onMeasureButtonStateChange);var d=a.getToolbar(!1);if(d){var e=d.getControl(b.TOOLBAR.MODELTOOLSID);if(e){if(this.measureToolButton){var f=e.getControl("toolbar-inspectSubMenu");f?f.removeControl(this.measureToolButton.getId()):e.removeControl(this.measureToolButton.getId())}this.measureToolButton=null}}b.theHotkeyManager.popHotkeys(this.escapeHotkeyId)},a.MeasureExtension=d,b.theExtensionManager.registerExtension("Autodesk.Measure",d)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),Autodesk.Viewing.Extensions.Measure.MeasureTool=function(a,b){function c(){y.updateLabelPositions()}function d(){h.clearMeasurement()}function e(){y||(y=new g(i)),y.hide(),z&&(z.setVisible(!0),z.updatePanel(),i.model&&i.model.is2d()&&z.isolate.setVisibility(!1),t?z.disableUnitOption(0):z.disableUnitOption())}function f(){y&&(y.hide(),y.destroy()),v={},z&&(z.setVisible(!1),z.updatePanel())}function g(a){var b=this,c=!1,d=2002943,e=.7,f="MeasureTool-endPoint",g="MeasureTool-edge",j="MeasureTool-face",k="MeasureTool-angle",n="MeasureTool-angle-outline",o="MeasureTool-extensionLine",p="MeasureTool-extensionFace",v=null,w=null,y=null,z=null,A=null,C=null,D=null,E={first:{},second:{}},F={first:{},second:{}},G={first:{},second:{}},H={xyz:{axis:!1,color:"FF9900"},x:{axis:!0,color:"F12C2C"},y:{axis:!0,color:"0BB80B"},z:{axis:!0,color:"2C2CF1"}},I={},J=[];this.showFirstVertex=function(a){var b=this.setScale(a);this.showEndPoint("first",a,b)},this.showSecondVertex=function(a){var b=this.setScale(a);this.showEndPoint("second",a,b)},this.showEndPoint=function(a,b,c){v||(v=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(f));var g=E[a],h=g.mesh;if(h||(g.geometry=new THREE.SphereGeometry(1),h=g.mesh=new THREE.Mesh(g.geometry,v),i.impl.addOverlay(f,h)),h.scale.x=c,h.scale.y=c,h.scale.z=c,h.position.set(b.x,b.y,b.z),h.visible=!0,i.impl.invalidate(!1,!1,!0),q||x){var j=g.label;if(!j){j=g.label=document.createElement("div"),j.className="measure-label",i.container.appendChild(j);var k=document.createElement("div");k.className="adsk-icon-"+a+" measure-label-icon",j.appendChild(k)}j.classList.toggle("visible",!0),g.position=b.clone(),this.updateLabelPositions()}},this.setScale=function(a){var b=5,c=i.navigation,d=c.getCamera(),e=c.getEyeVector(),f=c.getPosition(),g=a.clone(),h=d.isPerspective?g.sub(f).dot(e.normalize()):c.getEyeVector().length(),j=c.getVerticalFov(),k=2*h*Math.tan(THREE.Math.degToRad(.5*j)),l=c.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.updateScale=function(){var a=i.impl.overlayScenes[f];if(a)for(var b=a.scene,c=0;c<b.children.length;c++){var d=b.children[c];if(d){var e=this.setScale(d.position);d.scale.x=e,d.scale.y=e,d.scale.z=e}}if(a=i.impl.overlayScenes[o])for(var b=a.scene,c=0;c<b.children.length;c++){var h=b.children[c];if(h){var j=this.setScale(h.geometry.vertices[0]);h.material.dashSize=4*j,h.material.gapSize=2*j}}if(a=i.impl.overlayScenes[g])for(var b=a.scene,c=0;c<b.children.length;c++){var k=b.children[c];k&&this.setCylinderScale(k)}if(a=i.impl.overlayScenes[n])for(var b=a.scene,c=0;c<b.children.length;c++){var k=b.children[c];k&&this.setCylinderScale(k)}for(var l in H)if(H.hasOwnProperty(l)){var m=H[l];m.line&&this.setCylinderScale(m.line)}},this.showFirstEdge=function(a,b){this.showEdge("first",a,b)},this.showSecondEdge=function(a,b){this.showEdge("second",a,b)},this.showEdge=function(a,b,c){w||(w=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(g));var f=F[a];if(f.line&&i.impl.removeMultipleOverlays(g,f.line),f.line=this.drawEdgeAsCylinder(b,w,5,1),i.impl.addMultipleOverlays(g,f.line),q||x){var h=f.label;if(!h){h=f.label=document.createElement("div"),h.className="measure-label",i.container.appendChild(h);var j=document.createElement("div");j.className="adsk-icon-"+a+" measure-label-icon",h.appendChild(j)}h.classList.toggle("visible",!0),f.intersectPoint=c.clone(),this.updateLabelPositions()}},this.drawEdgeAsCylinder=function(a,b,c,d){var e=[];if(1==d)for(var f=0;f<a.vertices.length;f+=2){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}else for(var f=0;f<a.vertices.length-1;f++){var g=this.cylinderMesh(a.vertices[f],a.vertices[f+1],b,c);this.setCylinderScale(g),e.push(g)}return e},this.drawLineAsCylinder=function(a,b,c){var d;return 2==a.vertices.length&&(d=this.cylinderMesh(a.vertices[0],a.vertices[1],b,c),this.setCylinderScale(d)),d},this.cylinderMesh=function(a,b,c,d){var e=(new THREE.Vector3).subVectors(b,a),f=new THREE.Matrix4;f.lookAt(a,b,(new THREE.Object3D).up),f.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var g=new THREE.CylinderGeometry(.1*d,.1*d,e.length(),8,1,!0),h=new THREE.Mesh(g,c);return h.applyMatrix(f),h.position.x=(b.x+a.x)/2,h.position.y=(b.y+a.y)/2,h.position.z=(b.z+a.z)/2,h},this.setCylinderScale=function(a){var b=this.setScale(a.position);a.scale.x=b,a.scale.z=b},this.showFirstFace=function(a,b){this.showFace("first",a,b)},this.showSecondFace=function(a,b){this.showFace("second",a,b)},this.showFace=function(a,b,c){y||(y=new THREE.MeshPhongMaterial({color:d,ambient:d,opacity:e,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(j));var f=G[a];if(f.mesh&&i.impl.removeOverlay(j,f.mesh),f.mesh=new THREE.Mesh(b,y),i.impl.addOverlay(j,f.mesh),q||x){var g=f.label;if(!g){g=f.label=document.createElement("div"),g.className="measure-label",i.container.appendChild(g);var h=document.createElement("div");h.className="adsk-icon-"+a+" measure-label-icon",g.appendChild(h)}g.classList.toggle("visible",!0),f.intersectPoint=c.clone(),this.updateLabelPositions()}},this.drawExtensionFace=function(a,b,c){D||(D=new THREE.MeshPhongMaterial({color:6737151,ambient:52479,opacity:.2,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),i.impl.createOverlayScene(p));var d=new THREE.Mesh(a,D);d.position.set(b.x,b.y,b.z);var e=d.position.clone();e.add(c),d.lookAt(e),d.updateMatrixWorld(),i.impl.addOverlay(p,d)},this.getEdgeLength=function(a){for(var b=0,c=a.clone(),d=c.vertices,e=0;e<d.length;e+=2)i.model.is2d()&&i.model.pageToModel(d[e],d[e+1],K),b+=d[e].distanceTo(d[e+1]);return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b),Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)},this.getCircularArcRadius=function(a){var b=a.radius;if(b){if(i.model.is2d()){var c=a.center.clone(),d=a.vertices[0].clone();i.model.pageToModel(c,d,K),b=c.distanceTo(d)}return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b),Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)}},this.getFaceArea=function(a){for(var b=0,c=a.vertices,d=new THREE.Vector3,e=new THREE.Vector3,f=0;f<c.length;f+=3)d.subVectors(c[f+1],c[f]),e.subVectors(c[f+2],c[f]),b+=d.length()*e.length()*Math.sin(d.angleTo(e))/2;return b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,b,"square"),t?Autodesk.Viewing.Private.formatValueWithUnits(b,t+"^2",3,u):Autodesk.Viewing.Private.formatValueWithUnits(b,null,3,u)},this.updateLabels=function(){r===SNAP_EDGE?F.first.label.children[0].textContent=this.getEdgeLength(l):r===SNAP_FACE&&(G.first.label.children[0].textContent=this.getFaceArea(l)),s===SNAP_EDGE?F.second.label.children[0].textContent=this.getEdgeLength(m):s===SNAP_FACE&&(G.second.label.children[0].textContent=this.getFaceArea(m))},this.updateLabelPositions=function(){function a(a,b,c){var d=i.navigation.getCamera(),e=i.navigation.getScreenViewport(),f=new THREE.Vector3(a,b,c);return f=f.project(d),{x:Math.round((f.x+1)/2*e.width)+5,y:Math.round((-f.y+1)/2*e.height)+5}}for(var b in H)if(H.hasOwnProperty(b)){var c=H[b],d=c.label;if(d){var e=a((c.p1.x+c.p2.x)/2,(c.p1.y+c.p2.y)/2,(c.p1.z+c.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",J.push(d)}}if(I&&(d=I.label)){var e=a((I.p1.x+I.p2.x)/2,(I.p1.y+I.p2.y)/2,(I.p1.z+I.p2.z)/2);d.style.top=e.y+"px",d.style.left=e.x+"px",J.push(d)}for(var b in G)if(G.hasOwnProperty(b)){var f=G[b],d=f.label,g=f.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",J.push(d)}}for(var b in F)if(F.hasOwnProperty(b)){var h=F[b],d=h.label,g=h.intersectPoint;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",J.push(d)}}for(var b in E)if(E.hasOwnProperty(b)){var j=E[b],d=j.label,g=j.position;if(d&&g){var e=a(g.x,g.y,g.z);d.style.top=e.y+"px",d.style.left=e.x+"px",J.push(d)}}for(var k=0;k<J.length;k++)for(var l=0;k>l;l++)this.labelsOverlapDetection(J[l],J[k]);J=[]},this.labelsOverlapDetection=function(a,b){var c=a.getBoundingClientRect(),d=b.getBoundingClientRect();d.top<=c.bottom&&d.bottom>=c.top&&(d.right>=c.left&&d.right<=c.right?b.style.left=parseInt(b.style.left,10)-(d.right-c.left)+"px":d.left>=c.left&&d.left<=c.right?b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px":d.left<=c.left&&d.right>=c.right&&(b.style.left=parseInt(b.style.left,10)+(c.right-d.left)+"px"))},this.drawLine=function(a,d,f){function g(a,d,f,g,h,j,k,l){var m=H[a],n=m.line,o=m.label,p=new THREE.Vector3(d,f,g),r=new THREE.Vector3(h,j,k);if(n&&(i.impl.removeOverlay("MeasureTool-"+a,n),m.line=null),o&&o.classList.remove("visible"),p.distanceTo(r)>=Math.pow(.1,u)&&l){var s="xyz"===a||!c&&q;n||(m.material=new THREE.MeshBasicMaterial({color:parseInt(m.color,16),depthTest:!1,depthWrite:!1}),m.overlayName="MeasureTool-"+a,i.impl.createOverlayScene(m.overlayName)),q?m.material.opacity=1:m.material.opacity=e,i.impl.clearOverlay(m.overlayName);var t=m.geometry=new THREE.Geometry;t.vertices.push(p),t.vertices.push(r);var v="xyz"===a?5:"z"===a?1:2;if(n=m.line=b.drawLineAsCylinder(t,m.material,v),i.impl.addOverlay(m.overlayName,n),n.visible=s,m.p1=p,m.p2=r,"xyz"!=a||q){if(!o){if(o=m.label=document.createElement("div"),o.className="measure-length","xyz"===a){var w=document.createElement("div");w.className="measure-length-text",o.appendChild(w)}else o.style.pointerEvents="none";m.axis&&(o.className="adsk-icon-axis-"+a+" measure-label-axis measure-label-axis-"+a),i.container.appendChild(o)}m.axis||b.updateDistance(),o.classList.toggle("visible",s)}}}function h(a,b){var c=Math.pow(.1,u);return Math.abs(a.x-b.x)>=c&&Math.abs(a.y-b.y)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.y-b.y)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.z-b.z)<c||Math.abs(a.z-b.z)>=c&&Math.abs(a.x-b.x)<c&&Math.abs(a.y-b.y)<c?!1:!0}g("xyz",a.x,a.y,a.z,d.x,d.y,d.z,!0);var j=i.navigation.getAlignedUpVector(),k=Math.abs(j.x),l=Math.abs(j.y),m=Math.abs(j.z),n=f?!1:h(a,d);m>k&&m>l?(g("x",a.x,a.y,a.z,d.x,a.y,a.z,n),g("y",d.x,a.y,a.z,d.x,d.y,a.z,n),g("z",d.x,d.y,a.z,d.x,d.y,d.z,n)):l>k&&l>m?(g("x",a.x,a.y,a.z,d.x,a.y,a.z,n),g("z",d.x,a.y,a.z,d.x,a.y,d.z,n),g("y",d.x,a.y,d.z,d.x,d.y,d.z,n)):(g("y",a.x,a.y,a.z,a.x,d.y,a.z,n),g("z",a.x,d.y,a.z,a.x,d.y,d.z,n),g("x",a.x,d.y,d.z,d.x,d.y,d.z,n)),this.updateLabelPositions()},this.updateDistance=function(){var a=H.xyz.label;a&&(a.children[0].textContent="~ "+h.getDistance("xyz"))},this.updateAngle=function(){var a=I.label;a&&(a.children[0].textContent="~ "+h.getAngle())},this.drawExtensionLine=function(a,b,c){var d,f,g,h,j=new THREE.Vector3,k=new THREE.Vector3;if(j.subVectors(b,a),k.subVectors(c,b),h=j.dot(k),j.subVectors(c,b),h=-h/j.dot(j),j.subVectors(c,b),j.multiplyScalar(h),g=j.add(b),0>h)d=b,f=g;else{if(!(h>1))return;d=c,f=g}C||(C=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(o)),q?C.opacity=1:C.opacity=e;var l=this.setScale(d);C.dashSize=4*l,C.gapSize=2*l;var m=new THREE.Geometry;m.vertices.push(d),m.vertices.push(f),m.computeLineDistances();var n=new THREE.Line(m,C);i.impl.addOverlay(o,n)},this.drawExtensionLinePointToPoint=function(a,b){var c=a,d=b;C||(C=new THREE.LineDashedMaterial({color:13311,linewidth:1,dashSize:1,gapSize:.5,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(o)),q?C.opacity=1:C.opacity=e;var f=this.setScale(c);C.dashSize=4*f,C.gapSize=2*f;var g=new THREE.Geometry;g.vertices.push(c),g.vertices.push(d),g.computeLineDistances();var h=new THREE.Line(g,C);i.impl.addOverlay(o,h)},this.nearestPointsInSegmentToSegment=function(a,b,c,d){var e=.001,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;f.subVectors(b,a),g.subVectors(d,c),h.subVectors(a,c);var i,j,k,l,m=f.dot(f),n=f.dot(g),o=g.dot(g),p=f.dot(h),q=g.dot(h),r=m*o-n*n,s=r,t=r;return e>r?(j=0,s=1,l=q,t=o):(j=n*q-o*p,l=m*q-n*p,0>j?(j=0,l=q,t=o):j>s&&(j=s,l=q+n,t=o)),0>l?(l=0,0>-p?j=0:-p>m?j=s:(j=-p,s=m)):l>t&&(l=t,0>-p+n?j=0:-p+n>m?j=s:(j=-p+n,s=m)),i=Math.abs(j)<e?0:j/s,k=Math.abs(l)<e?0:l/t,f.multiplyScalar(i),g.multiplyScalar(k),h.add(f),h.sub(g),f.add(a),g.add(c),[f,g]},this.edgeToEdgeMeasure=function(a,b,c){var d=.01,e=B.getEndPointsInEdge(a),f=e[0].clone(),g=e[1].clone();e=B.getEndPointsInEdge(b);var h=e[0].clone(),i=e[1].clone(),j=this.nearestPointInPointToLine(f,h,i),k=this.nearestPointInPointToLine(g,h,i),l=new THREE.Vector3,m=new THREE.Vector3;if(l.subVectors(f,g),m.subVectors(h,i),l.normalize(),m.normalize(),this.isEqualVectors(l,m,d)||this.isInverseVectors(l,m,d))return f.distanceTo(c)<=g.distanceTo(c)?(this.drawLine(f,j),this.drawExtensionLine(f,h,i),[f,j]):(this.drawLine(g,k),this.drawExtensionLine(g,h,i),[g,k]);var n=this.nearestPointInPointToLine(c,f,g),o=this.angleVectorToVector(l,m);return f.distanceTo(h)<f.distanceTo(i)&&f.distanceTo(h)<g.distanceTo(h)&&f.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,h,i,o):f.distanceTo(i)<f.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(h)&&f.distanceTo(i)<g.distanceTo(i)?this.drawAngleLineToLine(f,n,i,h,o):g.distanceTo(h)<f.distanceTo(h)&&g.distanceTo(h)<f.distanceTo(i)&&g.distanceTo(h)<g.distanceTo(i)?this.drawAngleLineToLine(g,n,h,i,o):this.drawAngleLineToLine(g,n,i,h,o),o},this.curvedEdgeToEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=B.getEndPointsInEdge(b),h=0;h<f.length;h+=2){var i=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[0],g[1]),j=i[0].distanceTo(i[1]);c>j&&(c=j,d=i[0],e=i[1])}return this.drawLine(d,e),[d,e]},this.curvedEdgeToCurvedEdgeMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=null,e=null,f=a.vertices,g=b.vertices,h=0;h<f.length;h+=2)for(var i=0;i<g.length;i+=2){var j=this.nearestPointsInSegmentToSegment(f[h],f[h+1],g[i],g[i+1]),k=j[0].distanceTo(j[1]);c>k&&(c=k,d=j[0],e=j[1])}return this.drawLine(d,e),[d,e]},this.nearestPointInPointToSegment=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),0>e?d=b:e>1?d=c:(f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)),d},this.nearestPointInPointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),f.subVectors(c,b),f.multiplyScalar(e),d=f.add(b)},this.pointToEdgeMeasure=function(a,b,c){var d=B.getEndPointsInEdge(b),e=d[0],f=d[1],g=this.nearestPointInPointToLine(a,e,f),h=this.nearestPointInPointToLine(c,e,f),i=new THREE.Vector3;return i.subVectors(h,g),i.add(a),this.drawLine(i,h),this.drawExtensionLinePointToPoint(a,i),[a,g]},this.edgeToPointMeasure=function(a,b){var c=B.getEndPointsInEdge(a),d=c[0],e=c[1],f=this.nearestPointInPointToLine(b,d,e);return this.drawLine(b,f),this.drawExtensionLine(b,d,e),[b,f]},this.curvedEdgeToVertexMeasure=function(a,b){for(var c=a.vertices,d=Number.MAX_VALUE,e=null,f=0;f<c.length;f+=2){var g=this.nearestPointInPointToSegment(b,c[f],c[f+1]),h=b.distanceTo(g);d>h&&(d=h,e=g)}return this.drawLine(b,e),[b,e]},this.faceToFaceMeasure=function(a,b,c,d){var e=.01,f=b.clone(),g=d.clone(),h=this.angleVectorToVector(b,d);if(f.x<=g.x+e&&f.x>=g.x-e&&f.y<=g.y+e&&f.y>=g.y-e&&f.z<=g.z+e&&f.z>=g.z-e||f.x<=-g.x+e&&f.x>=-g.x-e&&f.y<=-g.y+e&&f.y>=-g.y-e&&f.z<=-g.z+e&&f.z>=-g.z-e){var i=new THREE.Vector3;i.subVectors(a,c);var j=f.dot(i)/f.dot(g);i.addVectors(c,g.multiplyScalar(j));var k=2*i.distanceTo(a),l=new THREE.PlaneBufferGeometry(k,k);return this.drawExtensionFace(l,a,b),this.drawLine(c,i,!0),[c,i,h]}return h=this.drawAngleFaceToFace(a,b,c,d)},this.angleVectorToVector=function(a,b){var c=180*a.angleTo(b)/Math.PI;return c},this.intersectPlaneToPlane=function(a,b,c,d){var e=new THREE.Vector3;e.crossVectors(b,d);var f,g=e.x>=0?e.x:-e.x,h=e.y>=0?e.y:-e.y,i=e.z>=0?e.z:-e.z;f=g>h?g>i?1:3:h>i?2:3;var j,k,l=new THREE.Vector3;switch(j=-b.dot(a),k=-d.dot(c),f){case 1:l.x=0,0!==e.x?(l.y=(k*b.z-j*d.z)/e.x,l.z=(j*d.y-k*b.y)/e.x):(l.y=-(k*b.z)/(b.z*d.y),l.z=-(j*d.y)/(b.z*d.y));break;case 2:l.y=0,0!==e.y?(l.x=(j*d.z-k*b.z)/e.y,l.z=(k*b.x-j*d.x)/e.y):(l.x=-(j*d.z)/(b.x*d.z),l.z=-(k*b.x)/(b.x*d.z));break;case 3:l.z=0,0!==e.z?(l.x=(k*b.y-j*d.y)/e.z,l.y=(j*d.x-k*b.x)/e.z):(l.x=-(k*b.y)/(b.y*d.x),l.y=-(j*d.x)/(b.y*d.x))}var m=new THREE.Vector3;m.addVectors(l,e.multiplyScalar(100));var n=this.nearestPointInPointToLine(a,l,m),o=this.nearestPointInPointToLine(c,l,m);return[n,o]},this.drawAngle=function(a,b,c,d,e,f){var g=.001;z||(z=new THREE.MeshPhongMaterial({color:10066329,ambient:10066329,opacity:.5,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),A=new THREE.MeshBasicMaterial({color:16750848,depthTest:!1,depthWrite:!1}),i.impl.createOverlayScene(k,z),i.impl.createOverlayScene(n,A)),i.impl.clearOverlay(k),i.impl.clearOverlay(n);var h=a.distanceTo(b),j=100,l=new THREE.CircleGeometry(h,j,0,e*Math.PI/180),m=new THREE.Mesh(l,z),o=m.geometry.vertices[0].clone();m.geometry.vertices.push(o),m.position.set(a.x,a.y,a.z);var p=m.position.clone();p.add(d),m.lookAt(p),m.updateMatrixWorld();var q=m.geometry.vertices[1].clone(),r=m.geometry.vertices[m.geometry.vertices.length-2].clone();q.applyMatrix4(m.matrixWorld),r.applyMatrix4(m.matrixWorld);var s=new THREE.Vector3,t=new THREE.Vector3,u=new THREE.Vector3,v=new THREE.Vector3;s.subVectors(q,a),t.subVectors(r,a),u.subVectors(b,a),v.subVectors(c,a);var w,x=s.angleTo(u),y=s.angleTo(v),B=t.angleTo(u),C=t.angleTo(v);w=(g>=x&&x>=-g||g>=y&&y>=-g)&&(g>=B&&B>=-g||g>=C&&C>=-g)?0:(x<=Math.PI+g&&x>=Math.PI-g||y<=Math.PI+g&&y>=Math.PI-g)&&(B<=Math.PI+g&&B>=Math.PI-g||C<=Math.PI+g&&C>=Math.PI-g)?Math.PI:B+g>=x&&x>=B-g||C+g>=x&&x>=C-g?x:y;var D=new THREE.Matrix4;if(D.makeRotationAxis(d,w),D.multiply(m.matrix),m.matrix=D,m.rotation.setFromRotationMatrix(m.matrix),m.updateMatrixWorld(),q=m.geometry.vertices[1].clone(),
r=m.geometry.vertices[m.geometry.vertices.length-2].clone(),q.applyMatrix4(m.matrixWorld),r.applyMatrix4(m.matrixWorld),s.subVectors(q,a),t.subVectors(r,a),x=s.angleTo(u),y=s.angleTo(v),B=t.angleTo(u),C=t.angleTo(v),x>=g&&y>=g){var D=new THREE.Matrix4;D.makeRotationAxis(d,2*-w),D.multiply(m.matrix),m.matrix=D,m.rotation.setFromRotationMatrix(m.matrix)}var E=new THREE.CircleGeometry(.9*h,j,0,e*Math.PI/180);E.vertices.splice(0,1),m.updateMatrixWorld(),E.applyMatrix(m.matrixWorld);var F=this.drawEdgeAsCylinder(E,A,2.5,0),G=new THREE.Geometry,H=new THREE.Geometry;G.vertices.push(m.geometry.vertices[0].clone(),m.geometry.vertices[1].clone()),H.vertices.push(m.geometry.vertices[0].clone(),m.geometry.vertices[m.geometry.vertices.length-2].clone()),G.applyMatrix(m.matrixWorld),H.applyMatrix(m.matrixWorld);var I=this.drawLineAsCylinder(G,A,2.5),J=this.drawLineAsCylinder(H,A,2.5);i.impl.addOverlay(k,m),i.impl.addMultipleOverlays(n,F),i.impl.addOverlay(n,I),i.impl.addOverlay(n,J),f.copy(m.geometry.vertices[Math.round(m.geometry.vertices.length/2)-1]),f.applyMatrix4(m.matrixWorld)},this.drawAngleFaceToFace=function(a,b,c,d){var e=this.intersectPlaneToPlane(a,b,c,d),f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(a,e[0]),g.subVectors(c,e[1]);var j=this.angleVectorToVector(f,g),k=e[0].clone(),l=new THREE.Vector3;l.crossVectors(b,d),l.normalize(),e=this.intersectPlaneToPlane(a,b,k,l);var m=e[0].clone();e=this.intersectPlaneToPlane(c,d,k,l);var n=e[0].clone(),o=new THREE.Vector3;if(this.drawAngle(k,m,n,l,j,o),q){var p=I.label;if(!p){p=I.label=document.createElement("div"),p.className="measure-length",i.container.appendChild(p);var r=document.createElement("div");r.className="measure-length-text",p.appendChild(r)}p.children[0].textContent=h.getAngle(),p.classList.toggle("visible",!0),I.p1=o.clone(),I.p2=o.clone(),this.updateLabelPositions()}return j},this.drawAngleLineToLine=function(a,b,c,d,e){var f=a,g=new THREE.Vector3,j=new THREE.Vector3,k=new THREE.Vector3;j.subVectors(a,b),k.subVectors(c,d),g.crossVectors(j,k),g.normalize();var l=b,m=new THREE.Vector3;m.subVectors(f,c),m.add(d);var n=new THREE.Vector3;if(this.drawAngle(f,l,m,g,e,n),q){var o=I.label;if(!o){o=I.label=document.createElement("div"),o.className="measure-length",i.container.appendChild(o);var p=document.createElement("div");p.className="measure-length-text",o.appendChild(p)}o.children[0].textContent=h.getAngle(),o.classList.toggle("visible",!0),I.p1=n.clone(),I.p2=n.clone(),this.updateLabelPositions()}},this.intersectLineToLine=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3;e.subVectors(c,a),e.cross(d),f.crossVectors(b,d);var g=e.divide(f);return f=b.clone(),f.multiplyScalar(g),e.addVectors(a,f),e},this.nearestPointInPointToPlane=function(a,b,c){var d=new THREE.Vector3,e=c.clone(),f=new THREE.Vector3;f.subVectors(a,b);var g=-e.dot(f),h=e.dot(e),i=g/h;return d.addVectors(a,e.multiplyScalar(i)),d},this.faceToPointMeasure=function(a,b,c,d){var e=a.vertices[0],f=this.nearestPointInPointToPlane(d,e,b),g=c.clone(),h=new THREE.Vector3;h.subVectors(g,f),h.add(d);var i=2*f.distanceTo(c),j=new THREE.PlaneBufferGeometry(i,i);return this.drawExtensionFace(j,c,b),this.drawLine(d,f),[d,f]},this.nearestPointInPointToTriangle=function(a,b,c,d){var e,f=Number.MAX_VALUE;if(e=this.pointProjectsInTriangle(a,b,c,d))return e;var g=this.nearestPointInPointToSegment(a,b,c);return a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,b,d),a.distanceTo(g)<f&&(f=a.distanceTo(g),e=g.clone()),g=this.nearestPointInPointToSegment(a,c,d),a.distanceTo(g)<f&&(e=g.clone()),e},this.pointToFaceMeasure=function(a,b,c,d){var e=b.vertices[0],f=this.nearestPointInPointToPlane(a,e,c),g=d.clone(),h=new THREE.Vector3;return h.subVectors(g,f),h.add(a),this.drawLine(g,h),this.drawExtensionLinePointToPoint(a,h),[a,f]},this.curvedFaceToVertexMeasure=function(a,b){for(var c,d=Number.MAX_VALUE,e=a.vertices,f=0;f<e.length;f+=3){var g=this.nearestPointInPointToTriangle(b,e[f],e[f+1],e[f+2]);b.distanceTo(g)<d&&(d=b.distanceTo(g),c=g)}return this.drawLine(c,b),[c,b]},this.pointProjectsInTriangle=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Vector3;e.subVectors(c,b),f.subVectors(d,b),h.crossVectors(e,f),g.subVectors(a,b),e.cross(g);var i=e.dot(h)/h.dot(h);g.cross(f);var c=g.dot(h)/h.dot(h),b=1-i-c;if(b>=0&&1>=b&&c>=0&&1>=c&&i>=0&&1>=i){var j=THREE.Triangle.normal(b,c,d),k=this.nearestPointInPointToPlane(a,b,j);return k}},this.nearestPointsInLineSegmentToTriangle=function(a,b,c,d,e){var f,g,h=[],i=Number.MAX_VALUE,j=this.pointProjectsInTriangle(a,c,d,e);j&&a.distanceTo(j)<i&&(i=a.distanceTo(j),h[0]=a,h[1]=j);var k=this.pointProjectsInTriangle(b,c,d,e);k&&b.distanceTo(k)<i&&(i=b.distanceTo(k),h[0]=b,h[1]=k),f=c,g=d;var l=this.nearestPointsInSegmentToSegment(a,b,f,g);return l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=c,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(i=l[0].distanceTo(l[1]),h[0]=l[0].clone(),h[1]=l[1].clone()),f=d,g=e,l=this.nearestPointsInSegmentToSegment(a,b,f,g),l[0].distanceTo(l[1])<i&&(h[0]=l[0].clone(),h[1]=l[1].clone()),h},this.nearestPointsInEdgeToFace=function(a,b,c){for(var d=[],e=Number.MAX_VALUE,f=0;f<c.vertices.length;f+=3){var g=this.nearestPointsInLineSegmentToTriangle(a,b,c.vertices[f],c.vertices[f+1],c.vertices[f+2]);g[0].distanceTo(g[1])<e&&(e=g[0].distanceTo(g[1]),d=g)}return d},this.nearestPointsInTriangleToTriangle=function(a,b,c,d,e,f){function g(a,b,c,d){var e=i.pointProjectsInTriangle(a,b,c,d);e&&a.distanceTo(e)<k&&(k=a.distanceTo(e),j[0]=a,j[1]=e)}function h(a,b,c,d){var e=i.nearestPointsInSegmentToSegment(a,b,c,d);e[0].distanceTo(e[1])<k&&(k=e[0].distanceTo(e[1]),j=e)}var i=this,j=[],k=Number.MAX_VALUE;return g(a,d,e,f),g(b,d,e,f),g(c,d,e,f),g(d,a,b,c),g(e,a,b,c),g(f,a,b,c),h(a,b,d,e),h(a,b,d,f),h(a,b,e,f),h(a,c,d,e),h(a,c,d,f),h(a,c,e,f),h(b,c,d,e),h(b,c,d,f),h(b,c,e,f),j},this.curvedEdgeToFaceMeasure=function(a,b){for(var c=Number.MAX_VALUE,d=[],e=a.vertices,f=0;f<e.length;f+=2){var g=this.nearestPointsInEdgeToFace(e[f],e[f+1],b);g[0].distanceTo(g[1])<c&&(c=g[0].distanceTo(g[1]),d=g)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.curvedFaceToFaceMeasure=function(a,b){var c=Number.MAX_VALUE,d=[],e=a.vertices,f=b.vertices;a.computeBoundingSphere(),b.computeBoundingSphere();var g=new THREE.Sphere,h=new THREE.Sphere,i=[],j=Number.MAX_VALUE,k=[],l=[];a.bSpheres=[],b.bSpheres=[];for(var m=0;m<e.length;m+=3){g.setFromPoints([e[m],e[m+1],e[m+2]]),a.bSpheres.push(g.clone());var n=g.center.distanceTo(b.boundingSphere.center)+g.radius+b.boundingSphere.radius;j>n&&(j=n)}for(var m=0;m<e.length;m+=3){g=a.bSpheres[m/3];var o=g.center.distanceTo(b.boundingSphere.center)-g.radius-b.boundingSphere.radius;j>=o&&k.push(m)}j=Number.MAX_VALUE;for(var p=0;p<f.length;p+=3){h.setFromPoints(f[p],f[p+1],f[p+2]),b.bSpheres.push(h.clone());var n=h.center.distanceTo(a.boundingSphere.center)+h.radius+a.boundingSphere.radius;j>n&&(j=n)}for(var p=0;p<f.length;p+=3){h=b.bSpheres[p/3];var o=h.center.distanceTo(a.boundingSphere.center)-h.radius-a.boundingSphere.radius;j>=o&&l.push(p)}j=Number.MAX_VALUE;for(var m=0;m<k.length;m++){g=a.bSpheres[k[m]/3];for(var p=0;p<l.length;p++){h=b.bSpheres[l[p]/3];var o=g.center.distanceTo(h.center)-g.radius-h.radius,n=g.center.distanceTo(h.center)+g.radius+h.radius;j>n&&(j=n,i.push({i:k[m],j:l[p],value:o}))}}for(var q=0;q<i.length;q++)if(i[q].value<=j&&i[q].value<c){var r=this.nearestPointsInTriangleToTriangle(e[i[q].i],e[i[q].i+1],e[i[q].i+2],f[i[q].j],f[i[q].j+1],f[i[q].j+2]);r[0].distanceTo(r[1])<c&&(c=r[0].distanceTo(r[1]),d=r)}return this.drawLine(d[0],d[1]),[d[0],d[1]]},this.faceToEdgeMeasure=function(a,b,c,d,e){var f,g,h=.01,i=B.getEndPointsInEdge(d);i[0].distanceTo(c)<i[1].distanceTo(c)?(f=i[0],g=i[1]):(f=i[1],g=i[0]);var j=new THREE.Vector3;j.subVectors(g,f);var k=this.angleLineToPlane(j,b);if(j.dot(b)<=h&&j.dot(b)>=-h){var l=a.vertices[0],m=this.nearestPointInPointToPlane(f,l,b),n=this.nearestPointInPointToLine(e,f,g);return this.faceToPointMeasure(a,b,c,n),[f,m,k]}var o=this.nearestPointInPointToLine(e,f,g);return this.drawAngleEdgeToFace(a.vertices[0],b,c,f,o,k),k},this.edgeToFaceMeasure=function(a,b,c,d,e){var f,g,h=.01,i=B.getEndPointsInEdge(a);i[0].distanceTo(e)<i[1].distanceTo(e)?(f=i[0],g=i[1]):(f=i[1],g=i[0]);var j=new THREE.Vector3;j.subVectors(g,f);var k=this.angleLineToPlane(j,d);if(j.dot(d)<=h&&j.dot(d)>=-h){var l=c.vertices[0],m=this.nearestPointInPointToPlane(f,l,d),n=new THREE.Vector3;n.subVectors(e,m),n.add(f);var o=new THREE.Vector3;return o.subVectors(e,m),o.add(g),this.drawLine(n,e),this.drawExtensionLinePointToPoint(n,o),[f,m,k]}var p=this.nearestPointInPointToLine(b,f,g);return this.drawAngleEdgeToFace(c.vertices[0],d,e,f,p,k),k},this.angleLineToPlane=function(a,b){var c=this.angleVectorToVector(a,b);return c>90?c-=90:c=90-c,c},this.drawAngleEdgeToFace=function(a,b,c,d,e,f){var g=this.intersectPointLineToPlane(a,b,d,e);if(g){var j=e;if(90===f)var k=c.clone();else var k=this.nearestPointInPointToPlane(e,a,b);var l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3;m.subVectors(e,d),n.subVectors(k,g),l.crossVectors(m,n),l.normalize();var o=new THREE.Vector3;if(this.drawAngle(g,j,k,l,f,o),q){var p=I.label;if(!p){p=I.label=document.createElement("div"),p.className="measure-length",i.container.appendChild(p);var r=document.createElement("div");r.className="measure-length-text",p.appendChild(r)}p.children[0].textContent=h.getAngle(),p.classList.toggle("visible",!0),I.p1=o.clone(),I.p2=o.clone(),this.updateLabelPositions()}}},this.intersectPointLineToPlane=function(a,b,c,d){var e=.001,f=new THREE.Vector3,g=new THREE.Vector3;f.subVectors(d,c),g.subVectors(c,a);var h=b.dot(f),i=-b.dot(g);return Math.abs(h)<e?null:(f.multiplyScalar(i/h),f.add(c),f)},this.nearestVertexInVertexToEdge=function(a,b){for(var c,d=Number.MAX_VALUE,e=0;e<b.vertices.length;e++){var f=a.distanceTo(b.vertices[e]);d>f&&(c=b.vertices[e],d=f)}return c},this.isEqualVectors=function(a,b,c){return Math.abs(a.x-b.x)<=c&&Math.abs(a.y-b.y)<=c&&Math.abs(a.z-b.z)<=c?!0:!1},this.isInverseVectors=function(a,b,c){return Math.abs(a.x+b.x)<=c&&Math.abs(a.y+b.y)<=c&&Math.abs(a.z+b.z)<=c?!0:!1},this.setSimple=function(a){if(c!=a){c=a;for(var b in H)if("xyz"!==b&&H.hasOwnProperty(b)){var d=H[b];d.line&&(d.line.visible=!a,d.label&&d.label.classList.toggle("visible",!a))}i.impl.invalidate(!1,!1,!0)}},this.hide=function(){var a;for(a in E)if(E.hasOwnProperty(a)){var b=E[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}for(a in F)if(F.hasOwnProperty(a)){var c=F[a];if(c.line)for(var d in c.line)c.line[d].visible=!1;c.label&&c.label.classList.remove("visible")}for(a in G)if(G.hasOwnProperty(a)){var e=G[a];e.mesh&&(e.mesh.visible=!1),e.label&&e.label.classList.remove("visible")}for(a in H)if(H.hasOwnProperty(a)){var f=H[a];f.line&&(f.line.visible=!1),f.label&&f.label.classList.remove("visible")}I.label&&I.label.classList.remove("visible"),z&&(i.impl.clearOverlay(k),i.impl.clearOverlay(n)),C&&i.impl.clearOverlay(o),D&&i.impl.clearOverlay(p),i.impl.invalidate(!1,!1,!0)},this.hideClick=function(a){if(E.hasOwnProperty(a)){var b=E[a];b.mesh&&(b.mesh.visible=!1),b.label&&b.label.classList.remove("visible")}if(F.hasOwnProperty(a)){var c=F[a];if(c.line)for(var d in c.line)c.line[d].visible=!1;c.label&&c.label.classList.remove("visible")}if(G.hasOwnProperty(a)){var e=G[a];e.mesh&&(e.mesh.visible=!1),e.label&&e.label.classList.remove("visible")}for(var f in H)if(H.hasOwnProperty(f)){var g=H[f];g.line&&(g.line.visible=!1),g.label&&g.label.classList.remove("visible")}I.label&&I.label.classList.remove("visible"),z&&(i.impl.clearOverlay(k),i.impl.clearOverlay(n)),C&&i.impl.clearOverlay(o),D&&i.impl.clearOverlay(p),i.impl.invalidate(!1,!1,!0)},this.destroy=function(){var a;for(a in E)if(E.hasOwnProperty(a)){var b=E[a];b.mesh&&(i.impl.removeOverlay(f,b.mesh),b.mesh=b.geometry=null),b.label&&(b.label.parentNode.removeChild(b.label),b.label=null)}for(a in F)if(F.hasOwnProperty(a)){var c=F[a];c.line&&(i.impl.removeMultipleOverlays(g,c.line),c.line=c.intersectPoint=null),c.label&&(c.label.parentNode.removeChild(c.label),c.label=null)}for(a in G)if(G.hasOwnProperty(a)){var d=G[a];d.mesh&&(i.impl.removeOverlay(j,d.mesh),d.mesh=d.intersectPoint=null),d.label&&(d.label.parentNode.removeChild(d.label),d.label=null)}v&&(v=null,i.impl.removeOverlayScene(f)),y&&(y=null,i.impl.removeOverlayScene(j)),w&&(w=null,i.impl.removeOverlayScene(g)),C&&(C=null,i.impl.removeOverlayScene(o)),D&&(D=null,i.impl.removeOverlayScene(p));for(a in H)if(H.hasOwnProperty(a)){var e=H[a];e.line&&(i.impl.removeOverlay(e.overlayName,e.line),i.impl.removeOverlayScene(e.overlayName),e.material=e.line=e.geometry=null),e.label&&(e.label.parentNode.removeChild(e.label),e.label=null),e.material=e.line=e.geometry=e.label=e.p1=e.p2=null}I.label&&(I.label.parentNode.removeChild(I.label),I.label=null),I.label=I.p1=I.p2=null}}var h=this,i=a,j=["measure"],k=!1,l=null,m=null,n=!1,o=!1,p=0,q=!1,r=null,s=null,t="",u=3,v={},w=0,x=!1,y=null,z=null,A="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAKZJREFUeNrclLEKwzAQQ9+FgH/Nk7d8ViFT+6cG36IsNXgIdMg5kAoOIw8WSDoDvAEN04BdEhFjgCTR4e6klFxSIgDLSNydbdsAPgRCktRaUylFkfZ0Z2qtVTlnAfugGibwAur3JFrAxoBnYGEy1pGYmQCLLNB6Uqmw182M9eRS0yzqGo+y6D9rytSQR8vM7DKfbtHy4x+/xG8J+d4W9WAi8fxFOwYA8W0ypu2ZfcsAAAAASUVORK5CYII=), wait",B=null,C=null,D=null,E=null,F=null,G=null,H=null,I=null,J=null,K=null,L=null,M=Autodesk.Viewing.Private.GuiViewer3D&&a instanceof Autodesk.Viewing.Private.GuiViewer3D;this.register=function(){M&&!z&&(z=new Autodesk.Viewing.Extensions.Measure.MeasurePanel(h,i,"measure-panel","Measure",b),i.addPanel(z)),B||(B=new Autodesk.Viewing.Extensions.Measure.Snapper(a),i.toolController.registerTool(B))},this.deregister=function(){this.deactivate(),z&&(i.removePanel(z),z.uninitialize()),i.toolController.deregisterTool(B),B=null},this.isActive=function(){return k},this.getNames=function(){return j},this.getName=function(){return j[0]},this.getCursor=function(){return n&&!o?null:A},this.activate=function(){k=!0,p=0,n=!1,t||(t=i.model.getDisplayUnit()),u=i.model&&i.model.is2d()?3:1,e(),i.clearSelection(),i.toolController.activateTool("snapper"),i.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),i.addEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.deactivate=function(){k=!1,l=m=null,v={},this.clearMeasurement(),f(),B&&B.isActive()&&i.toolController.deactivateTool("snapper"),i.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,c),i.removeEventListener(Autodesk.Viewing.RESET_EVENT,d)},this.update=function(){return!1},this.getUnits=function(){return t},this.setUnits=function(a){t!==a&&(t=a,y&&y.updateDistance())},this.getPrecision=function(){return u},this.setPrecision=function(a){u!==a&&(u=a,y&&y.updateDistance())},this.getDistance=function(a){if(i.model&&i.model.isLoadDone()){var b=Autodesk.Viewing.Private.convertUnits(i.model.getUnitString(),t,v[a]||0);return Autodesk.Viewing.Private.formatValueWithUnits(b,t,3,u)}},this.getAngle=function(){return Autodesk.Viewing.Private.formatValueWithUnits(w,String.fromCharCode(176),3,u)},this.getMeasurement=function(a,b){t=a||t,u=b||u;var c=["Vertex","Edge","Face","Circular Arc","Curved Edge","Curved Face"],d={from:c[this.getFirstGeometry().type],to:c[this.getSecondGeometry().type],distance:this.getDistance("xyz"),deltaX:this.getDistance("x"),deltaY:this.getDistance("y"),deltaZ:this.getDistance("z"),angle:this.getAngle(),unitType:t,precision:u};return d},this.clearMeasurement=function(){l=m=null,r=s=null,I=J=null,K=L=null,p=1,v={},w=0,y&&y.hide(),z&&(z.updatePanel(),z.hideMeasureResult(),z.isolateMeasure&&this.clearIsolate())},this.clearRubberBand=function(){m=null,s=null,y.hideClick("second")},this.clearFirstPick=function(){m?(y.hide(),l=m.clone(),r=s,C=D,E=F,I=J,K=L,G=H,x=!0,r===SNAP_VERTEX?y.showFirstVertex(l):r===SNAP_EDGE?y.showFirstEdge(l,C):r===SNAP_FACE&&y.showFirstFace(l,C),x=!1,m=null,s=null,J=null,L=null,H=null,p=2,v={},w=0,z&&z.isolateMeasure&&this.clearIsolate()):this.clearMeasurement(),z&&z.showSelection1()},this.clearSecondPick=function(){m=null,s=null,J=null,L=null,p=2,v={},w=0,y.hideClick("second"),z&&z.isolateMeasure&&this.clearIsolate()},this.getIndicator=function(){return y},this.getFirstGeometry=function(){return{type:r,geometry:l}},this.getSecondGeometry=function(){return{type:s,geometry:m}},this.getEdgeLength=function(a){return y.getEdgeLength(a)},this.getFaceArea=function(a){return y.getFaceArea(a)},this.getCircularArcRadius=function(a){return y.getCircularArcRadius(a)},this.isolateMeasurement=function(){if(I&&J){var a=[I,J];i.isolate(a)}},this.clearIsolate=function(){i.showAll()},this.isIdenticalEdges=function(){if(l.vertices.length===m.vertices.length){for(var a=0;a<l.vertices.length;a++)if(!l.vertices[a].equals(m.vertices[a]))return!1;return!0}return!1},this.isIdenticalFaces=function(){if(l.faceId&&m.faceId){if(l.fragId===m.fragId&&l.faceId===m.faceId)return!0}else if(l.vertices.length===m.vertices.length){for(var a=0;a<l.vertices.length;a++)if(!l.vertices[a].equals(m.vertices[a]))return!1;return!0}return!1},this.isIdenticalGeometries=function(){if(r===s)switch(r){case SNAP_VERTEX:if(l.equals(m))return!0;break;case SNAP_EDGE:return this.isIdenticalEdges();case SNAP_FACE:return this.isIdenticalFaces();case SNAP_CIRCULARARC:return this.isIdenticalEdges();case SNAP_CURVEDEDGE:return this.isIdenticalEdges();case SNAP_CURVEDFACE:return this.isIdenticalFaces()}return!1},this._handleMouseEvent=function(a){if(B.isSnapped()){if(0===p&&(this.clearMeasurement(),p=1),1===p)K=B.getViewportIndex(),r=B.getHighlightGeometry(),C=B.getIntersectPoint(),l=B.getGeometry(),r===SNAP_VERTEX?y.showFirstVertex(l):r===SNAP_EDGE||r===SNAP_CURVEDEDGE?y.showFirstEdge(l,C):r===SNAP_FACE?(E=B.getFaceNormal(),y.showFirstFace(l,C)):r===SNAP_CIRCULARARC?(G=B.getCircularArcCenter(),l.center=B.getCircularArcCenter(),l.radius=B.getCircularArcRadius(),y.showFirstEdge(l,C)):r===SNAP_CURVEDFACE&&y.showFirstFace(l,C),I=B.getSnapNode(),z&&z.showSelection1();else if(2===p){var b=null;if(s=B.getHighlightGeometry(),D=B.getIntersectPoint(),m=B.getGeometry(),s===SNAP_CIRCULARARC&&(m.center=B.getCircularArcCenter(),m.radius=B.getCircularArcRadius()),this.isIdenticalGeometries())return!1;if(r===SNAP_VERTEX&&s===SNAP_VERTEX?(y.showSecondVertex(m),y.drawLine(l,m),b=[l,m]):r===SNAP_EDGE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.edgeToEdgeMeasure(m,l,D)):r===SNAP_FACE&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),b=y.faceToFaceMeasure(C,E,D,F)):r===SNAP_VERTEX&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.pointToEdgeMeasure(l,m,D)):r===SNAP_EDGE&&s===SNAP_VERTEX?(y.showSecondVertex(m),b=y.edgeToPointMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),b=y.pointToFaceMeasure(l,m,F,D)):r===SNAP_FACE&&s===SNAP_VERTEX?(y.showSecondVertex(m),b=y.faceToPointMeasure(l,E,C,m)):r===SNAP_EDGE&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),b=y.edgeToFaceMeasure(l,C,m,F,D)):r===SNAP_FACE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.faceToEdgeMeasure(l,E,C,m,D)):r===SNAP_CIRCULARARC&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),G.equals(H)?(m=y.nearestVertexInVertexToEdge(D,m),s=SNAP_VERTEX,y.showSecondVertex(m),y.drawLine(G,m),b=[G,m]):(y.showSecondEdge(m,D),y.drawLine(G,H),b=[G,H])):r===SNAP_CIRCULARARC&&s===SNAP_VERTEX?(y.showSecondVertex(m),y.drawLine(G,m),b=[G,m]):r===SNAP_VERTEX&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),y.drawLine(l,H),b=[l,H]):r===SNAP_CIRCULARARC&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.pointToEdgeMeasure(G,m,D)):r===SNAP_EDGE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),b=y.edgeToPointMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_FACE?(F=B.getFaceNormal(),y.showSecondFace(m,D),b=y.pointToFaceMeasure(G,m,F,D)):r===SNAP_FACE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),b=y.faceToPointMeasure(l,E,C,H)):r===SNAP_CURVEDEDGE&&s===SNAP_VERTEX?(y.showSecondVertex(m),b=y.curvedEdgeToVertexMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToVertexMeasure(m,l)):r===SNAP_CURVEDEDGE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),b=y.curvedEdgeToVertexMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToVertexMeasure(m,G)):r===SNAP_CURVEDEDGE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToEdgeMeasure(l,m)):r===SNAP_EDGE&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToEdgeMeasure(m,l)):r===SNAP_CURVEDEDGE&&s===SNAP_CURVEDEDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToCurvedEdgeMeasure(l,m)):r!==SNAP_CURVEDEDGE||s!==SNAP_FACE&&s!==SNAP_CURVEDFACE?r!==SNAP_FACE&&r!==SNAP_CURVEDFACE||s!==SNAP_CURVEDEDGE?r===SNAP_CURVEDFACE&&s===SNAP_VERTEX?(y.showSecondVertex(m),b=y.curvedFaceToVertexMeasure(l,m)):r===SNAP_VERTEX&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),b=y.curvedFaceToVertexMeasure(m,l)):r===SNAP_CURVEDFACE&&s===SNAP_CIRCULARARC?(H=B.getCircularArcCenter(),y.showSecondEdge(m,D),b=y.curvedFaceToVertexMeasure(l,H)):r===SNAP_CIRCULARARC&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),b=y.curvedFaceToVertexMeasure(m,G)):r===SNAP_CURVEDFACE&&s===SNAP_EDGE?(y.showSecondEdge(m,D),b=y.curvedEdgeToFaceMeasure(m,l)):r===SNAP_EDGE&&s===SNAP_CURVEDFACE?(y.showSecondFace(m,D),b=y.curvedEdgeToFaceMeasure(l,m)):r!==SNAP_CURVEDFACE||s!==SNAP_FACE&&s!==SNAP_CURVEDFACE?r===SNAP_FACE&&s===SNAP_CURVEDFACE&&(y.showSecondFace(m,D),b=y.curvedFaceToFaceMeasure(l,m)):(y.showSecondFace(m,D),b=y.curvedFaceToFaceMeasure(l,m)):(y.showSecondEdge(m,D),b=y.curvedEdgeToFaceMeasure(m,l)):(y.showSecondFace(m,D),b=y.curvedEdgeToFaceMeasure(l,m)),q){if(void 0===b.length)w=b,z&&z.showAngleResult();else{var c=b[0].clone(),d=b[1].clone();i.model.is2d()&&i.model.pageToModel(c,d,K),v.xyz=c.distanceTo(d),v.x=Math.abs(c.x-d.x),v.y=Math.abs(c.y-d.y),v.z=Math.abs(c.z-d.z),z&&(r===SNAP_FACE&&s===SNAP_FACE?z.showDistanceResult(!0):z.showDistanceResult())}z&&(z.showSelection2(),z.updatePanel()),y.updateDistance(),y.updateAngle(),J=B.getSnapNode(),L=B.getViewportIndex(),z&&z.isolateMeasure&&this.isolateMeasurement()}y.updateLabelPositions()}return!0}if(2===p){var e=this.inverseProject(a.canvasX,a.canvasY);r===SNAP_VERTEX?y.drawLine(l,e):r===SNAP_EDGE?y.edgeToPointMeasure(l,e):r===SNAP_FACE?y.faceToPointMeasure(l,E,C,e):r===SNAP_CIRCULARARC?y.drawLine(G,e):r===SNAP_CURVEDEDGE?y.curvedEdgeToVertexMeasure(l,e):r===SNAP_CURVEDFACE&&y.curvedFaceToVertexMeasure(l,e)}return!1},this.inverseProject=function(a,b){var c=i.navigation.getCamera(),d=i.navigation.getScreenViewport(),e=new THREE.Vector3;return e.x=a/d.width*2-1,e.y=-(b/d.height*2-1),e.z=0,e=e.unproject(c)},this.handleButtonDown=function(a,b){return n=!0,0!==b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||(q=!0),!1},this.handleMouseMove=function(a){return q=!1,2===p&&(this.clearRubberBand(),this._handleMouseEvent(a)),!1},this.handleButtonUp=function(a,b){return n=!1,!1},this.handleSingleClick=function(a,b){return q&&(this._handleMouseEvent(a)||(this.clearMeasurement(),p=0),(1===p||2===p)&&(p=1===p?2:0),q=!1),!0},this.handleDoubleClick=function(a,b){return!0},this.handleWheelInput=function(a){return y.updateScale(),!1},this.handleSingleTap=function(a){return this.handleSingleClick(a)},this.handleDoubleTap=function(a){return!0},this.handleResize=function(){y&&y.updateLabelPositions()}},function(){"use strict";var a=AutodeskNamespace("Autodesk.Viewing.Extensions.Measure"),b=Autodesk.Viewing,c=Autodesk.Viewing.Extensions,d=Autodesk.Viewing.Private,e=Autodesk.Viewing.UI,f=function(a,c,f,g,h){e.DockingPanel.call(this,c.container,f,g,h),this.kPanelExpandedHeight=310,this.kPanelCollapsedHeight=35,this.isDeltaExpanded=!0,this.isSettingsExpanded=!1,this.isolateMeasure=!1,this.measureTool=a,this.viewer=c,this.parentContainer=c.container,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="300px",this.container.style.width="300px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="200px",this.container.style.left="220px",this.container.style.position="absolute",this.addEventListener(this.closer,"click",function(a){h&&h.onCloseCallback&&h.onCloseCallback()});var i=this.container.children[0];i.classList.add("expanded"),h=h||{},h.heightAdjustment||(h.heightAdjustment=40),h.marginTop||(h.marginTop=0),h.left=!1,this.createScrollContainer(h),this.measureResults=document.createElement("div"),this.scrollContainer.appendChild(this.measureResults);var j=this;this.selection1=document.createElement("div"),this.selection1.className="measure-result-container",this.measureResults.appendChild(this.selection1);var k=document.createElement("div");k.className="measure-selectionOne-label",this.selection1.appendChild(k);var l=document.createElement("div");l.className="adsk-icon-first measure-label-icon",k.appendChild(l),this.selection1Result=document.createElement("div"),this.selection1Result.className="measure-selection-result",this.selection1.appendChild(this.selection1Result);var m=document.createElement("div");m.className="adsk-icon-refresh measure-repick",m.addEventListener("click",function(a){j.firstSelectionRepick()},!0),this.selection1.appendChild(m),this.addDivider(this.selection1),this.results=document.createElement("div"),this.results.className="measure-result-container",this.measureResults.appendChild(this.results),this.distIcon=document.createElement("div"),this.distIcon.className="adsk-icon-measure-distance measure-distance-icon",this.results.appendChild(this.distIcon),this.angleIcon=document.createElement("div"),this.angleIcon.className="adsk-icon-measure-angle measure-angle-icon",this.results.appendChild(this.angleIcon),this.distanceDiv=document.createElement("div"),this.distanceDiv.className="measure-result",this.results.appendChild(this.distanceDiv),this.angleDiv=document.createElement("div"),this.angleDiv.className="measure-result",this.results.appendChild(this.angleDiv),this.initialDiv=document.createElement("div"),this.initialDiv.className="measure-initial",this.initialDiv.textContent="0.00",this.results.appendChild(this.initialDiv),this.settingsButton=document.createElement("div"),this.settingsButton.className="adsk-icon-settings measure-settings-button",this.settingsButton.addEventListener("click",function(a){j.showMeasureSettings()},!0),this.results.appendChild(this.settingsButton),this.deltaButton=document.createElement("div"),this.deltaButton.className="adsk-icon-arrow measure-delta-button",this.deltaButton.addEventListener("click",function(a){j.toggle()},!0),this.results.appendChild(this.deltaButton),this.deltaXDiv=document.createElement("div"),this.deltaXDiv.className="measure-delta-result",this.results.appendChild(this.deltaXDiv);var n=document.createElement("span");n.setAttribute("data-i18n","Delta"),n.textContent=b.i18n.translate("Delta"),this.deltaXDiv.appendChild(n);var o=document.createElement("span");o.className="measure-label-axis-x",o.textContent="X",this.deltaXDiv.appendChild(o);var p=document.createElement("span");this.deltaXDiv.appendChild(p),this.deltaYDiv=document.createElement("div"),this.deltaYDiv.className="measure-delta-result",this.results.appendChild(this.deltaYDiv);var q=document.createElement("span");q.setAttribute("data-i18n","Delta"),q.textContent=b.i18n.translate("Delta"),this.deltaYDiv.appendChild(q);var r=document.createElement("span");r.className="measure-label-axis-y",r.textContent="Y",this.deltaYDiv.appendChild(r);var s=document.createElement("span");this.deltaYDiv.appendChild(s),this.deltaZDiv=document.createElement("div"),this.deltaZDiv.className="measure-delta-result",this.results.appendChild(this.deltaZDiv);var t=document.createElement("span");t.setAttribute("data-i18n","Delta"),t.textContent=b.i18n.translate("Delta"),this.deltaZDiv.appendChild(t);var u=document.createElement("span");u.className="measure-label-axis-z",u.textContent="Z",this.deltaZDiv.appendChild(u);var v=document.createElement("span");this.deltaZDiv.appendChild(v),this.addDivider(this.results),this.selection2=document.createElement("div"),this.selection2.className="measure-result-container",
this.measureResults.appendChild(this.selection2);var w=document.createElement("div");w.className="measure-selectionTwo-label",this.selection2.appendChild(w);var x=document.createElement("div");x.className="adsk-icon-second measure-label-icon",w.appendChild(x),this.selection2Result=document.createElement("div"),this.selection2Result.className="measure-selection-result",this.selection2.appendChild(this.selection2Result);var y=document.createElement("div");y.className="adsk-icon-refresh measure-repick",y.addEventListener("click",function(a){j.secondSelectionRepick()},!0),this.selection2.appendChild(y),this.addDivider(this.selection2),this.measureSettings=document.createElement("div"),this.measureSettings.className="measure-settings",this.measureSettings.style.display="none",this.measureResults.appendChild(this.measureSettings),this.table=document.createElement("table"),this.table.className="tftable measure-table",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.measureSettings.appendChild(this.table),this.units=[{name:"Unknown",units:"",matches:[""]},{name:"Decimal feet",units:"decimal-ft",matches:["ft","decimal-ft"]},{name:"Feet and fractional inches",units:"ft-and-fractional-in",matches:["ft-and-fractional-in"]},{name:"Feet and decimal inches",units:"ft-and-decimal-in",matches:["ft-and-decimal-in"]},{name:"Decimal inches",units:"decimal-in",matches:["in","decimal-in"]},{name:"Fractional inches",units:"fractional-in",matches:["fractional-in"]},{name:"Meters",units:"m",matches:["m"]},{name:"Centimeters",units:"cm",matches:["cm"]},{name:"Millimeters",units:"mm",matches:["mm"]},{name:"Meters and centimeters",units:"m-and-cm",matches:["m-and-cm"]}];for(var z=this.findUnits(),A=[],B=0;B<this.units.length;++B)A.push(this.units[B].name);this.unitList=new d.OptionDropDown("Unit type",this.tbody,A,z),this.addEventListener(this.unitList,"change",function(a){var b=j.unitList.selectedIndex,c=j.units[b].units;j.measureTool.setUnits(c),j.updatePanel(),j.setupPrecision(),d.logger&&d.logger.log({category:"pref_changed",name:"measure/units",value:c})}),this.precisionList=new d.OptionDropDown("Precision",this.tbody,[],-1),this.addEventListener(this.precisionList,"change",function(a){var b=j.precisionList.selectedIndex;j.measureTool.setPrecision(b),j.updatePanel(),d.logger&&d.logger.log({category:"pref_changed",name:"measure/precision",value:b})}),this.setupPrecision(),this.isolate=new d.OptionCheckbox("Isolate measurement",this.tbody,!1),this.addEventListener(this.isolate,"change",function(a){var b=j.isolate.checked;j.isolateMeasure=b,j.isolateMeasure?j.measureTool.isolateMeasurement():j.measureTool.clearIsolate(),d.logger&&d.logger.log({category:"pref_changed",name:"measure/isolate",value:b})}),this.addDivider(this.measureSettings);var C=document.createElement("div");C.className="measure-restart",C.setAttribute("data-i18n","Restart"),C.textContent=b.i18n.translate("Restart"),C.addEventListener("click",function(){j.measureTool.clearMeasurement()},!1),this.measureResults.appendChild(C),this.updatePanel(),this.addVisibilityListener(function(){j.resizeToContent({maxHeight:j.parentContainer.offsetHeight-75})}),this.hideMeasureResult()};f.prototype=Object.create(e.DockingPanel.prototype),c.ViewerPanelMixin.call(f.prototype),f.prototype.addDropDownMenu=function(a,c,d,e,f){var g=function(a){var b=a.target.selectedIndex;f(b)},h=document.createElement("select");h.className="optionDropDown";for(var i=0;i<d.length;i++){var j=document.createElement("option");j.value=i,j.setAttribute("data-i18n",d[i]),j.textContent=b.i18n.translate(d[i]),h.add(j)}var k=document.createElement("div");k.className="measure-submenu-select";var l=document.createElement("div");return l.className="measure-submenu-selectlabel",l.setAttribute("for",c),l.setAttribute("data-i18n",c),l.textContent=b.i18n.translate(c),k.appendChild(l),k.appendChild(h),a.appendChild(k),h.selectedIndex=e,h.onchange=g,h},f.prototype.addDivider=function(a){var b=document.createElement("div");return b.className="measure-horizontal-divider",a.appendChild(b),b},f.prototype.findUnits=function(){var a,b,c=this.measureTool.getUnits();for(a=0;a<this.units.length;++a){var d=this.units[a].matches;if(d)for(b=0;b<d.length;++b)if(d[b]===c)return a}return 0},f.prototype.setupPrecision=function(){for(;this.precisionList.dropdownElement.lastChild;)this.precisionList.dropdownElement.removeChild(this.precisionList.dropdownElement.lastChild);var a,b=this.measureTool.getUnits();a="ft-and-fractional-in"===b||"fractional-in"===b?["1","1/2","1/4","1/8","1/16","1/32","1/64"]:["0","0.1","0.01","0.001","0.0001","0.00001"];for(var c=0;c<a.length;++c){var d=document.createElement("option");d.value=c,d.textContent=a[c],this.precisionList.dropdownElement.appendChild(d)}var e=this.measureTool.getPrecision();a.length<=e&&(e=a.length-1,self.measureTool.setPrecision(e)),this.precisionList.dropdownElement.selectedIndex=e},f.prototype.uninitialize=function(){this.viewer=null,e.DockingPanel.prototype.uninitialize.call(this)},f.prototype.onTitleClick=function(a){},f.prototype.deltaCollapse=function(){this.deltaButton.classList.toggle("rotated"),this.measureTool.getIndicator().setSimple(this.isDeltaExpanded),this.isDeltaExpanded?(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none",this.isDeltaExpanded=!1):(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"),this.isDeltaExpanded=!0),this.resizeToContent()},f.prototype.toggle=function(){this.deltaCollapse()},f.prototype.isExpanded=function(){return this.container.children[0].classList.contains("expanded")},f.prototype.getContentSize=function(){return{height:this.isExpanded()?this.measureResults.clientHeight+46:0,width:this.measureResults.clientWidth}},f.prototype.updatePanel=function(){function a(a,c){"angle"===c?a.textContent="~ "+b.measureTool.getAngle():"xyz"===c?a.textContent="~ "+b.measureTool.getDistance(c):a.children[2].textContent=" = ~ "+b.measureTool.getDistance(c)}var b=this;a(this.distanceDiv,"xyz"),a(this.deltaXDiv,"x"),a(this.deltaYDiv,"y"),a(this.deltaZDiv,"z"),a(this.angleDiv,"angle"),this.unitList.dropdownElement.selectedIndex=this.findUnits(),this.precisionList.dropdownElement.selectedIndex=this.measureTool.getPrecision(),this.initialDiv.textContent=d.formatValueWithUnits(0,null,3,this.measureTool.getPrecision()),this.showSelection1(),this.showSelection2()},f.prototype.showDistanceResult=function(a){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="inline-block",this.distIcon.style.display="inline-block",a?(this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none")):(this.deltaButton.style.display="inline-block",this.isDeltaExpanded&&(this.deltaXDiv.style.display="block",this.deltaYDiv.style.display="block",this.viewer.model&&!this.viewer.model.is2d()&&(this.deltaZDiv.style.display="block"))),this.resizeToContent()},f.prototype.showAngleResult=function(){this.results.style.display="block",this.initialDiv.style.display="none",this.angleDiv.style.display="inline-block",this.angleIcon.style.display="inline-block",this.distanceDiv.style.display="none",this.distIcon.style.display="none",this.deltaButton.style.display="none",this.isDeltaExpanded&&(this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"),this.resizeToContent()},f.prototype.showSelection1=function(){var a=this.measureTool.getFirstGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection1Result.setAttribute("data-i18n","Vertex"),this.selection1Result.textContent=b.i18n.translate("Vertex"),this.selection1Result.style.display="inline-block"):a.type===SNAP_EDGE||a.type===SNAP_CURVEDEDGE?(this.selection1Result.setAttribute("data-i18n","Edge"),this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection1Result.style.display="inline-block"):a.type===SNAP_FACE||a.type===SNAP_CURVEDFACE?(this.selection1Result.setAttribute("data-i18n","Face"),this.selection1Result.textContent=b.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(a.geometry),this.selection1Result.style.display="inline-block"):a.type===SNAP_CIRCULARARC&&(this.selection1Result.setAttribute("data-i18n","Edge"),a.geometry.radius?this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(a.geometry)+" (R)":this.selection1Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection1Result.style.display="inline-block"),this.selection1.style.display="block",this.resizeToContent())},f.prototype.showSelection2=function(){var a=this.measureTool.getSecondGeometry();null!==a.type&&(a.type===SNAP_VERTEX?(this.selection2Result.setAttribute("data-i18n","Vertex"),this.selection2Result.textContent=b.i18n.translate("Vertex"),this.selection2Result.style.display="inline-block"):a.type===SNAP_EDGE||a.type===SNAP_CURVEDEDGE?(this.selection2Result.setAttribute("data-i18n","Edge"),this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection2Result.style.display="inline-block"):a.type===SNAP_FACE||a.type===SNAP_CURVEDFACE?(this.selection2Result.setAttribute("data-i18n","Face"),this.selection2Result.textContent=b.i18n.translate("Face")+" ~ "+this.measureTool.getFaceArea(a.geometry),this.selection2Result.style.display="inline-block"):a.type===SNAP_CIRCULARARC&&(this.selection2Result.setAttribute("data-i18n","Edge"),a.geometry.radius?this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getCircularArcRadius(a.geometry)+" (R)":this.selection2Result.textContent=b.i18n.translate("Edge")+" ~ "+this.measureTool.getEdgeLength(a.geometry),this.selection2Result.style.display="inline-block"),this.selection2.style.display="block",this.resizeToContent())},f.prototype.firstSelectionRepick=function(){this.measureTool.clearFirstPick(),this.selection1Result.textContent=this.selection2Result.textContent,this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.secondSelectionRepick=function(){this.measureTool.clearSecondPick(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.hideMeasureResult=function(){this.clearSelectionOne(),this.clearSelectionTwo(),this.clearResult(),this.resizeToContent()},f.prototype.disableUnitOption=function(a){null!=a?this.unitList.dropdownElement.children[a].style.display="none":this.unitList.dropdownElement.disabled=!0},f.prototype.showMeasureSettings=function(){this.isSettingsExpanded?(this.measureSettings.style.display="none",this.isSettingsExpanded=!1):(this.measureSettings.style.display="block",this.isSettingsExpanded=!0),this.resizeToContent()},f.prototype.clearSelectionOne=function(){this.selection1Result.setAttribute("data-i18n","Select Object"),this.selection1Result.textContent=b.i18n.translate("Select Object")},f.prototype.clearSelectionTwo=function(){this.selection2Result.setAttribute("data-i18n","Select Object"),this.selection2Result.textContent=b.i18n.translate("Select Object")},f.prototype.clearResult=function(){this.distIcon.style.display="none",this.angleIcon.style.display="none",this.distanceDiv.style.display="none",this.angleDiv.style.display="none",this.initialDiv.style.display="inline-block",this.deltaButton.style.display="none",this.deltaXDiv.style.display="none",this.deltaYDiv.style.display="none",this.deltaZDiv.style.display="none"},a.MeasurePanel=f}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Measure");var SNAP_VERTEX=0,SNAP_EDGE=1,SNAP_FACE=2,SNAP_CIRCULARARC=3,SNAP_CURVEDEDGE=4,SNAP_CURVEDFACE=5,SNAP_PRECISION=.001;Autodesk.Viewing.Extensions.Measure.Snapper=function(a){function b(a,b){this.viewer=a,this.snapper=b,this.lineGeom=new THREE.Geometry,this.circularArc=null,this.circularArcCenter,this.circularArcRadius,this.ellipticalArc=null,this.ellipticalArcCenter,this.minDist=Number.MAX_VALUE,this.vpIdLine=null,this.vpIdCircular=null,this.vpIdElliptical=null,this.detectRadius=this.snapper.getDetectRadius()}var c=a,d=["snapper"],e=!1,f="MeasureTool-snapper-face",g="MeasureTool-snapper-vertex",h="MeasureTool-snapper-edge",i=null,j=Number.MAX_VALUE,k=null,l=null,m=null,n=null,o=null,p=null,q=null,r=null,s=!1,t=!1,u=null,v=null,w=null;this.isActive=function(){return e},this.getNames=function(){return d},this.getName=function(){return d[0]},this.activate=function(){e=!0},this.deactivate=function(){e=!1,this.destroy()},this.getFace=function(){return l},this.getEdge=function(){return m},this.getVertex=function(){return n},this.getGeometry=function(){switch(p){case SNAP_VERTEX:return this.getVertex();case SNAP_EDGE:return this.getEdge();case SNAP_FACE:return this.getFace();case SNAP_CIRCULARARC:return this.getEdge();case SNAP_CURVEDEDGE:return this.getEdge();case SNAP_CURVEDFACE:return this.getFace()}},this.getSnapNode=function(){return o},this.getHighlightGeometry=function(){return p},this.getIntersectPoint=function(){return q},this.getFaceNormal=function(){return r},this.getEndPointsInEdge=function(a){for(var b=a.vertices,c=[],d=0;d<b.length;++d){for(var e=!1,f=0;f<b.length;++f)if(f!==d&&b[f].equals(b[d])){e=!0;break}e||c.push(b[d])}return c},this.getViewportIndex=function(){return u},this.getCircularArcCenter=function(){return v},this.getCircularArcRadius=function(){return w},this.getDetectRadius=function(){return i},this.isSnapped=function(){return t},this.isEqualWithPrecision=function(a,b){return Math.abs(a-b)<=SNAP_PRECISION?!0:!1},this.isEqualVectorsWithPrecision=function(a,b){return Math.abs(a.x-b.x)<=SNAP_PRECISION&&Math.abs(a.y-b.y)<=SNAP_PRECISION&&Math.abs(a.z-b.z)<=SNAP_PRECISION?!0:!1},this.isInverseVectorsWithPrecision=function(a,b){return Math.abs(a.x+b.x)<=SNAP_PRECISION&&Math.abs(a.y+b.y)<=SNAP_PRECISION&&Math.abs(a.z+b.z)<=SNAP_PRECISION?!0:!1},this.snapping3D=function(a){o=a.dbId;var b=a.face;q=a.intersectPoint;var d;if(d=void 0===a.fragId.length?[a.fragId]:a.fragId,c.model.hasTopology()){o&&(d=[],c.model.getData().instanceTree.enumNodeFragments(o,function(a){d.push(a)},!0)),l=m=n=null,j=Number.MAX_VALUE;for(var e=0;e<d.length;++e){var f=d[e],g=c.impl.getRenderProxy(c.model,f),h=g.geometry,s=c.model.getTopoIndex(f),u=c.model.getTopology(s),x=u.faces,y=u.edges;u.vertices;if(!l){l=this.faceSnappingWithTopology(b,h,x,g),l&&(l.fragId=f);var z=(new THREE.Matrix3).getNormalMatrix(g.matrixWorld);r=b.normal.applyMatrix3(z).normalize()}this.edgeSnappingWithTopology(q,h,y,g)}if(n=this.vertexSnappingWithTopology(m,q),l){if(i=this.setDetectRadius(q),i>k)this.drawPoint(n),p=SNAP_VERTEX;else if(i>j){this.drawLine(m);var A=this.edgeIsCircle(m);A?(v=A,w=A.distanceTo(m.vertices[0]),p=SNAP_CIRCULARARC):p=this.edgeIsCurved(m)?SNAP_CURVEDEDGE:SNAP_EDGE}else this.drawFace(l),p=this.faceIsCurved(l)?SNAP_CURVEDFACE:SNAP_FACE;t=!0}}else for(var e=0;e<d.length;++e){var f=d[e],g=c.impl.getRenderProxy(c.model,f),h=g.geometry;if(l=this.faceSnapping(b,h)){l.applyMatrix(g.matrixWorld),m=this.edgeSnapping(l,q),n=this.vertexSnapping(m,q);var z=(new THREE.Matrix3).getNormalMatrix(g.matrixWorld);r=b.normal.applyMatrix3(z).normalize(),i=this.setDetectRadius(q),i>k?(this.drawPoint(n),p=SNAP_VERTEX):i>j?(this.drawLine(m),p=SNAP_EDGE):(this.drawFace(l),p=SNAP_FACE),t=!0;break}}},this.faceSnappingWithTopology=function(a,b,c,d){var e=new THREE.Vector3,f=new THREE.Vector3,g=new THREE.Vector3,h=new THREE.Geometry,i=b.attributes;if(void 0!==i.index){for(var j=b.vb?b.vb:i.position.array,k=b.vb?b.vbstride:3,l=0;l<c.length;l++){for(var m=c[l].indexList,n=c[l].id,o=0;o<m.length;o+=3)if(a.a===m[o]){if(a.b===m[o+1]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o+1])break}else if(a.a===m[o+1]){if(a.b===m[o]&&a.c===m[o+2]||a.b===m[o+2]&&a.c===m[o])break}else if(a.a===m[o+2]&&(a.b===m[o]&&a.c===m[o+1]||a.b===m[o+1]&&a.c===m[o]))break;if(o<m.length)break}if(l<c.length)for(var o=0;o<m.length;o+=3){e.set(j[m[o]*k],j[m[o]*k+1],j[m[o]*k+2]),f.set(j[m[o+1]*k],j[m[o+1]*k+1],j[m[o+1]*k+2]),g.set(j[m[o+2]*k],j[m[o+2]*k+1],j[m[o+2]*k+2]);var p=h.vertices.length;h.vertices.push(e.clone()),h.vertices.push(f.clone()),h.vertices.push(g.clone()),h.faces.push(new THREE.Face3(p,p+1,p+2))}}return h.vertices.length>0?(h.faceId=n,h.applyMatrix(d.matrixWorld),h):null},this.faceSnapping=function(a,b){var c=new THREE.Vector3,d=new THREE.Vector3,e=new THREE.Vector3,f=new THREE.Geometry,g=b.attributes;if(void 0!==g.index){var h=g.index.array||b.ib,i=b.vb?b.vb:g.position.array,j=b.vb?b.vbstride:3,k=b.offsets;k&&0!==k.length||(k=[{start:0,count:h.length,index:0}]);for(var l=0;l<k.length;++l)for(var m=k[l].start,n=k[l].count,o=k[l].index,p=m;m+n>p;p+=3){var q=o+h[p],r=o+h[p+1],s=o+h[p+2];c.set(i[q*j],i[q*j+1],i[q*j+2]),d.set(i[r*j],i[r*j+1],i[r*j+2]),e.set(i[s*j],i[s*j+1],i[s*j+2]);var t=THREE.Triangle.normal(c,d,e),u=new THREE.Vector3;if(u.set(i[a.a*j],i[a.a*j+1],i[a.a*j+2]),this.isEqualVectorsWithPrecision(t,a.normal)&&this.isEqualWithPrecision(t.dot(c),a.normal.dot(u))){var v=f.vertices.length;f.vertices.push(c.clone()),f.vertices.push(d.clone()),f.vertices.push(e.clone()),f.faces.push(new THREE.Face3(v,v+1,v+2))}}}return f.vertices.length>0?this.getTrianglesOnSameFace(f,a,i,j):null},this.getTrianglesOnSameFace=function(a,b,c,d){var e=!1,f=a.vertices.slice(),g=new THREE.Vector3;g.set(c[b.a*d],c[b.a*d+1],c[b.a*d+2]);var h=new THREE.Vector3;h.set(c[b.b*d],c[b.b*d+1],c[b.b*d+2]);var i=new THREE.Vector3;i.set(c[b.c*d],c[b.c*d+1],c[b.c*d+2]);var j=new THREE.Geometry;j.vertices.push(g),j.vertices.push(h),j.vertices.push(i),j.faces.push(new THREE.Face3(0,1,2));var k=[];do{k=[];for(var l=0;l<f.length;l+=3)if(f[l].equals(g)&&f[l+1].equals(h)&&f[l+2].equals(i))e=!0,k.push(l);else for(var m=0;m<j.vertices.length;m+=3)if(this.trianglesSharedEdge(f[l],f[l+1],f[l+2],j.vertices[m],j.vertices[m+1],j.vertices[m+2])){var n=j.vertices.length;j.vertices.push(f[l].clone()),j.vertices.push(f[l+1].clone()),j.vertices.push(f[l+2].clone()),j.faces.push(new THREE.Face3(n,n+1,n+2)),k.push(l);break}for(var o=k.length-1;o>=0;--o)f.splice(k[o],3)}while(k.length>0);return e?j:null},this.trianglesSharedEdge=function(a,b,c,d,e,f){var g=!1,h=!1,i=!1;return(a.equals(d)||a.equals(e)||a.equals(f))&&(g=!0),(b.equals(d)||b.equals(e)||b.equals(f))&&(h=!0),(c.equals(d)||c.equals(e)||c.equals(f))&&(i=!0),g&h||g&i||h&i?!0:!1},this.edgeSnappingWithTopology=function(a,b,c,d){var e,f=new THREE.Geometry,g=Number.MAX_VALUE,h=new THREE.Vector3,i=new THREE.Vector3,k=b.attributes;if(void 0!==k.index&&void 0!=c){for(var l=b.vb?b.vb:k.position.array,n=b.vb?b.vbstride:3,o=0;o<c.length;o++)for(var p=c[o].indexList,q=0;q<p.length-1;q++){h.set(l[p[q]*n],l[p[q]*n+1],l[p[q]*n+2]),i.set(l[p[q+1]*n],l[p[q+1]*n+1],l[p[q+1]*n+2]),h.applyMatrix4(d.matrixWorld),i.applyMatrix4(d.matrixWorld);var r=this.distancePointToLine(a,h,i);g>r&&(g=r,e=o)}if(e){p=c[e].indexList;for(var s=0;s<p.length-1;s++)f.vertices.push(new THREE.Vector3(l[p[s]*n],l[p[s]*n+1],l[p[s]*n+2])),f.vertices.push(new THREE.Vector3(l[p[s+1]*n],l[p[s+1]*n+1],l[p[s+1]*n+2]))}}j>=g&&f.vertices.length>0&&(j=g,f.applyMatrix(d.matrixWorld),m=f)},this.edgeSnapping=function(a,b){for(var c=new THREE.Geometry,d=!0,e=!0,f=!0,g=0;g<a.vertices.length;g+=3){for(var h=0;h<a.vertices.length;h+=3)g!==h&&((a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(d=!1),(a.vertices[g].equals(a.vertices[h])||a.vertices[g].equals(a.vertices[h+1])||a.vertices[g].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(e=!1),(a.vertices[g+1].equals(a.vertices[h])||a.vertices[g+1].equals(a.vertices[h+1])||a.vertices[g+1].equals(a.vertices[h+2]))&&(a.vertices[g+2].equals(a.vertices[h])||a.vertices[g+2].equals(a.vertices[h+1])||a.vertices[g+2].equals(a.vertices[h+2]))&&(f=!1));d&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+1].clone())),e&&(c.vertices.push(a.vertices[g].clone()),c.vertices.push(a.vertices[g+2].clone())),f&&(c.vertices.push(a.vertices[g+1].clone()),c.vertices.push(a.vertices[g+2].clone())),d=!0,e=!0,f=!0}for(var i,k=new THREE.Geometry,l=Number.MAX_VALUE,m=0;m<c.vertices.length;m+=2){var n=this.distancePointToLine(b,c.vertices[m],c.vertices[m+1]);l>n&&(l=n,i=m)}return k.vertices.push(c.vertices[i].clone()),k.vertices.push(c.vertices[i+1].clone()),k.vertices=this.getConnectedLineSegmentsOnSameLine(c,k.vertices),j=l,k},this.distancePointToLine=function(a,b,c){var d,e,f=new THREE.Vector3,g=new THREE.Vector3;return f.subVectors(b,a),g.subVectors(c,b),e=f.dot(g),f.subVectors(c,b),e=-e/f.dot(f),0>e?d=a.distanceTo(b):e>1?d=a.distanceTo(c):(f.subVectors(a,b),g.subVectors(a,c),f.cross(g),g.subVectors(c,b),d=Math.sqrt(f.dot(f))/Math.sqrt(g.dot(g))),d},this.getConnectedLineSegmentsOnSameLine=function(a,b){var c=a.vertices.slice(),d=b[0],e=b[1],f=[];do{f=[];for(var g=0;g<c.length;g+=2)if(!c[g].equals(d)||!c[g+1].equals(e))for(var h=0;h<b.length;h+=2)if(c[g].equals(b[h])||c[g+1].equals(b[h])||c[g].equals(b[h+1])||c[g+1].equals(b[h+1])){var i=new THREE.Vector3,j=new THREE.Vector3;if(i.subVectors(b[h],b[h+1]),i.normalize(),j.subVectors(c[g],c[g+1]),j.normalize(),this.isEqualVectorsWithPrecision(i,j)||this.isInverseVectorsWithPrecision(i,j)){f.push(g);break}}for(var k=f.length-1;k>=0;--k)b.push(c[f[k]]),b.push(c[f[k]+1]),c.splice(f[k],2)}while(f.length>0);return b},this.vertexSnappingWithTopology=function(a,b){var c=Number.MAX_VALUE,d=new THREE.Vector3;if(a&&a.vertices.length>1){var e=b.distanceTo(a.vertices[0]),f=b.distanceTo(a.vertices[a.vertices.length-1]);f>=e?(c=e,d=a.vertices[0].clone()):(c=f,d=a.vertices[a.vertices.length-1].clone())}return k=c,d},this.vertexSnapping=function(a,b){for(var c=Number.MAX_VALUE,d=new THREE.Vector3,e=0;e<a.vertices.length;++e){var f=b.distanceTo(a.vertices[e]);c-SNAP_PRECISION>f&&(c=f,d=a.vertices[e].clone())}return k=c,d},this.edgeIsCircle=function(a){var b=a.vertices;if(b.length<8)return!1;if(b[0].equals(b[b.length-1])){for(var c=new THREE.Vector3(0,0,0),d=0;d<b.length;d+=2)c.add(b[d]);c.divideScalar(b.length/2);for(var e=c.distanceTo(b[0]),d=0;d<b.length;d+=2)if(!(Math.abs(c.distanceTo(b[d])-e)<=SNAP_PRECISION))return!1;return c}return!1},this.edgeIsCurved=function(a){var b=a.vertices;if(b.length<=2)return!1;if(b[0].equals(b[b.length-1]))return!0;var c=new THREE.Vector3;c.subVectors(b[0],b[1]);for(var d=new THREE.Vector3,e=2;e<b.length;e+=2)if(d.subVectors(b[e],b[e+1]),!this.isEqualVectorsWithPrecision(c,d))return!0;return!1},this.faceIsCurved=function(a){var b=a.vertices,c=a.faces;if(c.length<=1)return!1;for(var d=THREE.Triangle.normal(b[c[0].a],b[c[0].b],b[c[0].c]),e=b[c[0].a],f=1;f<c.length;f++){var g=THREE.Triangle.normal(b[c[f].a],b[c[f].b],b[c[f].c]),h=b[c[f].a];if(!this.isEqualVectorsWithPrecision(d,g)||!this.isEqualWithPrecision(d.dot(e),g.dot(h)))return!0}return!1},this.angleVector2=function(a){return a.x>0&&a.y>=0?Math.atan(a.y/a.x):a.x>=0&&a.y<0?Math.atan(a.y/a.x)+2*Math.PI:a.x<0&&a.y<=0?Math.atan(a.y/a.x)+Math.PI:a.x<=0&&a.y>0?Math.atan(a.y/a.x)+Math.PI:null},b.prototype.onLineSegment=function(a,b,c,d,e){var f=this.snapper.getIntersectPoint(),g=this.lineGeom.vertices,h=new THREE.Vector3(a,b,f.z),i=new THREE.Vector3(c,d,f.z),j=this.snapper.distancePointToLine(f,h,i);j<=this.detectRadius&&j<this.minDist&&(g.splice(0,2,h,i),this.minDist=j,this.vpIdLine=e)},b.prototype.onCircularArc=function(a,b,c,d,e,f){var g=this.snapper.getIntersectPoint(),h=new THREE.Vector2(g.x,g.y),i=new THREE.Vector2(a,b),j=h.distanceTo(i);h.sub(i);var k=this.snapper.angleVector2(h);if(Math.abs(j-e)<=this.detectRadius){if(d>c&&k>=c&&d>=k)var l=new THREE.CircleGeometry(e,100,c,d-c);else{if(!(c>d&&(k>=c||d>=k)))return;var l=new THREE.CircleGeometry(e,100,c,2*Math.PI-c+d)}l.vertices.splice(0,1),l.applyMatrix((new THREE.Matrix4).makeTranslation(a,b,g.z)),this.circularArc=l,this.circularArcCenter=new THREE.Vector3(a,b,g.z),this.circularArcRadius=e,this.vpIdCircular=f}},b.prototype.onEllipticalArc=function(a,b,c,d,e,f,g,h){var i=this.snapper.getIntersectPoint(),j=new THREE.Vector2(i.x,i.y),k=e-this.detectRadius,l=f-this.detectRadius,m=e+this.detectRadius,n=f+this.detectRadius,o=(j.x-a)*(j.x-a)/(k*k)+(j.y-b)*(j.y-b)/(l*l),p=(j.x-a)*(j.x-a)/(m*m)+(j.y-b)*(j.y-b)/(n*n),q=new THREE.Vector2(a,b);j.sub(q),j.x*=f,j.y*=e;var r=this.snapper.angleVector2(j);if(d>2*Math.PI&&(d=2*Math.PI),o>=1&&1>=p&&(d>c&&r>=c&&d>=r||c>d&&(r>=c||d>=r))){var s=new THREE.EllipseCurve(a,b,e,f,c,d,!1),t=new THREE.Path(s.getPoints(50)),u=t.createPointsGeometry(50);this.snapper.isEqualWithPrecision(d-c,2*Math.PI)||u.vertices.pop(),u.applyMatrix((new THREE.Matrix4).makeTranslation(0,0,i.z)),this.ellipticalArc=u,this.ellipticalArcCenter=new THREE.Vector3(a,b,i.z),this.vpIdElliptical=h}},this.snapping2D=function(a){if(a){var d=a.intersectPoint,e=a.fragId;if("undefined"!=typeof e){Array.isArray(e)||(e=[e]),q=d,i=this.setDetectRadius(d);for(var f=new b(c,this),g=0;g<e.length;++g){var h=c.impl.getRenderProxy(c.model,e[g]),j=new Autodesk.Viewing.Private.VertexBufferReader(h.geometry);j.enumGeomsForObject(a.dbId,f)}f.circularArc?(d.distanceTo(f.circularArc.vertices[0])<i?(n=f.circularArc.vertices[0],this.drawPoint(n),p=SNAP_VERTEX):d.distanceTo(f.circularArc.vertices[f.circularArc.vertices.length-1])<i?(n=f.circularArc.vertices[f.circularArc.vertices.length-1],this.drawPoint(n),p=SNAP_VERTEX):(this.lineStripToPieces(f.circularArc),m=f.circularArc,this.drawLine(m),v=f.circularArcCenter,w=f.circularArcRadius,p=SNAP_CIRCULARARC),u=f.vpIdCircular,t=!0):f.ellipticalArc?(d.distanceTo(f.ellipticalArc.vertices[0])<i?(n=f.ellipticalArc.vertices[0],this.drawPoint(n),p=SNAP_VERTEX):d.distanceTo(f.ellipticalArc.vertices[f.ellipticalArc.vertices.length-1])<i?(n=f.ellipticalArc.vertices[f.ellipticalArc.vertices.length-1],this.drawPoint(n),p=SNAP_VERTEX):(this.lineStripToPieces(f.ellipticalArc),m=f.ellipticalArc,this.drawLine(m),v=f.ellipticalArcCenter,w=null,p=SNAP_CIRCULARARC),u=f.vpIdElliptical,t=!0):f.lineGeom.vertices.length&&(d.distanceTo(f.lineGeom.vertices[0])<i?(n=f.lineGeom.vertices[0],this.drawPoint(n),p=SNAP_VERTEX):d.distanceTo(f.lineGeom.vertices[1])<i?(n=f.lineGeom.vertices[1],this.drawPoint(n),p=SNAP_VERTEX):(m=f.lineGeom,this.drawLine(m),p=SNAP_EDGE),u=f.vpIdLine,t=!0)}}},this.lineStripToPieces=function(a){for(var b=a.vertices,c=b.length-2;c>0;c--)b.splice(c,0,b[c])},this.createOverlay=function(a){c.impl.createOverlayScene(a)},this.addOverlay=function(a,b){c.impl.addOverlay(a,b)},this.clearOverlay=function(){c.impl.overlayScenes[f]&&c.impl.clearOverlay(f),c.impl.overlayScenes[g]&&c.impl.clearOverlay(g),c.impl.overlayScenes[h]&&c.impl.clearOverlay(h)},this.drawFace=function(a){this.createOverlay(f);var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=new THREE.Mesh(a,d,!0);this.addOverlay(f,e)},this.cylinderMesh=function(a,b,c){var d=(new THREE.Vector3).subVectors(b,a),e=new THREE.Matrix4;e.lookAt(a,b,(new THREE.Object3D).up),e.multiply((new THREE.Matrix4).set(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1));var f=new THREE.CylinderGeometry(.5,.5,d.length(),8,1,!0),g=new THREE.Mesh(f,c);return g.applyMatrix(e),g.position.x=(b.x+a.x)/2,g.position.y=(b.y+a.y)/2,g.position.z=(b.z+a.z)/2,g},this.drawLine=function(a){this.createOverlay(h);for(var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=0;e<a.vertices.length;e+=2){var f=this.cylinderMesh(a.vertices[e],a.vertices[e+1],d);this.setEdgeScale(f),this.addOverlay(h,f)}},this.drawArc=function(a){this.createOverlay(h);for(var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1,side:THREE.DoubleSide}),e=0;e<a.vertices.length-1;e++){var f=this.cylinderMesh(a.vertices[e],a.vertices[e+1],d);this.setEdgeScale(f),this.addOverlay(h,f)}},this.drawPoint=function(a){this.createOverlay(g);var b=52224,c=.5,d=new THREE.MeshPhongMaterial({color:b,ambient:b,opacity:c,transparent:!0,depthTest:!1,depthWrite:!1}),e=new THREE.Mesh(new THREE.SphereGeometry(1),d);e.position.set(a.x,a.y,a.z),this.setPointScale(e),this.addOverlay(g,e)},this.setScale=function(a){var b=5,d=c.navigation,e=d.getCamera(),f=d.getEyeVector(),g=d.getPosition(),h=a.position.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):d.getEyeVector().length(),j=d.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=d.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.setPointScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.y=b,a.scale.z=b},this.setEdgeScale=function(a){var b=this.setScale(a);a.scale.x=b,a.scale.z=b},this.updatePointScale=function(){var a=c.impl.overlayScenes[g];if(a)for(var b=a.scene,d=0;d<b.children.length;d++){var e=b.children[d];e&&this.setPointScale(e)}},this.updateEdgeScale=function(){var a=c.impl.overlayScenes[h];if(a)for(var b=a.scene,d=0;d<b.children.length;d++){var e=b.children[d];e&&this.setEdgeScale(e)}},this.setDetectRadius=function(a){var b=10,d=c.navigation,e=d.getCamera(),f=d.getEyeVector(),g=d.getPosition(),h=a.clone(),i=e.isPerspective?h.sub(g).dot(f.normalize()):d.getEyeVector().length(),j=d.getVerticalFov(),k=2*i*Math.tan(THREE.Math.degToRad(.5*j)),l=d.getScreenViewport(),m=window.devicePixelRatio||1,n=b*k/(l.height*m);return n},this.drawIntersectFace=function(a,b,c,d){this.createOverlay();var e=new THREE.Vector3;e.set(b[a.a*c],b[a.a*c+1],b[a.a*c+2]);var f=new THREE.Vector3;f.set(b[a.b*c],b[a.b*c+1],b[a.b*c+2]);var g=new THREE.Vector3;g.set(b[a.c*c],b[a.c*c+1],b[a.c*c+2]);var h=new THREE.Geometry;h.vertices.push(e),h.vertices.push(f),h.vertices.push(g),h.faces.push(new THREE.Face3(0,1,2));var i=new THREE.Mesh(h,d.material,!0);i.matrixWorld=d.matrixWorld,this.addOverlay(i)},this.handleWheelInput=function(a){return this.updatePointScale(),this.updateEdgeScale(),!1},this.handleButtonDown=function(a,b){return s=!0,!1},this.handleButtonUp=function(a,b){return s=!1,!1},this.handleMouseMove=function(a){if(!s){this.clearOverlay(),l=null,m=null,n=null,t=!1;var b=c.impl.snappingHitTest(a.canvasX,a.canvasY,!1);b&&b.intersectPoint&&(b.face?this.snapping3D(b):this.snapping2D(b))}return!1},this.destroy=function(){this.clearOverlay(),c.impl.removeOverlayScene(f),c.impl.removeOverlayScene(g),c.impl.removeOverlayScene(h)}},function(){AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool=function(a){function b(a){if(p)return!1;var b=a.ctrlKey||d&&a.metaKey,c=a.metaKey&&!d;return b||c||a.shiftKey||a.altKey}var c,d=-1!=navigator.userAgent.search("Mac OS"),e=a.navigation,f=a.container,g=e.getCamera(),h=["firstperson"],i={SHIFT:0,ALT:0,CONTROL:0},j=Autodesk.Viewing.theHotkeyManager.KEYCODES,k=!1,l=!1,m=!0,n=!1,o=0,p=null,q=new THREE.Clock(!0),r=-1,s=5e3,t=1,u=1,v=2,w=2,x=1,y=.5,z=.0035,A=0,B=0,C=0,D=-1e20,E=0,F=0,G=-1e20,H=0,I=0,J=!1,K=!1,L=!1,M=!1,N=!1,O=!1,P=g.fov,Q=!1,R=g.isPerspective,S=!1,T=!1;(navigator.getGamepads||navigator.webkitGetGamepads||navigator.webkitGamepads)&&(c=new Autodesk.Viewing.Extensions.GamepadModule(a)),this.isActive=function(){return k},this.getNames=function(){return h},this.getName=function(){return h[0]},this.activate=function(b){q.start(),R=g.isPerspective,e.toPerspective(),P=g.fov,e.setVerticalFov(75,!0),t=a.model.getUnitScale();var d=a.model.getBoundingBox().size();u=Math.max(Math.min(Math.min(d.x,d.y),d.z)/10,1e-4),a.canvas.focus(),k=!0,T||X(),addCrosshair(),c&&c.activate(this.getName())},
this.deactivate=function(a){k=!1,q.stop(),V(),removeCrosshair(),Q&&e.setVerticalFov(P,!0),S&&(R||e.toOrthographic()),c&&c.deactivate()},this.getCursor=function(){return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3goOFQoQszohGAAAA9hJREFUSMedll1oHGUUhp8zuzP5291pEvNTomgVjFCCCa0NpAqJEJTUFVv8uWxQLwKCF6IUr7wJ6J30QvBCAlZssA0EkYJaAm1FwU3iakrbVNNuutlukk3dzWyT/ZnJ7ufFTtokbmvX72Y45+N73/Oe8858I+xYSikBJJFI7AmFQh9alvVWoVC47vP5ho4cOXJeRGwqWN4yOQ2oHh0dPROJRNo7OjqIRCKPRxeiP66srBxSSn0vIsX/RaCU0gDV399vNjQ0tB8/fpxAIEAsFuP06dPEYrFvgHqguEMxIqLKdUPbmnArU52dnb2maWJUGeRyOWzbpqGxgXg87gOMncDlwLe2Y5uCwcHBFp/P90k4PE349xkWolGi0SjhPy5hF+UmIEopz/1AtxRcqmJzDQ8P7750+Wq8e9+TPGLe4sSp39jz9LMsxm/izE6gOVnquoIcOHDgnddfe/VEU3PLWkUzSCQSesCzxNtvHKZu11O0137OuTMneYY1+l+px99sci5zgU+/Pv/Z5OTkWeCvigja2tqqri3/RPbiMfSWLvY+/wJ7XwxCOoyz+gPF5C0OzsFZv8NEOOxU7KL5+fkcooFUo9avYt+4htTU43noJVTmIPYvp8hnChSKCr/fr1VMkEqlCgEATUDTAIVykhSWRtj4M4/KKzZ9Z9u2ehCCbVUYhlEaurg7m09NB/GWYhe2r69vV8UEvb29DeIWL+6uIG6w6b1SGAqF0hUTZDKZ7GLKy1w0h+Z1keQuMEDOKbK+oZFIJOyKZqCUEsuy/k4mk6kr0ZH6/Z2CkrttEl1QjuJkKI3z6KGp6vTFpYoVmKaZ9Xg8lleDoq3IzOdBILuygbVgs2YVSNrgOM7o1NTURkUE7qufX15evo5A0VHcnrNRgFgFJF6gsVmntlaIxWKNIlK/s8D/VCAianZ29spmv0vfVoVuaNT6PYhWMpGIGIZhNAGtQC3bbXDfj51YlrWObHeOKu3didfX1x3btgGqgADgu5eafyXT6XT2zmDLnVDg9Xq9uq573fMeQAeqy+HtTAgguq7h0aUsgyZCJpPZcBxnE1xz3fhACqp7enoe+3ZimVg8j6ELiIACEUETWErnsCwrD2h1dXW6C+4A2a033T0VfPD+e8dePvoFb36sM/LzKomkQ1FgMW3z7neL3Gh6jtbW1rmamhrDNM0NYAVIAYWyl06ZPwoNeHh6evqJmZmZiV8vnCBw+yLRRCv7gkdpamr6aGho6KuBgQFnfHx88V7AZQlcEt01jgD+sbGx3V+OjPR07d8fDQaDl1OpVLK7u9swTXP1Qa7NfwCi46BIaoRmhAAAAABJRU5ErkJggg==), auto"},this.adjustSpeed=function(a){0===a?w=v:(w*=a>0?1.1:.9,.01>w&&(w=.01))},this.handleGesture=function(a){switch(a.pointers&&a.pointers.length>0&&(a.pageX=a.pointers[0].pageX,a.pageY=a.pointers[0].pageY),a.type){case"dragstart":return p="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===p?this.handleMouseMove(a):!1;case"dragend":return"drag"===p?(this.handleButtonUp(a,0),p=null,!0):!1}return!1},this.handleSingleClick=function(a,b){return!1},this.handleButtonDown=function(a,c){V(),o+=1<<c;var d=b(a);return 0!==c||d?!0:(B=a.pageX-window.innerWidth/2,E=a.pageY-window.innerHeight/2,D=a.pageX,G=a.pageY,H=I=0,C=F=0,n=!0,!0)},this.handleMouseMove=function(a){var b=-1e10>D?0:a.pageX-D,c=-1e10>G?0:a.pageY-G;return D=a.pageX,G=a.pageY,n!==m||l||(H+=b*z,I+=c*z),!0},this.handleButtonUp=function(a,b){return o-=1<<b,0===b&&n?(H=I=0,C=F=0,n=!1,!0):!0},this.handleKeyDown=function(a,b){if(l)return!1;V();var c=!1,d=!1;switch(b){case j.ESCAPE:break;case j.TAB:d=!1;break;case j.SHIFT:i.SHIFT=1,c=d=!0;break;case j.CONTROL:i.CONTROL=1,c=d=!0;break;case j.ALT:i.ALT=1,c=d=!0;break;case j.SPACE:i.SPACE=1,c=d=!0;break;case j.EQUALS:this.adjustSpeed(1),d=!0;break;case j.DASH:this.adjustSpeed(-1),d=!0;break;case j.ZERO:this.adjustSpeed(0),d=!0;break;case j.UP:case j.w:J=!0,d=!0;break;case j.LEFT:case j.a:L=!0,d=!0;break;case j.DOWN:case j.s:K=!0,d=!0;break;case j.RIGHT:case j.d:M=!0,d=!0;break;case j.q:N=!0,d=!0;break;case j.e:O=!0,d=!0;break;case j.g:d=!0;break;case j.F1:d=!0}return d},this.handleKeyUp=function(a,b){if(l)return!1;var c=!1,d=!1;switch(b){case j.TAB:d=!1;break;case j.SHIFT:i.SHIFT=0,c=d=!0;break;case j.CONTROL:i.CONTROL=0,c=d=!0;break;case j.ALT:i.ALT=0,c=d=!0;break;case j.SPACE:i.SPACE=0,c=d=!0;break;case j.UP:case j.w:J=!1,d=!0;break;case j.LEFT:case j.a:L=!1,d=!0;break;case j.DOWN:case j.s:K=!1,d=!0;break;case j.RIGHT:case j.d:M=!1,d=!0;break;case j.q:N=!1,d=!0;break;case j.e:O=!1,d=!0;break;case j.g:C=F=0,m=!m,W(m),d=!0;break;case j.F1:X(),d=!0}return d},this.handleWheelInput=function(a){return l?!1:(e.getReverseZoomDirection()&&(a*=-1),A+=a,!0)},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleBlur=function(a){return J=K=!1,L=M=!1,N=O=!1,!1},this.update=function(){if(!k)return!1;var a=q.getDelta();if(r>-1){var b=(new Date).getTime();b-r>s&&V()}g.isPerspective||(console.log("Lost perspective mode: resetting view."),e.toPerspective());var d=g.clone(),f=a*w*u*(1===i.SHIFT?4:1),h=a*y*u*(1===i.SHIFT?4:1);if(0!=A){var j=A*x*u*(1===i.SHIFT?4:1);d.translateZ(-j),A=0}J&&d.translateZ(-f),K&&d.translateZ(f),L&&d.translateX(-f),M&&d.translateX(f),N&&d.translateY(h),O&&d.translateY(-h);var l=d.position,m=0!==l.distanceToSquared(g.position),n=d.target,o=g.target.clone().sub(g.position),p=o.clone().cross(g.up).normalize();if(0!=I){var t=new THREE.Quaternion;t.setFromAxisAngle(p,-I);var v=o.clone();v.applyQuaternion(t);var z=g.worldup.clone(),B=v.angleTo(z),C=THREE.Math.degToRad(5);B>=C&&B<=Math.PI-C&&(o.applyQuaternion(t),d.up.applyQuaternion(t)),I=0}if(0!=H){var D=new THREE.Quaternion;D.setFromAxisAngle(g.worldup,-H),o.applyQuaternion(D),d.up.applyQuaternion(D),H=0}n=l.clone().add(o);var E=0!==n.distanceToSquared(g.target);return(m||E)&&(e.setView(l,n),e.orientCameraUp()),c&&(g=c.update(g)),g.dirty};var U=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage&&(Autodesk.Viewing.Private.HudMessage.displayMessage(f,a,c,d,e),b>0?(r=(new Date).getTime(),s=b):(r=-1,s=0))},V=function(){Autodesk.Viewing.Private.HudMessage&&Autodesk.Viewing.Private.HudMessage.dismiss(),r=-1},W=function(a){V();var b={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:a?"Press the primary mouse button and drag to change the view orientation":"Move the cursor to change the view orientation"};U(b,0)},X=function(){V();var a={msgTitleKey:"First Person Tool",messageKey:"First Person Tool",messageDefaultValue:"Use the WASD and QE keys to move",checkboxChecked:T};U(a,0,null,null,function(a){T=a.target.checked})};addCrosshair=function(){"function"==typeof stringToDOM&&(this.crosshair=stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>f'),a.canvasWrap.appendChild(this.crosshair))},removeCrosshair=function(){this.crosshair&&this.crosshair.parentNode&&this.crosshair.parentNode.removeChild(this.crosshair)}}}(),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FirstPerson"),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.constructor=Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension,Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.load=function(){var a=this,b=this.viewer,c=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.FirstPerson.FirstPersonTool(b),b.toolController.registerTool(this.tool),this.createUI(),this.onToolChanged=function(b){if(-1!==b.toolName.indexOf("firstperson")&&a.firstPersonToolButton){var d=b.active?c.Button.State.ACTIVE:c.Button.State.INACTIVE;a.firstPersonToolButton.setState(d)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.createUI=function(){var a=this.viewer;if(a.getToolbar){var b=this,c=Autodesk.Viewing.UI,d=a.getToolbar(!0),e=d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.firstPersonToolButton=new c.Button("toolbar-firstPersonTool"),this.firstPersonToolButton.setToolTip("First person"),this.firstPersonToolButton.onClick=function(d){var e=b.firstPersonToolButton.getState();e===c.Button.State.INACTIVE?a.setActiveNavigationTool("firstperson"):e===c.Button.State.ACTIVE&&a.setActiveNavigationTool()},this.firstPersonToolButton.setIcon("adsk-icon-first-person");var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.firstPersonToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.firstPersonToolButton)}},Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension.prototype.unload=function(){var a=this.viewer;if(a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.firstPersonToolButton){var b=a.getToolbar(!1);b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.firstPersonToolButton.getId()),this.firstPersonToolButton=null}return a.getActiveNavigationTool()==this.tool.getName()&&a.setActiveNavigationTool(),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.FirstPerson",Autodesk.Viewing.Extensions.FirstPerson.FirstPersonExtension)}(),AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRTool=function(a,b){var c=a.navigation,d=a.container,e=c.getCamera(),f=["vr"],g=!1,h=null,i=!1,j=!0,k=!1,l={SHIFT:0,ALT:0,CONTROL:0},m=Autodesk.Viewing.theHotkeyManager.KEYCODES,n=0,o=!1,p=!1,q=!1,r=!1,s=!1,t=!1,u=!1,v=new THREE.Clock(!0),w=-1,x=5e3,y=1,z=16,A=15,B=3,C=!1,D=1.75,E=16,F=15,G=(e.fov,e.isPerspective),H=null,I=null,J=null,K=!1,L=-1,M=!0,N=null,O=null,P=.15,Q=!1,R=new THREE.Vector3(0,0,0),S=new THREE.Vector3(0,0,0),T=!1;Math.PI/2;this.isActive=function(){return g},this.getNames=function(){return f},this.getName=function(){return f[0]},this.activate=function(b){if(!g){i=e.worldup&&1===e.worldup.x,j=e.worldup&&1===e.worldup.y,k=e.worldup&&1===e.worldup.z,console.log("VRTool : camera world up = "+e.worldup.x+","+e.worldup.y+","+e.worldup.z),v.start(),X()?(fa(),U(!1),console.log("VR Supported (Web API): Oculus, etc.")):(ea(),window.addEventListener("deviceorientation",_,!0));var c=a.config&&a.config.useVR?a.config.useVR:"";T="wearality"===c.toLowerCase(),V(!0);var d=a.utilities.getBoundingBox(!0).size();y=Math.max(Math.min(Math.min(d.x,d.y),d.z)/100,1),this.resetPointerTracking(),a.canvas.focus(),ca(),g=!0}},this.deactivate=function(a){g&&(g=!1,ba(),H&&(J&&(J.stop(),J=null),H.disconnect(),H=null,I&&I.disable()),V(!1),exitFullscreen(),v.stop(),U(!0))},this.getCursor=function(){return"url(data:image/gif;base64,R0lGODlhGAAYAMIDAAQEBH19feDg4P///////////////////yH+EUNyZWF0ZWQgd2l0aCBHSU1QACH5BAEKAAQALAAAAAAYABgAAAMqSLrc/jDKSau9OOvN8fjDNghBIITZEABAgHpr+15jeYpgp+987//AICEBADs=), auto"};var U=function(a){var b=document.getElementsByClassName("toolbar-menu");b.length>0&&""!==b[0]&&(b[0].style.display=a?"block":"none")},V=function(b){if(b!==!!h)if(console.log("Enable Render Context: "+b),b){a.displayViewCube(!1,!1),G=a.navigation.isPerspective,G||a.navigation.toPerspective();var c=!!N,d=null;if(T){var e=.075;d={useWarp:c,HMD:{hResolution:1920,vResolution:1080,hScreenSize:.12576,vScreenSize:.07074,interpupillaryDistance:e,lensSeparationDistance:e,eyeToScreenDistance:.041,distortionK:[1,.22,.24,0],chromaAbParameter:[.996,-.004,1.014,0]}}}else d={useWarp:c};h=new Autodesk.Viewing.Extensions.Oculus.StereoRenderContext(d),a.impl.setUserRenderContext(h),a.resize(a.canvas.clientWidth,a.canvas.clientHeight),N?launchFullscreen(a.impl.canvas,{vrDisplay:N}):launchFullscreen(a.impl.canvas)}else h=null,a.impl.setUserRenderContext(null),a.setScreenMode(Autodesk.Viewing.ScreenMode.kNormal),a.displayViewCube(a.prefs.get("viewCube"),!1)};this.handleSingleTap=function(b){if(H&&b.pointers){if(1===b.pointers.length)return setTimeout(function(){a.setActiveNavigationTool(a.defaultNavigationToolName)},10),!0;if(2===b.pointers.length)return W(),!0}return!1},this.handleDoubleTap=function(a){return!1},this.handlePressHold=function(a){return!1},this.handleGesture=function(a){if(H)switch(a.type){case"dragstart":u=!0;break;case"dragmove":break;case"dragend":u=!1}return!1},this.handleKeyDown=function(a,b){var c=!1,d=!1;switch(b){case m.TAB:d=!0;break;case m.SHIFT:l.SHIFT=1,c=!0,d=!0;break;case m.CONTROL:l.CONTROL=1,c=!0,d=!0;break;case m.ALT:l.ALT=1,c=!0,d=!0;break;case m.SPACE:d=!0;break;case m.EQUALS:this.adjustSpeed(1),d=!0;break;case m.DASH:this.adjustSpeed(-1),d=!0;break;case m.ZERO:this.adjustSpeed(0),d=!0;break;case m.w:if(1===l.CONTROL&&1===l.SHIFT){d=!0;break}case m.UP:o=!0,d=!0;break;case m.LEFT:case m.a:q=!0,d=!0;break;case m.DOWN:case m.s:p=!0,d=!0;break;case m.RIGHT:case m.d:r=!0,d=!0;break;case m.q:t=!0,d=!0;break;case m.e:s=!0,d=!0;break;case m.h:d=!0}return d},this.handleKeyUp=function(a,b){var c=!1,d=!1;switch(b){case m.SHIFT:l.SHIFT=0,c=!0;break;case m.CONTROL:l.CONTROL=0,c=!0;break;case m.ALT:l.ALT=0,c=!0;break;case m.SPACE:N&&Z(),d=!0;break;case m.w:if(!o&&1===l.CONTROL&&1===l.SHIFT){setTimeout(function(){V(!1),T=!T,V(!0)},10),d=!0;break}case m.UP:o=!1,d=!0;break;case m.LEFT:case m.a:q=!1,d=!0;break;case m.DOWN:case m.s:p=!1,d=!0;break;case m.RIGHT:case m.d:r=!1,d=!0;break;case m.q:t=!1,d=!0;break;case m.e:s=!1,d=!0;break;case m.h:ca(),d=!0}return d},this.handleBlur=function(a){return o=!1,p=!1,q=!1,r=!1,!1},this.update=function(a){if(g){var b=v.getDelta();if(w>-1){var d=(new Date).getTime();d-w>x&&ba()}var f=!1;N&&Y(b)?f=!0:H&&$(b)&&(f=!0);var h=e.clone(),i=b*z*y*(1===l.SHIFT?4:1),j=b*A*y*(1===l.SHIFT?4:1);if(0!=n){var k=n*B*y*(1===l.SHIFT?4:1);h.translateZ(-k),n=0}var m=!1,u=!1,D=!1,E=!1;C&&(m=!0),(o||m)&&h.translateZ(-i),(p||u)&&h.translateZ(i),(q||D)&&h.translateX(-i),(r||E)&&h.translateX(i),s&&h.translateY(j),t&&h.translateY(-j);var F=h.position,G=0!==F.distanceToSquared(e.position);if(G){var I=h.target,J=F.clone().sub(e.position);I.add(J),c.setView(F,I)}return e.dirty}},this.resetPointerTracking=function(){o=p=!1,q=r=!1,s=t=!1,_mouseDraggingLookMode=!1};var W=function(){return C=!C,C?(E=z,z=D,L=(new Date).getTime()):z=E,da(C),C},X=function(){function a(a){for(var c=0;c<a.length;++c)a[c]instanceof HMDVRDevice&&(N=a[c]);for(var c=0;c<a.length;++c)a[c]instanceof PositionSensorVRDevice&&(!N||a[c].hardwareUnitId==N.hardwareUnitId)&&(O=a[c],b=!0)}var b=!1;return navigator.getVRDevices?navigator.getVRDevices().then(a):navigator.mozGetVRDevices?navigator.mozGetVRDevices(a):b=!1,b},Y=function(a){if(!O)return!1;var b=O.getState();if(e){if(k?(S.x=b.position.x,S.y=-b.position.z,S.z=b.position.y):(S.x=b.position.x,S.y=b.position.y,S.z=b.position.z),Q){var c=R.distanceTo(S);if(c>=P){var d=(c-P)/.0762,f=a*z*y*d,g=S.clone().sub(R).normalize().multiplyScalar(f);e.position.add(g)}}k?(e.quaternion.x=b.orientation.x,e.quaternion.y=-b.orientation.z,e.quaternion.z=b.orientation.y,e.quaternion.w=b.orientation.w):(e.quaternion.x=b.orientation.x,e.quaternion.y=b.orientation.y,e.quaternion.z=b.orientation.z,e.quaternion.w=b.orientation.w);var h=new THREE.Vector3(0,0,-1);k&&(h=new THREE.Vector3(h.x,-h.z,h.y)),h.applyQuaternion(e.quaternion),e.target=e.position.clone().add(h.clone().multiplyScalar(10)),e.dirty=!0}return!0},Z=function(){N&&(Q=!Q,Q&&R.copy(S),da(Q))},$=function(a){if(!H)return!1;var b=H.update();if(!b)return!1;if(k){var d=b.z;b.z=b.y,b.y=-d}var f=k?new THREE.Vector3(0,1,0):new THREE.Vector3(0,0,-1),g=f.clone().applyQuaternion(b),h=e.target.clone().sub(e.position).length();if(c.setTarget(e.position.clone().add(g.multiplyScalar(h))),J){if(J.isStarted())if(0>=L)J.checkVideoThreshold(F)&&W();else{var i=J.checkVideoThreshold(F);if(i){if(C){var j=(new Date).getTime(),l=j-L;l>250&&(L=j,z+=E,da(!0))}}else L=-1}}else{var m=k?new THREE.Vector3(0,0,-1):new THREE.Vector3(0,-1,0),n=THREE.Math.radToDeg(g.angleTo(m));if(30>n)if(K){if(C){var j=(new Date).getTime(),l=j-L,o=M?1500:1e3;l>=o&&(M=!1,L=j,z+=E,da(!0))}}else W(),K=!0,C&&(M=!0);else n>=30&&(K=!1,L=-1)}return e.dirty=!0,!0},_=function(a){return a.alpha?(window.removeEventListener("deviceorientation",_,!0),H=new THREE.DeviceOrientationControls,H.connect(),I||(I=new window.NoSleep,I.enable()),J=new VideoHelper("videoVR","videoVR-canvas",1),J.start()||(J=null,console.log("VideoHelper : Failed to start.")),U(!1),console.log("VR Supported (DeviceOrientation): Google Goggles, etc."),!0):!1},aa=function(a,b){Autodesk.Viewing.Private.HudMessage.dismiss(),Autodesk.Viewing.Private.HudMessage.displayMessage(d,a),w=(new Date).getTime(),(!b||0>=b)&&(b=5e3),x=b},ba=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),w=-1},ca=function(){var a={msgTitleKey:"Virtual Reality Tool",messageKey:"Virtual Reality Tool",messageDefaultValue:"This is the Virtual Reality tool"};aa(a,3e3)},da=function(a,b){(!b||0>=b)&&(b=250);var c=Autodesk.Viewing.i18n.translate("START Auto Move"),d=Autodesk.Viewing.i18n.translate("STOP Auto Move"),e=a?c+" ("+Math.floor(z)+")":d,f={msgTitleKey:"VR Toggle Move",messageKey:"VR Toggle Move",messageDefaultValue:e};aa(f,b)},ea=function(){var a={msgTitleKey:"VR Device Orientation",messageKey:"VR Device Orientation",messageDefaultValue:"VR Mode Enabled Device Orientation"};aa(a,2e3)},fa=function(){var a={msgTitleKey:"VR Head Mounted Display",messageKey:"VR Head Mounted Display",messageDefaultValue:"VR Mode Enabled Head Mounted Display"};aa(a,2e3)}},AutodeskNamespace("Autodesk.Viewing.Extensions.VR"),Autodesk.Viewing.Extensions.VR.VRExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.VR.VRExtension.prototype.constructor=Autodesk.Viewing.Extensions.VR.VRExtension,Autodesk.Viewing.Extensions.VR.VRExtension.prototype.load=function(){var a=this,b=this.viewer,c=b.getToolbar(!0),d=Autodesk.Viewing.UI;return this.tool=new Autodesk.Viewing.Extensions.VR.VRTool(b,this),b.toolController.registerTool(this.tool),this.createUI(c),this.onToolChanged=function(b){if(-1!==b.toolName.indexOf("vr")){var c=b.active?d.Button.State.ACTIVE:d.Button.State.INACTIVE;a.vrToolButton.setState(c)}},b.addEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),!0},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.createUI=function(a){var b=this,c=this.viewer,d=Autodesk.Viewing.UI,e=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);this.vrToolButton=new d.Button("toolbar-vrTool"),this.vrToolButton.setToolTip("Virtual Reality Tool"),this.vrToolButton.setIcon("toolbar-vrToolButton"),this.vrToolButton.onClick=function(a){var e=b.vrToolButton.getState();e===d.Button.State.INACTIVE?c.setActiveNavigationTool("vr"):e===d.Button.State.ACTIVE&&c.setActiveNavigationTool()};var f=e.getControl("toolbar-cameraSubmenuTool");f?e.addControl(this.vrToolButton,{index:e.indexOf(f.getId())}):e.addControl(this.vrToolButton)},Autodesk.Viewing.Extensions.VR.VRExtension.prototype.unload=function(){var a=this.viewer;a.removeEventListener(Autodesk.Viewing.TOOL_CHANGE_EVENT,this.onToolChanged),this.onToolChanged=void 0,Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID);var b=a.getToolbar(!1);return b&&b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID).removeControl(this.vrToolButton.getId()),this.vrToolButton=null,a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.VR",Autodesk.Viewing.Extensions.VR.VRExtension),function(){"use strict";AutodeskNamespace("Autodesk.Viewing.Extensions.FusionOrbit");var a=Autodesk.Viewing,b=a.UI,c=a.Extensions.FusionOrbit,d=function(b,c){a.Extension.call(this,b,c)};d.prototype=Object.create(a.Extension.prototype),d.prototype.constructor=d,d.prototype.load=function(){function b(){e.removeEventListener(a.TOOLBAR_CREATED_EVENT,b),d.createUI()}var d=this,e=this.viewer,f=e.getToolbar?e.getToolbar(!0):void 0;if(this.tool=new c.FusionOrbitTool,this.tool.setViewer(e),e.toolController.registerTool(this.tool),f){var g=f.getControl(a.TOOLBAR.MODELTOOLSID);g&&g.getNumberOfControls()>0?b():e.addEventListener(a.TOOLBAR_CREATED_EVENT,b)}else e.addEventListener(a.TOOLBAR_CREATED_EVENT,b);return!0},d.prototype.createUI=function(){var c=this.viewer,d=c.getToolbar(!1),e=d.getControl(a.TOOLBAR.NAVTOOLSID);this.classicBehavior={},this.classicBehavior.orbitOnClick=e.orbitbutton.onClick,this.classicBehavior.freeorbitOnClick=e.freeorbitbutton.onClick,this.classicBehavior.returnToDefault=e.returnToDefault,e.freeorbitbutton.onClick=function(a){var d=e.freeorbitbutton.getState();d===b.Button.State.INACTIVE?(c.setActiveNavigationTool("fusion orbit"),e.freeorbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.setActiveNavigationTool(),e.freeorbitbutton.setState(b.Button.State.INACTIVE))},e.orbitbutton.onClick=function(a){var d=e.orbitbutton.getState();d===b.Button.State.INACTIVE?(c.setActiveNavigationTool("fusion orbit constrained"),e.orbitbutton.setState(b.Button.State.ACTIVE)):d===b.Button.State.ACTIVE&&(c.setActiveNavigationTool(),e.orbitbutton.setState(b.Button.State.INACTIVE))},e.returnToDefault=function(){e.orbittoolsbutton.setState(b.Button.State.ACTIVE),e.orbittoolsbutton.setState(b.Button.State.INACTIVE)},e.orbittoolsbutton.setState(b.Button.State.INACTIVE),c.prefs.fusionOrbitConstrained?(e.orbittoolsbutton.onClick=e.orbitbutton.onClick,e.orbittoolsbutton.setIcon(e.orbitbutton.iconClass),c.setDefaultNavigationTool("orbit")):(e.orbittoolsbutton.onClick=e.freeorbitbutton.onClick,e.orbittoolsbutton.setIcon(e.freeorbitbutton.iconClass),c.setDefaultNavigationTool("freeorbit")),c.setActiveNavigationTool(),e.returnToDefault()},d.prototype.unload=function(){var c=this.viewer,d=c.getToolbar(!1),e=d.getControl(a.TOOLBAR.NAVTOOLSID);return e&&(e.orbitbutton&&(e.orbitbutton.onClick=this.classicBehavior.orbitOnClick),e.freeorbitbutton&&(e.freeorbitbutton.onClick=this.classicBehavior.freeorbitOnClick),e.returnToDefault=this.classicBehavior.returnToDefault,e.orbittoolsbutton&&(e.orbittoolsbutton.onClick=e.orbitbutton.onClick,e.orbittoolsbutton.setIcon("adsk-icon-orbit-constrained"),e.orbittoolsbutton.setState(b.Button.State.ACTIVE))),c.setActiveNavigationTool("orbit"),c.setDefaultNavigationTool("orbit"),c.toolController.deregisterTool(this.tool),this.tool.setViewer(null),this.tool=null,!0},c.FusionOrbitExtension=d,a.theExtensionManager.registerExtension("Autodesk.Viewing.FusionOrbit",d)}(),Autodesk.Viewing.Extensions.FusionOrbit.html=['<div class="orbit-gizmo noselect">','<div class="outside"></div>','<div class="ring"></div>','<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="layout-mid">','<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>",'<div class="circle">','<div class="crosshair-area">','<div class="crosshair-v"></div>','<div class="crosshair-h"></div>',"</div>","</div>",'<div class="layout-ver">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>",'<div class="layout-hor">','<div class="edgemark-area"><div class="edgemark"></div></div>',"</div>","</div>"].join("\n"),Autodesk.Viewing.Extensions.FusionOrbit.FusionOrbitTool=function(){var a,b,c,d,e,f,g=["fusion orbit","fusion orbit constrained"],h=.8,i=1.2,j="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAt1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8AAAAzMzP6+vri4uISEhKKioqtra2dnZ2EhIR9fX10dHRkZGQdHR3t7e3Hx8e5ubm1tbWoqKhWVlZKSko4ODgICAjv7+/o6OjMzMyxsbFOTk4pKSkXFxcEBAT29vbW1tZ6enpISEgLCwvhzeX+AAAAGXRSTlMANRO0nHRJHfnskIxQRKh89syDVwTWZjEJxPFEswAAAOFJREFUKM+1j+lygkAQhIflEAJe0Rw9u4CCeKKoSTTX+z9XoMJWWeX+ssrvZ3f19DQ5zOw/0DUMQPlmQ72bE2adBp8/Rp3CQUi3ILx+bxj4fjDs9T1Bmo6bbPPN8aDU4bjJt4nb+de789kSFyxn826jW3ICLNZZKU8nWWbrBTCRVm04U8TpjquRFf1Go0d7l8aYOrUR7FGEFr1S9LGymwthgX2gE/Kl0cHPOtF2xOWZ5QpIC93RflW4InkDoPRXesd5LJIMQPzV7tCMa7f6BvhJL79AVDmYTNQ1NhnxbI/uwB8H5Bjd4zQPBAAAAABJRU5ErkJggg==), auto",k={HORIZONTAL:0,VERTICAL:1,ROLL:2},l={HORIZONTAL:.005,VERTICAL:.005,ROLL:1},m=isTouchDevice(),n=!1,o={buttons:[],src:void 0,x:0,y:0,dx:0,dy:0,firstMove:!0,mode:void 0},p=this;this.setViewer=function(a){this.viewer=a,this.navapi=a?a.navigation:null};var q=function(a){o.buttons[a.touches?0:a.button]=!0,o.src=a.target.className,o.x=0,o.y=0,o.dx=0,o.dy=0,o.firstMove=!0,o.mode=void 0,"ring"===o.src?o.mode=k.ROLL:"edgemark-area"===o.src&&("layout-ver"===a.target.parentNode.className?o.mode=k.HORIZONTAL:"layout-hor"===a.target.parentNode.className&&(o.mode=k.VERTICAL)),x(),a.stopPropagation()},r=function(a){o.buttons[a.touches?0:a.button]=!1,o.src=void 0},s=function(a){o.buttons[0]&&(t(a),u(),o.firstMove=!1)},t=function(a){var b=a.touches?a.touches[0].pageX:a.pageX,c=a.touches?a.touches[0].pageY:a.pageY;o.firstMove||(o.dx=b-o.x,o.dy=c-o.y),o.x=b,o.y=c},u=function(){var a=f.target.clone().sub(f.position).normalize(),c=a.clone().cross(f.up).normalize(),d=c.clone().cross(a).normalize();if(f.up.copy(d),o.mode===k.ROLL){var g=new THREE.Vector3(o.x-b.center.x,o.y-b.center.y,0),h=new THREE.Vector3(o.dx,o.dy,0).add(g);g.normalize(),h.normalize();var i=g.clone().cross(h),j=Math.asin(i.z);f.up.applyAxisAngle(a,-j*l.ROLL)}else{var m,n;o.mode===k.HORIZONTAL?(n=-o.dx*l.HORIZONTAL,e&&(f.up=Autodesk.Viewing.Navigation.snapToAxis(f.up.clone())),m=f.up):o.mode===k.VERTICAL&&(n=-o.dy*l.VERTICAL,e?(o.firstMove&&(f.up=Autodesk.Viewing.Navigation.snapToAxis(f.up.clone())),m=a.clone().cross(f.up).normalize()):m=c,f.up.applyAxisAngle(m,n));var q=p.navapi.getPivotPoint(),r=f.position.clone().sub(q);r.applyAxisAngle(m,n),f.position.addVectors(q,r);var s=f.target.clone().sub(q);s.applyAxisAngle(m,n),f.target.addVectors(q,s)}f.dirty=!0},v=function(){var a=f.target.clone().sub(f.position).normalize(),b=p.viewer.impl.rayIntersect(new THREE.Ray(f.position,a));return b&&b.intersectPoint?b.intersectPoint:f.target},w=function(a,b){var c=b||a.clone().sub(f.position).normalize();return new THREE.Plane(c,-c.x*a.x-c.y*a.y-c.z*a.z)},x=function(){var a=f.target.clone().sub(f.position).normalize(),b=w(f.position,a),c=b.distanceToPoint(f.pivot);f.pivot.copy(a).multiplyScalar(c).add(f.position)},y=function(a){a.touches||0!==a.button||x()},z=function(a){n&&p.viewer.setActiveNavigationTool()},A=function(a,b){var c,d=p.viewer.impl.hitTest(a,b);if(d&&d.intersectPoint)c=d.intersectPoint;else{var e=p.viewer.impl.viewportToRay(p.viewer.impl.clientToViewport(a,b));c=e.intersectPlane(w(f.target))}var g=f.position.clone().sub(v()).add(c);p.navapi.setRequestTransition(!0,g,c,f.fov)};this.register=function(){a=stringToDOM(Autodesk.Viewing.Extensions.FusionOrbit.html),a.style.display="none",this.viewer.canvasWrap.insertBefore(a,this.viewer.canvasWrap.firstChild),c=a.querySelector(".ring"),c.addEventListener("mousedown",q),Array.prototype.forEach.call(a.querySelectorAll(".edgemark-area"),function(a,b){a.addEventListener("mousedown",q),m&&a.addEventListener("touchstart",q)}),window.addEventListener("mouseup",r),window.addEventListener("mousemove",s),d=a.querySelector(".outside"),d.addEventListener("mousedown",z);var b=a.querySelector(".circle");b.addEventListener("mousedown",y),m&&(c.addEventListener("touchstart",q),window.addEventListener("touchend",r),window.addEventListener("touchmove",s),d.addEventListener("touchstart",z),b.addEventListener("touchstart",y)),f=this.viewer.impl.camera},this.deregister=function(){window.removeEventListener("mouseup",r),window.removeEventListener("mousemove",s),d.removeEventListener("mousedown",z),m&&(window.removeEventListener("touchend",r),window.removeEventListener("touchmove",s),d.removeEventListener("touchstart",z)),this.viewer.canvasWrap.removeChild(a),a=void 0,c=void 0,d=void 0},this.activate=function(b){a.style.display="",this.handleResize(),e="fusion orbit constrained"===b,e?(this.viewer.setDefaultNavigationTool("orbit"),this.viewer.prefs.set("fusionOrbitConstrained",!0)):(this.viewer.setDefaultNavigationTool("freeorbit"),this.viewer.prefs.set("fusionOrbitConstrained",!1)),this.viewer.navigation.setZoomTowardsPivot(!0)},this.deactivate=function(b){a.style.display="none",this.viewer.navigation.setZoomTowardsPivot(this.viewer.prefs.zoomTowardsPivot)},this.getNames=function(){return g},this.getName=function(){return g[0]},this.update=function(){return!1},this.handleSingleClick=function(a,b){return A(a.canvasX,a.canvasY),!0},this.handleDoubleClick=function(a,b){return!0},this.handleSingleTap=function(a){return A(a.canvasX,a.canvasY),!0},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){var b,c=this.viewer.impl.canvas.getBoundingClientRect();b=c.width>c.height?new THREE.Vector2(((a.canvasX+.5)/c.width*2-1)*c.width/c.height,2*-((a.canvasY+.5)/c.height)+1):new THREE.Vector2((a.canvasX+.5)/c.width*2-1,(2*-((a.canvasY+.5)/c.height)+1)*c.height/c.width);var e=b.length(),f=e>i;return n!==f&&(f?d.style.cursor="":d.style.cursor=j,n=f),!1},this.handleGesture=function(a){return x(),!1},this.handleBlur=function(a){return!1},this.handleResize=function(){b=a.getBoundingClientRect(),b.center={},b.center.x=b.left+b.width/2,b.center.y=b.top+b.height/2;var d=(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)*h;a.style.width=a.style.height=""+d+"px",a.style.top=a.style.left="calc(50% - "+d/2+"px)",c.style.borderWidth=""+.1*d+"px"}},AutodeskNamespace("Autodesk.Viewing.Private.Collaboration"),function(){function a(a,b,c){function e(b){var c=b.data.msg;if(h.x=c.x1,h.y=c.y1,i.x=c.x2,i.y=c.y2,j=c.explode,c.command)if("gohome"==c.command)h.x=h.y=0,i.x=i.y=0,a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0),k=null;else if("select"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d?a.impl.selector.toggleSelection(d.dbId,d.model):a.impl.selector.clearSelection()}else if("hide"==c.command){var d=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));d&&a.hide(d.dbId)}else if("fly"==c.command)k=k?null:f.target.clone().sub(f.position).normalize();else if("savepoint"==c.command){var c=g.getState(t);r.push(c),alertify.success("Savepoint created.")}else"nextsavepoint"==c.command&&r.length&&(s>=r.length&&(s=0),g.restoreState(r[s++]))}var f,g,h=new THREE.Vector2,i=new THREE.Vector2,j=0,k=null,l=a,m=.02,n=.002,o=.05,p=.01,q=1,r=[],s=0,t={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},u=function(){if(!a.impl.model.is2d()){var b=a.impl.model.getData().bbox.size(),c=b.length();m*=c,n*=c,a.removeEventListener(Autodesk.Viewing.PROGRESS_UPDATE_EVENT,u)}};a.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,u),this.getNames=function(){return["joystick"]},this.getName=function(){return"joystick"},this.activate=function(a){if(b.addEventListener("joystick",e),c.addEventListener("joystick",e),f=l.navigation.getCamera(),l.model){var h=l.model.getBoundingBox();q=.001*h.size().length(),g=new d.ViewerState(l)}},this.deactivate=function(a){b.removeEventListener("joystick",e),c.removeEventListener("joystick",e),f=null,g=null,r.length=0},this.update=function(b){if(f.isPerspective||a.navigation.toPerspective(),k){var c=k.clone().multiplyScalar(n);f.position.add(c),f.target.add(c)}if(0!=j){var d=a.getExplodeScale()+j*p;d>1&&(d=1),0>d&&(d=0),a.explode(d)}if(0==h.x&&0==h.y&&0==i.x&&0==i.y)return!(!k&&!j);var e=f.target.clone().sub(f.position),g=e.length();e.multiplyScalar(1/g);var l=e.clone().cross(f.up).normalize(),q=e.clone().multiplyScalar(h.y*m);f.position.add(q),f.target.add(q);var r=l.clone().multiplyScalar(h.x*m);f.position.add(r),f.target.add(r);var s=new THREE.Quaternion;s.setFromAxisAngle(l,i.y*o);var t=e.clone().applyQuaternion(s);f.up.applyQuaternion(s);var u=new THREE.Quaternion;return u.setFromAxisAngle(f.worldup,-i.x*o),t.applyQuaternion(u),f.up.applyQuaternion(u),t.multiplyScalar(g),f.target.copy(f.position).add(t),k&&k.copy(f.target).sub(f.position).normalize(),!0},this.handleSingleClick=function(a,b){return!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return!1},this.handleDoubleTap=function(a,b){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){
return!1},this.handleButtonUp=function(a,b){return!1},this.handleMouseMove=function(a){return!1},this.handleGesture=function(a,b){return!1},this.handleTouchChange=function(a,b){return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){}}var b=Autodesk.Viewing,c=b.Extensions,d=b.Private,e=b.UI;d.Collaboration;c.RemoteControl=function(c,e){b.Extension.call(this,c,e),this.viewer=c,this.client=d.MessageClient.GetInstance(),this.p2p=new d.P2PClient(this.client),this.controllerTool=new a(c,this.client,this.p2p),c.toolController.registerTool(this.controllerTool)},c.RemoteControl.prototype=Object.create(b.Extension.prototype),c.RemoteControl.prototype.constructor=c.RemoteControl,c.RemoteControl.prototype.createUI=function(){var a=this,b=this.viewer;this.controlButton=new e.Button("toolbar-remoteControlTool"),this.controlButton.setToolTip("Pair with controller device"),this.controlButton.onClick=function(){this.getState()===e.Button.State.INACTIVE?(a.connect(),this.setState(e.Button.State.ACTIVE)):(a.disconnect(),this.setState(e.Button.State.INACTIVE))},this.controlButton.setIcon("adsk-icon-game-controller"),b.modelTools.addControl(this.controlButton),this.panel=new Autodesk.Viewing.UI.DockingPanel(b.container,"remote-panel","Remote Control"),this.panel.width=300,this.panel.height=375,this.panel.container.style.width=this.panel.width+"px",this.panel.container.style.height=this.panel.height+"px",this.panel.container.style.top=(window.innerHeight-this.panel.height)/2+"px",this.panel.container.style.left=(window.innerWidth-this.panel.width)/2+"px",this.panel.body=document.createElement("div"),this.panel.body.classList.add("body"),this.panel.container.appendChild(this.panel.body);var c=Autodesk.Viewing.i18n.translate("Go to this link"),d=Autodesk.Viewing.i18n.translate("Scan the QR code with your device");this.panel.body.innerHTML=["<p>"+c+"</p>",'<p><a class="url" target="_blank" href="#">Link</a></p>',"<p>or</p>","<p>"+d+"</p>",'<img class="qr-img" src="">'].join("\n"),this.panel.link=this.panel.container.querySelector(".url"),this.panel.code=this.panel.container.querySelector(".code"),this.panel.qrImg=this.panel.container.querySelector(".qr-img")},c.RemoteControl.prototype.load=function(){function a(d){b.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),c.createUI()}var b=this.viewer,c=this;return b.modelTools&&b.modelTools.getNumberOfControls()>0?c.createUI():b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,a),!0},c.RemoteControl.prototype.unload=function(){var a=this.viewer;if(this.p2p.hangup(),this.client.disconnect(),a.toolController.deactivateTool(this.controllerTool.getName()),this.panel&&(this.panel.setVisible(!1),this.panel=null),this.controlButton)try{a.modelTools.removeControl(this.controlButton),this.controlButton=null}catch(b){stderr("RemoteControlReceiver - Failed to remove controlButton"),this.controlButton=null}return!0},c.RemoteControl.prototype.addCrosshair=function(){this.crosshair=stringToDOM('<div id="remote-crosshair"><div class="crosshair-v"></div><div class="crosshair-h"></div></div>'),this.viewer.canvasWrap.appendChild(this.crosshair)},c.RemoteControl.prototype.removeCrosshair=function(){this.crosshair&&this.crosshair.remove()},c.RemoteControl.prototype.connect=function(a){if(this.client.isConnected())return void console.log("RemoteControl already connected");var b=this,c=this.viewer;b.client.addEventListener("connectSucceeded",function(c){function e(){i&&i.setVisible(!1),b.p2p.removeEventListener("dataChannelAdded",e),b.addCrosshair()}stderr("connect succeeded");var f=c.data.id+"rc";b.client.join(f);var g=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html?sessionId="+f+"&env="+d.env,h="http://chart.googleapis.com/chart?cht=qr&chs=200x200&choe=UTF-8&chld=H|0&chl="+escape(g),i=b.panel;i&&(i.link.href=g,i.link.innerHTML=(LMV_RESOURCE_ROOT.length?LMV_RESOURCE_ROOT:window.location.origin+"/")+"rc.html",i.qrImg.src=h,i.setVisible(!0)),b.p2p.addEventListener("dataChannelAdded",e),a&&a instanceof Function&&a(g)}),c.navigation.toPerspective(),b.client.connect(),c.toolController.activateTool(b.controllerTool.getName())},c.RemoteControl.prototype.disconnect=function(){this.p2p.hangup(),this.client.disconnect(),this.viewer.toolController.deactivateTool(this.controllerTool.getName()),this.removeCrosshair()},b.theExtensionManager.registerExtension("Autodesk.Viewing.RemoteControl",c.RemoteControl)}(),function(){AutodeskNamespace("Autodesk.Viewing.Extensions.GamepadModule"),Autodesk.Viewing.Extensions.GamepadModule=function(a){function b(){for(var a in G)if(G.hasOwnProperty(a)&&e.buttons[a].pressed&&.5!=e.buttons[a].value)return x[a]=!0,!0;for(var a in x)if(x.hasOwnProperty(a)&&x[a])return!0;return!(Math.abs(e.axes[E.LEFT_STICK_X])<t&&Math.abs(e.axes[E.LEFT_STICK_Y])<t&&Math.abs(e.axes[E.RIGHT_STICK_X])<t&&Math.abs(e.axes[E.RIGHT_STICK_Y])<t)}function c(){for(var a in D)D.hasOwnProperty(a)&&d(D[a])}function d(a){if(e.buttons[a].value>t)switch(x[a]=!0,a){case D.LEFT_SHOULDER:G[a]();break;case D.RIGHT_SHOULDER:G[a]();break;case D.LEFT_TRIGGER:G[a](e.buttons[D.LEFT_TRIGGER].value);break;case D.RIGHT_TRIGGER:G[a](e.buttons[D.RIGHT_TRIGGER].value)}else if(x[a])switch(x[a]=!1,a){case D.SOUTH_BTN:G[a]();break;case D.EAST_BTN:G[a]();break;case D.WEST_BTN:G[a]();break;case D.NORTH_BTN:G[a]();break;case D.NORTH_DPAD:G[a]();break;case D.SOUTH_DPAD:G[a]();break;case D.WEST_DPAD:G[a]();break;case D.EAST_DPAD:G[a]();break;case D.RIGHT_STICK_BUTTON:G[a]();break;case D.LEFT_STICK_BUTTON:G[a]();break;case D.LEFT_TRIGGER:G[a](e.buttons[D.LEFT_TRIGGER].value);break;case D.RIGHT_TRIGGER:G[a](e.buttons[D.RIGHT_TRIGGER].value)}}var e,f,g,h,i,j,k,l,m,n,o=a.navigation,p=a.container,q=o.getCamera(),r=1,s=0,t=.1,u=5.5,v=6,w=v,x={},y=new THREE.Clock(!0),z={seedURN:!1,objectSet:!0,viewport:!0,renderOptions:{environment:!1,ambientOcclusion:!1,toneMap:{exposure:!1},appearance:!1}},A=2,B=75,C=-45,D={SOUTH_BTN:0,EAST_BTN:1,WEST_BTN:2,NORTH_BTN:3,LEFT_SHOULDER:4,RIGHT_SHOULDER:5,LEFT_TRIGGER:6,RIGHT_TRIGGER:7,SOUTH_DPAD:13,EAST_DPAD:15,WEST_DPAD:14,NORTH_DPAD:12,LEFT_STICK_BUTTON:10,RIGHT_STICK_BUTTON:11},E={LEFT_STICK_X:0,LEFT_STICK_Y:1,RIGHT_STICK_X:2,RIGHT_STICK_Y:3},F=function(){},G={};for(var H in D)D.hasOwnProperty(H)&&(G[D[H]]=F);var I=function(){};this.activate=function(b){var c=a.model.getBoundingBox().size();r=Math.max(Math.min(Math.min(c.x,c.y),c.z)/10,1e-4),e=navigator.getGamepads()[0],h=new Autodesk.Viewing.Private.ViewerState(a),i=[],j=0,n=b,M(b)},this.deactivate=function(){n=null,h=null},this.update=function(a,d){if(d&&(q=d),a=y.getDelta(),e=navigator.getGamepads()[0],f>-1){var h=(new Date).getTime();h-f>g&&K()}if(e&&(l=a*A*r*w,q.isPerspective||o.toPerspective(),e&&b())){q.dirty=!0,k&&(m=q.position.z);var i=q.target.clone().sub(q.position),j=i.length();i.multiplyScalar(1/j);var n=i.clone().cross(q.up).normalize();if(Math.abs(e.axes[E.LEFT_STICK_Y])>t){var p=i.clone().multiplyScalar(-e.axes[E.LEFT_STICK_Y]*l);q.position.add(p),q.target.add(p)}if(Math.abs(e.axes[E.LEFT_STICK_X])>t){var s=n.clone().multiplyScalar(e.axes[E.LEFT_STICK_X]*l);q.position.add(s),q.target.add(s)}var u=new THREE.Quaternion,v=i;if(Math.abs(e.axes[E.RIGHT_STICK_Y])>t){var x=q.clone(),z=i.clone();u.setFromAxisAngle(n,-e.axes[E.RIGHT_STICK_Y]*l/2),z.applyQuaternion(u),x.up.applyQuaternion(u);var B=x.worldup.clone(),C=z.angleTo(B),D=THREE.Math.degToRad(5);C>=D&&C<=Math.PI-D&&(v=i.clone().applyQuaternion(u),q.up.applyQuaternion(u))}var F=new THREE.Quaternion;Math.abs(e.axes[E.RIGHT_STICK_X])>t&&(F.setFromAxisAngle(q.worldup,-e.axes[E.RIGHT_STICK_X]*l/2),v.applyQuaternion(F),q.up.applyQuaternion(F)),c(),k&&(q.position.z=m),v.multiplyScalar(j),q.target.copy(q.position).add(v)}return q};var J=function(a,b,c,d,e){Autodesk.Viewing.Private.HudMessage.displayMessage(p,a,c,d,e),b>0?(f=(new Date).getTime(),g=b):(f=-1,g=0)},K=function(){Autodesk.Viewing.Private.HudMessage.dismiss(),f=-1},L=function(a){K();var b;switch(a){case"up":b=k?"Vertical Lock Mode":"Fly mode";break;case"left":break;case"right":break;case"down":}var c={msgTitleKey:"View Orientation Drag Mode Toggled",messageKey:"View Orientation Drag Mode Toggled",messageDefaultValue:b};J(c,2e3)},M=function(a){switch(a){case"headtracker":G[D.SOUTH_BTN]=W,G[D.SOUTH_DPAD]=N,G[D.NORTH_DPAD]=_,G[D.WEST_BTN]=Z,G[D.LEFT_SHOULDER]=O,G[D.RIGHT_SHOULDER]=P,G[D.LEFT_TRIGGER]=Q,G[D.RIGHT_TRIGGER]=S,G[D.RIGHT_STICK_BUTTON]=X,G[D.LEFT_STICK_BUTTON]=Y;break;default:G[D.SOUTH_BTN]=W,G[D.EAST_BTN]=T,G[D.WEST_BTN]=Z,G[D.NORTH_BTN]=$,G[D.SOUTH_DPAD]=N,G[D.WEST_DPAD]=U,G[D.EAST_DPAD]=V,G[D.NORTH_DPAD]=_,G[D.LEFT_SHOULDER]=O,G[D.RIGHT_SHOULDER]=P,G[D.LEFT_TRIGGER]=R,G[D.RIGHT_TRIGGER]=S,G[D.RIGHT_STICK_BUTTON]=X,G[D.LEFT_STICK_BUTTON]=Y}},N=function(){a.navigation.setRequestHomeView(!0),a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},O=function(){k?m+=-e.buttons[D.LEFT_SHOULDER].pressed*l:q.translateY(-e.buttons[D.LEFT_SHOULDER].pressed*l)},P=function(){k?m+=e.buttons[D.RIGHT_SHOULDER].pressed*l:q.translateY(e.buttons[D.RIGHT_SHOULDER].pressed*l)},Q=function(b){if(b>t){if(.5==b)return void a.explode(0);s=b;var c=s;c>1&&(c=1),0>c&&(c=0),a.explode(c)}else a.explode(0)},R=function(a){if(a>t){if(.5==a)return q.fov=B,void(x[D.LEFT_TRIGGER]=!1);q.fov=C*a+B}else q.fov=B},S=function(a){if(a>t){if(.5==a)return void(x[D.RIGHT_TRIGGER]=!1);w=-(u*a)+v}else w=v},T=function(){var a=h.getState(z);i.push(a),stderr("Savepoint created.")},U=function(){i.length&&(j--,0>j&&(j=i.length-1),h.restoreState(i[j]))},V=function(){i.length&&(j++,j>=i.length&&(j=0),h.restoreState(i[j]))},W=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0));"headtracker"==n&&q.updateMatrixWorld(),b?a.impl.selector.toggleSelection(b.dbId,b.model):a.impl.selector.clearSelection()},X=function(){a.impl.selector.clearSelection()},Y=function(){a.showAll(),a.impl.selector.clearSelection(),a.explode(0)},Z=function(){var b=a.impl.hitTestViewport(new THREE.Vector3(0,0,0),!1);b&&(b.dbId in a.getHiddenNodes()?a.show(b.dbId):a.hide(b.dbId))},$=function(){a.getPropertyPanel(!0).setVisible(!a.getPropertyPanel(!0).isVisible())},_=function(){k=!k,k&&(m=q.position.z),L("up")};I()}}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionExtension,Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.load=function(){var a=this,b=this.viewer;if(this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(b),b.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],b.getToolbar){var c=b.getToolbar(!0);c?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),b.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var d=[{keycodes:[Autodesk.Viewing.theHotkeyManager.KEYCODES.ESCAPE],onRelease:function(){return a.enableSectionTool(!1)}}];return Autodesk.Viewing.theHotkeyManager.pushHotkeys(this.HOTKEYS_ID,d),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.unload=function(){var a=this.viewer;return Autodesk.Viewing.theHotkeyManager.popHotkeys(this.HOTKEYS_ID),this.destroyUI(),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.isActive=function(){return this.tool.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var a=this.sectionStyle||"X";this.setSectionStyle(a,!0)}return this.isActive()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.getSectionStyle=function(){return this.sectionStyle},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.setSectionStyle=function(a,b){if(-1===this.supportedStyles.indexOf(a))return!1;var c=this.isActive(),d=this.sectionStyle!==a||!b;return this.sectionStyle=a,c&&d?this.tool.setSection(a):c||(this.enableSectionTool(!0),d?this.tool.setSection(a):this.tool.attachControl(!0)),!0},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.enableSectionTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!a&&c?(b.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0):!1},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.onReset=function(){this.tool.resetSection()},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createUI=function(){var a=this.viewer,b=Autodesk.Viewing.UI;this.sectionToolButton=new b.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var c=a.getToolbar(!1),d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID),e=d.getControl("toolbar-resetTool");e?d.addControl(this.sectionToolButton,{index:d.indexOf(e.getId())}):d.addControl(this.sectionToolButton,{index:0})},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState();c===f.Button.State.INACTIVE?(a.setState(f.Button.State.ACTIVE),d.enableSectionTool(!0),this instanceof f.ComboButton==!1?d.tool.setSection(b):d.tool.attachControl(!0)):c===f.Button.State.ACTIVE&&(a.setState(f.Button.State.INACTIVE),d.enableSectionTool(!1)),d.sectionStyle=b}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){return a.subVectors(b,c),a.lengthSq()<d}}(),b=new THREE.Vector3(1,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),h=e.autocam.getWorldRightVector(),i=e.autocam.getWorldUpVector(),j=e.autocam.getWorldFrontVector(),k=1e-4;a(i,b,k)?d.sectionYButton.setIcon("adsk-icon-plane-x"):a(i,g,k)?d.sectionYButton.setIcon("adsk-icon-plane-z"):d.sectionYButton.setIcon("adsk-icon-plane-y"),a(h,f,k)?d.sectionXButton.setIcon("adsk-icon-plane-y"):a(h,g,k)?d.sectionXButton.setIcon("adsk-icon-plane-z"):d.sectionXButton.setIcon("adsk-icon-plane-x"),a(j,b,k)?d.sectionZButton.setIcon("adsk-icon-plane-x"):a(j,f,k)?d.sectionZButton.setIcon("adsk-icon-plane-y"):d.sectionZButton.setIcon("adsk-icon-plane-z"),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var d=this,e=this.viewer,f=Autodesk.Viewing.UI,g=this.sectionXButton=new f.Button("toolbar-sectionTool-x");g.setToolTip("Add X plane"),g.setIcon("adsk-icon-plane-x"),g.onClick=b(g,"X"),a.addControl(g);var h=this.sectionYButton=new f.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane"),h.setIcon("adsk-icon-plane-y"),h.onClick=b(h,"Y"),a.addControl(h);var i=this.sectionZButton=new f.Button("toolbar-sectionTool-z");i.setToolTip("Add Z plane"),i.setIcon("adsk-icon-plane-z"),i.onClick=b(i,"Z"),a.addControl(i);var j=this.sectionBoxButton=new f.Button("toolbar-sectionTool-box");j.setToolTip("Add box"),j.setIcon("adsk-icon-box"),j.onClick=b(j,"BOX"),a.addControl(j),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)},Autodesk.Viewing.Extensions.Section.SectionExtension.prototype.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(c&&this.sectionToolButton){var d=c.getControl("toolbar-inspectSubMenu");d?d.removeControl(this.sectionToolButton.getId()):c.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.Section.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(a,b){function c(){F||(s=new THREE.TransformControls(u.camera,u.canvas,"transrotate"),s.addEventListener("change",e),s.setSnap(Math.PI/2,Math.PI/36),t=new THREE.TransformControls(u.camera,u.canvas,"translate"),t.addEventListener("change",e),void 0===u.overlayScenes[D]&&u.createOverlayScene(D),u.addOverlay(D,s),u.addOverlay(D,t),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.addEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.addEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!0)}function d(){F&&(u.removeOverlay(D,s),s.removeEventListener("change",e),s=null,u.removeOverlay(D,t),t.removeEventListener("change",e),t=null,u.removeOverlayScene(D),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,f),a.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,g),a.removeEventListener(Autodesk.Viewing.HIDE_EVENT,g),a.removeEventListener(Autodesk.Viewing.SHOW_EVENT,g),F=!1)}function e(){u.invalidate(!1,!1,!0)}function f(){s&&s.update(),t&&t.update()}function g(){1===A.length&&(k(!0),f(),i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)))}function h(a){return a.color||new THREE.Color(16777215)}function i(a){init_three_triangulator(),init_three_intersector();var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b);var c=new THREE.Object3D;c.name="section",u.sceneAfter.add(c);var d=new THREE.Object3D;c.add(d);var e=new THREE.Object3D;c.add(e);var f=Autodesk.Viewing.Private,g=f.Intersector.makePlaneBasis(a),i=(new THREE.Matrix4).getInverse(g),j=u.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),k=u.matman().findMaterial(null,j);k.transparent=!0,k.depthTest=!0,k.polygonOffset=!0,k.polygonOffsetFactor=-1,k.polygonOffsetUnits=1;var l=new THREE.Box3,m=u.getVisibleBounds(!0),n=(25e-6*m.size().length(),u.modelQueue().getModels());n.forEach(function(b){var c=b.getData().instanceTree;if(c){var j=b.getFragmentList();c.enumNodeChildren(b.getRootId(),function(b){if(!c.isNodeHidden(b)&&!c.isNodeOff(b)){var m,n=[];if(c.enumNodeFragments(b,function(b){j.getWorldBounds(b,l),f.Intersector.intersectBoxPlane(a,l)&&(m=j.getVizmesh(b),m.geometry&&(m.geometry.is2d||m.geometry.isLines||m.material.cutplanes&&f.Intersector.intersectMeshPlane(a,m,n)))},!1),n.length){var o=new THREE.Box3;f.Intersector.convertToPlaneCoords(g,n,o);var p=new f.VertexBufferBuilder(!1,8*n.length),q=h(m.material),r=0|.25*q.r*255.5,s=0|.25*q.g*255.5,t=0|.25*q.b*255.5,v=4278190080|t<<16|s<<8|r,w=new f.Triangulator.ContourSet(n,o);w.snapEdges(),w.sanitizeEdges(),w.stitchContours();for(var x=0;x<w.contours.length;x++)for(var y=w.contours[x],r=0|255.5*Math.random(),s=0|255.5*Math.random(),t=0|255.5*Math.random(),z=(y[0]===y[y.length-1],1);z<y.length;z++){var A=w.pts[y[z-1]],B=w.pts[y[z]];p.addSegment(A.x,A.y,B.x,B.y,0,.02,v,b,0)}var C={mesh:p.toMesh()};BufferGeometryUtils.meshToGeometry(C);var D=C.geometry;D.streamingDraw=!0,D.streamingIndex=!0;var E=new THREE.Mesh(D,k);E.matrix.copy(i),E.matrixAutoUpdate=!1,E.frustumCulled=!1,e.add(E);var F=new f.Triangulator.TriangulatedSurface(w);if(F.indices.length){for(var G=new THREE.BufferGeometry,H=new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)H[3*x]=F.pts[x].x,H[3*x+1]=F.pts[x].y,H[3*x+2]=0;G.addAttribute("position",new THREE.BufferAttribute(H,3));for(var I=m.material.packedNormals,J=I?new Uint16Array(2*F.pts.length):new Float32Array(3*F.pts.length),x=0;x<F.pts.length;x++)if(I){var K=.5*(0/Math.PI+1),L=1;J[2*x]=65535*K|0,J[2*x+1]=65535*L|0}else J[3*x]=0,J[3*x+1]=0,J[3*x+2]=1;G.addAttribute("normal",new THREE.BufferAttribute(J,I?2:3)),I&&(G.attributes.normal.bytesPerItem=2,G.attributes.normal.normalize=!0);var M=new Uint16Array(F.indices.length);M.set(F.indices),G.addAttribute("index",new THREE.BufferAttribute(M,1)),G.streamingDraw=!0,G.streamingIndex=!0;var N=u.matman().cloneMaterial(m.material);N.packedNormals=I,N.cutplanes=null,N.side=THREE.FrontSide,N.depthTest=!0,N.map=null,N.bumpMap=null,N.normalMap=null,N.alphaMap=null,N.specularMap=null,N.transparent=!1,N.depthWrite=!0,N.hatchPattern=!0,N.needsUpdate=!0;var O=(m.material.id+2)*Math.PI*.125,P=Math.tan(O);N.hatchParams=new THREE.Vector2(P,10),N.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,N.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=N.prismType&&(N.defines={},N.defines[N.prismType.toUpperCase()]="","PrismWood"==N.prismType&&(N.defines.NO_UVW=""));var Q=new THREE.Mesh(G,N);Q.matrix.copy(i),Q.matrixAutoUpdate=!1,Q.dbId=b,Q.fragId=n.fragId,d.add(Q)}}}},!0)}})}function j(a,b){var c,d=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal);if(b){var e=a.projectPoint(b.max),f=a.projectPoint(b.min),g=d.clone().inverse();e.applyQuaternion(g),f.applyQuaternion(g);var h=(new THREE.Vector3).subVectors(e,f);c=new THREE.PlaneBufferGeometry(h.x,h.y)}else{b=u.getVisibleBounds();var h=2*b.getBoundingSphere().radius;c=new THREE.PlaneBufferGeometry(h,h)}var i=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),j=new I.SectionMesh(c,i,a),k=a.projectPoint(b.center());j.position.copy(k),j.quaternion.multiply(d);for(var l=Autodesk.Viewing.Private.LightPresets[u.currentLightPreset()].bgColorGradient,m="rgb("+(255-l[0])+","+(255-l[1])+","+(255-l[2])+")",n=new THREE.LineBasicMaterial({color:m,linewidth:1,depthTest:!1}),o=j.geometry.getAttribute("position"),p=0;p<H.length;p++){var c=new THREE.Geometry;c.vertices.push((new THREE.Vector3).fromArray(o.array,H[p][0]*o.itemSize),(new THREE.Vector3).fromArray(o.array,H[p][1]*o.itemSize));var q=new THREE.Line(c,n);j.add(q),j.outlines.push(q)}return j}function k(a){l(function(b){if(b instanceof I.SectionMesh)if(b.connectivity.length>0){for(var c=(new THREE.Matrix4).getInverse(b.matrixWorld),d=new THREE.Vector3,e=b.geometry.getAttribute("position"),f=0;f<e.length/e.itemSize;f++){var g=b.connectivity[f];null!==J(b.plane,g[0],g[1],d)&&(d.applyMatrix4(c),e.setXYZ(f,d.x,d.y,d.z))}e.needsUpdate=!0,b.geometry.computeBoundingBox(),b.geometry.computeBoundingSphere();for(var f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}else if(a){var i=u.getVisibleBounds(),j=2*i.getBoundingSphere().radius,d=b.plane.projectPoint(i.center());b.geometry=new THREE.PlaneBufferGeometry(j,j),b.position.copy(d);for(var e=b.geometry.getAttribute("position"),f=0;f<b.outlines.length;f++){var h=b.outlines[f];h.geometry.vertices[0].fromArray(e.array,H[f][0]*e.itemSize),h.geometry.vertices[1].fromArray(e.array,H[f][1]*e.itemSize),h.geometry.verticesNeedUpdate=!0}}})}function l(a){for(var b=0;b<z.length;b++)z[b].traverse(a)}function m(){l(function(a){a instanceof I.SectionMesh&&a.update()}),1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),u.setCutPlanes(A)}function n(a){for(var b=0;b<z.length;b++)z[b].visible=a;y!==a&&e(),y=a}function o(b){b&&A.length>0&&(1===A.length&&i((new THREE.Plane).setComponents(A[0].x,A[0].y,A[0].z,A[0].w)),a.setCutPlanes(A)),n(b)}function p(a,b){a.attach(b),a.setPosition(b.position),a.visible=!0}function q(a){var b=u.api.navigation.getEyeVector();b.dot(a)>0&&a.negate();var c=new THREE.Group,d=new THREE.Plane(a,0),e=j(d,null);c.add(e),A.push(e.planeVec),z.push(c),u.addOverlay(D,c),p(s,e),s.showRotationGizmos(!0),B=s.getPicker(),m()}function r(){for(var a=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],b=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],c=new THREE.Group,d=u.getVisibleBounds(),e=d.center(),f=new THREE.Box3(d.min,e),g=[],h=[],i=0;i<a.length;i++){var k=new THREE.Plane(a[i],-1*e.dot(a[i]));if(g.push(k),i>2){var l=k.orthoPoint(f.max),n=k.orthoPoint(f.min),o=(new THREE.Vector3).subVectors(l,n);k.constant-=o.length()}var q=j(k,f);c.add(q),h.push(q),A.push(q.planeVec)}for(var i=0;i<h.length;i++)for(var q=h[i],r=b[i],v=0;v<r.length;v++){for(var w=[],x=r[v],y=0;y<x.length;y++)w.push(g[x[y]]);q.connectivity.push(w)}z.push(c),u.addOverlay(D,c),p(s,z[0].children[0]),p(t,z[0]),s.showRotationGizmos(!1),B=s.getPicker().concat(t.getPicker()),m()}var s,t,u=a.impl,v=["section"],w=!1,x=!1,y=!0,z=[],A=[],B=[],C="",D="gizmo",E=null,F=!1,G=!0,H=[[0,1],[1,3],[3,2],[2,0]],I=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var J=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h){a.set(e.normal.x,e.normal.y,e.normal.z,f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z);var i=a.determinant();if(0===i)return null;b.crossVectors(f.normal,g.normal).multiplyScalar(-e.constant),c.crossVectors(g.normal,e.normal).multiplyScalar(-f.constant),d.crossVectors(e.normal,f.normal).multiplyScalar(-g.constant);var j=h||new THREE.Vector3;return j.copy(b).add(c).add(d).divideScalar(i)}}(),K=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster,d=u.camera;return function(e,f,g){var h=u.canvas.getBoundingClientRect(),i=(e.clientX-h.left)/h.width*2-1,j=2*-((e.clientY-h.top)/h.height)+1;d.isPerspective?(a.set(i,j,.5),a.unproject(d),c.set(d.position,a.sub(d.position).normalize())):(a.set(i,j,-1),a.unproject(d),b.set(0,0,-1),c.set(a,b.transformDirection(d.matrixWorld)));var k=c.intersectObjects(f,g);return k[0]?k[0]:null}}();this.isActive=function(){return w},this.setSection=function(a){switch(this.clearSection(),a){case"X":var b=new THREE.Vector3(1,0,0);q(b);break;case"Y":var b=new THREE.Vector3(0,1,0);q(b);break;case"Z":var b=new THREE.Vector3(0,0,1);q(b);break;case"BOX":r()}C=a},this.clearSection=function(){for(s&&s.detach(),t&&t.detach();A.length>0;)A.pop();for(;z.length>0;){var a=z.pop();u.removeOverlay(D,a)}var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),u.setCutPlanes()},this.isPlaneOn=function(){return y},this.showPlane=function(a){n(a)},this.attachControl=function(a){a?(p(s,z[0].children[0]),s.highlight(),"BOX"===C&&p(t,z[0])):(s.detach(),t.detach())},this.resetSection=function(){this.setSection(C)},this.getNames=function(){return v},this.getName=function(){return v[0]},this.register=function(){},this.deregister=function(){this.clearSection(),d()},this.activate=function(a){c(),w=!0,x=!1,G=!0,A=A||[],o(!0)},this.deactivate=function(a){w=!1,x=!1;var b=u.sceneAfter.getObjectByName("section");b&&u.sceneAfter.remove(b),o(!1),u.setCutPlanes(),s.detach(),t.detach()},this.update=function(a){return!1},this.handleSingleClick=function(a,b){var c=a.pointers?a.pointers[0]:a,d=K(c,z[0].children);return d&&(p(s,d.object),s.highlight(),e()),!1},this.handleDoubleClick=function(a,b){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(a){return!1},this.handleKeyDown=function(a,b){return!1},this.handleKeyUp=function(a,b){return!1},this.handleWheelInput=function(a){return!1},this.handleButtonDown=function(a,b){return x=!0,t.onPointerDown(a)?!0:s.onPointerDown(a)},this.handleButtonUp=function(a,b){return x=!1,t.onPointerUp(a)?!0:s.onPointerUp(a)},this.handleMouseMove=function(a){if(x){if(t.onPointerMove(a))return m(),s.update(),!0;if(s.onPointerMove(a))return m(),k(),!0}if("touch"!==a.pointerType){var b=a.pointers?a.pointers[0]:a,c=K(b,z[0].children);c&&(G=!1);var d=G||c||K(b,B,!0)?!0:!1;s.visible=d,t.visible=void 0!==t.object&&d,n(d)}return t.onPointerHover(a)?!0:s.onPointerHover(a)},this.handleGesture=function(a){switch(a.type){case"dragstart":return E="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===E?this.handleMouseMove(a):!1;case"dragend":return"drag"===E?(E=null,this.handleButtonUp(a,0)):!1}return!1},this.handleBlur=function(a){return!1},this.handleResize=function(){},this.handlePressHold=function(a){return!0}},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef=function(){this.studyNode,this.constraintsNode=-1,this.constraintNodes=[],this.loadsNode=-1,this.loadNodes=[],this.resultsNode=-1,this.bodyNode=-1,this.resultTypes={},this.resultGroups={},this.simNodes=[],this.modelNodes=[],this.modalAnalysis=!1,this.modalResults={},this.modelStructurePanel=null,this.simExt=null},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateResult=function(a,b){this.resultTypes[b]=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateResultGroup=function(a,b){this.resultGroups[b]=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.associateModalResult=function(a,b){var c=[];if(c=this.modalResults[a],null==c){var d=[];d.push(b),c=d}else c.push(b);this.modalResults[a]=c},Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef.prototype.reset=function(){this.studyNode=-1,this.constraintsNode=-1,this.constraintNodes=[],this.loadsNode=-1,this.loadNodes=[],this.resultsNode=-1,this.bodyNode=-1,this.resultTypes={},this.resultGroups={},this.simNodes=[],this.modelNodes=[],this.modalAnalysis=!1,this.modalResults={},this.modelStructurePanel=null},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel=function(a){this.viewer=a,this.simDef=null,Autodesk.Viewing.UI.DockingPanel.call(this,a.container,"Simulation-Panel","Simulation Results")},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype=Object.create(Autodesk.Viewing.UI.DockingPanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel,Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.initialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.initialize.call(this);var a=this;this.kPanelExpandedHeight=420,this.kPanelCollapsedHeight=35,this.container.classList.add("measurePanel"),this.container.dockRight=!0,this.container.style.minWidth="380px",this.container.style.width="380px",this.container.style.minHeight=this.kPanelCollapsedHeight+"px",this.container.style.height=this.kPanelExpandedHeight+"px",this.container.style.maxHeight=this.kPanelExpandedHeight+"px",this.container.style.top="150px",this.container.style.left="220px",this.container.style.position="absolute",this.legend=document.createElement("div"),this.container.appendChild(this.legend),this.resultsGroup=document.createElement("select"),this.resultsGroup.classList.add("simulation-resultGroup"),this.resultsGroup.style.position="absolute",this.resultsGroup.style.top="42px",this.resultsGroup.style.width="180px",this.resultsGroup.style.left="5px",this.resultsGroup.style.color="black",this.resultsGroup.style.height="22px",this.resultsGroup.style.border="1px",this.resultsGroup.addEventListener("change",function(b){a.viewer.hide(a.simDef.resultsNode),0==a.simDef.modalAnalysis?a.fillResultTypes(a.resultsGroup.value):a.fillModalResultTypes(a.resultsGroup.value),setTimeout(function(){a.setSimObjectsVisibility()},100)}),this.legend.appendChild(this.resultsGroup),
this.resultTypes=document.createElement("select"),this.resultTypes.classList.add("simulation-resultTypes"),this.resultTypes.style.position="absolute",this.resultTypes.style.top="42px",this.resultTypes.style.width="180px",this.resultTypes.style.left="190px",this.resultTypes.style.color="black",this.resultTypes.style.height="22px",this.resultTypes.style.border="1px",this.resultTypes.addEventListener("change",function(b){a.viewer.hide(a.simDef.resultsNode),a.setSimObjectsVisibility()}),this.legend.appendChild(this.resultTypes),this.colorScale=document.createElement("div"),this.colorScale.classList.add("simulation-colorscale"),this.colorScale.style.width="210px",this.colorScale.style.height="20px",this.colorScale.style.margin="5px",this.colorScale.style.position="absolute",this.colorScale.style.left="-70px",this.colorScale.style.top="170px",this.colorScale.style.backgroundRepeat="repeat",this.legend.appendChild(this.colorScale),this.colorScaleTopText=document.createElement("div"),this.colorScaleTopText.style.position="absolute",this.colorScaleTopText.style.left="52px",this.colorScaleTopText.style.top="73px",this.colorScaleTopText.innerHTML="- 3333",this.legend.appendChild(this.colorScaleTopText),this.colorScaleBottomText=document.createElement("div"),this.colorScaleBottomText.style.position="absolute",this.colorScaleBottomText.style.left="52px",this.colorScaleBottomText.style.top="281px",this.colorScaleBottomText.innerHTML="- 3333",this.legend.appendChild(this.colorScaleBottomText),this.line=document.createElement("hr"),this.line.style.position="absolute",this.line.style.top="300px",this.line.style.width="100%",this.line.style.borderTop="1px solid black",this.legend.appendChild(this.line),this.tbl=document.createElement("table"),this.tblBody=document.createElement("tbody"),this.tbl.appendChild(this.tblBody),this.legend.appendChild(this.tbl),this.tbl.style.position="absolute",this.tbl.style.top="310px",this.tbl.style.margin="5px"},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setSimulationDef=function(a){function b(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function c(a){var c=b(a.properties,"Name");f.setTitle(c)}function d(a,b,c){}function e(a){var c=b(a.properties,"Elements"),d=b(a.properties,"Nodes");f.cellTextElements2.nodeValue=c,f.cellTextNodes2.nodeValue=d}this.simDef=a;var f=this,g=Number(this.simDef.studyNode);this.viewer.getProperties(g,c,d);var h;if(h=1==this.simDef.modalAnalysis?Autodesk.Viewing.i18n.translate("Modal Frequencies"):Autodesk.Viewing.i18n.translate("Static Stress"),this.rowType)this.cellTextType2.nodeValue=h;else{this.rowType=document.createElement("tr"),this.cellType1=document.createElement("td"),this.cellTextType1=document.createTextNode(Autodesk.Viewing.i18n.translate("Analysis Type")),this.cellType1.appendChild(this.cellTextType1),this.cellType1.style.width="180px",this.cellType2=document.createElement("td"),this.cellTextType2=document.createTextNode(h),this.cellType2.appendChild(this.cellTextType2),this.rowType.appendChild(this.cellType1),this.rowType.appendChild(this.cellType2),this.tblBody.appendChild(this.rowType),this.rowNodes=document.createElement("tr"),this.cellNodes1=document.createElement("td"),this.cellTextNodes1=document.createTextNode(Autodesk.Viewing.i18n.translate("Nodes")),this.cellNodes1.appendChild(this.cellTextNodes1),this.cellNodes2=document.createElement("td");var i="1872";this.cellTextNodes2=document.createTextNode(i),this.cellNodes2.appendChild(this.cellTextNodes2),this.rowNodes.appendChild(this.cellNodes1),this.rowNodes.appendChild(this.cellNodes2),this.tblBody.appendChild(this.rowNodes),this.rowElements=document.createElement("tr"),this.cellElements1=document.createElement("td"),this.cellTextElements1=document.createTextNode(Autodesk.Viewing.i18n.translate("Elements")),this.cellElements1.appendChild(this.cellTextElements1),this.cellElements2=document.createElement("td");var j="1084";this.cellTextElements2=document.createTextNode(j),this.cellElements2.appendChild(this.cellTextElements2),this.rowElements.appendChild(this.cellElements1),this.rowElements.appendChild(this.cellElements2),this.tblBody.appendChild(this.rowElements),this.rowMin=document.createElement("tr"),this.cellMin1=document.createElement("td"),this.cellTextMin1=document.createTextNode(Autodesk.Viewing.i18n.translate("Min")),this.cellMin1.appendChild(this.cellTextMin1),this.cellMin2=document.createElement("td");var k="0.000E+02 MPa";this.cellTextMin2=document.createTextNode(k),this.cellMin2.appendChild(this.cellTextMin2),this.rowMin.appendChild(this.cellMin1),this.rowMin.appendChild(this.cellMin2),this.tblBody.appendChild(this.rowMin),this.rowMax=document.createElement("tr"),this.cellMax1=document.createElement("td"),this.cellTextMax1=document.createTextNode(Autodesk.Viewing.i18n.translate("Max")),this.cellMax1.appendChild(this.cellTextMax1),this.cellMax2=document.createElement("td");var l="5.117E+02 MPa";this.cellTextMax2=document.createTextNode(l),this.cellMax2.appendChild(this.cellTextMax2),this.rowMax.appendChild(this.cellMax1),this.rowMax.appendChild(this.cellMax2),this.tblBody.appendChild(this.rowMax)}if(this.resultsGroup.options.length=0,0==this.simDef.modalAnalysis){var m=Object.keys(a.resultGroups);if(!m||0==m.length)return void this.setSimObjectsVisibility();for(var n=0;n<m.length;n++){var o=document.createElement("option");o.value=m[n];var p=a.resultGroups[m[n]];o.setAttribute("data-i18n",p),o.textContent=Autodesk.Viewing.i18n.translate(p),this.resultsGroup.add(o)}}else{var m=Object.keys(a.modalResults);if(!m||0==m.length)return void this.setSimObjectsVisibility();for(var n=0;n<m.length;n++){var o=document.createElement("option");o.value=m[n];var p=m[n];o.setAttribute("data-i18n",p),o.textContent=Autodesk.Viewing.i18n.translate(p),this.resultsGroup.add(o)}}this.resultsGroup.options.length<=1?(this.resultsGroup.disabled=!0,this.resultsGroup.style.webkitAppearance="none",this.resultsGroup.style.mozappearance="none",this.resultsGroup.style.MozAppearance="none",this.resultsGroup.style.appearance="none"):(this.resultsGroup.disabled=!1,this.resultsGroup.style.webkitAppearance="",this.resultsGroup.style.mozappearance="",this.resultsGroup.style.MozAppearance="",this.resultsGroup.style.appearance="");var f=this,q=f.viewer.model;q.getObjectTree(function(b){f.instanceTree=b,0==f.simDef.modalAnalysis?f.fillResultTypes(f.resultsGroup.value):f.fillModalResultTypes(f.resultsGroup.value),setTimeout(function(){a.simExt.showResultsDlg(!0),a.simExt.applySettings(),f.setSimObjectsVisibility()},500)});var r=Number(this.simDef.resultsNode);this.viewer.getProperties(r,e,d)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.processNodes=function(a,b){function c(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function d(a,b){function d(d){var e=d.properties,g=c(d.properties,"A1C6011B-E1A6-4ADF-975D-A0003C592F87");if(g){var i=!0;if("SIM_CONSTRAINTS"==g)h.constraintsNode=a;else if("SIM_CONSTRAINT"==g)h.constraintNodes.push(a);else if("SIM_LOADS"==g)h.loadsNode=a;else if("SIM_LOAD"==g)h.loadNodes.push(a);else if("SIM_RESULTS_SCALAR_PLOT"==g)0==h.modalAnalysis?h.associateResult(c(e,"Name"),a):h.associateModalResult(c(e,"Name"),a);else if("SIM_RESULTS_GROUP"==g)0==h.modalAnalysis&&h.associateResultGroup(c(e,"Name"),a);else if("SIM_RESULTS"==g)h.resultsNode=a,f.viewer.hide(a);else if("SIM_STUDY"==g){h.studyNode=a;var j=c(d.properties,"Study Type");"SimCaseModalFrequencies"==j&&(h.modalAnalysis=!0)}1==i&&h.simNodes.push(a)}else h.modelNodes.push(a);b()}function e(a,c,d){b()}a&&f.viewer&&f.viewer.getProperties(a,d,e)}function e(){g.length>0?d(g.shift(),e):(Autodesk.Viewing.Extensions.Fusion360Sim.$getObjectTree=function(){return h},b(h))}var f=this,g=[],h=this.simDef;h?h.reset():h=new Autodesk.Viewing.Extensions.Fusion360Sim.SimulationDef,a.enumNodeChildren(a.getRootId(),function(a){g.push(a)},!0),e()},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.initModel=function(a,b){if(this.viewer){var c=this;c.processNodes(a,function(a){a.simExt=b,c.setSimulationDef(a)}),c.addEventListener(c.viewer,Autodesk.Viewing.ISOLATE_EVENT,function(a){if(-1!=c.simDef.loadsNode&&c.hightlightNode(c.simDef.loadsNode,!1),-1!=c.simDef.constraintsNode&&c.hightlightNode(c.simDef.constraintsNode,!1),c.simDef.modelNodes&&c.simDef.modelNodes.length>0)for(var b=0;b<c.simDef.modelNodes.length;++b)c.hightlightNode(c.simDef.modelNodes[b],!1);var d=a.nodeIdArray;d&&(0==d.length?c.setSimObjectsVisibility():1==d.length&&c.isModelNode(d[0])&&(c.simDef.loadsNode&&c.viewer.hide(c.simDef.loadsNode),c.simDef.constraintsNode&&c.viewer.hide(c.simDef.constraintsNode),c.simDef.resultsNode&&c.viewer.hide(c.simDef.resultsNode)))})}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.hightlightNode=function(a,b){var c=this.viewer.impl,d=this,e=!1,f=this.viewer.model.getData().instanceTree;if(f){var g=f.getRootId();e="number"==typeof a&&a===g}e&&b||d.instanceTree.enumNodeFragments(a,function(a){c.highlightFragment(d.viewer.model,a,b,!0)},!0)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.fillResultTypes=function(a){function b(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function c(a){function c(a){var c=b(a.properties,"Result group");if(c===f){var d=document.createElement("option");d.value=a.dbId;var g=e.simDef.resultTypes[a.dbId];d.setAttribute("data-i18n",g),d.textContent=Autodesk.Viewing.i18n.translate(g),e.resultTypes.add(d),e.resultTypes.options.length<=1?(e.resultTypes.disabled=!0,e.resultTypes.style.webkitAppearance="none",e.resultTypes.style.mozappearance="none",e.resultTypes.style.MozAppearance="none",e.resultTypes.style.appearance="none"):(e.resultTypes.disabled=!1,e.resultTypes.style.webkitAppearance="",e.resultTypes.style.mozappearance="",e.resultTypes.style.MozAppearance="",e.resultTypes.style.appearance="")}}for(var f=b(a.properties,"Result group"),g=Object.keys(e.simDef.resultTypes),h=0;h<g.length;h++){var i=Number(g[h]);e.viewer.getProperties(i,c,d)}}function d(a,b,c){}var e=this;e.resultTypes.options.length=0;var f=Number(a);e.viewer.getProperties(f,c,d)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.fillModalResultTypes=function(a){function b(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function c(a){var c=b(a.properties,"Result type");if(c===f){var d=document.createElement("option");d.value=a.dbId;var g=b(a.properties,"Mode"),h=g;d.setAttribute("data-i18n",h),d.textContent=h,e.resultTypes.add(d),e.simDef.associateResult(h,a.dbId),e.resultTypes.options.length<=1?(e.resultTypes.disabled=!0,e.resultTypes.style.webkitAppearance="none",e.resultTypes.style.mozappearance="none",e.resultTypes.style.MozAppearance="none",e.resultTypes.style.appearance="none"):(e.resultTypes.disabled=!1,e.resultTypes.style.webkitAppearance="",e.resultTypes.style.mozappearance="",e.resultTypes.style.MozAppearance="",e.resultTypes.style.appearance="")}}function d(a,b,c){}var e=this;e.resultTypes.options.length=0;for(var f=a,g=e.simDef.modalResults[f],h=0;h<g.length;h++){var i=Number(g[h]);e.viewer.getProperties(i,c,d)}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.uninitialize=function(){Autodesk.Viewing.UI.DockingPanel.prototype.uninitialize.call(this),this.viewer=null},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setTitle=function(a,b){a||(a="Simulations",b=b||{},b.localizeTitle=!0),Autodesk.Viewing.UI.DockingPanel.prototype.setTitle.call(this,a,b)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setModelNodesVisible=function(a){if(this.simDef.modelNodes&&this.simDef.modelNodes.length>0)for(var b=0;b<this.simDef.modelNodes.length;b++){var c=this.simDef.modelNodes[b],d=!1,e=this.viewer.model.getData().instanceTree;if(e){var f=e.getRootId();d="number"==typeof c&&c===f}d||(a?this.viewer.show(c):this.viewer.hide(c))}},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isModelNode=function(a){return this.simDef.modelNodes&&0!=this.simDef.modelNodes.length?-1!==this.simDef.modelNodes.indexOf(a):!1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setNodeVisibility=function(a,b){b?this.viewer.show(a):this.viewer.hide(a)},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimLoadNode=function(a){return this.simDef.loadNodes?-1!==this.simDef.loadNodes.indexOf(a):!1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimConstraintNode=function(a){return this.simDef.constraintNodes?-1!==this.simDef.constraintNodes.indexOf(a):!1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimLoadsNode=function(a){return-1==this.simDef.loadsNode?!1:this.simDef.loadsNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimConstraintsNode=function(a){return-1==this.simDef.constraintsNode?!1:this.simDef.constraintsNode==a},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimStudyNode=function(a){return this.simDef.studyNode?this.simDef.studyNode==a:!1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.isSimResultsNode=function(a){return this.simDef.resultsNode?this.simDef.resultsNode==a:!1},Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel.prototype.setSimObjectsVisibility=function(a){function b(a,b){for(var c=0;c<a.length;++c){var d=a[c];if(d.displayName===b)return d.displayValue}return null}function c(a){var c=b(a.properties,"Minimal value"),d=b(a.properties,"Maximal value"),f=b(a.properties,"Scale reversed"),g=b(a.properties,"Unit");e.cellTextMin2.nodeValue=c+" "+g,e.cellTextMax2.nodeValue=d+" "+g;var h=b(a.properties,"Lower referential value"),i=b(a.properties,"Upper referential value");"True"==f?(e.colorScale.style.transform="rotate(90deg)",e.colorScale.style.moztransform="rotate(90deg)",e.colorScale.style.webkittransform="rotate(90deg)"):(e.colorScale.style.transform="rotate(-90deg)",e.colorScale.style.moztransform="rotate(-90deg)",e.colorScale.style.webkittransform="rotate(-90deg)"),e.colorScaleTopText.innerHTML="- "+i+" "+g,e.colorScaleBottomText.innerHTML="- "+h+" "+g}function d(a,b,c){}if(!this.resultTypes||0==this.resultTypes.options.length)return this.setModelNodesVisible(!0),void this.simDef.simExt.showResultsDlg(!1);var e=this;this.viewer.hide(this.simDef.resultsNode);var f=Number(this.resultTypes.value);if(a){var g=!1,h=this.viewer.model.getData().instanceTree;if(h){var i=h.getRootId();g="number"==typeof a&&a===i}this.setModelNodesVisible(!1);var j=(this.isSimLoadNode(a),this.isSimLoadsNode(a),this.isSimConstraintNode(a),this.isSimConstraintsNode(a),this.isSimStudyNode(a));this.viewer.hide(this.simDef.resultsNode),this.viewer.show(f),this.simDef.loadsNode&&this.viewer.show(this.simDef.loadsNode),this.simDef.constraintsNode&&this.viewer.show(this.simDef.constraintsNode),g||j||h.enumNodeFragments(a,function(a){e.viewer.impl.highlightFragment(e.viewer.model,a,!0,!0)},!0)}else this.setModelNodesVisible(!1),this.viewer.show(f),-1!=this.simDef.loadsNode&&this.viewer.show(this.simDef.loadsNode),-1!=this.simDef.constraintsNode&&this.viewer.show(this.simDef.constraintsNode);var e=this;e.viewer.getProperties(f,c,d)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a.viewer,b,c),this.viewer=a.viewer,this.ext=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.setGallery=function(a){this.simGalleryPanel=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.initialize=function(){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.initialize.call(this)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimResultsNode=function(a){return this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode?this.simGalleryPanel.simDef.resultsNode==a:!1},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isSimStudyNode=function(a){return this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.studyNode?this.simGalleryPanel.simDef.studyNode==a:!1},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.isModelNode=function(a){return this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length?-1!==this.simGalleryPanel.simDef.modelNodes.indexOf(a):!1},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.shouldInclude=function(a){return this.isSimStudyNode(a)?!1:!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.simGalleryPanel.setModelNodesVisible(!0),this.simGalleryPanel.hightlightNode(a,!0),this.simGalleryPanel.simDef.loadsNode&&this.viewer.hide(this.simGalleryPanel.simDef.loadsNode),this.simGalleryPanel.simDef.constraintsNode&&this.viewer.hide(this.simGalleryPanel.simDef.constraintsNode),this.simGalleryPanel.simDef.resultsNode&&this.viewer.hide(this.simGalleryPanel.simDef.resultsNode)},Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel=function(a,b,c){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.call(this,a.viewer,b,c),this.viewer=a.viewer,this.ext=a,this.container.style.left="350px"},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype=Object.create(Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel,Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.setGallery=function(a){this.simGalleryPanel=a},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.isSimResultsNode=function(a){return this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.resultsNode?this.simGalleryPanel.simDef.resultsNode==a:!1},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.isModelNode=function(a){return this.simGalleryPanel&&this.simGalleryPanel.simDef&&this.simGalleryPanel.simDef.modelNodes&&0!=this.simGalleryPanel.simDef.modelNodes.length?1==this.simGalleryPanel.simDef.modelNodes.indexOf(a):!1},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.shouldInclude=function(a){return this.isSimResultsNode(a)||this.isModelNode(a)?!1:!0},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.onClick=function(a,b){Autodesk.Viewing.Extensions.ViewerModelStructurePanel.prototype.onClick.call(this,a,b),this.simGalleryPanel.setSimObjectsVisibility(a)},Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel.prototype.expandStudyNode=function(){this.simGalleryPanel.simDef.studyNode&&this.tree.setCollapsed(this.simGalleryPanel.simDef.studyNode,!1)},AutodeskNamespace("Autodesk.Viewing.Extensions.Fusion360Sim"),Autodesk.Viewing.Extensions.Fusion360Sim.Simulation=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.simButton=null,this.useSetupPanel=!0,this.useModelPanel=!0,b&&(void 0!==b.useSetupPanel&&(this.useSetupPanel=b.useSetupPanel),void 0!==b.useModelPanel&&(this.useModelPanel=b.useModelPanel))},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.constructor=Autodesk.Viewing.Extensions.Fusion360Sim.Simulation,Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.load=function(){var a=this,b=this.viewer;a.galleryPanel=new Autodesk.Viewing.Extensions.Fusion360Sim.GalleryPanel(a.viewer),a.viewer.addPanel(a.galleryPanel),a.simButton=new Autodesk.Viewing.UI.Button("toolbar-simulation"),a.simButton.setToolTip("Simulation Results"),a.simButton.onClick=function(b){var c=a.galleryPanel.isVisible();a.galleryPanel.setVisible(!c),a.simButton.setState(c?Autodesk.Viewing.UI.Button.State.INACTIVE:Autodesk.Viewing.UI.Button.State.ACTIVE)},a.simButton.setIcon("toolbar-simulationIcon"),b.settingsTools.addControl(a.simButton,{index:1}),this.hideLines=b.prefs.get("lineRendering"),this.ghosting=b.prefs.get("ghosting"),this.ambientShadow=b.prefs.get("ambientShadows"),this.antialiazing=b.prefs.get("antialiasing"),this.lightPreset=b.prefs.get("lightPreset");var c=function(){b.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c);var d=a.viewer.model;d.getObjectTree(function(b){a.galleryPanel.initModel(b,a),a.useModelPanel&&a.initModelBrowser(),a.useSetupPanel&&a.initSetupPanel()})};this.initIfLoaded=function(){var b=a.viewer.model;b&&b.isLoadDone&&b.getObjectTree(function(b){setTimeout(function(){a.galleryPanel.initModel(b,a),a.useModelPanel&&a.initModelBrowser(),a.useSetupPanel&&a.initSetupPanel()},100)})};var d=a.viewer.model;return d&&d.isLoadDone?(b.addEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.initIfLoaded),d.getObjectTree(function(b){setTimeout(function(){a.galleryPanel.initModel(b,a),a.useModelPanel&&a.initModelBrowser(),a.useSetupPanel&&a.initSetupPanel()},100)})):b.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c),!0},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.unload=function(){return this.viewer.removeEventListener(Autodesk.Viewing.MODEL_ROOT_LOADED_EVENT,this.initIfLoaded),this.showResultsDlg(!1),this.viewer.settingsTools.removeControl(this.simButton),this.viewer.removePanel(this.galleryPanel),this.galleryPanel.uninitialize(),this.viewer.hideLines(!this.hideLines),this.viewer.setGhosting(this.ghosting),this.viewer.setQualityLevel(this.ambientShadow,this.antialiazing),this.viewer.setLightPreset(this.lightPreset),this.modelStructurePanel&&this.viewer.setModelStructurePanel(null),this.simSetupPanel&&(this.simSetupPanel.setVisible(!1),this.viewer.removePanel(this.simSetupPanel),this.simSetupPanel.uninitialize()),!0},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.initSetupPanel=function(){var a=this;setTimeout(function(){a.simSetupButton=new Autodesk.Viewing.UI.Button("toolbar-simulation-setup"),a.simSetupButton.setToolTip("Simulation Setup"),a.simSetupButton.onClick=function(b){var c=a.simSetupPanel.isVisible();a.simSetupPanel.setVisible(!c),a.simSetupButton.setState(c?Autodesk.Viewing.UI.Button.State.INACTIVE:Autodesk.Viewing.UI.Button.State.ACTIVE)},a.simSetupButton.setIcon("toolbar-simulationSetupIcon"),a.viewer.settingsTools.addControl(a.simSetupButton,{index:0}),a.simSetupPanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimSetupPanel(a,Autodesk.Viewing.i18n.translate("Simulation Setup Loading"),a.options),a.simSetupPanel.setGallery(a.galleryPanel),a.viewer.addPanel(a.simSetupPanel),a.viewer.model&&a.viewer.model.getObjectTree(function(b){a.simSetupPanel.setModel(b,Autodesk.Viewing.i18n.translate("Simulation Setup"))})},100)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.initModelBrowser=function(){var a=this;setTimeout(function(){a.modelStructurePanel=new Autodesk.Viewing.Extensions.Fusion360Sim.SimModelStructurePanel(a,"Simulation Model Structure Loading",a.options),a.viewer.setModelStructurePanel(a.modelStructurePanel),a.modelStructurePanel.setGallery(a.galleryPanel)},100)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.showResultsDlg=function(a){this.simButton.setState(a?Autodesk.Viewing.UI.Button.State.ACTIVE:Autodesk.Viewing.UI.Button.State.INACTIVE),this.simButton.setVisible(a),this.galleryPanel.setVisible(a)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.applySettings=function(a){this.viewer.hideLines(!1),this.viewer.setGhosting(!1),this.viewer.setQualityLevel(!1,!0),this.viewer.setLightPreset(4)},Autodesk.Viewing.Extensions.Fusion360Sim.Simulation.prototype.simData=function(){return this.galleryPanel.simDef},Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Fusion360.Simulation",Autodesk.Viewing.Extensions.Fusion360Sim.Simulation),function(a,b){"use strict";var c,d=a.document;c=function(){var c,e,f,g,h,i,j,k,l,m,n,o,p,q={},r={},s=!1,t={ENTER:13,ESC:27,SPACE:32},u=[];return r={buttons:{holder:'<nav class="alertify-buttons">{{buttons}}</nav>',submit:'<button type="submit" class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',ok:'<button class="alertify-button alertify-button-ok" id="alertify-ok">{{ok}}</button>',cancel:'<button class="alertify-button alertify-button-cancel" id="alertify-cancel">{{cancel}}</button>'},input:'<div class="alertify-text-wrapper"><input type="text" class="alertify-text" id="alertify-text"></div>',message:'<p class="alertify-message">{{message}}</p>',log:'<article class="alertify-log{{class}}">{{message}}</article>'},p=function(){var a,c,e=!1,f=d.createElement("fakeelement"),g={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"};for(a in g)if(f.style[a]!==b){c=g[a],e=!0;break}return{type:c,supported:e}},c=function(a){return d.getElementById(a)},q={labels:{ok:"OK",cancel:"Cancel"},delay:5e3,buttonReverse:!1,buttonFocus:"ok",transition:b,addListeners:function(a){var b,c,i,j,k,l="undefined"!=typeof f,m="undefined"!=typeof e,n="undefined"!=typeof o,p="",q=this;b=function(b){return"undefined"!=typeof b.preventDefault&&b.preventDefault(),i(b),"undefined"!=typeof o&&(p=o.value),"function"==typeof a&&("undefined"!=typeof o?a(!0,p):a(!0)),!1},c=function(b){return"undefined"!=typeof b.preventDefault&&b.preventDefault(),i(b),"function"==typeof a&&a(!1),!1},i=function(a){q.hide(),q.unbind(d.body,"keyup",j),q.unbind(g,"focus",k),l&&q.unbind(f,"click",b),m&&q.unbind(e,"click",c)},j=function(a){var d=a.keyCode;(d===t.SPACE&&!n||n&&d===t.ENTER)&&b(a),d===t.ESC&&m&&c(a)},k=function(a){n?o.focus():!m||q.buttonReverse?f.focus():e.focus()},this.bind(g,"focus",k),this.bind(h,"focus",k),l&&this.bind(f,"click",b),m&&this.bind(e,"click",c),this.bind(d.body,"keyup",j),this.transition.supported||this.setFocus()},bind:function(a,b,c){"function"==typeof a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)},handleErrors:function(){if("undefined"!=typeof a.onerror){var b=this;return a.onerror=function(a,c,d){b.error("["+a+" on line "+d+" of "+c+"]",0)},!0}return!1},appendButtons:function(a,b){return this.buttonReverse?b+a:a+b},build:function(a){var b="",c=a.type,d=a.message,e=a.cssClass||"";switch(b+='<div class="alertify-dialog">',b+='<a id="alertify-resetFocusBack" class="alertify-resetFocus" href="#">Reset Focus</a>',"none"===q.buttonFocus&&(b+='<a href="#" id="alertify-noneFocus" class="alertify-hidden"></a>'),"prompt"===c&&(b+='<div id="alertify-form">'),b+='<article class="alertify-inner">',b+=r.message.replace("{{message}}",d),"prompt"===c&&(b+=r.input),b+=r.buttons.holder,b+="</article>","prompt"===c&&(b+="</div>"),b+='<a id="alertify-resetFocus" class="alertify-resetFocus" href="#">Reset Focus</a>',b+="</div>",c){case"confirm":b=b.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.ok)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"prompt":b=b.replace("{{buttons}}",this.appendButtons(r.buttons.cancel,r.buttons.submit)),b=b.replace("{{ok}}",this.labels.ok).replace("{{cancel}}",this.labels.cancel);break;case"alert":b=b.replace("{{buttons}}",r.buttons.ok),b=b.replace("{{ok}}",this.labels.ok)}return l.className="alertify alertify-"+c+" "+e,k.className="alertify-cover",b},close:function(a,b){var c,d,e=b&&!isNaN(b)?+b:this.delay,f=this;this.bind(a,"click",function(){c(a)}),d=function(a){a.stopPropagation(),f.unbind(this,f.transition.type,d),m.removeChild(this),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")},c=function(a){"undefined"!=typeof a&&a.parentNode===m&&(f.transition.supported?(f.bind(a,f.transition.type,d),a.className+=" alertify-log-hide"):(m.removeChild(a),m.hasChildNodes()||(m.className+=" alertify-logs-hidden")))},0!==b&&setTimeout(function(){c(a)},e)},dialog:function(a,b,c,e,f){j=d.activeElement;var g=function(){m&&null!==m.scrollTop&&k&&null!==k.scrollTop||g()};if("string"!=typeof a)throw new Error("message must be a string");if("string"!=typeof b)throw new Error("type must be a string");if("undefined"!=typeof c&&"function"!=typeof c)throw new Error("fn must be a function");return this.init(),g(),u.push({type:b,message:a,callback:c,placeholder:e,cssClass:f}),s||this.setup(),this},extend:function(a){if("string"!=typeof a)throw new Error("extend method must have exactly one paramter");return function(b,c){return this.log(b,a,c),this}},hide:function(){var a,b=this;u.splice(0,1),u.length>0?this.setup(!0):(s=!1,a=function(c){c.stopPropagation(),b.unbind(l,b.transition.type,a)},this.transition.supported?(this.bind(l,this.transition.type,a),l.className="alertify alertify-hide alertify-hidden"):l.className="alertify alertify-hide alertify-hidden alertify-isHidden",k.className="alertify-cover alertify-cover-hidden",j.focus())},init:function(){d.createElement("nav"),d.createElement("article"),d.createElement("section"),null==c("alertify-cover")&&(k=d.createElement("div"),k.setAttribute("id","alertify-cover"),k.className="alertify-cover alertify-cover-hidden",d.body.appendChild(k)),null==c("alertify")&&(s=!1,u=[],l=d.createElement("section"),l.setAttribute("id","alertify"),l.setAttribute("style","z-index : 999999999"),l.className="alertify alertify-hidden",d.body.appendChild(l)),null==c("alertify-logs")&&(m=d.createElement("section"),m.setAttribute("id","alertify-logs"),m.className="alertify-logs alertify-logs-hidden",d.body.appendChild(m)),d.body.setAttribute("tabindex","0"),this.transition=p()},log:function(a,b,c){var d=function(){m&&null!==m.scrollTop||d()};return this.init(),d(),m.className="alertify-logs",this.notify(a,b,c),this},notify:function(a,b,c){var e=d.createElement("article");e.className="alertify-log"+("string"==typeof b&&""!==b?" alertify-log-"+b:""),e.innerHTML=a,m.appendChild(e),setTimeout(function(){e.className=e.className+" alertify-log-show"},50),this.close(e,c)},set:function(a){var b;if("object"!=typeof a&&a instanceof Array)throw new Error("args must be an object");for(b in a)a.hasOwnProperty(b)&&(this[b]=a[b])},setFocus:function(){o?(o.focus(),o.select()):i.focus()},setup:function(a){var d,j=u[0],k=this;s=!0,d=function(a){a.stopPropagation(),k.setFocus(),k.unbind(l,k.transition.type,d)},this.transition.supported&&!a&&this.bind(l,this.transition.type,d),l.innerHTML=this.build(j),g=c("alertify-resetFocus"),h=c("alertify-resetFocusBack"),f=c("alertify-ok")||b,e=c("alertify-cancel")||b,i="cancel"===q.buttonFocus?e:"none"===q.buttonFocus?c("alertify-noneFocus"):f,o=c("alertify-text")||b,n=c("alertify-form")||b,"string"==typeof j.placeholder&&""!==j.placeholder&&(o.value=j.placeholder),a&&this.setFocus(),this.addListeners(j.callback)},unbind:function(a,b,c){"function"==typeof a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}},{alert:function(a,b,c){return q.dialog(a,"alert",b,"",c),this},confirm:function(a,b,c){return q.dialog(a,"confirm",b,"",c),this},extend:q.extend,init:q.init,log:function(a,b,c){return q.log(a,b,c),this},prompt:function(a,b,c,d){return q.dialog(a,"prompt",b,c,d),this},success:function(a,b){return q.log(a,"success",b),
this},error:function(a,b){return q.log(a,"error",b),this},set:function(a){q.set(a)},hide:function(a){q.hide(a)},labels:q.labels,debug:q.handleErrors}},"undefined"==typeof a.alertify&&(a.alertify=new c)}(this),AutodeskNamespace("Autodesk.Viewing"),AutodeskNamespace("Autodesk.Viewing.Private");var auth=null,VIEWING_URL,ACM_SESSION_URL,OSS_URL,PROTEIN_ROOT=null,PRISM_ROOT=null,LOCALIZATION_REL_PATH="",LMV_VIEWER_VERSION="@build_version@",LMV_VIEWER_PATCH="@build_number@",LMV_BUILD_TYPE="@build_type@",LMV_RESOURCE_VERSION=null,LMV_RESOURCE_ROOT="";!function(){var a=Autodesk.Viewing.Private;a.env=null,a.logger=null,a.docItemId=null,a.token={getAccessToken:null,tokenRefreshInterval:null},a.memoryOptimizedLoading=!0,a.GPU_MEMORY_LIMIT=268435456,a.GPU_OBJECT_LIMIT=1e4;var b=isAndroidDevice()||isIOSDevice();b?(a.FRAGS_PERSISTENT_COUNT=2e3,a.FRAGS_PERSISTENT_MAX_COUNT=15e4,a.GEOMS_COUNT_LIMIT=8e3):(a.FRAGS_PERSISTENT_COUNT=1e4,a.FRAGS_PERSISTENT_MAX_COUNT=8e5,a.GEOMS_COUNT_LIMIT=3e5),a.onDemandLoading=!1,a.cullGeometryOnLoading=a.onDemandLoading,a.pageOutGeometryEnabled=a.onDemandLoading,a.PAGEOUT_SUCCESS=0,a.PAGEOUT_FAIL=1,a.PAGEOUT_NONE=2,a.PAGEOUT_PERCENTAGE=.35,a.GEOMS_PAGEOUT_COUNT=a.GEOMS_COUNT_LIMIT*a.PAGEOUT_PERCENTAGE,a.assets=[],a.offline=!1,a.offlineResourcePrefix=null;var c={local:{LOGGING:"rtc-dev.api.autodesk.com",RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},dev:{LOGGING:"rtc-dev.api.autodesk.com",RTC:["https://rtc-dev.api.autodesk.com:443","https://lmv.autodesk.com:443"]},stg:{LOGGING:"rtc-stg.api.autodesk.com",RTC:["https://rtc-stg.api.autodesk.com:443","https://lmv.autodesk.com:443"]},prod:{LOGGING:"rtc.api.autodesk.com",RTC:["https://rtc.api.autodesk.com:443","https://lmv.autodesk.com:443"]}},d={local:"",dev:"https://viewing-dev.api.autodesk.com",stg:"https://viewing-staging.api.autodesk.com",prod:"https://viewing.api.autodesk.com"},e={local:"",dev:"https://developer-dev.api.autodesk.com",stg:"https://developer-stg.api.autodesk.com",prod:"https://developer.api.autodesk.com"},f={ACM:"/oss-ext/v1/acmsessions",OSS:"/oss/v1",VIEWING:"/viewingservice/v1",VIEWING2:"/derivativeservice/v2"};a.EnvironmentConfigurations={Local:{ROOT:"",VIEWING:"",ACM:"",OSS:"",LMV:c.local},Development:{ROOT:d.dev,VIEWING:d.dev+f.VIEWING,ACM:e.dev+f.ACM,OSS:e.dev+f.OSS,LMV:c.dev},Staging:{ROOT:d.stg,VIEWING:d.stg+f.VIEWING,ACM:e.stg+f.ACM,OSS:e.stg+f.OSS,LMV:c.stg},Production:{ROOT:d.prod,VIEWING:d.prod+f.VIEWING,ACM:e.prod+f.ACM,OSS:e.prod+f.OSS,LMV:c.prod},AutodeskDevelopment:{ROOT:e.dev,VIEWING:e.dev+f.VIEWING,ACM:e.dev+f.ACM,OSS:e.dev+f.OSS,LMV:c.dev},AutodeskStaging:{ROOT:e.stg,VIEWING:e.stg+f.VIEWING,ACM:e.stg+f.ACM,OSS:e.stg+f.OSS,LMV:c.stg},AutodeskProduction:{ROOT:e.prod,VIEWING:e.prod+f.VIEWING,ACM:e.prod+f.ACM,OSS:e.prod+f.OSS,LMV:c.prod},DevelopmentV2:{ROOT:d.dev,VIEWING:d.dev+f.VIEWING2,ACM:e.dev+f.ACM,OSS:e.dev+f.OSS,LMV:c.dev},StagingV2:{ROOT:d.stg,VIEWING:d.stg+f.VIEWING2,ACM:e.stg+f.ACM,OSS:e.stg+f.OSS,LMV:c.stg},ProductionV2:{ROOT:d.prod,VIEWING:d.prod+f.VIEWING2,ACM:e.prod+f.ACM,OSS:e.prod+f.OSS,LMV:c.prod},AutodeskDevelopmentV2:{ROOT:e.dev,VIEWING:e.dev+f.VIEWING2,ACM:e.dev+f.ACM,OSS:e.dev+f.OSS,LMV:c.dev},AutodeskStagingV2:{ROOT:e.stg,VIEWING:e.stg+f.VIEWING2,ACM:e.stg+f.ACM,OSS:e.stg+f.OSS,LMV:c.stg},AutodeskProductionV2:{ROOT:e.prod,VIEWING:e.prod+f.VIEWING2,ACM:e.prod+f.ACM,OSS:e.prod+f.OSS,LMV:c.prod}},a.initializeEnvironmentVariable=function(b){var c;if(b&&b.env&&(c=b.env),c||(c=a.getParameterByName("env")),b&&b.offlineResourcePrefix&&(a.offlineResourcePrefix=b.offlineResourcePrefix),b&&b.offline&&"true"===b.offline&&(a.offline=!0),!c)switch(window.location.hostname){case"viewing-dev.api.autodesk.com":c="Development";break;case"viewing-staging.api.autodesk.com":c="Staging";break;case"viewing.api.autodesk.com":c="Production";break;case"developer-dev.api.autodesk.com":c="AutodeskDevelopment";break;case"developer-stg.api.autodesk.com":c="AutodeskStaging";break;case"developer.api.autodesk.com":c="AutodeskProduction";break;case"localhost.autodesk.com":c="Local";break;case"":c="Local";break;case"127.0.0.1":c="Local";break;default:c="AutodeskProduction"}console.log("Host name : "+window.location.hostname),console.log("Environment initialized as : "+c),a.env=c},a.initializeServiceEndPoints=function(b){var c=a.env,d=a.EnvironmentConfigurations[c];VIEWING_URL=d.VIEWING,ACM_SESSION_URL=d.ACM,OSS_URL=d.OSS;var e=["viewer3D.js","viewer3D.min.js","firefly.js","firefly.min.js"];b&&b.hasOwnProperty("libraryName")&&e.push(b.libraryName);for(var f,g,h=0;h<e.length;h++){var i=a.getScript(e[h]);g=i?i.src:"";var j=g.indexOf(e[h]);if(j>=0){f=g.substr(0,j);break}}LMV_RESOURCE_VERSION="v"+LMV_VIEWER_VERSION;var k=a.getParameterByNameFromPath("v",g);k&&k.length&&k!=LMV_RESOURCE_VERSION?(console.warn("Version string mismatch between requested and actual version: "+k+" vs. "+LMV_RESOURCE_VERSION+". Using "+k),LMV_RESOURCE_VERSION=k):k&&k.length||(LMV_RESOURCE_VERSION=null,console.info("No viewer version specified, will implicitly use "+LMV_VIEWER_VERSION)),LMV_RESOURCE_ROOT=f||LMV_RESOURCE_ROOT},a.refreshCookie=function(b,c,d){var e=new XMLHttpRequest;if(e.onload=c,e.onerror=d,e.ontimeout=d,0===a.env.indexOf("Autodesk")){var f=a.EnvironmentConfigurations[a.env].ROOT;e.open("POST",f+"/utility/v1/settoken",!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.withCredentials=!0,e.send("access-token="+b),_isIE11&&(a.accessToken=b)}else{var b={oauth:{token:b}};e.open("POST",VIEWING_URL+"/token",!0),e.setRequestHeader("Content-Type","application/json"),e.withCredentials=!0,e.send(JSON.stringify(b))}},a.initializeAuth=function(b,c){function d(e,f){g=e,a.refreshCookie(g,a.token.tokenRefreshInterval?null:b);var h=f-60;0>=h&&(h=f),a.token.tokenRefreshInterval=1e3*h,setTimeout(function(){c.getAccessToken(d)},a.token.tokenRefreshInterval)}var e=c?c.shouldInitializeAuth:void 0;if(void 0===e){var f=a.getParameterByName("auth");e="false"!==f.toLowerCase()}if("Local"==a.env||!e)return setTimeout(b,0),auth=!1;auth=!0;var g;return c&&c.getAccessToken?(a.token.getAccessToken=c.getAccessToken,g=c.getAccessToken(d),"string"==typeof g&&g&&a.refreshCookie(g,b)):c&&c.accessToken?(g=c.accessToken,a.refreshCookie(g,b)):(g=a.getParameterByName("accessToken"),g||(g="QYNrnn1T44Jy3wWMKJaT6RHmMgg=",console.log("Warning : no access token is provided. Use built in token : "+g)),a.refreshCookie(g,b)),auth},a.initializeLogger=function(b){var c={endpoint:a.EnvironmentConfigurations[a.env].LMV.LOGGING,eventCallback:b?b.eventCallback:void 0};a.logger=new a.Logger(c)},a.initializeProtein=function(){if((!ENABLE_DEBUG||"Local"!=a.env||auth)&&!a.offline){var b=new XMLHttpRequest;b.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=protein",!0),b.responseType="json",b.onload=function(a){var c=b.response.url;c&&c.length&&(c=c.replace("http://","https://"),PROTEIN_ROOT=c+"/",stderr("Protein root is: "+PROTEIN_ROOT))},b.send();var c=new XMLHttpRequest;c.open("GET","https://raas-assets.autodesk.com/StaticContent/BaseAddress?family=prism",!0),c.responseType="json",c.onload=function(a){var b=c.response.url;b&&b.length&&(b=b.replace("http://","https://"),PRISM_ROOT=b+"/",stderr("Prism root is: "+PRISM_ROOT))},c.send()}},a.getAuthObject=function(){return auth},a.getParameterByName=function(b){return a.getParameterByNameFromPath(b,window.location.href)},a.getParameterByNameFromPath=function(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":decodeURIComponent(e[1].replace(/\+/g," "))},a.urlIsApiViewingOrDev=function(a){return-1!==a.indexOf("developer.api.autodesk.com")||-1!==a.indexOf("developer-stg.api.autodesk.com")||-1!==a.indexOf("developer-dev.api.autodesk.com")||-1!==a.indexOf("viewing.api.autodesk.com")||-1!==a.indexOf("viewing-staging.api.autodesk.com")||-1!==a.indexOf("viewing-dev.api.autodesk.com")},a.getDemoDocumentURN=function(){var b;switch(a.env){case"Development":b="urn:dXJuOmFkc2suYTM2MGJldGFkZXY6ZnMuZmlsZTplbnRlcnByaXNlLmxtdnRlc3QuRFM1YTczMFFUYmYwMDIyZDA3NTFhYmE5MjZlZDZkMjJlZDY0P3ZlcnNpb249MQ==";break;case"Staging":b="urn:dXJuOmFkc2suczM6ZGVyaXZlZC5maWxlOlZpZXdpbmdTZXJ2aWNlVGVzdEFwcC91c2Vycy9NaWNoYWVsX0hhbicvTU0zNTAwQXNzZW1ibHkuZHdm";break;case"Production":b="FIXME";break;default:b="https://lmv.rocks/viewer/data/gears/output/bubble.json"}return b},a.setLanguage=function(a,b){var c={lng:a,resGetPath:"res/locales/__lng__/__ns__.json",ns:{namespaces:["allstrings"],defaultNs:"allstrings"},fallbackLng:"en",debug:!1};LOCALIZATION_REL_PATH="res/locales/"+a+"/",Autodesk.Viewing.i18n.init(c,function(a){Autodesk.Viewing.i18n.localize(),b&&b()})},a.initializeLocalization=function(b){var c=b&&b.language||navigator.language,d=c.split("-");c=d.length>1?d[0].toLowerCase()+"-"+d[1].toUpperCase():d[0].toLowerCase();var e=["cs","de","en","es","fr","it","ja","ko","pl","pt-BR","ru","tr","zh-HANS","zh-HANT"];-1===e.indexOf(c)&&(c=c.indexOf("zh-CN")>-1?"zh-HANS":c.indexOf("zh-TW")>-1?"zh-HANT":d.length>1&&e.indexOf(d[0])>-1?d[0]:"en"),a.setLanguage(c)},a.initializeUserInfo=function(b){b&&b.userInfo&&(a.setUserName(b.userInfo.name),b.comment2Token&&(a.comment2Token=b.comment2Token))},a.getScript=function(a){a=a.toLowerCase();var b=document.getElementsByTagName("SCRIPT");if(b&&b.length>0)for(var c=0;c<b.length;++c)if(b[c].src&&-1!==b[c].src.toLowerCase().indexOf(a))return b[c];return null},a.getResourceUrl=function(a){var b=LMV_RESOURCE_VERSION;return LMV_RESOURCE_ROOT+a+(b?"?v="+b:"")},a.loadDependency=function(b,c,d){if("undefined"==typeof window[b]){var e=document.createElement("SCRIPT");e.src=a.getResourceUrl(c),document.head.appendChild(e),d&&(e.onload=d)}else d&&d()},Autodesk.Viewing.Initializer=function(b,c){function d(){THREE.warn=function(){stderr.apply(stderr,arguments)},init_three_dds_loader(),a.initializeLogger(b),a.initializeAuth(c,b),a.initializeLocalization(b),a.initializeUserInfo(b)}a.WEBGL_HELP_LINK=b?b.webGLHelpLink:null,a.initializeEnvironmentVariable(b),a.initializeServiceEndPoints(b),a.initializeProtein(),a.initWorkerScript(),a.loadDependency("THREE","three.min.js",d)}}();